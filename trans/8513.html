<html>
<head>
<title>Risk and Return over Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一段时间内的风险和回报</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/risk-and-return-over-time-e92ea93f5684?source=collection_archive---------4-----------------------#2021-01-13">https://medium.datadriveninvestor.com/risk-and-return-over-time-e92ea93f5684?source=collection_archive---------4-----------------------#2021-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b4b0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Python执行蒙特卡罗模拟来预测被动投资的可能结果。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/15ccbaa185957780487aa3bc20ad9bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k8iCcA9fXlrGEwtG"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@loicleray?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Loic Leray</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="8823" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">要旨</strong></h2><p id="5870" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi ml translated"><span class="l mm mn mo bm mp mq mr ms mt di">我们</span>将对一个由50%债券和50%股票组成的投资组合进行多次蒙特卡洛模拟。通过模拟，我们将计算作为投资时间的函数的可能的回报和赔钱的机会。我们将会看到，坚持投资更长的时间将会减少我们失败的机会，从而降低我们的风险。</p><h2 id="bbbe" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">基础知识</strong></h2><p id="3b8f" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">股市没有免费的午餐。投资一只预期回报(即利润)较高的股票应该伴随着较高的风险。或者从另一个角度来看，我们可以说<em class="mu">高风险应该得到高预期回报</em>。风险较高的资产可以被视为价格波动较大的资产，这意味着它的价值可能会大幅上升，也可能会暴跌。但是，如果我们将长期坚持投资，我们应该较少受到这种波动的影响。</p><h2 id="03ae" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">那个什么</strong></h2><p id="470a" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">我们将选择一个由50%的股票(由遵循标准普尔500的ETF执行)和50%的债券(同样由遵循债券指数的ETF执行)组成的投资组合。查看历史数据，我们将通过随机获取两种资产的多个月变化来构建一个实现。这样，我们可以创建多个模拟的“历史”(或未来)，同时保持我们的资产之间的相关性(或缺乏相关性)。对于给定的时间跨度(即1年到15年)，我们将看到可能的回报，以及我们最终将比开始时赚得更少的可能性。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="1f8b" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">跳水</strong></h2><p id="735a" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">让我们从加载所有需要的库开始:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="80ed" class="kw kx iq nd b gy nh ni l nj nk"><strong class="nd ir"># inviting our friends to the party:<br/></strong>import pandas as pd<br/>import pandas_datareader.data as web<br/>import datetime<br/>import matplotlib<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import numpy as np<br/>import scipy</span><span id="0bfb" class="kw kx iq nd b gy nl ni l nj nk">plt.style.use('seaborn-paper')<br/>matplotlib.rc('xtick', labelsize=16)<br/>matplotlib.rc('ytick', labelsize=16)</span></pre><p id="1df7" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">现在我们可以编写一个函数，从Yahoo Finances导入ETF的历史数据。我们将只查看调整后的收盘价(标记为“Adj Close”)。我们还希望只查看月度数据，最后我们将把价格标准化为我们时间历史开始时的价值，这样我们就可以直接看到我们的回报。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="08ea" class="kw kx iq nd b gy nh ni l nj nk">def <strong class="nd ir">importasset</strong>(name,start_date,end_date,freq='BM'): <br/>  <strong class="nd ir">""" <br/>  Imports a ticker from Yahoo, normalizes is and down samples it to   every month <br/>  """ <br/>  </strong>asset=web.DataReader(name, 'yahoo', start_date, end_date)<br/>  asset_close= asset.drop(asset.columns[0:5], axis=1).asfreq(freq)<br/>  asset_normlized=asset_close['Adj Close']/asset_close['Adj Close'][0]<br/>  asset_normlized.fillna(method='ffill', inplace=True)<br/>  return(asset_normlized)</span></pre><p id="2ce9" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">我们还将编写一个函数，多次调用"<strong class="lu ir"> <em class="mu"> importasset </em> </strong>"函数，从而构建一个包含我们感兴趣的股票的价格历史的表:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="879c" class="kw kx iq nd b gy nh ni l nj nk">def <strong class="nd ir">makestockmarket</strong>(list,start_date,end_date,freq='BM'): <br/>  <strong class="nd ir">""" <br/>  Function that takes a list of imported assets and builds a single table. <br/>  example symbols_list = ['VTSAX', 'VBTLX']<br/>  "freq" is the import frequency and we will use "Business Month (BM)<br/>  """</strong><br/>  d = {}<br/>  for ticker in list:<br/>    d[ticker] = importasset(ticker, start_date,end_date,freq)<br/>  pan = pd.DataFrame.from_dict(d)<br/>  return(pan)</span></pre><p id="d4a4" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">现在，让我们使用我们的新函数加载VFIAX(股票)和VBTLX(债券)ETF的数据，并绘制它们从2005年到2020年底的曲线。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="2caa" class="kw kx iq nd b gy nh ni l nj nk">tick=['VFIAX','VBTLX']<br/>stocks=makestockmarket(tick,datetime.datetime(2005, 1, 1),datetime.datetime(2020, 12, 30)) <br/>plt.figure(figsize=(10,6))<br/>plt.plot(stocks,linewidth=3)<br/>plt.xlabel('Time',fontsize=18)<br/>plt.ylabel('Return',fontsize=18)<br/>plt.legend(['Stocks','Bonds'],fontsize=18) <br/>plt.show</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/d8c78875220a7b2053f41aeea7f78b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*gAm99e_9nq-Dvo0ltx400g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Stock (VFIAX) and bonds (VBTLX) return from 2005 to 2020</figcaption></figure><p id="2375" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">接下来，我们将编写模拟“新”市场历史的函数。我们将使用通常所说的“<em class="mu">引导法</em>”，从我们的市场数据中随机选择每月的变化。从模拟市场中，我们将通过股票和债券的配置生成一个投资组合。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="bd21" class="kw kx iq nd b gy nh ni l nj nk">def <strong class="nd ir">simulateportfolio</strong>(stock,days,aloc):<br/><strong class="nd ir">  """<br/>  Takes a stock market history data and simulates a new portfolio with "aloc" allocation over "days" time steps<br/>  """<br/>  </strong>pct=stocks.pct_change(1)<br/>  newpct=pct.iloc[1:].sample(n=days,replace='True')<br/>  allocation=np.array(aloc)/np.array(aloc).sum()<br/>  total=np.ndarray([1,len(allocation)])<br/>  total[0,:]=allocation<br/>  for i in range(len(newpct)-1):<br/>    thisday=total[-1,:]*(1+newpct.iloc[i+1])<br/>    total=np.vstack([total,thisday])<br/>  sumall=np.sum(total,axis=1)<br/>  return(sumall)</span></pre></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="7b3b" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">现在我们都准备好得到一些结果了。首先，我们想看看在10年的时间里我们能期望得到什么样的回报。让我们导入2005年至2020年的资产历史:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="a607" class="kw kx iq nd b gy nh ni l nj nk">tick=['VFIAX','VBTLX'] <strong class="nd ir"># VFIAX is a stocks ETF and VBTLX is a bond based ETF<br/></strong>stocks=makestockmarket(tick,datetime.datetime(2005, 12, 1),datetime.datetime(2020, 12, 1))</span></pre><p id="aef6" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">我们将模拟2000个不同的市场，并绘制10年后1美元回报率的直方图。我们在这个测试案例中的投资组合将由50%的股票和50%的债券组成。我应该指出，我们在整个投资过程中都保持这个比例。如果股票价格上涨，我们将卖出一些，购买一些债券。如果股票下跌，我们将卖出一些债券，以更低的价格买入更多股票。再平衡是维持风险/回报比的基本概念。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="ccbf" class="kw kx iq nd b gy nh ni l nj nk">ret=[]<br/>std=[]<br/>iterations=2000 # it may take a minute or so to run<br/>years=10<br/>allocation=[0.5,0.5]<br/>output=np.empty([iterations,]).reshape(-1,1)<br/>endret=[]<br/>for i in range(iterations):<br/>  sims=simulateportfolio(stocks,12*years,allocation)<br/>  endret.append(sims[-1])<br/>output=np.hstack((output,np.array(endret).reshape(-1,1)))<br/>output=output[0:,1:]</span></pre><p id="2c3e" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">现在，我们可以绘制2000年模拟的预期回报直方图，以及符合结果的<em class="mu">对数正态</em>:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="c11b" class="kw kx iq nd b gy nh ni l nj nk">f, ax = plt.subplots(1, sharex='col', figsize=(10, 6))<br/>risk=[]<br/>profit=[]<br/>weights = np.ones_like(output)/float(len(output))<br/>fitting_params_lognormal = scipy.stats.lognorm.fit(output, floc=0)<br/>lognorm_dist_fitted = scipy.stats.lognorm(*fitting_params_lognormal)<br/>t = np.arange(0.5, 6, 0.1) <strong class="nd ir"># bins return from 0.5 to 6 with steps of 0.1</strong></span><span id="2b2f" class="kw kx iq nd b gy nl ni l nj nk"><strong class="nd ir"># Now let plot<br/></strong>ax=sns.distplot(output,norm_hist=True, kde=False,color='r')<br/>ax.plot(t, lognorm_dist_fitted.pdf(t), lw=2,c='r')<br/>plt.xlim((0, 6))<br/>plt.xlabel('Return on $1',fontsize=18)<br/>plt.ylabel('Probability',fontsize=18)<br/>plt.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/29b91118a5496797bd80e7b16f2a8f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*36Hjz6Fvn5kC_xuot1Wiyw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Histogram of the expected return over 10 years for a 50/50 portfolio</figcaption></figure><p id="e884" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">我们看到，我们有最大的机会获得大约2倍的投资资金，但在曲线的左侧，我们也有可能获得少于1美元的资金，这意味着我们会损失一些钱。这将是我们对风险的定义——收回较少投资的机会。</p><p id="8100" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">现在，我们可以在20年的时间内进行模拟，并计算0.5%的回报率以及我们定义的风险。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="1823" class="kw kx iq nd b gy nh ni l nj nk">ret=[]<br/>std=[]<br/>iterations=2000<br/>years=20<br/>allocation=[0.5,0.5]<br/>output=np.empty([12*years,]).reshape(-1,1)<br/>endret=[]<br/>for i in range(iterations):<br/>  sims=simulateportfolio(stocks,12*years,allocation)<br/>  output=np.hstack((output,np.array(sims).reshape(-1,1)))<br/><strong class="nd ir"># downsample to year rows<br/></strong>yearsreturn=output[12::12,1:].transpose()</span></pre><p id="5a6a" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">现在我们画出结果:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="e7a4" class="kw kx iq nd b gy nh ni l nj nk">data=pd.DataFrame(yearsreturn)<br/>risk=[]<br/>profit=[[],[],[]]<br/>profit=np.empty([3,]).reshape(-1,1)<br/>for (columnName, columnData) in data.iteritems():<br/>  fitting_params_lognormal=scipy.stats.lognorm.fit(columnData, floc=0)<br/>  lognorm_dist_fitted=scipy.stats.lognorm(*fitting_params_lognormal)<br/>  risk.append(lognorm_dist_fitted.cdf(1))<br/>  profit = np.hstack((profit,lognorm_dist_fitted.ppf([0.10,0.5,0.90]).reshape(-1,1)))</span><span id="a2f4" class="kw kx iq nd b gy nl ni l nj nk">plt.rcParams['figure.figsize'] = (14, 6)<br/>fig, (ax1, ax2) = plt.subplots(1, 2)<br/>ax1.plot(profit[0:,1:].transpose(),'-', marker='o', markersize=5)<br/>ax2.plot(np.array(risk)*100,'-', marker='o', markersize=5)<br/>ax1.set_xlabel('Years',fontsize=18)<br/>ax2.set_xlabel('Years',fontsize=18)<br/>ax1.set_ylabel('Return',fontsize=18)<br/>ax2.set_ylabel('% you will lose some money',fontsize=18)<br/>ax1.legend([x + ' percentile' for x in ['0.1','0.5','0.9']],fontsize=18)<br/>plt.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/41e422257f9db653af292436f29435ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BvEDpOQTq8BMaKZBZRY6vg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Expected return and “risk” from a 50/50 stock/bonds portfolio as a function of investment length</figcaption></figure><p id="6639" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">从上一张图中我们可以看到，对于一年期的投资，我们有大约18%的机会会损失一些钱。对于更长的投资期，没有任何收益的可能性非常小。实际上，我们可以看到，有90%的可能性(0.1个百分点)我们会收回至少2美元(每投资1美元)，有50%的可能性我们会得到4美元或更多。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="7731" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi ml translated"><span class="l mm mn mo bm mp mq mr ms mt di">我们</span>无法预测未来(或者至少我不能)，但我们可以利用过去的数据做更充分的准备。使用蒙特卡罗模拟和引导法可以帮助我们获得更多的洞察力。我们可以开始用概率而不仅仅是确定性的值来理解风险和回报。在股市中，风险、回报和时间都是相互联系的。我希望您能研究一下上面的代码，获得一些更有趣的观察和见解。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="8554" class="pw-post-body-paragraph ls lt iq lu b lv nm jr lx ly nn ju ma lf no mc md lj np mf mg ln nq mi mj mk ij bi translated">明智地投资，不要只是在网上看一些东西，然后用你的钱进行“全押”。其他的我不建议也不奉劝。</p></div></div>    
</body>
</html>