<html>
<head>
<title>Conditional Kubeflow Pipeline for Dummies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于虚拟对象的条件库贝流管道</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/conditional-kubeflow-pipeline-for-dummies-972fd81f9de2?source=collection_archive---------2-----------------------#2021-02-02">https://medium.datadriveninvestor.com/conditional-kubeflow-pipeline-for-dummies-972fd81f9de2?source=collection_archive---------2-----------------------#2021-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/682d9adc74da026ea548da181bf807fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/0*8jH_wJJoilIlk1dy.png"/></div></figure><p id="6b4b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此管道描述了如何使用条件运算符<code class="fe ks kt ku kv b">kfp.dsl</code>和运行时管道参数来分支管道。Kubeflow DSL不支持使用常规的<code class="fe ks kt ku kv b">if:else</code>语句来定义管道图。为了实现这一点，我们可以传递一个决定性的参数，它的值定义了管道图的执行流。<br/>这在下面使用简单函数来举例说明，该简单函数用于相对于传递给管道的期望运行时间计算变量来计算加法或除法。</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="3427" class="le lf iq kv b gy lg lh l li lj">import kfp<br/>import kfp.components as comp</span></pre><h1 id="5211" class="lk lf iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">定义三个简单的函数</h1><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="f33a" class="le lf iq kv b gy lg lh l li lj">def print_fun(calculation: str) -&gt; str:<br/>"""<br/>simple print function<br/>"""<br/>	print("Calculation Type: ",calculation)<br/>	return calculation</span><span id="3652" class="le lf iq kv b gy mh lh l li lj">def add(calculation: str, a: float, b: float) -&gt; float:<br/>"""<br/>calculates sum of two arguments<br/>"""<br/>	print("Calculation Type: ",calculation)<br/>	print("Sum: ",a+b)<br/>	return a + b</span><span id="37a5" class="le lf iq kv b gy mh lh l li lj">def div(calculation: str, dividend: float, divisor: float) -&gt; float:<br/>"""<br/>Divides two numbers and calculates the quotient<br/>"""<br/>	print("Calculation Type: ",calculation)<br/>	quotient = dividend/divisor<br/>	print("Quotient: ",quotient)<br/>	return quotient</span></pre><h1 id="248a" class="lk lf iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">将函数转换为管道运算符</h1><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="658f" class="le lf iq kv b gy lg lh l li lj">print_op = comp.func_to_container_op(print_fun)<br/>add_op = comp.func_to_container_op(add)<br/>divmod_op = comp.func_to_container_op(div)</span></pre><h1 id="85d2" class="lk lf iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">定义管道</h1><p id="1e09" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">管道函数必须用<code class="fe ks kt ku kv b">@dsl.pipeline</code>装饰器和管道函数内部使用的<code class="fe ks kt ku kv b">dsl.Condition</code>来装饰，以创建管道图。</p><p id="2aa0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用<code class="fe ks kt ku kv b">if:else</code>语句无法定义管道执行的方式</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="e78a" class="le lf iq kv b gy lg lh l li lj">import kfp.dsl as dsl<br/>@dsl.pipeline(<br/>	name="calculation pipeline",<br/>	description="A toy pipeline that performs arithmetic calculations."<br/>)</span><span id="205c" class="le lf iq kv b gy mh lh l li lj">def calculation_pipeline(calculation: str, a: float, b: float) -&gt; None:<br/>"""<br/>This function defines the pipeline graph and uses dsl conditions that<br/>need to be evaluated on runtime to decide the execution flow of the pipeline<br/>"""<br/>print_task = print_op(calculation)</span><span id="aaae" class="le lf iq kv b gy mh lh l li lj"># defining the branching condition<br/>with dsl.Condition(print_task.output=="add"):<br/>	add_task = add_op(print_task.output, a, 4).after(print_task)<br/>with dsl.Condition(print_task.output=="div"):<br/>	divmod_task = divmod_op(print_task.output, a, b).after(print_task)</span></pre><p id="d003" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里要考虑的一点是，两个分支操作必须在同一个操作之前。这将确保所形成的图具有从根节点生成的2个叶节点。</p><p id="71c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有了<code class="fe ks kt ku kv b">dsl.condition</code>语句和传递的动态参数，我们可以确定只有一个叶节点会被执行。这模拟了一个简单的<code class="fe ks kt ku kv b">if:elif</code>语句执行，但是使用了<code class="fe ks kt ku kv b">dsl.condition</code></p><h1 id="cc89" class="lk lf iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">提交执行参数集01的管道</h1><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="9d8a" class="le lf iq kv b gy lg lh l li lj">#Specify pipeline argument values<br/>arguments = {"calculation": "add" ,"a": "7", "b": "8"}<br/>#Submit a pipeline run<br/>kfp.Client().create_run_from_pipeline_func(calculation_pipeline, arguments=arguments)</span></pre><h1 id="2c39" class="lk lf iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">提交执行参数集02的管道</h1><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="5d4c" class="le lf iq kv b gy lg lh l li lj">#Specify pipeline argument values<br/>arguments = {"calculation": "div" ,"a": "7", "b": "8"}<br/>#Submit a pipeline run<br/>kfp.Client().create_run_from_pipeline_func(calculation_pipeline, arguments=arguments)</span></pre><h1 id="8d76" class="lk lf iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">管道输出</h1><p id="fa4e" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">找到两个参数的管道运行的屏幕截图，如下所示:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/1fb37120c2f26f8ddc5880bf3c02e642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jjx9LzRZrBYJKEwLdE3A6A.png"/></div></div></figure></div></div>    
</body>
</html>