<html>
<head>
<title>CDC Pipeline From Mysql to Snowflake</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Mysql到雪花的CDC管道</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/cdc-pipeline-from-mysql-to-snowflake-58a01d4d596a?source=collection_archive---------3-----------------------#2021-02-05">https://medium.datadriveninvestor.com/cdc-pipeline-from-mysql-to-snowflake-58a01d4d596a?source=collection_archive---------3-----------------------#2021-02-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0d78fc432513f712d79281a7a1f4c7fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hw4KOFuLOmqKlvetxwUlkA.png"/></div></div></figure><p id="1e60" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">MySQL是一个开源的关系数据库系统，是当今大多数企业技术的一部分。在一般的体系结构中，MySQL被用作带有独立数据仓库的事务数据库，以支持分析和报告或其他下游应用程序需求。</p><p id="0917" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Change-Data-Capture </strong> (CDC)允许从数据库实时捕获提交的更改，并将这些更改传播到下游应用程序或其他目标数据库。</p><p id="4325" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">雪花</em> </strong> <em class="kz"> </em>最近越来越受欢迎，因为它<em class="kz"> </em>提供了企业分析数据库的所有功能，以及许多附加的特殊特性和独特功能。</p><p id="aa3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这篇博客中，我们将学习如何创建一个流集数据收集器(SDC)管道，将插入、更新和删除操作从MySQL BinLog传播到雪花。</p><p id="17d7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> MySQL使用二进制日志捕获变更数据</strong></p><p id="c6f6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">MySQL二进制日志提供了一种非常有效的方法来跟踪数据变化。它们包含描述数据修改的事件。简而言之，二进制日志包含从服务器启动开始跟踪服务器全局状态所需的所有信息。</p><p id="89d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将设置MySQL并启用二进制日志。出于演示目的，将使用docker图像</p><p id="796c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在使用这些二进制日志应用程序之前，使用下面的代码片段来更改MySQL服务器配置以启用二进制日志。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="f0bf" class="lj lk it lf b gy ll lm l ln lo">$cat my.cnf</span><span id="990a" class="lj lk it lf b gy lp lm l ln lo">[mysqld]<br/><br/>server-id  = 1<br/><br/>log_bin  = /var/lib/mysql/mysql-bin.log<br/><br/>expire_logs_days = 10<br/><br/>max_binlog_size  = 100M<br/><br/>binlog-format    = row</span></pre><p id="bcd8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们启动Mysql docker容器并启用binlog</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="58ec" class="lj lk it lf b gy ll lm l ln lo">$ docker run -d --name mysqlcdc -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -v /Users/rishijain/my.cnf:/etc/mysql/my.cnf -v /tmp/mysql:/var/lib/mysql mysql:5.7 mysqld --datadir=/var/lib/mysql --user=mysql</span></pre><p id="d737" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们设计一个MySQL CDC到雪花的实际管道</p><h1 id="7930" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">管道概述</h1><p id="8bdf" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">以下是从MySQL BinLog读取行并将插入、更新和删除操作传播到雪花的管道的高级概述:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/07c1a0d86f0cb01405688333ad01ace1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6xr_aA3B7lBYeZzg"/></div></div></figure><p id="1b5c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以从这里的链接<a class="ae mt" href="https://github.com/rishi871/Blog.git" rel="noopener ugc nofollow" target="_blank">下载示例管道</a></p><p id="f228" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:我使用了最新的流集数据收集器3.21.0</p><h1 id="e907" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">MySQL BinLog起源</h1><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/d4a2f2e9fd9268903415918095739fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/0*xi8ovLjPlXxUN756"/></div></figure><p id="b5bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae mt" href="https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Origins/MySQLBinaryLog.html" rel="noopener ugc nofollow" target="_blank"> MySQL BinLog Origin </a>配置如下:</p><h1 id="61c2" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">MySQL BinLog选项卡属性</h1><p id="0041" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">设置MySQL主机或IP地址、端口和唯一的服务器ID (SDC将充当复制客户端的角色):</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/b9ea1067f882086b5edadbb6681ab26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZNCuET6veaGEhGBsQggTg.png"/></div></div></figure><h1 id="b843" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">高级选项卡—最大批量</h1><ul class=""><li id="c8b2" class="mw mx it kd b ke mn ki mo km my kq mz ku na ky nb nc nd ne bi translated">将“高级”选项卡上的最大批处理大小至少设置为20000，以便在写入雪花时获得最佳性能。该值将相应地受到sdc.properties文件中设置的production.maxBatchSize的约束</li></ul><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/d3743e9421302cf5a3f97f716199302f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DnVXfiDRmxs7wc9r"/></div></div></figure><h1 id="f388" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">高级选项卡—包括/忽略表格</h1><p id="d54b" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">默认情况下，MySQL BinLog源将捕获对所有表的更改。若要筛选表的子集，请使用database.table表示法指定要包含或忽略的表。您还可以使用通配符“%”来匹配任何子字符串。下面的示例将捕获表demo.test_1和demo.test_2</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/1d13b882f9d15b92e0685178d1cc8eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3aP6e61TZr0uCCz5n2THpg.png"/></div></div></figure><h1 id="eba9" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">在页眉中设置表格</h1><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/40423b0c912a7bdc5e6a411a8c10924d.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*AR8WgQtCqv5sU2Hn"/></div></figure><p id="e6f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Set Table in Header步骤是一个表达式求值器，它将表名从记录体复制到记录头，因此我们可以保留雪花目标的表名，即使在我们修剪记录之后。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/9998bc7519fb50cd9221fe2e948b55dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HH4gD8TOG41Y8IAK"/></div></div></figure><h1 id="2b87" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">操作路由器</h1><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/52ce0d02e527069398dc0eba66789a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/0*rGkxoNbxm8fwfHyl"/></div></figure><p id="9f3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">操作路由器是基于操作类型进行路由的流选择器:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/7098768297b1e1545aea185646d707b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zmF6f6FdkNrK37yM"/></div></div></figure><p id="81a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">插入和更新操作被直接路由到雪花目的地；删除操作需要额外的转换。</p><p id="0d2d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该不需要更改此设置。</p><h1 id="efdd" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">处理删除</h1><p id="48b0" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">Handle Delete是一个字段重命名器，它只是将OldData字段重命名为Data，以便雪花目标可以找到用于删除操作的PK字段:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/8f531acff4177d8f5c3ac5b49b2d5711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*85Og9CsGNX37KuLT"/></div></div></figure><p id="1256" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该不需要更改此设置。</p><h1 id="0ae2" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">雪花的目的地</h1><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/6aa223b17f856c5014a2983e5adc4233.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/0*Sa4NOoPc8IFT0Y12"/></div></figure><p id="ddbd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">雪花目标具有以下配置:</p><h1 id="fa49" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">雪花连接信息</h1><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/bd30e4c5b96ba881616a4eb8ca6df68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OBm9qZb9Uf7lbMG3"/></div></div></figure><p id="0b90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">指定帐户和用户属性。</p><p id="b5da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">雪花密码从磁盘中读取的方式与上述MySQL密码相同。确保在磁盘上创建snowflake_password文件，创建方式与上面MySQL BinLog阶段的凭证部分中描述的文件相同。</p><h1 id="5b07" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">雪花标签</h1><p id="cb54" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">用您自己的设置替换下面的仓库、数据库和模式设置。</p><p id="f109" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">表格属性是从我们之前设置的记录标题中选取的。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/2518edaa3830335c330f9885550e081a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bgo7LFb4P0xoS6MictrkGw.png"/></div></div></figure><h1 id="97df" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">分段选项卡</h1><p id="e2d7" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">您可以使用雪花的任何一个暂存位置:</p><ul class=""><li id="a7d9" class="mw mx it kd b ke kf ki kj km nm kq nn ku no ky nb nc nd ne bi translated">亚马逊S3</li><li id="c7e8" class="mw mx it kd b ke np ki nq km nr kq ns ku nt ky nb nc nd ne bi translated">Azure Blob存储</li><li id="f426" class="mw mx it kd b ke np ki nq km nr kq ns ku nt ky nb nc nd ne bi translated">雪花内部阶段</li></ul><p id="50fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">出于演示目的，我使用雪花内部用户阶段，但是，您可以使用任何阶段位置</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/51cea173a470f923a00b43199ca00de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ICyJNhozF5_jwytEyLXFeQ.png"/></div></div></figure><p id="9c62" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于外部雪花阶段，需要提前创建，一旦存在，请在下面指定其名称。如果您在具有IAM角色的节点上运行以读写S3，您可以将这些键留空。如果您需要提供密钥，请在磁盘上创建aws_access_key和aws_secret_key文件，创建方式与上面MySQL BinLog阶段的凭证部分中描述的方式相同。同样，你需要为微软Azure进行配置</p><h1 id="3492" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">数据选项卡</h1><p id="69ff" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">这些是数据选项卡中的关键设置。确保设置CDC数据复选框！</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/cfe604342d2fabf3f891fe34616026ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iyR1oiW0pas36Gu0dLqTzA.png"/></div></div></figure><p id="72c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">/Data row字段是MySQL BinLog中数据的显示方式；您不应该更改该设置。</p><p id="b38f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以从snowflake获取主键信息，也可以手动提供静态键。</p><h1 id="af2c" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">数据高级选项卡</h1><p id="450e" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">以下是一些有用的设置:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/e3b007a4d9b7da7da73300121b5f3715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V0Cm4DO3mUoSKWtI"/></div></div></figure><h1 id="4c46" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">验证管道</h1><p id="f9aa" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">配置管道后，单击SDC GUI右上角的复选标记图标，确保验证成功:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/6b6682f125a3d6a5168befb2d6a90bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-eDpVwzfNY4h7v1u"/></div></div></figure><h1 id="0f53" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">运行管道</h1><p id="6f0e" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">如果验证成功，运行管道并检查雪花中的数据:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/ec70272682c7db6d6b885fdf2673cb9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/0*CPl1WNm-sxonDXhj"/></div></figure><p id="de78" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切顺利，您应该看到以下内容:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/77915db5547c05c695f5c719f6929f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yTg34Cno9pALow44"/></div></div></figure><p id="87c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">结论</strong>:在本教程中，我们学习了如何创建一个到雪花的Mysql CDC管道。请在评论中告诉我你是如何创建MySQL CDC到雪花数据管道的。</p></div></div>    
</body>
</html>