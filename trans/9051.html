<html>
<head>
<title>Scraping Top Publications’ data with Python (using Selenium, Imaplib, and BeautifulSoup4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python抓取顶级出版物的数据(使用Selenium、Imaplib和BeautifulSoup4)</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/scraping-top-publications-data-with-python-using-selenium-imaplib-and-beautifulsoup4-18fcf9b95c47?source=collection_archive---------8-----------------------#2021-01-29">https://medium.datadriveninvestor.com/scraping-top-publications-data-with-python-using-selenium-imaplib-and-beautifulsoup4-18fcf9b95c47?source=collection_archive---------8-----------------------#2021-01-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/56ae1080735aef7ef3477a8598efea62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_iOXX0C2otTYfu-H"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bef5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个系列的第二篇文章，旨在完成拼图游戏，了解谁是MMedium.com的用户。获取此类知识的关键原因和附加值在<a class="ae kc" href="https://jkcandick.medium.com/data-science-project-get-rewarded-by-knowing-medium-com-user-pool-modeling-business-problem-part-b93b8088c644" rel="noopener">上一篇文章</a>中有详细解释。总之，这些信息可以帮助你在这个平台上获得更多的观点和奖励，就像它对这个平台本身一样。也正如文中所解释的，隐藏在<a class="ae kc" href="https://toppubs.smedian.com/" rel="noopener ugc nofollow" target="_blank">顶级出版物</a>网站上的一些信息是了解用户构成的关键。</p><div class="lb lc gp gr ld le"><a href="https://jkcandick.medium.com/data-science-project-get-rewarded-by-knowing-medium-com-user-pool-modeling-business-problem-part-b93b8088c644" rel="noopener follow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">通过了解Medium.com用户获得回报——第1/4部分抽象商业模式和行动要点</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">一个端到端的数据科学项目，从模拟现实世界的业务问题开始，到…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">jkcandick.medium.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jw le"/></div></div></a></div><p id="8891" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们目标页面的一瞥。举例来说，我敢打赌，没有人会愿意花几十个小时去翻阅页面，记下12385份出版物中排名前1500位的数据。不用说随时更新信息。这正是在几分钟内收集所有您需要的数据的主要动力。我会告诉你如何做到这一点。</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/6be15df0cf68b456168098d8fcfe936c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4wvgTh8HVzlCf3tfLdINrQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">toppubs.smedian.com page</figcaption></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="7662" class="mf mg iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">预购</h1><p id="a794" class="pw-post-body-paragraph kd ke iq kf b kg nd ki kj kk ne km kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">我假设您的计算机上已经安装了Python 3。然后一切都变得容易了。如果您愿意，可以在命令或终端中使用以下代码，在您想要保存工作的目录中创建一个虚拟环境。尽管这一步有助于控制包及其版本，但它是可选的。</p><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="5340" class="nn mg iq nj b gy no np l nq nr">cd path/to/your/target/directory<br/>python3 -m venv "Give your virtual environment a name"</span></pre><p id="1ce2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后应该安装三个核心库，<a class="ae kc" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank"> BeautifulSoup4 </a>、<a class="ae kc" href="https://pypi.org/project/selenium/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>和<a class="ae kc" href="https://pypi.org/project/webdriver-manager/" rel="noopener ugc nofollow" target="_blank"> Webdriver Manager </a>。等用到位了再介绍。一种(也是我喜欢的)方法是这样的:</p><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="a0ec" class="nn mg iq nj b gy no np l nq nr">python3 -m pip install beautifulsoup4<br/>python3 -m pip install selenium<br/>python3 -m pip install webdriver-manager</span></pre><p id="a8c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">恭喜，你现在可以走了！</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="a78e" class="mf mg iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">方法</h1><p id="66bb" class="pw-post-body-paragraph kd ke iq kf b kg nd ki kj kk ne km kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">这种方法可以用一句话来概括:在Selenium(一个使这项工作变得更容易的包)的帮助下，在特定的web页面上复制您需要遵循的过程，以访问您想要的信息。</p><p id="9e94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第一步:理解与目标页面的基本交互</strong></p><p id="2d4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的首要任务是了解在目标页面上看到我们想要的信息所需的最少步骤，【https://toppubs.smedian.com<a class="ae kc" href="https://toppubs.smedian.com" rel="noopener ugc nofollow" target="_blank"/>。我将在下面列出我对这个特定页面的发现。</p><ol class=""><li id="35bc" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la nx ny nz oa bi translated">一个人必须登陆这个页面，点击“登录”开始。不登录，只能看到前100个出版物。(需要硒)</li><li id="1e9c" class="ns nt iq kf b kg ob kk oc ko od ks oe kw of la nx ny nz oa bi translated">登录程序不标准。一种选择是使用你的电子邮件地址登录，然后一封带有登录链接的电子邮件会进入你的邮箱，你可以点击它。(需要硒+ Imaplib)</li><li id="4f5b" class="ns nt iq kf b kg ob kk oc ko od ks oe kw of la nx ny nz oa bi translated">登录后，您可以向下滚动页面，查看所有出版物，包括出版物排名、关注者数量、关注者增长率、出版物描述等信息。(需要硒+美素)</li><li id="6986" class="ns nt iq kf b kg ob kk oc ko od ks oe kw of la nx ny nz oa bi translated">将您的数据保存到本地的. csv文件和/或Google Sheet中。</li></ol><p id="8f2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第二步:在Python和Selenium库的帮助下复制交互。</strong></p><blockquote class="og oh oi"><p id="847b" class="kd ke oj kf b kg kh ki kj kk kl km kn ok kp kq kr ol kt ku kv om kx ky kz la ij bi translated">“Selenium是一个总括项目，它封装了各种工具和库，支持web浏览器自动化。Selenium专门为W3C WebDriver规范提供了一个基础设施，这是一个与所有主流web浏览器兼容的平台和语言中立的编码接口。— Selenium主页</p></blockquote><p id="982c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Selenium是我对网络浏览器自动化的选择。可以使用python原生包(如“requests”和“httplib ”)创建自定义客户端。</p><p id="8b29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但俗话说，不要再试图创造轮子了！我在下面的步骤中使用了Selenium来收集数据。</p><ul class=""><li id="07e1" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">首先，准备并导入库。</li></ul><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="a14d" class="nn mg iq nj b gy no np l nq nr">import imaplib</span><span id="24ab" class="nn mg iq nj b gy oo np l nq nr">import email</span><span id="7b1e" class="nn mg iq nj b gy oo np l nq nr">from email.header import decode_header</span><span id="8544" class="nn mg iq nj b gy oo np l nq nr">import time</span><span id="0b1f" class="nn mg iq nj b gy oo np l nq nr">import re</span><span id="a681" class="nn mg iq nj b gy oo np l nq nr">from bs4 import BeautifulSoup</span><span id="fc6c" class="nn mg iq nj b gy oo np l nq nr">from selenium import web-driver</span><span id="3e77" class="nn mg iq nj b gy oo np l nq nr">from webdriver_manager.chrome import ChromeDriverManager</span><span id="6350" class="nn mg iq nj b gy oo np l nq nr">import csv</span></pre><ul class=""><li id="44c4" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">使用Selenium创建web浏览器驱动程序。</li></ul><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="c4c0" class="nn mg iq nj b gy no np l nq nr">def driver():</span><span id="9240" class="nn mg iq nj b gy oo np l nq nr">    return webdriver.Chrome(ChromeDriverManager().install())</span></pre><ul class=""><li id="83ef" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">定义自动触发认证邮件的功能。</li></ul><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="b9f8" class="nn mg iq nj b gy no np l nq nr">def loginLinkTrigger(driver, email):</span><span id="0337" class="nn mg iq nj b gy oo np l nq nr">    # load the Smedian.com pagpe</span><span id="4833" class="nn mg iq nj b gy oo np l nq nr">    driver.get('https://toppubs.smedian.com')</span><span id="ad51" class="nn mg iq nj b gy oo np l nq nr">    time.sleep(5)</span><span id="ae06" class="nn mg iq nj b gy oo np l nq nr">    # scroll to the bottom before next click</span><span id="cd5f" class="nn mg iq nj b gy oo np l nq nr">    driver.execute_script(<br/>      "window.scrollTo(0,document.body.scrollHeight);")</span><span id="8818" class="nn mg iq nj b gy oo np l nq nr">    # click on login button</span><span id="12a7" class="nn mg iq nj b gy oo np l nq nr">    driver.find_element_by_xpath(<br/>      '//*[@id="__next"]/div[1]/nav/ul/li[2]/button').click()</span><span id="8936" class="nn mg iq nj b gy oo np l nq nr">    time.sleep(2)</span><span id="0412" class="nn mg iq nj b gy oo np l nq nr">    # scroll to the bottom before next click</span><span id="aaac" class="nn mg iq nj b gy oo np l nq nr">    driver.execute_script(<br/>      "window.scrollTo(0, document.body.scrollHeight);")</span><span id="d502" class="nn mg iq nj b gy oo np l nq nr">    # click on "login with email button"</span><span id="ae3d" class="nn mg iq nj b gy oo np l nq nr">    driver.find_element_by_xpath(<br/>      '//button[@class="btn btn-success u-sizeFullWidth u-flex u-justifyContentCenter u-alignItemsCenter"]').click()</span><span id="6814" class="nn mg iq nj b gy oo np l nq nr">    time.sleep(3)</span><span id="f3d1" class="nn mg iq nj b gy oo np l nq nr">    # scroll to the bottom before next click</span><span id="93ed" class="nn mg iq nj b gy oo np l nq nr">    driver.execute_script(<br/>      "window.scrollTo(0, document.body.scrollHeight);")</span><span id="6c89" class="nn mg iq nj b gy oo np l nq nr">    # login with email</span><span id="8a1e" class="nn mg iq nj b gy oo np l nq nr">    loginEmail = driver.find_element_by_xpath('//input[@type="email"]')</span><span id="7b41" class="nn mg iq nj b gy oo np l nq nr">    loginEmail.clear()</span><span id="13d0" class="nn mg iq nj b gy oo np l nq nr">    loginEmail.send_keys(email)</span><span id="a033" class="nn mg iq nj b gy oo np l nq nr">    driver.find_element_by_xpath(<br/>      '//button[@class="btn btn-success btn-rounded u-lineHeight30"]').click()</span></pre><p id="956c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">值得注意的是，我总是在点击任何链接之前滚动到页面的底部(使用<code class="fe op oq or nj b">driver.execute_script(“window.scrollTo(0,document.body.scrollHeight);”)</code>),然后等待一两秒钟(使用<code class="fe op oq or nj b">time.sleep(2)</code>),以便页面可以完成加载。这里的原则是确保所需元素的可见性和不重叠。您可以根据这一原则调整代码。</p><ul class=""><li id="435c" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">制作一个功能，将检索您的认证电子邮件，并在后台为您点击登录链接。工作代码片段是专门针对Gmail的。</li></ul><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="28b3" class="nn mg iq nj b gy no np l nq nr">def loginLinkRetrieve(_email, _password):</span><span id="8c90" class="nn mg iq nj b gy oo np l nq nr">    # Function to get email content part i.e its body part</span><span id="94a7" class="nn mg iq nj b gy oo np l nq nr">    def get_body(msg):</span><span id="368e" class="nn mg iq nj b gy oo np l nq nr">        if msg.is_multipart():</span><span id="f0d7" class="nn mg iq nj b gy oo np l nq nr">           return get_body(msg.get_payload(0))</span><span id="3843" class="nn mg iq nj b gy oo np l nq nr">        else:</span><span id="1c84" class="nn mg iq nj b gy oo np l nq nr">           return msg.get_payload(None, True)</span><span id="3da3" class="nn mg iq nj b gy oo np l nq nr">    # Function to search for a key value pair</span><span id="f16b" class="nn mg iq nj b gy oo np l nq nr">    def search(key, value, con):</span><span id="77b6" class="nn mg iq nj b gy oo np l nq nr">        result, data = con.search(None, key, '"{}"'.format(value))</span><span id="3ff5" class="nn mg iq nj b gy oo np l nq nr">        return data</span><span id="3f94" class="nn mg iq nj b gy oo np l nq nr">   # Function to get the list of emails under this label</span><span id="8163" class="nn mg iq nj b gy oo np l nq nr">        def get_emails(result_bytes):</span><span id="3854" class="nn mg iq nj b gy oo np l nq nr">            msgs = []  # all the email data are pushed inside an array</span><span id="d4eb" class="nn mg iq nj b gy oo np l nq nr">            for num in result_bytes[0].split():</span><span id="ac91" class="nn mg iq nj b gy oo np l nq nr">                typ, data = con.fetch(num, '(RFC822)')</span><span id="c49e" class="nn mg iq nj b gy oo np l nq nr">                msgs.append(data)</span><span id="cc57" class="nn mg iq nj b gy oo np l nq nr">            return msgs</span><span id="d74e" class="nn mg iq nj b gy oo np l nq nr">    # this is done to make SSL connnection with GMAIL</span><span id="7d33" class="nn mg iq nj b gy oo np l nq nr">    con = imaplib.IMAP4_SSL('imap.gmail.com')</span><span id="998f" class="nn mg iq nj b gy oo np l nq nr">    # logging the user in</span><span id="0e1c" class="nn mg iq nj b gy oo np l nq nr">    con.login(_email, _password)</span><span id="2ced" class="nn mg iq nj b gy oo np l nq nr">    # calling function to check for email under this label</span><span id="21bd" class="nn mg iq nj b gy oo np l nq nr">    con.select('Inbox')</span><span id="2d00" class="nn mg iq nj b gy oo np l nq nr">    # fetching emails from aunthenticator@penname.me</span><span id="f452" class="nn mg iq nj b gy oo np l nq nr">    msgs = get_emails(search('FROM', 'aunthenticator@penname.me', con))</span><span id="87b7" class="nn mg iq nj b gy oo np l nq nr">    # Find the login link</span><span id="0674" class="nn mg iq nj b gy oo np l nq nr">    for info in msgs[-1]:</span><span id="19e4" class="nn mg iq nj b gy oo np l nq nr">        if isinstance(info, tuple):</span><span id="a618" class="nn mg iq nj b gy oo np l nq nr">           msg = email.message_from_string(info[1].decode('utf-8'))</span><span id="0668" class="nn mg iq nj b gy oo np l nq nr">           dt = decode_header(msg["Date"])[0][0]</span><span id="f5d1" class="nn mg iq nj b gy oo np l nq nr">           try:</span><span id="938d" class="nn mg iq nj b gy oo np l nq nr">              loginLink = re.findall(<br/>                  rb'.*&lt;a class="button js-consumeAuthTokenLink ng-binding" ng-href=.*"(.*)".*', msg.get_payload(decode=True), re.M)[0]</span><span id="8651" class="nn mg iq nj b gy oo np l nq nr">           except:</span><span id="a99e" class="nn mg iq nj b gy oo np l nq nr">              loginLink = 'Unknown'</span><span id="fd72" class="nn mg iq nj b gy oo np l nq nr">              print('Parse login link failed')</span><span id="a1f3" class="nn mg iq nj b gy oo np l nq nr">    print('Time received: ', dt)</span><span id="c8e7" class="nn mg iq nj b gy oo np l nq nr">    print('Login link: ', loginLink)</span></pre><p id="9adb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">认证电子邮件始终来自“aunthenticator@penname.me”。电子邮件数据(从<code class="fe op oq or nj b">msg.get_payload(decode=True)</code>返回)对我来说是多行字节格式，因此在<code class="fe op oq or nj b">re.findall()</code>函数中需要标志<code class="fe op oq or nj b">rb</code>和<code class="fe op oq or nj b">re.M</code>。而且，如果你想了解更多关于imaplib库的知识，<a class="ae kc" href="https://docs.python.org/3/library/imaplib.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>可以是一个很好的参考。</p><ul class=""><li id="8689" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">现在您应该已经登录，需要向下滚动页面来查看尽可能多的出版物信息。这可以通过下面的函数自动完成。</li></ul><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="5153" class="nn mg iq nj b gy no np l nq nr">def scroll2bottom(driver):</span><span id="5987" class="nn mg iq nj b gy oo np l nq nr">    SCROLL_PAUSE_TIME = 6</span><span id="5e2c" class="nn mg iq nj b gy oo np l nq nr">    last_height = driver.execute_script(<br/>         "returndocument.body.scrollHeight")</span><span id="b9fc" class="nn mg iq nj b gy oo np l nq nr">    numOfPages = 100</span><span id="e9f2" class="nn mg iq nj b gy oo np l nq nr">    currentPage = 0</span><span id="b6a8" class="nn mg iq nj b gy oo np l nq nr">    while currentPage &lt;= numOfPages:</span><span id="2cd6" class="nn mg iq nj b gy oo np l nq nr">          # Scroll down to bottom</span><span id="01f8" class="nn mg iq nj b gy oo np l nq nr">          driver.execute_script(<br/>              "window.scrollTo(0, document.body.scrollHeight);")</span><span id="b6cb" class="nn mg iq nj b gy oo np l nq nr">         # Wait to load page</span><span id="61a7" class="nn mg iq nj b gy oo np l nq nr">         time.sleep(SCROLL_PAUSE_TIME)</span><span id="7cbf" class="nn mg iq nj b gy oo np l nq nr">         # Calculate new scroll height and compare with last scroll height</span><span id="5efd" class="nn mg iq nj b gy oo np l nq nr">         new_height = driver.execute_script(<br/>               "returndocument.body.scrollHeight")</span><span id="9b74" class="nn mg iq nj b gy oo np l nq nr">         if new_height == last_height:</span><span id="421c" class="nn mg iq nj b gy oo np l nq nr">            break</span><span id="e6ed" class="nn mg iq nj b gy oo np l nq nr">         last_height = new_height</span><span id="eade" class="nn mg iq nj b gy oo np l nq nr">         currentPage += 1</span></pre><p id="a404" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个示例代码中，我将页面向下滚动的次数限制为100，因为在此之后的关注者的数量将少于1000。但是你可以随时查看更多。再次，给它一秒钟来加载每一页。</p><ul class=""><li id="1ffd" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">现在是一个激动人心的时刻，我们都准备好解析数据了。在撰写本文时，出版物的名称、其主页URL和排名、描述、类别、订阅者数量、关注者增长率将在找到其元素后从页面中解析出来。右键单击元素，然后您可以选择复制xpaths或css选择器。如果您已经有了使用xpath的经验，建议您自己为这些元素定义它们。代码利用这些选择器来解析下面共享的数据。</li></ul><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi os"><img src="../Images/151f3a09bb5be2345af237aaac8196f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZg7-jdF6KhDSo3I4M6F6w.png"/></div></div></figure><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="5415" class="nn mg iq nj b gy no np l nq nr">def parser(driver, page):</span><span id="2fb5" class="nn mg iq nj b gy oo np l nq nr">    driver.get(page)</span><span id="c4ba" class="nn mg iq nj b gy oo np l nq nr">    scroll2bottom(driver)</span><span id="e5db" class="nn mg iq nj b gy oo np l nq nr">    content = driver.page_source</span><span id="258f" class="nn mg iq nj b gy oo np l nq nr">    soup = BeautifulSoup(content, features="html.parser")</span><span id="9e24" class="nn mg iq nj b gy oo np l nq nr">    rows = [['publication', 'rank', 'URL', 'description',<br/>      'category', 'subscriber', 'growthRate']]</span><span id="0f60" class="nn mg iq nj b gy oo np l nq nr">    dataBlocks = soup.find_all("li", "u-marginBottom40")</span><span id="9b64" class="nn mg iq nj b gy oo np l nq nr">    for block in dataBlocks:</span><span id="d4fb" class="nn mg iq nj b gy oo np l nq nr">        publication = block.find(<br/>            "a", "heading link link--primary u-accentColor--hoverTextNormal u-displayInline").text or ""</span><span id="8b7a" class="nn mg iq nj b gy oo np l nq nr">        rank = block.find(<br/>            "a", "link u-displayInline u-marginRight5 u-fontWeight500 u-fontSize20").text or ""</span><span id="1b5b" class="nn mg iq nj b gy oo np l nq nr">        URL = block.find(<br/>            "a", "heading link link--primary u-accentColor--hoverTextNormal u-displayInline").get("href") or ""</span><span id="f37e" class="nn mg iq nj b gy oo np l nq nr">        description = block.find(<br/>            "p", "card-description u-marginTop10 u-fontWeight400 u-xs-fontSize16").text or ""</span><span id="edef" class="nn mg iq nj b gy oo np l nq nr">        category = block.find(<br/>            "div", "col-md-2 u-textAlignCenter u-textColorDarker u-fontWeight300 u-sm-hide").text or ""</span><span id="25c5" class="nn mg iq nj b gy oo np l nq nr">        subscriber = block.find(<br/>            "div", "col-md-2 u-textAlignRight u-textColorDarker u-fontWeight300 u-sm-hide").text or ""</span><span id="7685" class="nn mg iq nj b gy oo np l nq nr">        for span in block.find_all("span"):<br/>            <br/>            txt = span.text or ""</span><span id="189b" class="nn mg iq nj b gy oo np l nq nr">            if "Followers Per Day" in txt:</span><span id="7b34" class="nn mg iq nj b gy oo np l nq nr">               growthRate = txt.replace(' Followers Per Day', '')</span><span id="5116" class="nn mg iq nj b gy oo np l nq nr">       row = [publication, rank, URL, description, category, subscriber, growthRate]</span><span id="80c3" class="nn mg iq nj b gy oo np l nq nr">       rows.append(row)</span><span id="88ec" class="nn mg iq nj b gy oo np l nq nr">    return rows</span></pre><p id="0c05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">功能<code class="fe op oq or nj b">driver</code>、<code class="fe op oq or nj b">scroll2bottom</code>在前面章节中定义。每一行都保存为一个列表。</p><ul class=""><li id="aa5f" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">将您的数据保存到。csv文件。这是在本地保存数据的最方便的方法。请修改下面的文件路径。</li></ul><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="7e36" class="nn mg iq nj b gy no np l nq nr">def w2csv(rows):</span><span id="235d" class="nn mg iq nj b gy oo np l nq nr">    # To csv file.</span><span id="7150" class="nn mg iq nj b gy oo np l nq nr">    with open('/path/to/data/file.csv', 'w') as f:<br/>         writer = csv.writer(f)<br/>         writer.writerows(rows)</span></pre><p id="a5a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也可以将你的数据保存到谷歌表单中。但这需要你创建一个谷歌平台项目服务账户，并安装一些支持的python库。完成所有这些后，下面的代码片段将为您提供您自己的google电子表格键(您的google工作表的标识符)</p><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="6b0c" class="nn mg iq nj b gy no np l nq nr">import gspread</span><span id="800f" class="nn mg iq nj b gy oo np l nq nr">from oauth2client.service_account import ServiceAccountCredentials</span><span id="8fb7" class="nn mg iq nj b gy oo np l nq nr">def w2gsheet(rows):</span><span id="ff67" class="nn mg iq nj b gy oo np l nq nr"># To google sheet</span><span id="05c8" class="nn mg iq nj b gy oo np l nq nr">scope = ['https://spreadsheets.google.com/feeds',<br/>         'https://www.googleapis.com/auth/spreadsheets',<br/>         'https://www.googleapis.com/auth/drive']</span><span id="9ae0" class="nn mg iq nj b gy oo np l nq nr">credentials = ServiceAccountCredentials.from_json_keyfile_name(<br/>    '/path/to/service/account.json', scope)</span><span id="14ae" class="nn mg iq nj b gy oo np l nq nr">gc = gspread.authorize(credentials)</span><span id="8459" class="nn mg iq nj b gy oo np l nq nr">gSpreadSheetKey = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span id="2a13" class="nn mg iq nj b gy oo np l nq nr">gSpreadSheet = gc.open_by_key(gSpreadSheetKey)</span><span id="4f7f" class="nn mg iq nj b gy oo np l nq nr">gSpreadSheet.values_update(<br/>    'Sheet1', params={'valueInputOption': 'RAW'}, body={'values': rows})</span></pre><ul class=""><li id="d754" class="ns nt iq kf b kg kh kk kl ko nu ks nv kw nw la on ny nz oa bi translated">最后，我们可以在主函数中构建一个工作流。在此填写您的有效电子邮件和密码。</li></ul><pre class="lu lv lw lx gt ni nj nk nl aw nm bi"><span id="c8b6" class="nn mg iq nj b gy no np l nq nr">def main():</span><span id="5a1a" class="nn mg iq nj b gy oo np l nq nr">    _email = 'xxxxxxxxxxxxxxxxxxxxx'</span><span id="eb41" class="nn mg iq nj b gy oo np l nq nr">    _pwd = 'xxxxxxxxxxxxxx'</span><span id="290d" class="nn mg iq nj b gy oo np l nq nr">   _driver = driver()</span><span id="b475" class="nn mg iq nj b gy oo np l nq nr">   _driver.maximize_window()</span><span id="4168" class="nn mg iq nj b gy oo np l nq nr">   loginLinkTrigger(_driver, _email)</span><span id="8080" class="nn mg iq nj b gy oo np l nq nr">   # Waiting time for the eamil to land in mailbox</span><span id="34a9" class="nn mg iq nj b gy oo np l nq nr">   time.sleep(30)</span><span id="7eb8" class="nn mg iq nj b gy oo np l nq nr">   loginLink = loginLinkRetrieve(_email, _pwd)</span><span id="52f6" class="nn mg iq nj b gy oo np l nq nr">   rows = parser(_driver, page=loginLink)</span><span id="8455" class="nn mg iq nj b gy oo np l nq nr">   w2csv(rows)</span><span id="e608" class="nn mg iq nj b gy oo np l nq nr">   w2gsheet(rows)</span></pre><p id="ac27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，完整的脚本将利用上述所有功能，如下所示。</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ot"><img src="../Images/b0398f8b76fc28cb0685bc4230f74678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GGtfR3gUMs5DH9WLjMw7Q.png"/></div></div></figure><p id="612f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在终端中执行脚本后，您将拥有一个. csv文件和/或一个填充了媒体出版物数据的google表单。csv文件示例在这里。</p><h2 id="1d36" class="nn mg iq bd mh ou ov dn ml ow ox dp mp ko oy oz mt ks pa pb mx kw pc pd nb pe bi translated"><strong class="ak">结束注释</strong></h2><p id="124b" class="pw-post-body-paragraph kd ke iq kf b kg nd ki kj kk ne km kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated"><strong class="kf ir">展开数据。</strong>更进一步，您可以扩展您的脚本来访问每个出版物的主页，并收集其他有趣的信息。</p><p id="1f5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">清理数据</strong>。数据还不完善。例如，每个出版物的类别可能会产生误导。因此，样本出版物的相关类别和主题需要核实和修订。选择正确的代表性样本是一个良好的开端。</p><p id="f940" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">使用数据</strong>。作为这个项目的下一步，我们将评估和利用这个数据集。最后，是时候找出Medium.com用户群的构成了。当你写下一个故事，优化标题、描述和标签(后者将在这个项目的最后一个故事中涉及)时，了解用户的兴趣和他们愿意为之付费的内容将会给你带来优势。</p><div class="lb lc gp gr ld le"><a href="https://medium.com/datadriveninvestor/an-ultimate-search-engine-optimisation-guide-for-bloggers-with-examples-c46f11ffea39" rel="noopener follow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">博客的终极搜索引擎优化指南，附示例</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">优化你的故事和博客，提高知名度。最佳实践的搜索引擎优化解释了一个…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.com</p></div></div><div class="ln l"><div class="pf l lp lq lr ln ls jw le"/></div></div></a></div><p id="eb95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你对我的下一篇关于<a class="ae kc" href="https://medium.com/datadriveninvestor/how-to-make-money-on-medium-in-2021-37fbffbd48f1" rel="noopener">的文章感兴趣，从这个数据集中发现的可操作的见解，</a>请随时关注。</p><div class="lb lc gp gr ld le"><a href="https://medium.com/datadriveninvestor/how-to-make-money-on-medium-in-2021-37fbffbd48f1" rel="noopener follow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">2021年如何在Medium上赚钱？</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">有哪些热门话题？哪些是盈利的？使用最佳实践在媒体上写作、出版和赚钱。</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.com</p></div></div><div class="ln l"><div class="pg l lp lq lr ln ls jw le"/></div></div></a></div><h1 id="217c" class="mf mg iq bd mh mi ph mk ml mm pi mo mp mq pj ms mt mu pk mw mx my pl na nb nc bi translated">作者的其他帖子</h1><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/empower-automated-stock-trading-with-pattern-recognition-a-recursive-programmatic-approach-5930da422555"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">通过模式识别实现自动化股票交易——一种递归编程方法</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">股票模式识别的一种高度概括的全局递归程序方法及其实现</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="ln l"><div class="pm l lp lq lr ln ls jw le"/></div></div></a></div><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-make-money-on-medium-in-2021-37fbffbd48f1"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">如何在介质上写作赚更多的钱？</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">用数据解释。有哪些热门话题？哪些是盈利的？使用最佳实践在…上写作、出版和赚钱</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="ln l"><div class="pg l lp lq lr ln ls jw le"/></div></div></a></div><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/an-ultimate-search-engine-optimisation-guide-for-bloggers-with-examples-c46f11ffea39"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">博客的终极搜索引擎优化指南，附示例</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">优化你的故事和博客，提高知名度。最佳实践的搜索引擎优化解释了一个…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="ln l"><div class="pf l lp lq lr ln ls jw le"/></div></div></a></div><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/data-science-project-get-rewarded-by-knowing-medium-com-user-pool-modeling-business-problem-part-b93b8088c644"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">抽象的商业模式和行动指向理解Medium.com的用户</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">一个端到端的数据科学项目，从模拟现实世界的业务问题开始，到…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jw le"/></div></div></a></div></div></div>    
</body>
</html>