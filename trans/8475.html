<html>
<head>
<title>Why Naive Bayes fails to tell if you have Covid-19</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么朴素贝叶斯无法判断你是否患有新冠肺炎</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/why-naive-bayes-fails-to-tell-if-you-have-covid-19-54aae712a590?source=collection_archive---------10-----------------------#2021-01-12">https://medium.datadriveninvestor.com/why-naive-bayes-fails-to-tell-if-you-have-covid-19-54aae712a590?source=collection_archive---------10-----------------------#2021-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d6c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我们将重点放在一个朴素贝叶斯分类器上，根据他的症状来检查某人是否患有新冠肺炎，以及他的感染有多严重。正如题目所揭示的，测试预测的准确性不令人满意，这不能用这种方法确定感染的严重程度。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/68282d14a668f4a509da1bb8d7965289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJAInEYFb6HjI9gAA9snUA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@anniespratt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Annie Spratt</a> on <a class="ae lb" href="https://unsplash.com/s/photos/covid-19-test?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ff1f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">1.Kaggle数据集</h1><blockquote class="ma mb mc"><p id="d5be" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">这些数据将有助于根据一些预定义的标准症状来识别任何人是否患有冠状病毒疾病。这些症状是基于who.int世界卫生组织(世卫组织)和印度卫生和家庭福利部给出的指南。</p></blockquote><div class="mh mi gp gr mj mk"><a href="https://www.kaggle.com/iamhungundji/covid19-symptoms-checker" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">新冠肺炎症状检查器</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">预测某人是否有冠状病毒？</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">www.kaggle.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my kv mk"/></div></div></a></div><p id="5638" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据集包含七个主要变量，每个变量的描述如下:</p><ol class=""><li id="79ce" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated">症状:根据世卫组织的说法，5是新冠肺炎的主要症状，发烧、疲倦、呼吸困难、干咳和喉咙痛。</li><li id="8508" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">经历任何其他症状:疼痛，鼻塞，流鼻涕，腹泻，和其他。</li><li id="cd78" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">性别:有三种性别(男性、女性、变性人)</li><li id="38a4" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">基于世卫组织年龄组标准的每个人的年龄组分类</li><li id="5c8e" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">此人是否接触过其他新冠肺炎患者</li><li id="8849" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">严重性级别，无、轻度、中度、重度</li><li id="1e5a" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">国家:访问过的国家列表(包括中国，法国，德国，伊朗，意大利，其他，韩国，西班牙和阿联酋。</li></ol><h1 id="d636" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">2.数据预处理</h1><p id="ceba" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">这个Kaggle数据存储库中上传了两个CSV文件。为了节省时间，我只选择了已清理的数据，并跳过了数据清理这一步。</p><p id="153c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">显然，在给定的数据集中有分类特征，例如国家。处理它们的一个简单方法是给它们分配一个编号，代码如下所示:</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="8d1d" class="nx ld iq nt b gy ny nz l oa ob"># df is the data frame read the csv file.<br/>country_id = {"Country":     {"China": 0, "UAE": 1, 'Italy':2,'Spain':3,'Iran':4,'Republic of Korean':5,<br/>                              'France':6,'Germany':7,'Other-EUR':8,'Other':9}}<br/>df = df.replace(country_id)</span></pre><p id="f382" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些特征，例如年龄、性别、严重程度，由不同元素的数量的大小的二进制向量来描述。没有问题，但我们只是想在同一格式的所有功能。因此，我们需要用下面的代码来处理它们:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/9a2b03834660e7234f755a21e3de613b.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*qJCtSL2ppUEFyf08QZ6xng.png"/></div></figure><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="f650" class="nx ld iq nt b gy ny nz l oa ob">df['Age'] = df['Age_0-9']*0+df['Age_10-19']*1+df['Age_20-24']*2+df['Age_25-59']*3+df['Age_60+']*4</span></pre><p id="ff7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个想法很容易用<strong class="jp ir">序数变量</strong>来标记年龄特征，这也将在所有特征中使用。我们可以将这一过程称为顺序编码，对于具有自然排序的分类变量非常有用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi od"><img src="../Images/19ed47e9e949cb47de78b5e9d1ffe2bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tULr8vFNRE1jlie9Fj08Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Image by Author: display of the dataframe, before and after the processes in this section. Comments: the output (Y1, Y2, Y3, Y4) is column 19–22 at the image left. The new output (Y, the only one) is column 15 at the image right.</figcaption></figure><h1 id="2e10" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">3.朴素贝叶斯</h1><p id="42be" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">朴素贝叶斯分类器是用于分类任务的概率机器学习模型。分类是一个两步的过程，学习步骤和预测步骤。在学习步骤中，基于给定的训练数据开发模型。在预测步骤中，模型用于预测给定数据的响应。朴素贝叶斯分类器通过假设特征独立于给定类别，即，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/b784d090d063c847ea163601d21fd82a.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*6DrAL45OC8YctbkjrqQYtA.png"/></div></figure><p id="fd42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中X=X1，X2，..Xn是特征向量，Y是类别。</p><p id="b389" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据贝叶斯定理，其中A和B是事件，P(B)不为零，条件概率可以用下面的公式计算。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi of"><img src="../Images/c9eeb524e6277346fe132b806247ab0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*TQJfSdJu7BxMyr1PnfWY6Q.png"/></div></figure><p id="f691" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个公式有助于<strong class="jp ir">贝叶斯推断</strong>，其中<strong class="jp ir">T3可以进行一个假设的概率。鉴于前因后果，如果A是后果，那么B就是带来A的潜在变量，在一个分类问题中，Y代表类，X代表特征。我们可以发现对Y的预测是基于对x的观察。</strong></p><p id="ff6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果给定n维X，Y属于{c1，c2，…，ck}，所有可能类的集合，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/334945d51bd89e3ba58ceb4c0fc51aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*QuD9etLPElXIK6sEQN0IfA.png"/></div></figure><p id="4e47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于X向量中的每个特征都是独立的，因此</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/a6a998ee2ea9e32daf2ecf531e4694c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*2SZPhLWE-8Csz1MhJQZPxg.png"/></div></figure><p id="418e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过结合这两个公式，我们得到了朴素贝叶斯分类器的表达式，这对我们以后的编程工作是必不可少的。在我们的代码中，我们只是使用了NumPy和Pandas，以便对这个数学表达式有进一步的理解。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/826cf49d97becafb26bd0fce67ff965e.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*Z_MiQFb32x6b5jDhkix2Ww.png"/></div></figure><p id="1cb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">朴素贝叶斯在许多实际应用中被证明是有效的，包括文本分类、医疗诊断和系统性能管理。</p><h1 id="59a7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">4.基于Numpy和Pandas的朴素贝叶斯分类器</h1><p id="c73d" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">首先，我们应该将数据分成训练集和测试集。像大多数人一样，我们将80%的数据划分到训练集中，其余的数据划分到测试集中。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="64ae" class="nx ld iq nt b gy ny nz l oa ob">np.random.seed(1)<br/>train=df.sample(frac=0.8,random_state=1) <br/>test=df.drop(train.index)</span></pre><p id="853b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们开始计算先验概率P(Y=ck)。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="0514" class="nx ld iq nt b gy ny nz l oa ob">prior = (train.groupby('Severity').size()).div(len(train)) <br/>print(prior)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oj"><img src="../Images/c705284bcef249976a93fe463122c81e.png" data-original-src="https://miro.medium.com/v2/resize:fit:312/format:webp/1*CAjZDu8SsTioEP11LxCGyg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">image by Author: index: 0 represents none in severity, in other words, not infected; 1 is mild severity; 2 is moderate severity; 3 is a severe infection. values at the left represent the prior probability of y=0, 1, 2, 3.</figcaption></figure><p id="ecda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基于先验概率，我们可以继续计算找到给定类别标签的每个要素的概率。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="c37f" class="nx ld iq nt b gy ny nz l oa ob">likelihood = {}<br/><strong class="nt ir">for</strong> x <strong class="nt ir">in</strong> train.columns[:-1]:<br/>  likelihood[x] = (train.groupby(['Severity',x]).size()).div(len(train)).div(prior)</span></pre><p id="d37c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在字典似然中，我们保存了任务所需的朴素贝叶斯分类器的后验概率——新冠肺炎检验器。</p><p id="f980" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了预测某人是否患有新冠肺炎，我们只需要输入各种症状、经历和个人信息的特征向量。然后模型可以告诉我们他是否感染了新冠肺炎病毒，以及他的感染程度有多严重。全部代码都写在Colab上。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="884a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，模型的测试结果并不像我们想象的那么好:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/7dc31d7e21645e749c58140e0c79d94c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*ScpRRyrTk9WI0I7SSn9P0g.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">image by Author: prediction in the test set</figcaption></figure><p id="eee1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">顺便说一下，我们不必每次都只用熊猫或Numpy来实现贝叶斯分类器。我们可以直接从Sklearn导入适当的分类器，如下所示:</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="5e3c" class="nx ld iq nt b gy ny nz l oa ob"><strong class="nt ir">from</strong> <strong class="nt ir">sklearn.naive_bayes</strong> <strong class="nt ir">import</strong> GaussianNB,CategoricalNB<br/>gnb = CategoricalNB()<br/>y_pred = gnb.fit(x_train, y_train).predict(x_test)</span></pre><p id="d077" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们用Numpy和Pandas进行编码，只是为了让这个过程更加透明和直观。如果你对贝叶斯分类模型不陌生，强烈推荐Sklearn，效率更高。</p><h1 id="d5a4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">5.估价</h1><p id="5bbc" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated">到目前为止，我们已经训练了一个朴素贝叶斯分类器，用于基于Kaggle的给定数据集检查新冠肺炎感染。不幸的是，它的测试集预测并不比黑暗中的射击好，对于Y空间中的4个目标，它也可以达到大约1/4 Acc。</p><p id="3725" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发生了什么事？</p><p id="f527" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们深入细节之前，我们应该始终牢记的一个前提是<strong class="jp ir">特征在朴素贝叶斯分类器下是独立的</strong>。</p><p id="d283" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的新冠肺炎检查的特征向量由主要症状和其他经历组成，它们不是完全相互独立的。我们可以想象，如果有人发烧，那个人也会很容易疲倦。如果有人现在鼻塞，下一分钟就可能流鼻涕。无论你感染的是哪一种，主要症状通常是相互伴随的。</p><p id="eb58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，并非所有列出的特征都是分类的重要特征。它们可能起到了显示病人情况的作用，但不够科学或详细。我们知道37.9°C和39.9°C无疑是发烧的信号。一个体温37.9摄氏度的人可以闲逛，而另一个体温39.9摄氏度的人肯定会发烧，这在给定的数据中没有得到清楚的解释。对特征进行定量测量会有很大帮助。除了判断是否发烧，我们还可以用温度来更准确地描述症状。其他症状也是如此，如持续咳嗽或偶尔咳嗽。我们需要一个合适的比例来定义特征。</p><p id="3afa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们能在这两个方面做出相应的调整，朴素贝叶斯分类器在检测新冠肺炎感染方面应该会显示出良好的性能。</p><p id="a249" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，建议与我们的话题无关。如果你感觉不舒服，并且一些症状已经出现好几天了，抗体测试可以告诉你是否感染了病毒。即使是最著名的医生也不能仅仅根据你的口头描述来判断是否有新冠肺炎感染。这实际上是训练模型不起作用的第三个原因😅。</p><h1 id="f64a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">6.参考</h1><p id="d7cc" class="pw-post-body-paragraph jn jo iq jp b jq nn js jt ju no jw jx jy np ka kb kc nq ke kf kg nr ki kj kk ij bi translated"><a class="ae lb" href="https://www.cc.gatech.edu/~isbell/reading/papers/Rish.pdf" rel="noopener ugc nofollow" target="_blank"> Rish，伊琳娜。"朴素贝叶斯分类器的实证研究."人工智能经验方法国际学术会议2001研讨会。第三卷。№22.2001.</a></p></div></div>    
</body>
</html>