<html>
<head>
<title>TensorFlow.js Helps Recognize Large Quantities of Icons in Milliseconds!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorFlow.js帮助在毫秒内识别大量图标！</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/tensorflow-js-helps-recognize-large-quantities-of-icons-in-milliseconds-289709671ecc?source=collection_archive---------27-----------------------#2021-01-12">https://medium.datadriveninvestor.com/tensorflow-js-helps-recognize-large-quantities-of-icons-in-milliseconds-289709671ecc?source=collection_archive---------27-----------------------#2021-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/9a2d647181cdf6dc8c87ceebcdfd43fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*ijkDe4FC-n3QOWRD.jpeg"/></div></figure><p id="d87a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">作者田可</em></p><h1 id="faa4" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">背景</h1><p id="5ab0" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在前端开发过程中，需要恢复图像的图标。在大多数情况下，图标没有相应的<code class="fe lw lx ly lz b">type</code>字段。如果用户需要用肉眼从数百个图标中寻找自己需要的东西，结果就是用户体验很差。</p><p id="5fb7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，去年，我提交了一个<a class="ae ma" href="https://ant.design/" rel="noopener ugc nofollow" target="_blank">蚂蚁设计</a>开源项目的pull请求。pull request贡献了一个新功能，基于深度学习技术搜索带有截图的图标。当用户点击、拖动或粘贴设计中的图标截图或任何要上传的图像时，他们可以搜索最佳匹配和相应的匹配率。记住<strong class="jw ir">所有识别任务都是由前端完成的！</strong></p><p id="8b43" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下图显示了效果:</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mb"><img src="../Images/46e4f66ec7d9dff8fc79e14b86878138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yO8qJkKIQ4Xt_owZ.gif"/></div></div></figure><p id="edf1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">也可以在官网体验:<a class="ae ma" href="https://ant.design/components/icon/" rel="noopener ugc nofollow" target="_blank">https://ant.design/components/icon/</a></p><p id="fb0e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们如何实现这项技术？本文将揭示这项技术背后的秘密:</p><ul class=""><li id="36c6" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated">深度学习简介</li><li id="efa5" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">样本生成</li><li id="c284" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">模特培训</li><li id="4af7" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">模型压缩和转换</li><li id="12cc" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">TensorFlow.js识别</li></ul><h1 id="840e" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">深度学习简介</h1><p id="8561" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">如前所述，该功能是基于深度学习实现的。什么是深度学习？深度学习是机器学习的一种。机器学习是对基于“经验”自动改进的计算机算法的研究。</p><p id="6277" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里的关键词是体验。长期以来，人类根据自己的经验来解决问题。比如，早在中世纪，就有人通过测量16个男人的平均脚长来估算所有男人的平均脚长。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/2bc2794ad1a1355dd50fb7bea83b977d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/0*tJ-zctRp5enLWjW2.png"/></div></figure><p id="c66f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是另一个例子。如果给你很多身高体重数据以及一个人的身高，你能估算出这个人的体重吗？</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mz"><img src="../Images/74d18ee704f0f5998c0d2e4ce8a3b001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T2HV5p_gvyVNikgf.png"/></div></div></figure><p id="c677" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当然可以！可以在上图所示的y = ax + b的公式中计算出a和b的值，然后根据身高计算出一个人的体重。在机器学习中，a叫权重，b叫偏差。更具体地说，这在机器学习中被称为线性回归。</p><p id="147d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">计算机可以学习数字模式。如果我们将图像、声音或文本转换成数字，计算机能识别这些模式吗？当然可以！然而，模型要复杂得多。</p><h1 id="7160" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">图像分类</h1><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/0b98c3d45ddfd11344fab4222aecf5dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/0*VVGjJCy4uHWIprVg.png"/></div></figure><h2 id="8e10" class="nb ku iq bd kv nc nd dn kz ne nf dp ld kf ng nh lh kj ni nj ll kn nk nl lp nm bi translated">语音助手</h2><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nn"><img src="../Images/a9773f0d80370bcac9d05e1568dc86b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vV-FlWzB-zg6Mfj4.png"/></div></div></figure><p id="1fb5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们使用一种叫做卷积神经网络的深度学习模型对图标截图进行分类。</p><p id="49ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">无论我们谈论的是简单的线性回归还是复杂的深度学习，模型都是从“经验”中学习的。这里的“经验”在机器学习中称为“样本”。所以首先要生成机器学习的样本。</p><h1 id="112f" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">样本生成</h1><p id="0a2b" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在此图标分类任务中，样本由两部分组成:</p><ul class=""><li id="fdb3" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated">形象</li><li id="b17a" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">图像标签</li></ul><p id="2de8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">标签指的是图像的类别名称。比如你想识别图像中是猫还是狗，那么猫和狗就是标签。</p><p id="519d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">研究表明，生成的样本越多，深度学习模型的学习效果就越好。因此，我们采用了集成一个示例页面的方法。它使用木偶戏与FaaS快速生成成千上万的图标图像及其相应的标签。我们如何实现它？</p><ol class=""><li id="5d10" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr no mq mr ms bi translated"><strong class="jw ir">编写一个示例页面:</strong>我们创建一个新的前端页面，它只呈现一个Ant设计图标。然而，这个图标可能是300多个Ant设计图标中的任何一个。除此之外，图标的大小、颜色和位置都是随机呈现的。</li><li id="16b8" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr no mq mr ms bi translated"><strong class="jw ir">使用puppet er循环截图:</strong>编写完一个样本页面后，我们使用puppet er(一个无头浏览器)打开页面，刷新-截图操作自动循环。生成了成千上万的图像。</li><li id="0e68" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr no mq mr ms bi translated"><strong class="jw ir">实现FaaS并发:</strong>在一台PC上生成上万张图片太慢，所以我们预计在100台电脑上并发截图。我们使用FaaS并创建100个实例并发截图，在测量过程中每分钟生成20，000张图像。</li></ol><p id="2bcf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，有许多样品可供选择。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi np"><img src="../Images/a36b1b62fdcbc49baadf48d4c7f5b8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N73TVPYYmtyf0sfS.png"/></div></div></figure><h1 id="5b8e" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">模特培训</h1><p id="c1b6" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">当样本可用时，您可以开始训练模型。我们使用张量流框架。TensorFlow框架提供了一个图片分类的例子供大家下载。运行它时，根据我们刚刚生成的示例指定参数。<a class="ae ma" href="https://github.com/tensorflow/hub/tree/master/examples/image_retraining" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/hub/tree/master/examples/image _ retaining</a></p><p id="191d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以在电脑上进行模型训练。训练模式比较慢，但是一个午休就能完成！</p><p id="5390" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ma" href="https://www.alibabacloud.com/product/machine-learning" rel="noopener ugc nofollow" target="_blank">阿里云机器学习平台AI (PAI) </a>提供可用的图像分类算法和GPU进行加速训练。我没有在PAI上使用图像分类算法。相反，我已经将TensorFlow代码部署到PAI进行模型训练。速度非常快！</p><h1 id="77ab" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">模型转换和压缩</h1><p id="5c6d" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">模型经过训练后，可以用来识别图像。但是，在使用模型之前，Python代码必须部署在服务器上。这会带来以下缺点:</p><ul class=""><li id="3d39" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated"><strong class="jw ir">服务器成本</strong>:部署一个模型需要服务器。蚂蚁设计是一个开源项目，所以我们不愿意承担任何线性增长的成本。</li><li id="f41a" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated"><strong class="jw ir">识别速度:</strong>服务器是集中式的，所以中国以外居住较远的用户在速度方面会受到影响。</li><li id="fb2e" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated"><strong class="jw ir">稳定性:</strong>数十万开发者正在使用蚂蚁设计。如果出现服务器问题，服务器稳定性堪忧，可能会有大量用户受到影响。</li><li id="38f5" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated"><strong class="jw ir">安全:</strong>蚂蚁设计是一个没有任何认证授权的静态公共网站，开放的接口必然会带来一些安全隐患。</li></ul><p id="1b48" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">鉴于这些缺点，我们打算将我们的模型转换为TensorFlow.js模型，并允许用户将后一种模型下载到他们的浏览器上进行识别。这可以带来以下好处:</p><ul class=""><li id="7787" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated"><strong class="jw ir">边缘计算:</strong>每个用户都有一台安装了GPU的电脑。我们的模型下载到每个用户的浏览器后，模型可以使用来自大量用户的GPU的计算能力，降低服务器成本，让用户免除对服务器攻击和服务器稳定性问题的担忧。</li><li id="f6d3" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated"><strong class="jw ir">识别速度快:</strong>模型下载到每个用户的浏览器，识别过程几乎是实时的，不涉及网络传输。</li></ul><p id="f51b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">模型转换和压缩都使用tfjs-converter:<a class="ae ma" href="https://github.com/tensorflow/tfjs/tree/master/tfjs-converter" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/tfjs/tree/master/tfjs-converter</a></p><p id="849a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们使用MobileNet进行迁移学习。型号为16 MB，压缩到3 MB左右，发布到jsDelivr进行全局加速。</p><h1 id="aa96" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">TensorFlow.js识别</h1><p id="cb24" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">现在，您需要编写一些TensorFlow.js代码。首先，加载模型文件。代码片段如下所示:</p><pre class="mc md me mf gt nq lz nr ns aw nt bi"><span id="5349" class="nb ku iq lz b gy nu nv l nw nx">const MODEL_PATH = 'https://cdn.jsdelivr.net/gh/lewis617/antd-icon-classifier@0.0.1/model/model.json';<br/>model = await tfconv.loadGraphModel(MODEL_PATH);</span></pre><p id="13d2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，把图标截图转换成张量。</p><p id="7783" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">张量是一种类似于多维数组的数据结构。在TensorFlow中，模型的输入和输出是张量。因此，在训练和识别之前，必须将数据转换成张量。</p><pre class="mc md me mf gt nq lz nr ns aw nt bi"><span id="52e2" class="nb ku iq lz b gy nu nv l nw nx">// Convert images into tensors<br/>constimg=tf.browser.fromPixels(imgEl).toFloat();</span><span id="4aaa" class="nb ku iq lz b gy ny nv l nw nx">constoffset=tf.scalar(127.5);<br/>// Normalize an image from [0, 255] to [-1, 1]<br/>constnormalized=img.sub(offset).div(offset);</span><span id="fbad" class="nb ku iq lz b gy ny nv l nw nx">// Change the image size <br/>let resized = normalized;<br/>if (img.shape[0] !== IMAGE_SIZE || img.shape[1] !== IMAGE_SIZE) {<br/>  const alignCorners = true;<br/>  resized = tf.image.resizeBilinear(<br/>    normalized, [IMAGE_SIZE, IMAGE_SIZE], alignCorners,<br/>  );<br/>}</span><span id="067b" class="nb ku iq lz b gy ny nv l nw nx">// Change the shape of a tensor to meet the model requirements<br/>constbatched=resized.reshape([-1,IMAGE_SIZE,IMAGE_SIZE,3]);</span></pre><p id="b643" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，开始识别图像。代码片段如下所示:</p><pre class="mc md me mf gt nq lz nr ns aw nt bi"><span id="ee9c" class="nb ku iq lz b gy nu nv l nw nx">pred=model.predict(batched).squeeze().arraySync();<br/>// Find the categories with the highest matching degree<br/>const predictions = findIndicesOfMax(pred, 5).map(i =&gt; ({<br/>    className: ICON_CLASSES[i],<br/>    score: pred[i],<br/>  }));</span></pre><p id="ff7c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，最后的结果就显示出来了！</p><p id="5111" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">GitHub上有完整的代码。点击<a class="ae ma" href="https://github.com/lewis617/antd-icon-classifier" rel="noopener ugc nofollow" target="_blank">此链接</a>获取完整代码。</p><h1 id="9ea0" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">原始来源:</h1><div class="nz oa gp gr ob oc"><a href="https://www.alibabacloud.com/blog/tensorflow-js-helps-recognize-large-quantities-of-icons-in-milliseconds_597000" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">TensorFlow.js帮助在毫秒内识别大量图标！</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">阿里巴巴F(x)团队2020年12月11日164在前端开发过程中，图片的图标需要恢复…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">www.alibabacloud.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq js oc"/></div></div></a></div></div></div>    
</body>
</html>