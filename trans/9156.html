<html>
<head>
<title>Creating the Optimal Portfolio of Philippine Stocks Through Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过分析创建菲律宾股票的最优投资组合</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/creating-the-optimal-portfolio-of-philippine-stocks-through-analytics-c40f76f90545?source=collection_archive---------8-----------------------#2021-02-02">https://medium.datadriveninvestor.com/creating-the-optimal-portfolio-of-philippine-stocks-through-analytics-c40f76f90545?source=collection_archive---------8-----------------------#2021-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="4318" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">PYTHON。FASTQUANT。投资。菲律宾</h2><div class=""/><div class=""><h2 id="e082" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Fastquant、Scipy和优化理论创建回报风险效率最高的股票投资组合</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/3751271d6c68f63441b31bac5c0a5348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_AYg9g8mrOC1Wu3C"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Photo by <a class="ae lh" href="https://unsplash.com/@adamaszczos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Adam Nowakowski</a> on <a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b8b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你尝试过投资股市，那么你最有可能面临“选择哪只股票”、“关注哪个行业”、“每只股票应该配置多少”等多重投资决策。</p><p id="088e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">幸运的是，Harry Markowitz为最后一个问题提供了答案，这个问题也被认为是投资中最困难的问题之一:<em class="me">投资组合证券选择</em>。他的现代投资组合理论(MPT)为他赢得了诺贝尔奖，并介绍了组合投资的思想以及证券的风险和相关性如何影响整个投资组合。</p><p id="ef4c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以你可能认为有很多方法可以回答“我应该投资多少”这个问题，但是最优化理论和Markowitz的工作会告诉你只有一个正确的答案。</p><p id="c0d3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将使用由菲律宾数据科学家开发的<em class="me"> fastquant </em>软件包，这是唯一一个可以轻松连接和访问菲律宾证券交易所数据的软件包。(<em class="me">其他软件包很难检索与全球股票有相同代码的股票</em>)</p><p id="0843" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文将讨论理论背后的数学以及一些代码。对于那些仅仅想要代码的人，<strong class="lk jd">你可以跳到标有“代码”的章节</strong>。</p><h1 id="fc8c" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated"><strong class="ak">金融数学:最优化理论和算法</strong></h1><p id="639e" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">最优化理论要求理解线性代数和矩阵运算。你将在下面看到的优化模型都是矩阵符号，所以这将有助于回顾一些基础知识。</p><p id="8e28" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">事实上，即使使用Scipy优化，定制代码也需要线性代数和矩阵的基础知识。</p><p id="92e2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最优投资组合有三种基本模型或版本(如果你愿意这么称呼的话)。这将取决于你的目标和约束。</p><p id="8299" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">任何优化问题最多有以下几个组成部分:</p><ol class=""><li id="c578" class="nc nd it lk b ll lm lo lp lr ne lv nf lz ng md nh ni nj nk bi translated"><strong class="lk jd">目标函数</strong> —我们希望优化的函数(最小化或最大化)</li><li id="f257" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md nh ni nj nk bi translated"><strong class="lk jd">决策变量</strong>——为达到最佳输出应改变的变量</li><li id="2d6d" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md nh ni nj nk bi translated"><strong class="lk jd">约束</strong> —如果没有约束，这被称为无约束优化。</li></ol><p id="357e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">利用这些基本知识，让我们开始使用三种股票的场景来查看我们的三个模型:</p><h2 id="2b2f" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated"><strong class="ak">型号1 </strong></h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/bc5cd9133f3abb9182163184f79f964b.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*2CBFDad0NoYoGC6P3JUbrw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">A Three-Stock model whose objective function aims to minimize portfolio variance. Note that the last constraint is ensuring that the sum of all the weights would equal 1.</figcaption></figure><p id="8183" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">模型1的目标是在给定回报的前提下，最小化投资组合的方差。这种模式最适合优先考虑风险管理的<strong class="lk jd"><em class="me"/></strong>金融机构。</p><p id="1c62" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，一家银行希望将风险(<em class="me">投资组合方差</em>)降至最低，同时确定其投资组合的年回报率至少应为10%，以满足其盈利目标。</p><h2 id="03f2" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated"><strong class="ak">模式二</strong></h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/ad7e34153a70dbf3814a7d02896af708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*VUyPXT90IaCJLwe3nF5R-g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">A Three-Stock model whose objective function aims to maximize portfolio return. Note that the last constraint is ensuring that the sum of all the weights would equal 1.</figcaption></figure><p id="9246" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">模型2旨在根据特定的风险水平最大化投资组合的回报。这种模式更<strong class="lk jd"> <em class="me">适合已经确定了自己可接受风险水平的金融机构或公司，因此更关心收益最大化</em> </strong>。</p><p id="c6ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，一家保险公司预测，为了成功管理流动性需求，投资组合方差不应超过5%。在满足约束条件后，我们可以专注于最大化回报。</p><h2 id="d0a0" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated"><strong class="ak">型号3 </strong></h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/04cad69738d9afd75fc36ec077686380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rjpkWQ8Zf4en4IanLL83Gg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">A Three-Stock model whose objective function aims to maximize the tradeoff or return and risk subject to the level of risk-aversion. Note that the last constraint is ensuring that the sum of all the weights would equal 1.</figcaption></figure><p id="cad5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">模型3旨在最大化收益和风险的权衡，以规避风险的水平为准。这个模型更适合于那些已经计算出他们的风险规避水平的更先进的金融机构。一些先进的资产管理公司使用这种模式。</p><h2 id="7d3b" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated"><strong class="ak">工作流程</strong></h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/5042b97b78b5c33362c9f385f5997b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*LAyWtRg81C0hcK46b9silQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">General Workflow for the Mean-Variance Optimization Problem. We can see that we need three primary inputs: returns information, covariance matrix, and the portfolio weight of the stocks.</figcaption></figure><p id="4ac9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于初学者来说，我们需要做的计算最优投资组合的工作量可能太大了。上面的工作流程应该有助于我们正确看待事情，并为流程提供一点秩序。</p><h1 id="8177" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated"><strong class="ak">代码</strong></h1><p id="e55d" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">确保安装了<em class="me"> fastquant </em>。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="3e65" class="nq mg it og b gy ok ol l om on">pip install fastquant</span></pre><p id="2be6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">导入必要的包:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="30e0" class="nq mg it og b gy ok ol l om on">from fastquant import get_stock_data, get_stock_table<br/>import pandas as pd<br/>import numpy as np</span><span id="2286" class="nq mg it og b gy oo ol l om on">#Optimization<br/>import scipy.optimize as optimization</span></pre><h2 id="84fc" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated">第一步:选择股票组合</h2><p id="0ff8" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">假设我们想在我们的投资组合中包括以下股票:</p><ul class=""><li id="4926" class="nc nd it lk b ll lm lo lp lr ne lv nf lz ng md op ni nj nk bi translated">超级世界</li><li id="83ce" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">宿务太平洋(CEB)</li><li id="131a" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">奥罗银行(BDO)</li><li id="e823" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">阿亚拉土地公司</li><li id="a483" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">梅拉尔科公司</li><li id="f878" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">阿亚拉公司</li><li id="2e5d" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">JG首脑会议(JGS)</li><li id="3c5f" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">环球罗比纳公司</li><li id="355a" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">乔利比食品公司</li><li id="8ca8" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">菲律宾七公司(SEVN)</li><li id="51e0" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">博戈·麦德林制粉公司</li><li id="0760" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">第一代</li><li id="2447" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated"><strong class="lk jd">马克斯集团公司(MAXS)</strong></li><li id="89b3" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md op ni nj nk bi translated">纯金</li></ul><p id="c39f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">用库存代码创建一个列表。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="0c18" class="nq mg it og b gy ok ol l om on">stocks = ['MEG','CEB', 'BDO','ALI', 'MER', 'AC', 'JGS', 'URC', <br/>          'JFC', 'SEVN', 'BMM', 'CAT', 'FGEN', 'MAXS', 'PGOLD']</span></pre><h2 id="bea8" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated"><strong class="ak">第二步:计算这些股票的回报率</strong></h2><p id="ae32" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">要计算回报，请指定有问题的时间段。这一点至关重要，因为时间段的选择可能与股票市场的高增长期或低增长期相吻合。</p><p id="b8f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们假设代表来年预期回报的正确时间周期由下式给出:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="6251" class="nq mg it og b gy ok ol l om on">START_DATE = "2014-01-01" #yyyy-mm-dd<br/>END_DATE = "2019-12-29"</span></pre><p id="088a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用<em class="me"> fastquant </em>软件包，为所选股票生成一天结束时的<strong class="lk jd">股票价格</strong>:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="2e72" class="nq mg it og b gy ok ol l om on">df = pd.DataFrame()<br/>for stock in stocks:<br/>    try:<br/>        df_ = get_stock_data(stock, START_DATE, END_DATE)<br/>    except:<br/>        continue<br/>    df_.columns = [stock]<br/>    df = pd.concat([df, df_], axis=1)</span></pre><p id="7603" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">得到股票价格后，pandas <em class="me"> pct_change() </em>方法提供了一种计算收益的便捷方法。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="3296" class="nq mg it og b gy ok ol l om on">returns = df.pct_change()<br/>returns.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/fc430de33aec45a79a57e44f0f3cc2bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MuONfwcPcOjeZ_iGqisMNA.png"/></div></div></figure><h2 id="34b1" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated">步骤3:生成收益的协方差矩阵</h2><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="73ec" class="nq mg it og b gy ok ol l om on">cov = returns.cov()<br/>cov.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/486927a41b493c552db669ec5bc2c0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m6AQtnqIAz0us617lxRV6g.png"/></div></div></figure><h2 id="3d56" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated">步骤4:初始化投资组合权重</h2><p id="f105" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">选择的权重必须来自从0到1的均匀分布。幸运的是，<em class="me"> NumPy </em>的<em class="me"> random.random </em>来自一个连续的、均匀的分布。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="6a7a" class="nq mg it og b gy ok ol l om on">weights = np.random.random(len(stocks))<br/>weights /= np.sum(weights)<br/>weights</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/41fc87ecb1d82f13287ac011e8f699fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*waoMdnoK4M40lRrV3sICjg.png"/></div></figure><p id="b4b3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些初始化的权重是我们的优化器可以使用的对象所必需的。</p><h2 id="c10c" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated">第五步:解决优化问题</h2><p id="83ac" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">为了使用Scipy优化器，我们需要定义一个函数来优化它。</p><p id="d9d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们有几个模型可以使用，但我们可以修改基本模型，以针对特定的指标，投资组合经理用来评估投资组合的表现。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/c152bdd745b5cdd3bd87122d169bfdc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WNQq0SvFuMANK5XzK1ylw.png"/></div></div></figure><p id="3724" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">夏普比率衡量投资组合每单位风险的<strong class="lk jd"><em class="me"/></strong>超额收益。它告诉你一个投资组合是否为了更高的回报而在一些风险(标准差)的交易中做得很好(<em class="me"> rp </em>)。夏普比率越高，投资组合的表现越好。</p><p id="966a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，最大化夏普比率在某种程度上类似于我们的模型3。</p><p id="5aa8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">任何优化问题的标准形式都是最小化，通过在任何函数上加上负号，最小化就变成了最大化问题。</p><p id="04e1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们定义Scipy将最小化的目标函数:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="501e" class="nq mg it og b gy ok ol l om on">def portfolio_metrics(weights):<br/>    <br/>    '''<br/>    This function generates the relative performance metrics that will be reported and will be used<br/>    to find the optimal weights.<br/>    <br/>    Parameters:<br/>    weights: initialized weights or optimal weights for performance reporting<br/>    <br/>    '''   <br/>    rf = 0.02 risk-free rate<br/>    rp = (returns.mean()*252)<a class="ae lh" href="http://twitter.com/weights" rel="noopener ugc nofollow" target="_blank">@weights</a> <br/>    port_var = weights@(cov*252)<a class="ae lh" href="http://twitter.com/weights" rel="noopener ugc nofollow" target="_blank">@weights</a><br/>    sharpe = (rp-rf)/np.sqrt(port_var)<br/>    df = pd.DataFrame({"Expected Return": rp,<br/>                       "Portfolio Variance":port_var,<br/>                       'Portfolio Std': np.sqrt(port_var),<br/>                       'Sharpe Ratio': sharpe}, index=["MV-Optimal Portfolio"])<br/>    return df</span></pre><p id="56a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用上面的函数，因为我们只需要夏普比率，我们可以这样定义函数:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="85c1" class="nq mg it og b gy ok ol l om on">#Objective Function<br/>def min_sharpe_ratio(weights):<br/>    return -portfolio_metrics(weights).loc['MV-Optimal Portfolio','Sharpe Ratio']</span></pre><p id="8c4b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Scipy优化器的下一个输入是约束。回想一下，在上面的模型中，我们有两种类型的约束，等式约束和不等式约束。</p><p id="6a93" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">投资组合优化问题的一个常见约束是“完全投资”约束，这意味着投资组合的权重总和应为1。</p><p id="6019" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Scipy约束都是结构化的，因此等式的右边总是‘0’。因此，为了表示“完全投资”约束，我们写下:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="939d" class="nq mg it og b gy ok ol l om on">#Constraints<br/>constraints = [{'type':'eq','fun': lambda x: np.sum(x)-1}]</span><span id="43aa" class="nq mg it og b gy oo ol l om on">#Bounds<br/>bounds = [(0, 1) for i in range(len(stocks))] #because each weight, as a percentage, should just be between 0 to 1.</span></pre><p id="9de4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为优化器设置好输入后，我们现在可以编写优化代码了:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="ca7f" class="nq mg it og b gy ok ol l om on">opt_weights = optimization.minimize(fun=min_sharpe_ratio,x0=weights,method='SLSQP',bounds=bounds,constraints=constraints)['x']</span></pre><p id="a2f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了检查dataframe格式的输出，我们可以编写另一个函数，该函数获取优化器的输出，并将其与特定的股票代码进行匹配:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="49be" class="nq mg it og b gy ok ol l om on">def optimal_portfolio_weights(weights):<br/>    df = pd.DataFrame({"Stock": stocks,<br/>                       "Weights": weights})<br/>    df.Weights = df.Weights.map(lambda x: '{:.2%}'.format(x))<br/>    return df</span><span id="376d" class="nq mg it og b gy oo ol l om on">optimal_portfolio_weights(opt_weights)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/ccbe20527b207922cad59c0bd8ac7f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*4rVkYf9NE6WgTIN9Iv8knw.png"/></div></figure><p id="1b66" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们所看到的，最优投资组合中股票配置最多的是BDO。最优投资组合同样不允许我们将任何东西分配给URC、JFC、MEG和PGOLD。</p><p id="b96e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意，这并不意味着这些配置为0%的股票是低效的或不可取的。只是在这种特殊的组合中，你可以优化回报和风险之间的权衡，而不用那些股票。在投资组合的其他组合中，它们的权重可能是正的。</p><p id="cf05" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了计算这个投资组合的指标，我们可以简单地将优化器计算的最优权重插入到我们定义的函数中:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="7f7f" class="nq mg it og b gy ok ol l om on">portfolio_metrics(opt_weights)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/9ec6d0c38d005afbefaace298a8e9248.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*-JRF0EoCRLx8OCNf2tkTpA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Note that for the Sharpe Ratio, we used 2% as our risk-free rate.</figcaption></figure><p id="94d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们看到，使用我们的最佳权重，我们预计我们的投资组合在一年内的回报率为23%，波动率约为19%。</p><p id="5abb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最佳的夏普比率似乎是1.13，这被金融文献认为是好的(任何超过1的夏普比率也是如此)。</p><h1 id="cbea" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated"><strong class="ak">基本情况的修改</strong></h1><p id="dfac" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">在这个练习中，我们只使用了历史回报，并将其作为预期回报。这个练习的其他更高级的版本将使用“预测”回报。对于这种情况，我发现ARIMA工作得最好，也许是我下一篇文章的主题。</p><p id="3172" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所选择的时间段可能会在很大程度上影响回报，进而影响我们拥有的协方差数据。在选择历史时间段时，最重要的考虑因素是，它类似于所讨论的投资组合的一年持有期。</p><p id="ab6b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我的Github页面上有完整的代码。</p><h2 id="0a0a" class="nq mg it bd mh nr ns dn ml nt nu dp mp lr nv nw mr lv nx ny mt lz nz oa mv iz bi translated"><strong class="ak">参考文献</strong></h2><p id="42dd" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated"><a class="ae lh" href="https://enzoampil.github.io/fastquant-blog/portfolio/optimization/2020/06/20/basic_portfolio.html" rel="noopener ugc nofollow" target="_blank">https://enzoampil . github . io/fast quant-blog/portfolio/optimization/2020/06/20/basic _ portfolio . html</a><br/><br/><a class="ae lh" href="https://towardsdatascience.com/time-series-forecasting-predicting-stock-prices-using-an-arima-model-2e3b3080bd70" rel="noopener" target="_blank">https://towards data science . com/time-series-forecasting-predicting-stock-prices-using-an-ARIMA-model-2e3b 3080 BD 70</a></p></div></div>    
</body>
</html>