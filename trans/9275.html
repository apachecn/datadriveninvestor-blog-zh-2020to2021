<html>
<head>
<title>Predicting Real Estate prices in Kings County, Washington — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测华盛顿金斯县的房地产价格-第1部分</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/predicting-real-estate-prices-in-kings-county-washington-part-1-bdca5f0db058?source=collection_archive---------4-----------------------#2021-02-05">https://medium.datadriveninvestor.com/predicting-real-estate-prices-in-kings-county-washington-part-1-bdca5f0db058?source=collection_archive---------4-----------------------#2021-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bd73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是两部分系列的第1部分。在本文中，我们执行数据探索。</p><h1 id="c6a7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">项目目标</h1><p id="338b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这个项目的目标是模拟美国华盛顿州金斯县的房地产价格。我们希望该模型能够基于我们用来构建模型的数据集中提供的许多特征来准确预测房价。预计一旦完成，该模型可被在金斯县地区经营的房地产投资者用作选择投资物业的工具。</p><h1 id="2f97" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">该过程</h1><p id="3c33" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们将使用金斯县住房数据集，<em class="lo"> kc_housing_data.csv </em>，该数据集可在Kaggle.com的<em class="lo">获得。数据集包含21列。一个是房屋的价格，其余的我们将用来做预测。</em></p><h1 id="c08e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">数据探索</h1><p id="4e90" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们将检查数据以获得对它的理解。我们将寻找缺失的值、数据类型和特性之间的关系。我们将确定某些数据是否可以被视为连续的或分类的。我们将使用可视化来帮助我们。</p><h1 id="733d" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">数据预处理</h1><p id="e1b5" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">当我们对我们的数据有了一个好的感觉时，我们将着手清理它。我们将解决价值观缺失的问题。如有必要，删除数据行的特征。如果需要，我们将把数字数据转换成分类数据。如果需要，我们甚至可以反过来做。我们还将处理分类数据的编码，根据需要决定任意数量的编码方案。基于我们发现，可能有必要执行转换和缩放。</p><h1 id="8c2a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">密码</h1><p id="fccf" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><em class="lo"> resources.py </em>中的所有代码也可以以markdown文件格式查看。为了便于参考，请查看<em class="lo">资源。MD </em>。</p><h1 id="51d0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">模型评估</h1><p id="1bce" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">然后，我们将尝试几种模型，对每种模型进行评估，以选择性能最佳的模型。</p><h1 id="0cbc" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">加载所有需要的python模块</h1><p id="3f3f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们从导入所有必要的Python库开始。我们还从<em class="lo"> source.resources </em>导入所有函数。这个模块包含了我们在数据清理、特征选择、创建交互术语等方面需要的许多功能</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2782" class="ly km iq lu b gy lz ma l mb mc"><strong class="lu ir">from</strong> <strong class="lu ir">source.resources</strong> <strong class="lu ir">import</strong> *<br/><strong class="lu ir">import</strong> <strong class="lu ir">pandas</strong> <strong class="lu ir">as</strong> <strong class="lu ir">pd</strong><br/><strong class="lu ir">import</strong> <strong class="lu ir">numpy</strong> <strong class="lu ir">as</strong> <strong class="lu ir">np</strong><br/><strong class="lu ir">import</strong> <strong class="lu ir">matplotlib.pyplot</strong> <strong class="lu ir">as</strong> <strong class="lu ir">plt</strong><br/><strong class="lu ir">import</strong> <strong class="lu ir">seaborn</strong> <strong class="lu ir">as</strong> <strong class="lu ir">sns</strong><br/><br/><strong class="lu ir">from</strong> <strong class="lu ir">sklearn.model_selection</strong> <strong class="lu ir">import</strong> train_test_split<br/><strong class="lu ir">from</strong> <strong class="lu ir">sklearn.linear_model</strong> <strong class="lu ir">import</strong> LinearRegression<br/><strong class="lu ir">from</strong> <strong class="lu ir">sklearn.model_selection</strong> <strong class="lu ir">import</strong> cross_val_score<br/><strong class="lu ir">from</strong> <strong class="lu ir">sklearn.model_selection</strong> <strong class="lu ir">import</strong> KFold<br/><strong class="lu ir">from</strong> <strong class="lu ir">sklearn.preprocessing</strong> <strong class="lu ir">import</strong> PolynomialFeatures<br/><strong class="lu ir">from</strong> <strong class="lu ir">sklearn.metrics</strong> <strong class="lu ir">import</strong> mean_squared_error, r2_score<br/><br/><strong class="lu ir">import</strong> <strong class="lu ir">itertools</strong> <strong class="lu ir">as</strong> <strong class="lu ir">it</strong><br/><strong class="lu ir">from</strong> <strong class="lu ir">statsmodels.regression</strong> <strong class="lu ir">import</strong> linear_model<br/><strong class="lu ir">import</strong> <strong class="lu ir">statsmodels.api</strong> <strong class="lu ir">as</strong> <strong class="lu ir">sm</strong><br/><strong class="lu ir">from</strong> <strong class="lu ir">statsmodels.formula.api</strong> <strong class="lu ir">import</strong> ols<br/>%matplotlib inline</span></pre><h1 id="58d7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">探索数据</h1><p id="f38f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们制作了一份拷贝，这样原始数据保持不变。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="8150" class="ly km iq lu b gy lz ma l mb mc">kc_data = pd.read_csv('kc_house_data.csv')<br/>kc_data_copy = kc_data.copy()</span></pre><h2 id="36b3" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">获取一些基本信息</h2><p id="3f46" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">使用<em class="lo"> info() </em>和*head()，我们得到了数据的第一瞥。我们可以看到有21列21597条记录。大多数数据都是数字。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2144" class="ly km iq lu b gy lz ma l mb mc">md(f'There are <strong class="lu ir">{</strong>kc_data.shape[0]<strong class="lu ir">}</strong> rows and <strong class="lu ir">{</strong>kc_data.shape[1]<strong class="lu ir">}</strong> columns')<br/>kc_data.info()<br/>kc_data.head()</span></pre><p id="86c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有21597行和21列</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="7040" class="ly km iq lu b gy lz ma l mb mc">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 21597 entries, 0 to 21596<br/>Data columns (total 21 columns):<br/>id               21597 non-null int64<br/>date             21597 non-null object<br/>price            21597 non-null float64<br/>bedrooms         21597 non-null int64<br/>bathrooms        21597 non-null float64<br/>sqft_living      21597 non-null int64<br/>sqft_lot         21597 non-null int64<br/>floors           21597 non-null float64<br/>waterfront       19221 non-null float64<br/>view             21534 non-null float64<br/>condition        21597 non-null int64<br/>grade            21597 non-null int64<br/>sqft_above       21597 non-null int64<br/>sqft_basement    21597 non-null object<br/>yr_built         21597 non-null int64<br/>yr_renovated     17755 non-null float64<br/>zipcode          21597 non-null int64<br/>lat              21597 non-null float64<br/>long             21597 non-null float64<br/>sqft_living15    21597 non-null int64<br/>sqft_lot15       21597 non-null int64<br/>dtypes: float64(8), int64(11), object(2)<br/>memory usage: 3.5+ MB</span><span id="d345" class="ly km iq lu b gy mo ma l mb mc">kc_data.shape[0] - kc_data.id.nunique()<br/>177</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mp"><img src="../Images/fa30c2199da76c042fb7860491ac0e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eDRM_AybOkllN2kQuYmgAQ.png"/></div></div></figure><h1 id="5164" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第一次观察</h1><h2 id="14ba" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">缺少值</h2><p id="32e1" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">首先突出的是缺少的值。<em class="lo">yr _ renewated</em>的缺失值最多，其次是<em class="lo">滨水</em>。<em class="lo">视图</em>也缺少63。我们需要进一步探索这些问题，然后才能决定如何解决它们。</p><h2 id="9d8b" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">数据类型</h2><p id="0145" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们还可以观察到，<em class="lo">日期</em>特征是object类型，正如<em class="lo"> sqft_basement </em>一样。这些可能需要转换成数字类型。但是我们还没有到那一步。</p><h2 id="5c37" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">我们能放弃“身份”吗</h2><p id="0e4b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">最后，在最初的观察中，我们看到<em class="lo"> id </em>可能有一些重复。这很有趣，因为这表明一些房子在一年内被多次出售。也许他们被“翻转”了。这很重要吗？我的第一个想法是，这些是独特的价值，因此我会放弃它。但现在看来，我需要看得更近一点。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="b69e" class="ly km iq lu b gy lz ma l mb mc">kc_data.describe().T</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mx"><img src="../Images/7a0bfa5b88e3e3a0550211765f95eea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mL1VQR1Uhoh_WGd2iLsg1w.png"/></div></div></figure><h2 id="e520" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">初始问题:</h2><blockquote class="my mz na"><p id="d9c3" class="jn jo lo jp b jq jr js jt ju jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">蝙蝠可以落在哪些栏目？</em>T9】</strong></p></blockquote><ul class=""><li id="68bc" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nj nk nl nm bi translated"><em class="lo"> ID </em>？</li><li id="c6b9" class="ne nf iq jp b jq nn ju no jy np kc nq kg nr kk nj nk nl nm bi translated">也许lat和long可以被删除，因为它们提供了与zipcode相同的信息。</li><li id="8eec" class="ne nf iq jp b jq nn ju no jy np kc nq kg nr kk nj nk nl nm bi translated"><em class="lo"> sqft_living </em>和<em class="lo"> sqft_above </em>相关性非常强，事实上，许多值都有相同的条目。进一步探究发现<em class="lo"> sqft_living </em>是<em class="lo"> sqft_above </em>加上<em class="lo"> sqft_basement </em>之和。我们将需要研究每一个的贡献</li></ul><p id="bf66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我可以将<em class="lo">卧室</em>和<em class="lo">浴室</em>转换成分类值吗？我们应该为房子的年龄创造一个特征吗？</strong></p><p id="1839" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ' <em class="lo">日期</em>'是日期格式，但属于对象类型。需要转换..猫？数字？日期时间？</strong></p><h1 id="53ac" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">探索一些关系</h1><p id="8a1e" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们将从探索特征之间的相关性开始。为此，我们在Seaborn的heatmap()方法中输入一个pandas关联矩阵。使用“RdYlGn”色彩映射表提供了一种易于阅读的配色方案。我们将在下面讨论我们的发现。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="b5e6" class="ly km iq lu b gy lz ma l mb mc">sns.heatmap(kc_data_copy.corr(),annot=<strong class="lu ir">True</strong>,cmap='RdYlGn',linewidths=0.2)<br/>fig=plt.gcf()<br/>fig.set_size_inches(14,12)<br/>plt.show()</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ns"><img src="../Images/deb76ac350fa3a43abdc7b6e6f182931.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTEUBvPyWoF8lAT3rV1brQ.png"/></div></div></figure><h2 id="7c19" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">热图告诉了我们什么</h2><p id="21da" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在上面的热图中，暗绿色表示高度正相关，暗红色表示负相关。我们将使用0.75和-0.75作为确定显著相关性的阈值。</p><p id="aad4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">‘sqft _ living’—强相关性</strong></p><p id="5abd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很容易看出<em class="lo"> sqft_living </em>与<em class="lo"> sqft_above </em>、<em class="lo"> sqft_basement </em>、<em class="lo">卧房</em>、<em class="lo"> sqft_living15 </em>和<em class="lo"> grade </em>有很强的正相关关系。</p><p id="07af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">‘grade’和‘sqft _ above’</strong></p><p id="380c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在0.76的正相关性下，可以认为<em class="lo">等级</em>和<em class="lo"> sqft_above </em>之间的关系很强。</p><h2 id="ca3f" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">根据我们的发现，我们能去掉任何与相关性有关的特征吗？</h2><h2 id="3467" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">让我们仔细看看这些关系。</h2><p id="6ff2" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">当我们仔细观察时，我们可以看到<em class="lo"> sqft_living </em>等于<em class="lo"> sqft_above </em>加上<em class="lo">sqft _ based</em>之和:</p><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1dfcc0aea0d1476c8d80303fa75043f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*ea28VOc4jfHP5wO9t_Q7CQ.png"/></div></figure><p id="08b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着我们可以通过添加另外两个特性来描述<em class="lo"> sqft_living </em>。如果我们放弃它，我们可以减少高相关性的实例。但是首先，我们需要对<em class="lo">的地下室</em>做一些改动。</p><p id="44aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">至于<em class="lo"> sqft_above </em>和<em class="lo">等级</em>的关系，我们两个都保留。</p><h2 id="f824" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">让我们证实我们的观察</h2><p id="e5da" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">从最初的探索中，我们可以看到sqft_basement属于“object”类型。让我们将它转换为“int”类型。但是首先，我们需要考虑字符串值“？”，这是在第一次尝试转换失败时找到的。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="dd0a" class="ly km iq lu b gy lz ma l mb mc">kc_data_copy['sqft_basement'].unique()[4]<br/>'?'</span><span id="0f38" class="ly km iq lu b gy mo ma l mb mc">kc_data_copy['sqft_basement'].replace('?','0.0',inplace=<strong class="lu ir">True</strong>)<br/>kc_data_copy['sqft_basement'] = kc_data_copy['sqft_basement'].astype(str).astype(float).astype(int)<br/><br/>kc_data_copy[['sqft_living','sqft_above','sqft_basement']].describe().T</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nu"><img src="../Images/015a3131c8326af3e01a3bcc2b358af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rGMEYAaYspAbWk32TBbUQ.png"/></div></div></figure><h2 id="ae9e" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">在“sqft_living”的顶部绘制“sqft_above”和“sqft _ baseball”</h2><p id="1ec5" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在'<em class="lo"> sqft_living </em>'之上绘制'<em class="lo"> sqft_above </em>'加上'<em class="lo"> sqft_basement </em>'并降低不透明度，显示它们完全重叠。蓝色地块在底部，黄色地块在顶部。它们混合成我们看到的紫色。如果有任何部分没有重叠，它们将显示为完全蓝色或黄色。这说明他们是一样的。因此，我们应该能够删除'<em class="lo"> sqft_above </em>'或'<em class="lo"> sqft_above' </em>'，因为两者都可以通过减去或加上'<em class="lo">sqft _ basis</em>'来导出。但在我们做出决定之前，我们将继续探索各种关系。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="b773" class="ly km iq lu b gy lz ma l mb mc"><em class="lo"># Plot 'sqft_above' plus 'sqft_basement' on top of 'sqft_living'. </em><br/>plt.figure(figsize=(12,6))<br/>plt.hist(kc_data_copy['sqft_living'], bins=20, color='blue', label='sqft_living')<br/>plt.hist(kc_data_copy['sqft_above'] + kc_data_copy['sqft_basement'], bins=20, color='yellow', alpha=0.4, label='sqft_above + sqft_basement')<br/>plt.legend()</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nv"><img src="../Images/2ea3d0d8524e66c85fa45337f0be9759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Skcc-BeRakFakTQIciRAGA.png"/></div></div></figure><h2 id="2fdf" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">让我们再来看看热图。</h2><p id="e39c" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">现在我们可以看到，我们已经通过删除一个特征消除了所有这些高相关性。下面，我们去掉了' sqft_living '，但是没有做到位。但是我们以后会做的。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="4e31" class="ly km iq lu b gy lz ma l mb mc">sns.heatmap(kc_data_copy.drop('sqft_living',axis=1).corr(),annot=<strong class="lu ir">True</strong>,cmap='RdYlGn',linewidths=0.2)<br/>fig=plt.gcf()<br/>fig.set_size_inches(14,12)<br/>plt.show()</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nw"><img src="../Images/d284d1e32952ee3e7cf450a670551f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2s6r_8hiJ_ZD5bXa6W4jg.png"/></div></div></figure><h2 id="8458" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">散点图</h2><p id="5dcb" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">让我们看看每个特性与价格的关系是什么样的。</p><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nx"><img src="../Images/e4318219eb8fb158348076d54feda2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AoeBf2mG7aQyBcveIicx-g.png"/></div></div></figure><h2 id="855a" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">观察</h2><p id="0f83" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">似乎有一些分类特征。这些包括<em class="lo">楼层、滨水区、景观、条件、等级、翻新年份和邮政编码</em>。</p><p id="6dd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将不得不仔细研究其中的一些变量。看起来卧室是个不错的开始。回归线显示了良好的正相关性，但大多数点都聚集在0到11之间。还有一个非常明显的离群值。</p><p id="33b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将进一步研究浴室，它的正相关性要弱得多。</p><p id="84ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">sqft_lot 的形状绝对需要仔细观察。由于该点似乎在左侧堆积，这种关系似乎不是很线性。对于<em class="lo"> sqft_lot15 </em>来说，这一切都是一样的。</p><p id="9690" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始吧</p><h2 id="8993" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">检查邮政编码</h2><p id="08ad" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">金斯县有70个邮政编码。这种高基数可能会使编码方案难以使用。然而，我们可以使用一键编码，这将使我们的特征数增加68。我们会回来的。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="c0b0" class="ly km iq lu b gy lz ma l mb mc">print(f'Total number of unique zipcodes: <strong class="lu ir">{</strong>kc_data["zipcode"].nunique()<strong class="lu ir">}</strong>')</span><span id="2b5f" class="ly km iq lu b gy mo ma l mb mc">Total number of unique zipcodes: 70</span></pre><h2 id="5d82" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">卧室</h2><p id="46a2" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们可以看到下面有两个明显的异常值。所以我们将比较排除异常值后的平均值。当排除7和更大的值时，检查平均值导致非常可忽略的差异。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2bb0" class="ly km iq lu b gy lz ma l mb mc">bedroom_count = kc_data_copy['bedrooms'].value_counts()<br/>print(f'The mean including outlier: <strong class="lu ir">{</strong>kc_data_copy["bedrooms"].mean()<strong class="lu ir">}\n</strong>'<br/>      f'The mean excluding outlier: <strong class="lu ir">{</strong>kc_data_copy[kc_data_copy["bedrooms"] &lt; 7]["bedrooms"].mean()<strong class="lu ir">}</strong>')<br/>print(f'The price of the 33 bedroom house is <strong class="lu ir">{</strong>kc_data_copy[kc_data_copy["bedrooms"] == 33]["price"]<strong class="lu ir">}</strong>')</span><span id="4602" class="ly km iq lu b gy mo ma l mb mc">The mean including outlier: 3.3731999814789093<br/>The mean excluding outlier: 3.3597863942419317<br/>The price of the 33 bedroom house is 15856    640000.0<br/>Name: price, dtype: float64</span></pre><h2 id="ab96" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">它是绝对的吗？</h2><p id="a7dc" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">当我们放大时，散点图显示<em class="lo">间卧室</em>实际上可能被更好地视为分类变量。我们肯定要考虑这一点。</p><p id="95d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这也表明，可疑的33房间入口是完全不可靠的，所以我们将摆脱它。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="9d0b" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(14,8))<br/>plt.scatter(kc_data_copy['bedrooms'],kc_data_copy['price'])<br/>plt.xlabel('Bedrooms')<br/>plt.ylabel('Price')</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ny"><img src="../Images/9127842e86a00743e3726b3db0e03489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DzyElDmFe9DgVLbDvZhrA.png"/></div></div></figure><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="c70c" class="ly km iq lu b gy lz ma l mb mc"><em class="lo"># Remove the outlier</em><br/>kc_data_copy.drop(kc_data_copy[kc_data_copy["bedrooms"] == 33].index, inplace=<strong class="lu ir">True</strong>)</span><span id="4f3f" class="ly km iq lu b gy mo ma l mb mc">plt.figure(figsize=(12,6))<br/>plt.scatter(kc_data_copy['bedrooms'],kc_data_copy['price'])<br/>plt.xlabel('Bedrooms')<br/>plt.ylabel('Price')</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nz"><img src="../Images/8d63c30889b477736cfcb109865ba600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTHhTOoijD9p3a7vjd9ZhQ.png"/></div></div></figure><p id="975d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，看起来好多了。</p><p id="123c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们更好地了解一下分布情况。</p><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oa"><img src="../Images/5567defc16382631ac46f1471baad3eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fMUr203PqXqE7sdJFyqYw.png"/></div></div></figure><h2 id="756b" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">创建卧室的新分类表示</h2><p id="eaf2" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">使用熊猫的“剪切”功能来绑定<em class="lo">卧室</em>特征，创建数据的分类表示。这样做可以对数据进行编码。我们使用虚拟编码。该代码包含在<em class="lo">预处理_数据()</em>中。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2ff4" class="ly km iq lu b gy lz ma l mb mc">bins = pd.IntervalIndex.from_tuples([(0, 2), (2, 3), (3,4), (4, 5), (5, 11)])<br/>bds_bins = pd.cut(kc_data_copy['bedrooms'],bins)<br/>bds_bins.categories = ['less than two bedroom','2 bedroom','3 bedroom','4 bedroom','5 or more bedroom']<br/><br/>bedroom_dummies = pd.get_dummies(bds_bins.cat.rename_categories(bds_bins.categories), drop_first=<strong class="lu ir">True</strong>)<br/>bedroom_dummies</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ob"><img src="../Images/49b34df07a5ce40965be583c8e0ea063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bD5yE5wH788wUPv6zWiZCw.png"/></div></div></figure><h2 id="9080" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">浴室</h2><p id="189f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在我们开始可视化之前，让我们看一下值计数。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="0789" class="ly km iq lu b gy lz ma l mb mc">bathroom_count = kc_data['bathrooms'].value_counts()<br/>print(f'Bathrooms value counts: <strong class="lu ir">\n{</strong>bathroom_count.sort_index(axis=0)<strong class="lu ir">}</strong>')</span><span id="0c75" class="ly km iq lu b gy mo ma l mb mc">Bathrooms value counts: <br/>0.50       4<br/>0.75      71<br/>1.00    3851<br/>1.25       9<br/>1.50    1445<br/>1.75    3048<br/>2.00    1930<br/>2.25    2047<br/>2.50    5377<br/>2.75    1185<br/>3.00     753<br/>3.25     589<br/>3.50     731<br/>3.75     155<br/>4.00     136<br/>4.25      79<br/>4.50     100<br/>4.75      23<br/>5.00      21<br/>5.25      13<br/>5.50      10<br/>5.75       4<br/>6.00       6<br/>6.25       2<br/>6.50       2<br/>6.75       2<br/>7.50       1<br/>7.75       1<br/>8.00       2<br/>Name: bathrooms, dtype: int64</span></pre><h2 id="d2e4" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">让我们仔细看看浴室的散点图</h2><p id="8a8d" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">该图表的放大版本显示，该特征也显示了分类特征的特征。因此，再次与<em class="lo">卧室</em>一样，我们可能不得不转换它。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="c704" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(12,6))<br/>plt.scatter(kc_data['bathrooms'],kc_data['price'])<br/>plt.xlabel('Number of bathrooms')<br/>plt.ylabel('Price')<br/>plt.title('Price by number of bathrooms')</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nz"><img src="../Images/c32a7a5efed450f5e08967888ed91e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eX_7QVkcGBYydOBARaCIdQ.png"/></div></div></figure><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="9ac4" class="ly km iq lu b gy lz ma l mb mc">brs_by_count_to_plot = kc_data.bathrooms<br/>plt.figure(figsize=(18,8))<br/>plt.xticks(np.arange(0, 8, .25))<br/>my_x = np.array(bathroom_count.sort_index(axis=0).index)<br/>my_y = bathroom_count.sort_index(axis=0).values<br/>plt.bar(my_x, my_y, width=0.2)</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oc"><img src="../Images/04af6c653b850e7e977c55d7b0bf8470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBnScsqQ8udsYqAivLPLVA.png"/></div></div></figure><h2 id="8b9a" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">将浴室分类</h2><p id="b8bf" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们再次使用pandas cut方法对特征值进行分类。我认为使用<em class="lo">浴室</em>和<em class="lo">卧室</em>的连续和分类版本来创建模型是值得的。该代码包含在<em class="lo"> preprocess_data() </em>中。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="db76" class="ly km iq lu b gy lz ma l mb mc">bins = pd.IntervalIndex.from_tuples([(0.0, 1.0), (1.0, 1.75), (1.75,2.5), (2.5, 3.0), (3.0, 3.75), (3.75,8)])</span><span id="5d74" class="ly km iq lu b gy mo ma l mb mc">bth_bins = pd.cut(kc_data_copy['bathrooms'],bins)</span><span id="77dc" class="ly km iq lu b gy mo ma l mb mc">bth_bins.categories = ['less than one bath','1 - 1.75 bath','1.75 - 2.5 bath','2.5 - 3.0 bath','3.0 - 3.75 bath', '3.75 bath and up']</span><span id="23ae" class="ly km iq lu b gy mo ma l mb mc">bathroom_dummies = pd.get_dummies(bth_bins.cat.rename_categories(bth_bins.categories), drop_first=<strong class="lu ir">True</strong>)</span><span id="f1db" class="ly km iq lu b gy mo ma l mb mc">bathroom_dummies</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi od"><img src="../Images/8b503500c53cf48f3caef4864f2e3413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tNaVvcJLnTmB96a6ZeK5ag.png"/></div></div></figure><h2 id="106c" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">现在我们探索滨水区</h2><p id="7146" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这显然是一个二元特征——这是不是一个滨水的财产。我们可以看到大部分房产都不是滨水的。</p><p id="3abc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个问题是这个特性是int64数据类型。它必须被转换成绝对的。</p><p id="74f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个问题是我们必须考虑2376个丢失的值。我们接下来会处理这个问题。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="af4b" class="ly km iq lu b gy lz ma l mb mc">kc_data_copy.waterfront.isnull().sum()<br/>2376</span></pre><h2 id="965f" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">我们如何处理丢失的值？</h2><p id="149a" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">有多种方法可以解释缺失值。最简单的方法是删除包含它们的行。然而，通过丢弃这些值，我们可能会失去一些意义。</p><p id="78cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种方法是，如果我们可以确定该特征对模型的预测能力没有足够的贡献，则删除该特征。</p><p id="7da0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一种方法是用统计值(如平均值或中值或其他值)来估算缺失值。</p><p id="8555" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我要做的是，根据位置坐标，尝试估算该房产是否为滨水房产。也就是说，我将绘制滨水区的属性，并尝试在这些属性周围定义边界框。姑且称之为聚类的粗糙尝试。如果一个属性缺少一个值，并且它落在一个边界框内，它将被赋予正确的值“1.0”。否则，如果它不在一个范围内，它将得到“0.0”。已经有值的属性值将保持不变。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="eeef" class="ly km iq lu b gy lz ma l mb mc"><strong class="lu ir">def</strong> set_waterfront(s):<br/>    <em class="lo">'''</em><br/><em class="lo">    Rough classifier based on where on the map waterfront properties appear.</em><br/><em class="lo">    Takes a dataframe row and uses the 'lat' and 'long' fields to determine if they are within either of three bounding</em><br/><em class="lo">    boxes that contain most of the waterfront properties.</em><br/><em class="lo">    '''</em><br/>    <strong class="lu ir">if</strong> pd.notna(s['waterfront']):<br/>        <strong class="lu ir">return</strong> s['waterfront']<br/><br/>    <strong class="lu ir">elif</strong> (47.34 &lt; s['lat'] &lt; 47.6) <strong class="lu ir">and</strong> (-122.6 &lt; s['long'] &lt; -122.35):<br/>        <strong class="lu ir">return</strong> 1.0<br/>    <strong class="lu ir">elif</strong> (47.5 &lt; s['lat'] &lt; 47.78) <strong class="lu ir">and</strong> (-122.27 &lt; s['long'] &lt; -122.2):<br/>        <strong class="lu ir">return</strong> 1.0<br/>    <strong class="lu ir">elif</strong> (47.56 &lt; s['lat'] &lt; 47.66) <strong class="lu ir">and</strong> (-122.1 &lt; s['long'] &lt; -122.05):<br/>        <strong class="lu ir">return</strong> 1.0<br/>    <strong class="lu ir">else</strong>:<br/>        <strong class="lu ir">return</strong> 0.0</span></pre><h2 id="dfaa" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">金斯县海滨地产的地块</h2><p id="4afc" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">首先，让我们根据<em class="lo">滨水区</em>的特征来绘制房产。下面是我们进行任何更改之前的样子。深色标记表示被记录为滨水区的房产。我使用这个地图来确定和定义包含这些属性的边界框。然后我将使用上面定义的函数<strong class="jp ir"> set_waterfront() </strong>来应用它们。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="d88b" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(12,10))<br/>plt.scatter(kc_data_copy['long'],kc_data_copy['lat'],c=kc_data_copy['waterfront'], cmap='Reds')<br/>plt.grid(b=<strong class="lu ir">True</strong>, which='major', linestyle='-')<br/>plt.minorticks_on()<br/>plt.grid(b=<strong class="lu ir">True</strong>, which='minor', color='#999999', linestyle='-', alpha=0.2)</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oe"><img src="../Images/06b219b560a02d1faeda7a7bf0881fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PZ6DL2minFFG63Sl1_gB0A.png"/></div></div></figure><h2 id="de43" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">转换NaNs以表明它是否是滨水地产。</h2><p id="26e1" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">使用set_waterfront()函数，迭代数据帧并将包含“NaN”的“waterfront”值更改为1(表示滨水区)或0(表示非滨水区),具体取决于它们是否属于非的边界框之一。</p><h2 id="6e1c" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">set_waterfront()</h2><p id="e476" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这是手动定义边界框的地方。如果值不为空，那么它只返回值。如果为空，该函数将尝试确定它是否位于某个边界框内。如果是，函数将返回“1.0”，否则将返回“0.0”。代码在'<em class="lo">source/resources . py</em>下</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="d1f6" class="ly km iq lu b gy lz ma l mb mc">kc_data_copy['waterfront'] = kc_data_copy.apply(<strong class="lu ir">lambda</strong> row: set_waterfront(row), axis=1)</span></pre><h2 id="3683" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">再次绘制地图，检查结果是否合理</h2><p id="780b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们再次绘制地图，看看结果。结果是，在其他滨水区物业的一般区域中出现了更多的滨水区点，并且没有空区。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="7e74" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(12,10))<br/>plt.scatter(kc_data_copy['long'],kc_data_copy['lat'],c=kc_data_copy['waterfront'], cmap='Reds')<br/>plt.grid(b=<strong class="lu ir">True</strong>, which='major', linestyle='-')<br/>plt.minorticks_on()<br/>plt.grid(b=<strong class="lu ir">True</strong>, which='minor', color='#999999', linestyle='-', alpha=0.2)<br/>md(f'There are now **<strong class="lu ir">{</strong>kc_data_copy.waterfront.isnull().sum()<strong class="lu ir">}</strong>** null values')</span><span id="d3ce" class="ly km iq lu b gy mo ma l mb mc">There are now <strong class="lu ir">0</strong> null values</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oe"><img src="../Images/c2f6ffb2902920b92580152a5d4b6226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7mnRBHuHF9RTLS5u2ILag.png"/></div></div></figure><h2 id="fce9" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">我们表现如何？</h2><p id="8152" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">所以<em class="lo">滨水区</em>不再有缺失值。看起来我们在评估财产名称方面做得很好。</p><h2 id="7c81" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">将滨水要素转换为分类要素</h2><p id="08f0" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们现在将把<em class="lo"> waterfront </em>转换为类型<em class="lo">分类</em>，并使用<em class="lo">类别代码</em>对其进行标签编码。</p><p id="e982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们将数据类型转换为“category”。现在我们有了一个合适的类别特征，我们可以对它进行编码。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="a902" class="ly km iq lu b gy lz ma l mb mc">kc_data_copy['waterfront'] = kc_data_copy['waterfront'].astype('category')<br/>kc_data_copy['waterfront'] = kc_data_copy['waterfront'].cat.codes<br/>kc_data_copy['waterfront'].value_counts()</span><span id="2dee" class="ly km iq lu b gy mo ma l mb mc">0    21048<br/>1      548<br/>Name: waterfront, dtype: int64</span></pre><h1 id="3013" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">现在看一下与日期相关的字段</h1><p id="3964" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们将从“yr _ renovated”开始。此列的数据类型为“float”。上面你可以看到有3842个空值，占17.78%，相当高。下面，我们看到有17755个条目有实际值。但是，其中17011的值为0.0。因此，我们只有744项有实际价值的记录，其中379项是自2000年以来的翻新记录。真的没有显而易见的方法来解决这个问题。</p><p id="c7e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也许，因为这是一个绝对的价值——无论翻新与否。我们可以根据装修时间长短来分类，并有一个“未知”类别。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="df14" class="ly km iq lu b gy lz ma l mb mc">md(f'The missing values are **<strong class="lu ir">{</strong>round(3842 / len(kc_data_copy)*100,2)<strong class="lu ir">}</strong>%** of all records.')<br/>kc_data_copy[kc_data_copy['yr_renovated'] &gt;= 2000]['yr_renovated'].value_counts().sum()</span><span id="0ed9" class="ly km iq lu b gy mo ma l mb mc">The missing values are <strong class="lu ir">17.79%</strong> of all records.<br/>379</span><span id="7bf5" class="ly km iq lu b gy mo ma l mb mc">with_vals = kc_data_copy[kc_data_copy['yr_renovated'].isnull() == <strong class="lu ir">False</strong>].shape[0]<br/>with_zero = kc_data_copy[kc_data_copy['yr_renovated'] == 0.0].shape[0]<br/><br/>md(f"Number of records with values: **<strong class="lu ir">{</strong>with_vals<strong class="lu ir">}</strong>**")<br/>md(f"Number of records with value 0.0: **<strong class="lu ir">{</strong>with_zero<strong class="lu ir">}</strong>**")<br/>md(f'There are **<strong class="lu ir">{</strong>with_vals - with_zero<strong class="lu ir">}</strong>** useful values out of **<strong class="lu ir">{</strong>kc_data_copy.shape[0]<strong class="lu ir">}</strong>** records.')</span><span id="9b4f" class="ly km iq lu b gy mo ma l mb mc">Number of records with values: <strong class="lu ir">17754<br/></strong>Number of records with value 0.0: <strong class="lu ir">17010<br/></strong>There are <strong class="lu ir">744</strong> useful values out of <strong class="lu ir">21596</strong> records.</span><span id="c67d" class="ly km iq lu b gy mo ma l mb mc"><em class="lo"># This will be done by our preprocessing function</em><br/>kc_data_copy['yr_renovated'] = kc_data_copy['yr_renovated'].apply(<strong class="lu ir">lambda</strong> x: 1 <strong class="lu ir">if</strong> x &gt; 0 <strong class="lu ir">else</strong> -1 <strong class="lu ir">if</strong> np.isnan(x) <strong class="lu ir">else</strong> x).astype('category')<br/>yr_reno_dummies = pd.get_dummies(kc_data_copy['yr_renovated'], prefix='cat_', drop_first=<strong class="lu ir">True</strong>)</span></pre><h2 id="1aad" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">现在让我们看看“yr _ built”</h2><p id="4f6f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">该特征属于int类型。没有缺失值，所有值都有效。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="ea08" class="ly km iq lu b gy lz ma l mb mc">kc_data_copy['yr_built'].unique()</span><span id="e0bd" class="ly km iq lu b gy mo ma l mb mc">array([1955, 1951, 1933, 1965, 1987, 2001, 1995, 1963, 1960, 2003, 1942,<br/>       1927, 1977, 1900, 1979, 1994, 1916, 1921, 1969, 1947, 1968, 1985,<br/>       1941, 1915, 1909, 1948, 2005, 1929, 1981, 1930, 1904, 1996, 2000,<br/>       1984, 2014, 1922, 1959, 1966, 1953, 1950, 2008, 1991, 1954, 1973,<br/>       1925, 1989, 1972, 1986, 1956, 2002, 1992, 1964, 1952, 1961, 2006,<br/>       1988, 1962, 1939, 1946, 1967, 1975, 1980, 1910, 1983, 1978, 1905,<br/>       1971, 2010, 1945, 1924, 1990, 1914, 1926, 2004, 1923, 2007, 1976,<br/>       1949, 1999, 1901, 1993, 1920, 1997, 1943, 1957, 1940, 1918, 1928,<br/>       1974, 1911, 1936, 1937, 1982, 1908, 1931, 1998, 1913, 2013, 1907,<br/>       1958, 2012, 1912, 2011, 1917, 1932, 1944, 1902, 2009, 1903, 1970,<br/>       2015, 1934, 1938, 1919, 1906, 1935], dtype=int64)</span><span id="d210" class="ly km iq lu b gy mo ma l mb mc"># Let's Plot it out<br/>sns.distplot(kc_data_copy['yr_built'])</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div class="gh gi of"><img src="../Images/63bd93f7266a2023a8e1b7413db4e604.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*6od0BzHC4fzhqzsffLe_tA.png"/></div></figure><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="779e" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(12,6))<br/>plt.scatter(kc_data['yr_built'],kc_data['price'])<br/>plt.xlabel('Year Built')<br/>plt.ylabel('Price')<br/>plt.title('Price by Year Built')</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi og"><img src="../Images/10328968823f7060fb3b04111a57dcec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0MVHnR_1bvEXWeTcwq-D5A.png"/></div></div></figure><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="25e8" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(14,8))<br/>sns.boxplot(x='yr_built', y='price', data=kc_data_copy)</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oh"><img src="../Images/43f95d00473db4d7b350c26a359b025c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ar381NVIsRcltMSJuuFafA.png"/></div></div></figure><h2 id="20b0" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">让我们来看看“日期”功能</h2><p id="7623" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这是一个类型为“<em class="lo">对象</em>的字段。没有缺失值，所有值都有效。但让我们看看还能找到什么。</p><p id="2dfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">散点图显示了一个轻微的负斜率。就其本身而言，似乎贡献不大。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="b83f" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(12,6))<br/>plt.scatter(x='date',y='price',data=kc_data_copy)<br/>plt.xlabel('Date Sold')<br/>plt.ylabel('Price')<br/>plt.title('Price by Date Sold')</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nz"><img src="../Images/68aa547f62d16e491e1a03f25b45766a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jB0MjrKeNAk0mYe8V00MAQ.png"/></div></div></figure><h1 id="6f53" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">创建“年龄何时售出”字段</h1><p id="7bb8" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们现在将通过从“<em class="lo">日期</em>特征中减去“<em class="lo">年_造</em>”来创建一个新特征“<em class="lo">年龄_售出时间</em>”。然后我们将把它转换成int类型。让我们看看我们是否能从组合这些特性中获得任何价值。</p><p id="fa80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从散点图来看，这些特征并没有多大作用。让我们让他们成为候选人。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6906" class="ly km iq lu b gy lz ma l mb mc">kc_data_copy['age_when_sold'] = pd.to_datetime(kc_data_copy['date']) - pd.to_datetime(kc_data_copy['yr_built'])<br/><br/>kc_data_copy['age_when_sold'] = kc_data_copy['age_when_sold'].dt.days</span><span id="b0ab" class="ly km iq lu b gy mo ma l mb mc">plt.figure(figsize=(12,6))<br/>plt.scatter(kc_data_copy['age_when_sold'],kc_data_copy['price'])<br/>plt.xlabel('Age when Sold')<br/>plt.ylabel('Price')<br/>plt.title('Price by Age')</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oi"><img src="../Images/7efa479f2951d5b905aca456e5828277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oZGA-ITkZQBLGuPEXfK1Bw.png"/></div></div></figure><h2 id="6b17" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">是时候看看一些连续变量了—首先是sqft_lot</h2><p id="d5cd" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这一特征与价格并不呈线性关系。这看起来是一个很好的下降的候选人。但首先，我们将看看是否有一些策略来转换这些数据，使其变得更有用。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="f564" class="ly km iq lu b gy lz ma l mb mc">plt.figure(figsize=(12,6))<br/>sns.regplot(x=kc_data_copy['sqft_lot'], y=kc_data_copy['price'])<br/>plt.xlabel('Lot Square Foot')<br/>plt.ylabel('Price')<br/>plt.title('Price by Lot Square Foot')</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nz"><img src="../Images/f41fc7a405a365305691984e145715c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6FTseKU1HmUPd1_dYd0yQ.png"/></div></div></figure><h1 id="684d" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">如果我们改变这个特征会发生什么？</h1><p id="fa20" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">下面的图表显示了该功能如何通过转换发生变化。顶部3描绘了<em class="lo"> sqft_lot </em>未改变、对数变换和平方根变换的分布图。我们可以看到，经过对数转换的版本看起来比其他两个版本更接近正常。</p><p id="c12d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们来看散点图。嗯。对数转换似乎提供了最好的结果，但也好不到哪里去。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="47ee" class="ly km iq lu b gy lz ma l mb mc">plot_trans(kc_data_copy['sqft_lot'], kc_data_copy['price'])</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oj"><img src="../Images/691829b49ec25f4ed29968d5bfc3c051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*94ydFE4wzJco8yc6ycp6mw.png"/></div></div></figure><h2 id="a1fe" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">sqft_lot15怎么样？</h2><p id="9709" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">该功能与<em class="lo"> sqft_lot </em>非常相似，因此我们可以删除一个或两个。</p><h2 id="dda6" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">来看看sqft_living吧</h2><p id="cb42" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们预计这一特性将成为预测价格的最重要因素之一。它给了我们这个建筑的总面积。对数变换特征使我们接近正态分布。然而，仍然存在显著的异方差。因此，转换数据可能没有足够的价值。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="3b4e" class="ly km iq lu b gy lz ma l mb mc">plot_trans(kc_data_copy['sqft_living'], kc_data_copy['price'])</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ok"><img src="../Images/66c7d91ab20fc8aed61dd47f37f6e291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kym7QoOxHaY6yUiujaizhw.png"/></div></div></figure><h2 id="0ad1" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">我们来看看上面的sqft _吧</h2><p id="de72" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">很像<em class="lo"> sqft_living </em>。它给了我们整个建筑的总面积，不包括地下室。对数变换特征使我们接近正态分布。然而，仍然存在显著的异方差。同样，转换数据可能没有足够的价值。敬请关注。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="53f6" class="ly km iq lu b gy lz ma l mb mc">plot_trans(kc_data_copy['sqft_above'], kc_data_copy['price'])</span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ok"><img src="../Images/457f5607bf5360702272df878617e1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_G0EGjPStkh-Cpbfc1p87A.png"/></div></div></figure><h2 id="53e2" class="ly km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">平方英尺_地下室</h2><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="a48a" class="ly km iq lu b gy lz ma l mb mc">plot_trans(kc_data_copy['sqft_basement'], kc_data_copy['price'],z=1)<br/><em class="lo">#kc_data_copy['sqft_basement'].value_counts()</em></span></pre><figure class="lp lq lr ls gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ol"><img src="../Images/9c0b45901f19b189f3fb9e09b3ee9883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CLGyM65VBMPdttv6DYjzzQ.png"/></div></div></figure><p id="7f5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据探索到此结束，第1部分到此结束。</p><p id="15b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第2部分中，我们将讨论和预处理数据。我们将执行特征选择和维数减少，以及执行转换。然后，我们将构建几个模型并对其进行评估，以选择最佳表现。</p><p id="cddc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望到目前为止你已经喜欢它了，并期待着第2部分。</p></div></div>    
</body>
</html>