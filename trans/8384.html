<html>
<head>
<title>Can We Beat The Bookies? Predicting Football Games With a Simple Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们能打败庄家吗？用简单模型预测足球比赛</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/can-we-beat-the-bookies-predicting-football-games-with-a-simple-model-43fe020fb384?source=collection_archive---------0-----------------------#2021-01-10">https://medium.datadriveninvestor.com/can-we-beat-the-bookies-predicting-football-games-with-a-simple-model-43fe020fb384?source=collection_archive---------0-----------------------#2021-01-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d7f7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">预测英超、西甲、意甲和德甲的足球比赛结果。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/14e166adae1c7955d442b87f2a8fd909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1ivoeEs0TsU-sfmNN2pPg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://pixabay.com/users/free-photos-242387/" rel="noopener ugc nofollow" target="_blank">Free-Photos</a> on <a class="ae ky" href="https://pixabay.com/photos/cards-blackjack-casino-gambling-1030852/" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><p id="e47c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">足球被认为是最精彩的比赛之一，因为它是如此的不可预测。失败者的胜利和东山再起让一些游戏变得难以预测，即使对于专业的下注者来说也是如此。</p><p id="1c7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，当涉及到建立一个预测联盟中所有比赛的模型时，事情就变了。一个赛季是一场漫长的比赛，即使是最强大的俱乐部也有许多起伏，但最终，只有几支球队是赢得联赛的重要候选人。最近十年西甲、意甲、德甲的冠军几乎一样，这不是巧合。</p><p id="91e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名投注者，我知道我无法预测利物浦会以7 -2输给阿斯顿维拉，但作为一名数据科学家，我知道有可能建立一个简单的模型来帮助增加赢得赌注的机会。</p><p id="be16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来预测欧洲四大联赛的足球比赛吧！首先，我会告诉你在哪里可以获得我正在使用的数据，然后我们一起建立模型，最后，我会告诉你这如何帮助我在体育博彩。</p><h1 id="2914" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据</h1><p id="464e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们需要三个输入来构建模型:<strong class="lb iu">历史数据、当前表和剩余的匹配项</strong>。幸运的是，在这个<a class="ae ky" href="https://www.football-data.co.uk/data.php" rel="noopener ugc nofollow" target="_blank">网站</a>上，许多联赛的足球比赛历史数据已经可以以CSV格式使用了。</p><p id="cd13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然网站上有很多赛季的足球数据，但我只考虑过去的5个赛季。关于建立一个模型需要多少历史数据还存在争议。根据我赌足球的经验，我认为过去5年足以做出好的预测。</p><p id="ef7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">过多的过去数据会使我们的模型不太准确。足球俱乐部、规则和球员这些年来变化很大。10年前，没有VAR来纠正裁判的决定，15年前，没有梅西独自为巴塞罗那赢得比赛。</p><p id="5910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ms">注</em> </strong> <em class="ms">:我也是用这些数据，用Python的Selenium和Pandas构建了一个盈利的投注工具。在下面的文章中，我展示了完整的代码，并解释了我是如何做到的。</em></p><div class="mt mu gp gr mv mw"><a href="https://frank-andrade.medium.com/i-used-to-pay-180-yr-for-a-profitable-betting-tool-this-year-i-built-one-in-python-dda1a9b9581f" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">我曾经每年花180美元购买一个有利可图的赌博工具。今年我用Python做了一个</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">完整的代码创建一个足球博彩工具与熊猫和硒。</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">frank-andrade.medium.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk ks mw"/></div></div></a></div><h2 id="2eb1" class="nl lw it bd lx nm nn dn mb no np dp mf li nq nr mh lm ns nt mj lq nu nv ml nw bi translated">史料</h2><p id="53f0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可以下载。csv文件，或者使用以下代码让Python <code class="fe nx ny nz oa b">for</code>循环为您完成这项工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="b83f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这个简单的代码，我们将第15/16季的数据存储在一个名为<code class="fe nx ny nz oa b">dict_historical_data</code>的字典中。在此之后，我们只需重命名密钥。例如<code class="fe nx ny nz oa b">‘SP1’</code>代表<code class="fe nx ny nz oa b">‘la_liga’.</code>那些细节可以在我的<a class="ae ky" href="https://github.com/ifrankandrade/football-games-predictions.git" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><h2 id="256c" class="nl lw it bd lx nm nn dn mb no np dp mf li nq nr mh lm ns nt mj lq nu nv ml nw bi translated">当前表格和左侧匹配项</h2><p id="58c5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有许多网站显示当前的位置和许多联赛中剩下的比赛。谷歌一下，复制粘贴必要的数据就行了。</p><p id="3389" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经建立了一个CSV文件，其中包含了前4名联赛的表格和即将到来的比赛。你可以在我的<a class="ae ky" href="https://github.com/ifrankandrade/football-games-predictions.git" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到这些文件。</p><h1 id="d6aa" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">背后的数学</h1><p id="b988" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们应该在编写任何代码之前了解数学，这次也不例外。</p><p id="e7e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你至少看过一次足球比赛，你就会知道一个球员可以在比赛中的任何时候进球。这是过去5年前4名联赛每场比赛进球数的柱状图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/4d37a59dfefb289a9931fc699e229c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LNV3IcPo-IFfqNgeohc35A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Histogram of the number of goals in the 4 leagues</figcaption></figure><p id="20cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">毫不奇怪，德甲拥有最高的平均进球数(2.91)，但如果你仔细看这4张图表，你会发现它们都有一些共同点——它们的分布有一条共同的拟合曲线。<strong class="lb iu">是泊松分布！</strong></p><h2 id="928f" class="nl lw it bd lx nm nn dn mb no np dp mf li nq nr mh lm ns nt mj lq nu nv ml nw bi translated">为什么是泊松分布？</h2><p id="9306" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">一些原因如下:</p><ol class=""><li id="cac7" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated">足球比赛是相互独立的。一场比赛/进球的发生不影响另一场比赛/进球的概率。</li><li id="0ae8" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">事件发生的确切时间是随机的。进球的时机是随机的。</li><li id="6baf" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">目标是一个离散变量，因为它们是可数的。一场足球比赛可以有1、2、3个进球，但不能有分数。</li></ol><p id="3076" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是，我们试图使这变得简单。我们可以添加更多的变量来提高预测的准确性，但是现在，让我们用最简单的方法来做。</p><p id="d564" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们在处理给定时间段内发生的事件数量的离散概率分布。如果我们把一个进球看作是一场足球比赛90分钟内可能发生的事件，这就更有意义了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/fa150105e0a363ad8ed1aca3eb62afd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*cz4KfGMbK0N1H73KZOVxBg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Poisson Distribution Formula</figcaption></figure><p id="e72b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上面的公式中看到的。泊松分布需要2个输入<code class="fe nx ny nz oa b">lambda</code>和<code class="fe nx ny nz oa b">x</code>。在我们的分析中,<code class="fe nx ny nz oa b">lambda</code>将是90分钟进球的中位数。这可能是主队、客场队或联赛中进球的中位数。另一方面，<code class="fe nx ny nz oa b">x</code>是A队或b队在一场比赛中可以打进的球数。</p><h1 id="0776" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">让我们建立模型</h1><p id="c473" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了预测比赛的获胜者，我们需要计算一个球队在联赛中的实力。为此，我使用函数<code class="fe nx ny nz oa b">calculate_strength</code>返回一个数据框，其中包含过去5年中前4名联赛中所有球队的标准化进球数和失球数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="e094" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面你可以找到一个英超球队实力的例子。例如，曼城是主场进攻最好的球队，而利兹则是客场失球最多的球队之一。</p><p id="3ee6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两支球队之间的比赛将增加比赛中的进球数量，也增加了曼城赢得比赛的机会。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot oc l"/></div></figure><p id="0efb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获得4个联赛的实力后，我们创建另一个函数来模拟所有剩余比赛之间的所有可能结果。这个函数使用前一个函数来计算每个队的实力。λ是用公式<code class="fe nx ny nz oa b">lambda = home_scored * away_conceded</code>计算出来的，代表主队或客场队进球的概率。</p><p id="2087" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们需要为模拟中使用的目标数量设置限制。由于像拜仁慕尼黑这样的球队最近设立了很高的标准，我们将使用每支球队最多10个进球的限制。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="ec14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每次迭代，我们计算之前显示的泊松公式。在这种情况下，参数是进球数(<code class="fe nx ny nz oa b">x</code>)和平均进球数(<code class="fe nx ny nz oa b">lamb_home</code>和<code class="fe nx ny nz oa b">lamb_away</code>)。我们不用编写公式，而是使用<code class="fe nx ny nz oa b">scipy</code>库中的<code class="fe nx ny nz oa b">poisson.pmf </code>函数。</p><p id="78c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果将被分为3类:赢，输或平局。之后，我们使用公式<code class="fe nx ny nz oa b">3*prob_home + prob_draw</code>找出足球比赛中的3分是如何在两队之间分配的。当主队赢得比赛的机会是100%时，那么<code class="fe nx ny nz oa b">points_home </code>将是1，主队将得到3分。同样的想法也适用于平局。</p><p id="78e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们执行用以下代码创建的两个函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="d50f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在for循环中，我们将每场比赛的结果存储在<code class="fe nx ny nz oa b">list_points_home</code>和<code class="fe nx ny nz oa b">list_points_away</code>中，并且在每场比赛模拟完成后更新表格。</p><p id="9b56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对4个联赛的预测如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou oc l"/></div></figure><p id="7e66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里你可以找到赛季中每场比赛的结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov oc l"/></div></figure><h1 id="ae3e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">你怎么能用这个进行体育博彩呢？</h1><p id="7e74" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果你喜欢赌全职直播结果(1x2)，这些预测很有帮助。想象一下，一个最喜欢的球队在上半场输了，那么赌一场翻盘或平局将比赌预赛的回报高得多。然而，在下注之前，你也应该考虑处于劣势的一方赢得比赛的机会。</p><p id="34e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是模型派上用场的时候了。通过在预测表中搜索球队名称，你可以很容易地看到他们获胜的机会，并决定他们是好还是坏的失败者。</p><p id="f78c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我以拜仁慕尼黑为例</strong>。拜仁此前的上半场成绩是0-2(输给美因茨)和2-2(战平门格拉德巴赫)。我们不需要模型来提醒我们拜仁慕尼黑是一支多么伟大的球队，但如果你对德甲知之甚少，模型可以告诉你美因茨队获胜或Borussia M'gladbach保持平局的可能性。</p><p id="c078" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在上表中键入德甲球队的名称，您将获得美因茨的得分为0.5，这意味着即使他们领先2球，赢得比赛的几率也很低。另一方面，格拉德巴赫在主场比赛时有0.8，如果你和其他德甲球队相比，这还算不错。</p><p id="5ecd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们对德甲一无所知，我们可以说，比起美因茨赢得或获得平局，格拉德巴赫至少有更多机会获得平局。</p><p id="fa6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是比赛的真实结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/f5cb83fda664ad4d89def8c20da1f262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aIMSYPd3WASATo_Pa3-lsA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Score results screenshot</figcaption></figure><p id="9237" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以模型终究是有帮助的！格拉德巴赫甚至赢得了比赛。自然，如果你在预赛中以此为指导下注，利润会很少，但如果你在喜欢的球队没有获胜时明智地使用它，那么回报会更高。</p><p id="5eaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是两个匹配。希望在这个赛季结束时，我能做一个更好的比较。</p><h1 id="df5f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最后的想法</h1><p id="8233" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这种模式远非完美。实际上，它的简单性使得它不太适合某些场景。例如，在一场足球比赛的分析中，我只考虑了正面交锋的历史数据。在现实生活中，这不足以让我下注。我仍然需要主队在主场比赛和没有主场优势的客场比赛的数据。</p><p id="48e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我仍然认为它对于预测联赛冠军非常有用，并且在最喜欢的球队没有赢得比赛时是一个很好的指导。在联赛或杯赛中，足球队有许多起伏，但最终…</p><blockquote class="ox"><p id="a0b2" class="oy oz it bd pa pb pc pd pe pf pg lu dk translated"><strong class="ak">足球</strong>是一种简单的<strong class="ak">游戏</strong>——22个人追逐一个球90分钟，最后<strong class="ak">德国人</strong>总是<strong class="ak">赢</strong></p></blockquote></div></div>    
</body>
</html>