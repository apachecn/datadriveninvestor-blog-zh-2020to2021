<html>
<head>
<title>Easy way to Deploy Lambda and API Gateway with Serverless Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器框架部署Lambda和API网关的简单方法</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/easy-way-to-deploy-lambda-and-api-gateway-with-serverless-framework-51c33e2290d1?source=collection_archive---------2-----------------------#2020-03-03">https://medium.datadriveninvestor.com/easy-way-to-deploy-lambda-and-api-gateway-with-serverless-framework-51c33e2290d1?source=collection_archive---------2-----------------------#2020-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="47a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将Lambda功能无缝部署到AWS Cloud的方法有很多，比如SAM template、CodeDeploy、Cloudformation、Terraform、Serverless等等。其中，今天我要用无服务器框架来部署Lambda和API Gateway。如果你是无服务器框架的新手，请点击链接<a class="ae kl" href="https://serverless.com/framework/docs/" rel="noopener ugc nofollow" target="_blank">https://serverless.com/framework/docs</a>阅读它的文档。</p><blockquote class="km"><p id="b2cd" class="kn ko iq bd kp kq kr ks kt ku kv kk dk translated">无服务器框架可以帮助你用更少的开销和成本构建无服务器应用。它为开发、部署、测试、保护和监控您的无服务器应用程序提供了强大的统一体验。</p></blockquote><figure class="kx ky kz la lb lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kw"><img src="../Images/c89b53ae4106536aa4410d55569d27dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_nKKgCa_uD1_PE1ZShlsQ.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">image source: <a class="ae kl" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">https://serverless.com</a></figcaption></figure><p id="b2bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上所述，使用无服务器部署Lambda函数有点容易与SAM、CodeDeploy等进行比较。如果您是nodejs开发人员，使用无服务器框架将NodeJS功能部署到AWS Lambda非常容易。</p><p id="d27e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请查看下图，无服务器框架如何将您的nodejs应用程序部署到AWS Lambda。</p><figure class="lo lp lq lr gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ln"><img src="../Images/f0db9010ffe74bc52d51d1048a21dfb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pzMCTye4wcxrgfBk4xmbw.png"/></div></div></figure><p id="ec53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在我将展示如何将我的nodejs应用程序部署到AWS Lambda。</p><ol class=""><li id="84fd" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated"><strong class="jp ir">先用NPM安装无服务器框架。</strong></li></ol><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="7fa2" class="mg mh iq mc b gy mi mj l mk ml">npm i serverless</span></pre><p id="6153" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。创建hello world nodejs函数，文件名为index.js </strong></p><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="266c" class="mg mh iq mc b gy mi mj l mk ml">const express = require('express')<br/>const serverless = require('serverless-http')<br/>const app = express()<br/>app.get('/', async (req, res, next) =&gt; {<br/>  res.status(200).send('Hello World!')<br/>})<br/>module.exports.server = serverless(app)</span></pre><p id="a2a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。创建AWS凭证</strong></p><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="25b3" class="mg mh iq mc b gy mi mj l mk ml">sls config credentials --provider aws --key ACCESS_KEY --secret SECRET_KEY</span></pre><p id="8da2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm"> PS:对于无服务器，你可以在</em> <strong class="jp ir"> <em class="mm">无服务器</em> </strong> <em class="mm">或者</em><strong class="jp ir"><em class="mm">SLS</em></strong><em class="mm">之间随便用。</em></p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="9410" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。创建serverless.yml文件，与index.js文件放在同一个文件夹下</strong></p><p id="a480" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4.1我先创建Lambda函数及其配置。</strong></p><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="d7b0" class="mg mh iq mc b gy mi mj l mk ml">functions: <br/>  app:<br/>    handler: index.handler<br/>    events:<br/>      - http: <br/>          method: any<br/>          path: /{proxy+}<br/>          cors: true</span></pre><p id="75fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.2我将配置它的Lambda函数内存、运行时和IAM角色。好，Lambda函数将CRUD到DynamoDB表中，并访问S3桶。</p><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="7b0b" class="mg mh iq mc b gy mi mj l mk ml">provider:<br/>  name: aws<br/>  runtime: nodejs8.10<br/>  stage: dev<br/>  region: ap-southeast-1<br/>  memorySize: 128<br/>  iamRoleStatements:<br/>    - Effect: Allow<br/>      Action:<br/>        - dynamodb:*<br/>      Resource: "arn:aws:dynamodb:ap-southeast-1:*:*"<br/>    - Effect: Allow<br/>      Action:<br/>        - s3:*<br/>      Resource: <br/>        - arn:aws:s3:::mybucket/*<br/>        - arn:aws:s3:::mybucket<br/>    - Effect: Allow<br/>      Action:<br/>        - lambda:InvokeFunction<br/>      Resource: "*"</span></pre><p id="34e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将创建AWS API网关来与Lambda函数集成，并创建自定义main。</p><p id="69e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，自定义域URL将是<a class="ae kl" href="http://api.ppshein.com" rel="noopener ugc nofollow" target="_blank">api.ppshein.com</a>，在将nodejs功能部署到AWS Lambda之前，我们必须首先在AWS ACM中为该域创建SSL证书。</p><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="bc5e" class="mg mh iq mc b gy mi mj l mk ml">custom:<br/>  customDomain:<br/>    domainName: api.ppshein.com<br/>    basePath: ''<br/>    stage: ${self:provider.stage}<br/>    createRoute53Record: true</span></pre><p id="0281" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我的<strong class="jp ir"> serverless.yml </strong>文件已经完成，现在我要将nodejs应用程序部署到AWS Lambda。当我创建自定义域名时，我需要在AWS中用这样的无服务器框架创建自定义域，</p><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="6e53" class="mg mh iq mc b gy mi mj l mk ml">serverless create_domain</span></pre><p id="44ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">至少需要25或30分钟。之后，我将把我的nodejs应用程序部署到AWS Lambda，如下所示:</p><pre class="lo lp lq lr gt mb mc md me aw mf bi"><span id="979a" class="mg mh iq mc b gy mi mj l mk ml">serverless deploy</span></pre><p id="4631" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦部署完毕，你将能够使用cURL或Postman测试API。</p><p id="268d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://gist.github.com/ppshein/ad37c0379b6b0c69409ea21ade7d7f8c" rel="noopener ugc nofollow" target="_blank">下载完成的Git URL </a></p><div class="mu mv gp gr mw mx"><a href="https://www.datadriveninvestor.com/2019/02/25/6-alternatives-to-the-yahoo-finance-api/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">雅虎财经API |数据驱动投资者的6种替代方案</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">长期以来，雅虎金融API一直是许多数据驱动型投资者的可靠工具。许多人依赖于他们的…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl lh mx"/></div></div></a></div><figure class="lo lp lq lr gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div></div>    
</body>
</html>