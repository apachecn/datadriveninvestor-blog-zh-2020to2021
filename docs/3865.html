<html>
<head>
<title>Deploy Deep Learning Models in AWS using AWS Lambda + AWS API gateway + AWS Elastic File System. (Part — 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda+AWS API gateway+AWS Elastic文件系统在AWS中部署深度学习模型。(第二部分)</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/deployment-of-deep-learning-models-in-aws-using-aws-lambda-aws-api-gateway-aws-elastic-file-2b7102b3ff39?source=collection_archive---------4-----------------------#2020-07-12">https://medium.datadriveninvestor.com/deployment-of-deep-learning-models-in-aws-using-aws-lambda-aws-api-gateway-aws-elastic-file-2b7102b3ff39?source=collection_archive---------4-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6392" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，</p><p id="b3d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这3篇文章系列中，我们将了解如何部署深度学习模型，该模型在AWS中执行图像分类，并向世界公开其API，因此其他人可以与您的API进行交互。</p><p id="298b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">前往岗位1: </strong> <a class="ae kl" href="https://medium.com/@balakrishnakumar.v/deployment-of-deep-learning-models-in-aws-using-aws-lambda-aws-api-gateway-aws-elastic-file-a48fdeb2c140" rel="noopener"> <strong class="jp ir">链接</strong> </a></p><p id="5410" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">转到帖子2:你正好在那里，在你应该在的地方。</strong></p><p id="0f26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">转到帖子3: </strong> <a class="ae kl" href="https://medium.com/@balakrishnakumar.v/deployment-of-deep-learning-models-in-aws-using-aws-lambda-aws-api-gateway-aws-elastic-file-c423139fa858?sk=c781d42e92cab18e797f2b5e58b7068c" rel="noopener"> <strong class="jp ir">链接</strong> </a></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="30a7" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">自动气象站Lambda(第二部分)</h1><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/717f42b327f577ae27d7d4e1e924e622.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/0*111wb2gZO_SQ8JT7.png"/></div></figure><p id="a67a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的第一篇文章中，我们提到了AWS Lambda的局限性，即为什么它<strong class="jp ir">不能</strong>处理大小为&gt; 250 MB的未压缩部署包，因此我们附加了EFS，它就像AWS的Google Drive，您可以在那里水平扩展并加载您的部署包。</p><p id="17d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在这篇文章中，我们将使用AWS Lambda层和AWS EFS将部署包添加到AWS Lambda中。</p><p id="6e4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始吧。</p><p id="d8e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.IAM角色的创建:</p><p id="8632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">IAM角色类似于为一个AWS服务提供访问其他服务的权限。在我们的例子中，Lambda函数将访问EFS(用于部署包)和S3(用于存储模型工件和最终输出结果)。</p><p id="c22f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导航到IAM控制台，点击<strong class="jp ir">创建角色</strong>，选择一个用例作为<strong class="jp ir"> Lambda </strong>，点击<strong class="jp ir">下一步:权限</strong></p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lz"><img src="../Images/ccb3ffe6f80d13777ae22212f25499b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJpg5BJ9DGOQjUwYxxI8Ag.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi me"><img src="../Images/a8b90a4ad167c0436f63199a9f1bc72d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxkTp_stGI7RMo_Fj1X7rQ.png"/></div></div></figure><p id="a8e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在附上下面列出的政策，然后添加您选择的标签。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mf"><img src="../Images/621349fa0ee37e375323de2e76d06b04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKKBV1JtAOf591ZYTVZJSA.png"/></div></div></figure><p id="a122" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您的控制台应该如下所示，然后单击CreateRole。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/2036cfd76c9d25cb0ad4e8e2dc9985fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1YtAhD_nORgC5sogSpm46g.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mh"><img src="../Images/81297e8f878fcb0b9b258318d85a60ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S--QFXtzXfkyIRULAv2VrQ.png"/></div></div></figure><p id="7a8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.现在让我们导航到AWS Lambda。现在单击创建函数。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/a70407b42a6f483e59681cf7db3753fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXZ5LNEBAKSnSqKeZsrMjg.png"/></div></div></figure><p id="f6c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.从头开始选择template -&gt; Author，提供您选择的函数名，为了方便起见，我选择运行时为Python 3.6。(你可以根据你训练深度学习模型的方式，选择任何类似python 3.7/3.8的运行时)</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mi"><img src="../Images/1fb44cc3fcaa9398c5f333882893370a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b-6UJ3y4rMUtj54Ab67T4g.png"/></div></div></figure><p id="f65a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在Permission选项卡下，您需要选择在IAM策略下创建的执行角色，这是我们在上一步中创建的。</p><p id="cc1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后单击创建函数。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/43722faf6c5b95c6c26b463232a9b572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hO6_t-hesT1T1eYNNhV3ww.png"/></div></div></figure><p id="cc4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们在新创建的函数的主页上。在这里，我们将逐步调整一些参数。</p><h1 id="7fd1" class="kt ku iq bd kv kw mj ky kz la mk lc ld le ml lg lh li mm lk ll lm mn lo lp lq bi translated">使用Lambda层导入包</h1><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/afaa031f121e930f48ba8c2b28dcfeb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EscgCuFn7YV1aGGeeLQw8Q.png"/></div></div></figure><p id="118a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.首先，我们将创建一个Lambda层来演示如何将一些轻量级的包加载到我们的函数代码中。所以在这个例子中，我将展示如何使用lambda层将Scikit-Learn包加载到Lambda函数中。层就像函数的后端，我们可以在其中放置一些依赖项。</p><p id="cfc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让lambda层工作，我们需要以下面的格式压缩我们的包。</p><p id="76bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以选择任何其他感兴趣的包。</p><p id="3939" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">scikit-image . zip</strong>→<strong class="jp ir">python \ lib \ python 3.6 \ site-packages</strong></p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mo"><img src="../Images/0e23dd99f808f5e8af0a3ad27e5895a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ahEoIUbIM9UCvIM3D0wOhw.png"/></div></div></figure><p id="0350" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.创建您选择的zip文件后，将zip文件上传到您拥有的一个S3存储桶中，或者创建一个新的S3存储桶并上传zip文件。在我的例子中，我有两个包，一个包含scikit-image，另一个包含其他依赖项，然后复制对象URL。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mp"><img src="../Images/693d0e029b1792fa2ae567ed740c3126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJhX9tff9u_L09omHbl28g.png"/></div></div></figure><p id="a141" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.转到Lambda主页，单击图层选项卡，然后单击创建图层按钮。然后提供名称和描述，在S3链接URL下附加包含zip文件的S3存储桶的链接，并选择适当的运行时。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/08bd65f1e88a27ad514c4f6e3560d82d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4uGa9YMtnq8n1cJlY_aQRA.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mq"><img src="../Images/34c22b3aea5722c0d396fb4029a763b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgqsQkCLYjFBkWh6F1lpyg.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/8abac0d1aa1532250e6ea210ef564549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wBZwXdTB1oTIKub5hnljtQ.png"/></div></div></figure><p id="eb82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.创建图层后，使用lambda函数添加图层。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/f0ad2b9558d1e36413aed6f1a19427cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cDJHn7ya_4A4Xvyps8FwA.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mr"><img src="../Images/c05ec66893674ccab941c36717deb776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbTpvE_wH8vMCyFBDYdLrA.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/e769de6205495859a482b7c46ed08268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHCRIQbn3BplkViEusCMXw.png"/></div></div></figure><p id="7e3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以看到一个与我们的功能相关的层。我们将尝试把这个模块导入到我们的函数中。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi ms"><img src="../Images/e0e35aeeaed1fd08397ce9145e94591a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YJwgaF1zgGy8nLjeHLAHKw.png"/></div></div></figure><p id="02e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们单击测试按钮时，它会提示配置测试事件。只需提供一个事件名称，然后单击保存。</p><p id="6790" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.相应地修改您的lambda函数，然后单击save并单击Test运行您的lambda函数。这里的输出将skimage版本打印为0.16.2。这就是我们如何使用lambda层导入包。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mt"><img src="../Images/55d418a747bed80cb37694315debbbdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k8ht6656ym1Fuqaeo3Gs3w.png"/></div></div></figure><h1 id="b6ca" class="kt ku iq bd kv kw mj ky kz la mk lc ld le ml lg lh li mm lk ll lm mn lo lp lq bi translated">使用EFS导入包</h1><p id="11ff" class="pw-post-body-paragraph jn jo iq jp b jq mu js jt ju mv jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated">因此，如果我们有更多的包要导入，那么lambda层无法处理它，所以我们将EFS配置为python后端。</p><p id="5305" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始吧。</p><p id="517c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的Lambda函数下，如果您滚动，您将看到VPC和文件系统的部分，现在让我们通过单击编辑来配置这些选项卡。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/9e726eef46f72514126950a507cf841d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tfm2FbklfM7oBJnvKVUVbQ.png"/></div></div></figure><ol class=""><li id="0866" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated">在vpc下，选择默认的VPC(你可以创建自定义的VPC，但当你添加互联网网关等时，它是昂贵的。)</li><li id="20ff" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">选择所有3个子网，这样lambda函数在所有子网中都可用。</li><li id="a533" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">选择我们在本系列的第1篇文章中创建的安全组，然后单击save。</li></ol><div class="ls lt lu lv gt ab cb"><figure class="nn lw no np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><img src="../Images/23d931ced5d6daaeef84a0e51abf49b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*WFed5xbxQRhHCzLTDhebcw.png"/></div></figure><figure class="nn lw nt np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><img src="../Images/67de5418f7eb7ea21aa4ae34aa84f51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*iTZea9yNn6XB2QeeM0p71g.png"/></div></figure></div><p id="49dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.现在让我们配置弹性文件系统。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/ff78293ecf955b088524a601196f6e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KQW99VF9SNXjuRRkJzKqMw.png"/></div></div></figure><p id="0ae5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.对于EFS文件系统，选择我们在文章1中创建的EFS，并选择EFS的访问点，在我们的例子中，我们创建了<strong class="jp ir"> /demo </strong>。选择适当的接入点。</p><p id="53e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，添加本地挂载路径，这是我们存储包并通过lambda函数访问它们的路径。</p><p id="74a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据AWS标准，它必须以“<strong class="jp ir">/mnt/demo”</strong>开始，然后单击保存。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nu"><img src="../Images/c97ed18fcabfc36a6b18cb2d671ec7c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLll0JzBrNYjjj8RDJ2UWg.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nv"><img src="../Images/a646b9ed56d8097db0b437a8b3936921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJLJW-pDyr6W2tFPLkgdsQ.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nw"><img src="../Images/6480a85e735c11ef90e0db07b8b2fff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0V2QE3Q6OJyb3oJTx5vrQ.png"/></div></div></figure><p id="35b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们已经成功配置了VPC和EFS装载点。注意我们有一个本地挂载点:<strong class="jp ir">“/mnt/demo”。</strong></p><p id="25b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们在这个路径下加载我们的部署包(heavy ),并在lambda函数中导入它们。</p><p id="e835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.因此，要加载一些包，我们可以遵循两种方法。</p><p id="d819" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">I .如果您的本地计算机上已经有了所有的包，那么只需使用WinSCP将其复制并粘贴到挂载位置。</p><p id="d079" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">二。通过EC2实例连接到EFS，然后简单地按照命令→<strong class="jp ir">pip 3 install&lt;package name&gt;-t/EFS/demo/—system</strong></p><p id="b4ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以通过putty和WinSCP看到我们的EFS文件系统，我们已经挂载了<strong class="jp ir"> demo </strong>文件夹。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/201b498fc5b56bb9b39ac7d75a8bc0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGMWTRgOQEN5sYuiBV6ptg.png"/></div></div></figure><p id="6a44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.现在让我们将PyTorch包添加到我们的EFS中，并尝试通过lambda函数导入它。</p><p id="49e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">命令:<strong class="jp ir">pip 3 install torch = = 1 . 5 . 1+CPU torch vision = = 0 . 6 . 1+CPU-f</strong><a class="ae kl" href="https://download.pytorch.org/whl/torch_stable.html" rel="noopener ugc nofollow" target="_blank">T5】https://download.pytorch.org/whl/torch_stable.html</a><strong class="jp ir">-t/EFS/demo/—系统</strong></p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/61115a53b53896dd79dd6ecdb02209d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a9t3zyTyUjXfxqJ8_0fbDw.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nx"><img src="../Images/247e3b9c903013cc9e3b50c524837063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sz34W-8U2Mm1BYvtHZC9tw.png"/></div></div></figure><p id="8d3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们通过WinSCP确认所有基于torch的包都已加载。现在让我们尝试将它们导入lambda函数中。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/58e34dae3b76e5cb27acadf3b6c5baeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*yYk_An52On-4P4m1idp0Vw.png"/></div></figure><p id="8965" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样在基本设置下，根据您的要求增加超时时间。最大时间是15分钟，这是硬限制，您可以将内存限制增加到3GB (RAM)以加快处理速度。因为AWS Lambda定价是基于执行时间和API调用计数的，所以您可以根据需要配置它们。</p><p id="f48a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常超时和内存是协同作用的，它们之间有一个平衡。</p><p id="4c84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.很好，现在我们需要在lambda函数上将EFS中挂载的torch目录的路径添加到我们的python文件系统中。因此，当python执行时，它会将目录添加到帐户中，并加载torch包。</p><p id="c6a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> C1:进口系统</strong></p><p id="b6d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> C2: sys.path.insert(0，'/mnt/demo/') # For python 3.6 </strong></p><p id="acf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里的输出中，我们实际上可以看到加载的torch包的版本，挂载路径也被添加到系统中。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/65125f7ec2143e40dbcae10d295c6638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESqhpJzdpMe242n-K2vDAw.png"/></div></div></figure><p id="585c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.到目前为止，我演示了torch包，稍后您可以添加其他必要的包，如six、requests、pillow、OpenCV、open3d、NumPy、matplotlib、fastai、cv2、statistics、requests等，通过<strong class="jp ir"> EC2 </strong>在同一个目录"<strong class="jp ir"> /efs/demo </strong>中使用pip3命令，并在<strong class="jp ir"> AWS LAMBDA中使用挂载点"<strong class="jp ir"> /mnt/demo </strong>调用它们。</strong></p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nz"><img src="../Images/9aae8bc1336baafa56408fd89442efe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JDdeWOFroKX457fvBIIeZg.png"/></div></div></figure><p id="8650" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，这是一个很好的措施，注意到我们的EFS计量大小，因为EFS比S3昂贵，请确保您正确使用它。</p><p id="ee9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">EFS通常收费<strong class="jp ir"> (0.33美元/GB)。</strong></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="9c1c" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak">端点创建</strong></h1><p id="e305" class="pw-post-body-paragraph jn jo iq jp b jq mu js jt ju mv jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated">10.现在，由于我们通过安全VPC将EFS连接到我们的Lambda，在AWS中，默认情况下，您的功能无法访问互联网(您可以创建一个新的VPC，并为互联网添加NAT网关，但这需要成本(每NAT网关小时0.056美元)，而且您无法使用boto3库与其他AWS服务建立任何连接。这里再解释一下<a class="ae kl" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="aa7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但幸运的是，我们可以通过端点将lambda函数只连接到两个服务，然后通过boto3库访问它们。</p><ol class=""><li id="40df" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated">连接到S3(通过端点)</li><li id="fae3" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">连接到DynamoDb(通过端点)</li></ol><p id="61a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了连接到S3铲斗进行数据传输，进行以下配置。</p><p id="71e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在VPC选项卡下，导航到端点并创建端点。</p><p id="b20f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在AWS服务下搜索S3，检查子网组，最后单击创建端点，然后等待直到状态变为可用。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/b88db21cf63f4739884fa3eb684653c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g64A-d0kB1Yu9HPokcdC7A.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/980ffe0866224a2906c6272ab376e044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJPOdqPNrxCROLZVMS_9Fg.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/ab23ca2ed7bf0116fb280ad9dc018098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pX6HPlzs14JJKbSwAu3gqg.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi oa"><img src="../Images/dc53c89b633cc4ac76accaaf2b14c725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jIiTt7tc0QLLTXTgiSPXiA.png"/></div></div></figure><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi ob"><img src="../Images/055b40fb5072a550b5ea426f98194dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G_mh9XYdGD3CKZzeUK6fog.png"/></div></div></figure><p id="2740" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您希望将dynamodb数据库连接到您的lambda函数，请执行相同的操作并搜索dynamodb。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="af4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经成功地完成了如何将沉重的包部署到AWS Lambda中。</p><p id="3103" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在继续阅读帖子3，部署我们的深度学习模型，并通过API Gateway调用它。</p><p id="20ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最佳做法是检查AWS Lambda:<a class="ae kl" href="https://aws.amazon.com/lambda/pricing/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/lambda/pricing/</a>的定价</p><p id="73ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将发布与机器和深度学习相关的文章，以及它们与AWS服务的交集。</p><p id="74ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你认为这是你应得的，请投票并关注。</p><p id="9bd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之前，下次见。</p><p id="a89e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">文章作者:</strong></p><p id="87ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> BALAKRISHNAKUMAR V </strong></p></div></div>    
</body>
</html>