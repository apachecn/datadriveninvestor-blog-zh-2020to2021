<html>
<head>
<title>Hierarchical Risk Parity in Portfolio Construction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">投资组合构建中的分级风险平价</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/hierarchical-risk-parity-in-portfolio-construction-fc368db18c78?source=collection_archive---------3-----------------------#2020-02-26">https://medium.datadriveninvestor.com/hierarchical-risk-parity-in-portfolio-construction-fc368db18c78?source=collection_archive---------3-----------------------#2020-02-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2fe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是马科斯·洛佩斯·德·普拉多文章(<a class="ae kl" href="https://www.amazon.com/Machine-Learning-Managers-Elements-Quantitative/dp/1108792898" rel="noopener ugc nofollow" target="_blank"> 1 </a>和<a class="ae kl" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3484152" rel="noopener ugc nofollow" target="_blank"> 2 </a>)在投资组合优化过程中的一个实际应用。更具体地说，我将概述分级风险平价方法(<strong class="jp ir"> HRP </strong>，以及它的一个变体——<strong class="jp ir">理论隐含相关性矩阵方法</strong>。文章中的大部分代码来自Prado教授的文章，并根据我的需要进行了调整。</p><p id="d6bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章有四个部分:</p><ol class=""><li id="3c8e" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated"><strong class="jp ir">第一部分:</strong>关于协方差和相关矩阵的一个问题</li><li id="cded" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><strong class="jp ir">第二部分:</strong>HRP方法的机制讨论</li><li id="69c2" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><strong class="jp ir">第三部分:</strong>HRP与理论隐含聚类树的变异</li><li id="ee66" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><strong class="jp ir">第四部分:</strong>方法在俄罗斯股票市场的应用</li></ol><h1 id="a440" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第一部分:马科维茨投资组合有什么问题</h1><p id="a14a" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">Markovitz问题是一个二次优化问题，其中一组资产被优化以获得最高的风险调整回报。简单地说，我们试图优化预期收益率与预期波动率之比(所谓的夏普比率)。在统计术语中，我们优化投资组合收益分布的一阶(均值)和二阶(波动率)矩的比率。如果资产相对不相关，这种方法就能很好地发挥作用。</p><p id="2417" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Marcos de Prado给出了一个直观的例子，说明为什么资产之间的高度相关性会导致优化问题的不稳定性。</p><p id="dd07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑两个资产的相关矩阵:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/bb0d15e6e17e303452a1fb9a79601798.png" data-original-src="https://miro.medium.com/v2/resize:fit:164/1*gR0nmt2Q6I9VqHEuL_IRog.gif"/></div></div></figure><p id="7f56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，C的倒数由下式给出</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/999360e37cfdfb6be3488ef862251554.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/1*-LpCzGb7-UjXQNS0zPgMhA.gif"/></div></figure><p id="9987" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">det(C)代表行列式</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/9ac72b2d92afc46eac8d0bfaef188f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/1*h15_E6gHeOSjpzat2gxN9A.gif"/></div></figure><p id="2c23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">p(相关性)偏离0越多，行列式越少，逆矩阵越多。如果你有十几只股票，而且其中至少有一些来自同一个行业，比如说<strong class="jp ir">能源</strong>，不稳定性就成了一个真正的问题。</p><p id="342f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，大量的方法，试图将自己与Markowitz方法区分开来。例如:<a class="ae kl" href="https://medium.com/@andreybabynin/portfolio-construction-overview-equal-risk-mean-variance-equal-weight-5efb6f451309" rel="noopener">风险平价组合</a>。</p><div class="mr ms gp gr mt mu"><a href="https://www.datadriveninvestor.com/2018/11/08/budget-better-to-build-bigger/" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">更好的预算，打造更大的|数据驱动型投资者</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">即使是专家也承认它们并不完美。从1到10的范围内，安东尼·科普曼和德尔…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni mn mu"/></div></div></a></div><p id="0e30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">普拉多教授引入了另一个概念，延续了传统:分级风险平价，或简单地说，多级风险优化。</p><h1 id="25b1" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第2部分:HRP方法</h1><p id="5d2e" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">这个想法很简单:如果我们有一些股票，它们之间的相关性比其他股票更大，那么让我们首先在它们之间分散权重，然后在这个相关股票组和其他股票组之间分散权重。例如，如果你的投资组合中有可口可乐和百事可乐，首先在它们之间建立权重，比如说60/40，然后将它们作为一个整体来进一步分散投资。你可能会发现可口可乐和百事可乐加起来占10%，所以可口可乐和百事可乐分别占6%和4%。</p><p id="88c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，听起来像一个经典的聚类问题，我们应该找到每个股票和其他股票之间的距离。</p><p id="800c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">距离度量</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/ba95b02086c29b083e4b9f5fc4f0b833.png" data-original-src="https://miro.medium.com/v2/resize:fit:264/1*1en6g3PAnQ47giGJ8FOJgg.gif"/></div></figure><p id="790f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<strong class="jp ir"> r </strong> —相关性</p><p id="a05e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个新的距离度量允许我们测量两列向量之间的距离。</p><p id="d350" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，有几个步骤:</p><ol class=""><li id="c8f1" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">树聚类</li></ol><p id="7617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.准对角化</p><p id="5f4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.递归二分法</p><p id="3dc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">顾名思义，树聚类的思想是基于前面给出的距离度量来识别聚类。<strong class="jp ir">准对角化</strong>重组协方差矩阵的行和列，使最大值位于对角线上。<strong class="jp ir">递归二分法</strong>是一种自上而下的方法，根据投资组合总方差的反比在子集之间分割投资组合权重。</p><h1 id="9f53" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第3部分:知识树和理论隐含相关矩阵</h1><p id="d3b4" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">知识树背后的思想与前一部分有关:</p><blockquote class="nk nl nm"><p id="3d05" class="jn jo nn jp b jq jr js jt ju jv jw jx no jz ka kb np kd ke kf nq kh ki kj kk ij bi translated">如果我们有一些基于相关性分析的层次树，我们可以使用其他树来实现这个目的吗？</p></blockquote><p id="a87f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">答案是肯定的，我们可以。一个例子是<a class="ae kl" href="https://en.wikipedia.org/wiki/Global_Industry_Classification_Standard" rel="noopener ugc nofollow" target="_blank"> GICS分类</a>，它使用四级系统进行分类(部门—行业组—行业—子行业)。</p><blockquote class="nk nl nm"><p id="80a4" class="jn jo nn jp b jq jr js jt ju jv jw jx no jz ka kb np kd ke kf nq kh ki kj kk ij bi translated">来自相关矩阵的经验树如何与分类表相关联？</p></blockquote><p id="f5c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，在理想世界中，它们是相似的，但在现实中，它们可能会显著偏离。知识树试图克服相关性的主要缺点——线性特性。因此，这种方法的美妙之处在于，我们可以将自己的观点强加于数据聚类。在市场动荡的情况下，当协方差和相关性可能急剧增加时，这一点尤其重要。</p><h1 id="7827" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第四部分:来自俄罗斯股票市场的证据</h1><p id="1d69" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我在2018年从MOEX指数中选取了46家公司，并安排每60个交易日进行一次重新配置，这大致相当于一个季度。</p><p id="3583" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2018年有5个投资组合:</p><ol class=""><li id="7315" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">具有从相关矩阵中导出的聚类树的分级风险平价(<strong class="jp ir"> HRP </strong>)</li><li id="993b" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">另一个带有GICS分类聚类树的HRP(<strong class="jp ir">HRP _ tree</strong>)</li><li id="3e57" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">等风险贡献投资组合(你可以在这里阅读<a class="ae kl" href="https://medium.com/@andreybabynin/portfolio-construction-overview-equal-risk-mean-variance-equal-weight-5efb6f451309" rel="noopener"/>)(<strong class="jp ir">Min _ var</strong>)</li><li id="395a" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">等权重投资组合</li><li id="7c89" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">MOEX指数(<a class="ae kl" href="https://www.moex.com/en/index/totalreturn/MCFTR" rel="noopener ugc nofollow" target="_blank"> MCFTR </a> — Moex总回报指数)</li></ol><p id="a81c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">显然，估计有几个缺点:1)用了一年，2)每次都从一个日期点开始，3)没有尝试使用蒙特卡罗。好吧，在我的辩护中，我可以说我没有试图建立一些投资建议，而是想展示方法本身，而不是比较表现。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nr"><img src="../Images/4ea13a72e1ba52168d97bc2543863833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KxratVtE63XtqBkL23-jFA.png"/></div></div></figure><p id="673d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了指数在所有投资组合中产生最大的回报，它也是最不稳定的一个。在风险最小化的投资组合中，引人注目的是<strong class="jp ir"> <em class="nn"> HRP_tree </em> </strong>第二个跑赢其他人。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/28e09f79dd2a7561164ad8edc540663c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*xknQx1wAnRPXReoInxf6rA.png"/></div></figure><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/0f04dc1468ba7b61b2fe49e60ad5cc59.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*rhm2Y3vXET9sKAO6B6xXhA.png"/></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk">Precise statistics about drowdawns</figcaption></figure><p id="5200" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不同寻常的是，<strong class="jp ir"> HRP </strong>和<strong class="jp ir"> HRP_tree </strong>与等风险投资组合(Min_var)等更简单的方法相比，没有给出任何合理的提款减少。</p><p id="6f1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种测试方法是比较体重随时间的变化。我总结了每只股票在不同时期的绝对变化。很明显，对于等权重的投资组合，到处都是0。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/a09c115d9b64b6779715eb7aaccc0d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*SqlXTXj24rubdILD6nLqkA.png"/></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk">Statsitics about cumulative weights change</figcaption></figure><p id="bd20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这幅图相当令人惊讶:无论是<strong class="jp ir"> HRP </strong>还是<strong class="jp ir"> HRP_tree </strong>的权重变化都低于等风险投资组合(Min_var)。</p><p id="19f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我决定使用<a class="ae kl" href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding" rel="noopener ugc nofollow" target="_blank"> TSNE方法</a>来可视化聚类，看看聚类的可识别性如何。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nz"><img src="../Images/6db4333af2509302af6ed75514fdbdb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZP0zgcFCrNy8dQlD7uq4zw.png"/></div></div></figure><p id="0872" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不能说集群是容易识别的，但是，有一群俄罗斯的<em class="nn">‘蓝筹股’</em>:ROS neft(<strong class="jp ir">ROSN</strong>)、Lukoil ( <strong class="jp ir"> LKOH </strong>)、Gazprom ( <strong class="jp ir"> GAZP </strong>)、Tatneft ( <strong class="jp ir"> TATN </strong>)和Surgutneftegaz ( <strong class="jp ir"> SNGS </strong>)与其他公司截然不同。图中间的金属&amp;矿业公司(<strong class="jp ir"> NLMK </strong>、<strong class="jp ir"> ALRS </strong>、<strong class="jp ir">马格</strong>、<strong class="jp ir"> GMKN </strong>等)也形成集群。</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="0c5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，普拉多教授在档案袋形成领域做出了巨大贡献。我深信HRP可以与包括二次优化在内的其他流行方法配合使用。它扩展了可用方法的范围，增加了ML概念，如聚类。但是，它不是万能的。</p><p id="41d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到所有代码<a class="ae kl" href="https://github.com/andreybabynin/HRP" rel="noopener ugc nofollow" target="_blank">。你也可以在</a><a class="ae kl" href="http://www.linkedin.com/in/ababynin" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>和我联系。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div></div>    
</body>
</html>