<html>
<head>
<title>How to Use the 4chan Json API With Python — Building a Dataset for Machine Learning Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中使用4chan Json API为机器学习构建数据集第1部分</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/how-to-use-the-4chan-json-api-with-python-building-a-dataset-for-machine-learning-part-1-ac36ad4c4be2?source=collection_archive---------1-----------------------#2020-02-27">https://medium.datadriveninvestor.com/how-to-use-the-4chan-json-api-with-python-building-a-dataset-for-machine-learning-part-1-ac36ad4c4be2?source=collection_archive---------1-----------------------#2020-02-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a433" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">4带Python的chan JSON API第1部分</h2><div class=""/><div class=""><h2 id="8b9b" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何用python和requests从4chan的/pol留言板提取评论？</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c9bbbc23234fcb0a8c8335254d6fbb40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z096JiqPCkcSpK6j.jpg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Astronaut trying to escape planet 4chan.</figcaption></figure><h1 id="4462" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated"><strong class="ak">简介</strong></h1><p id="a366" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">对于所有围绕4chan的争议，嗯…我想是4chan的开始，我对他们的<strong class="ly ja"> Javascript </strong> <strong class="ly ja">对象</strong> <strong class="ly ja">符号</strong> ( <strong class="ly ja"> JSON </strong> ) <strong class="ly ja">应用</strong> <strong class="ly ja">编程</strong> <strong class="ly ja">接口</strong> ( <strong class="ly ja"> API </strong>)的博客帖子的缺乏感到惊讶。</p><p id="1c53" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">是啊！没错，4chan有一个只读的JSON API，里面充满了各种去道德化、摧毁灵魂的可能性。</p><p id="e351" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">然而，不管出于什么原因，这个奇怪见解的金矿在互联网评论中几乎不存在。</p><p id="c119" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">如果我们在duckduckgo或google中搜索<em class="mx">‘4chan JSON API python’</em>，我们几乎找不到与博客文章相关的点击。</p><p id="1d39" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">事实上，我们得到的点击率如此之低，人们可能会对此产生怀疑。</p><p id="ee1d" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">声名狼藉/pol </strong></p><p id="446f" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">4chan确实是一个有趣的地方。</p><p id="e67e" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">在网站上花不超过60秒的时间就能理解为什么它如此有争议。</p><p id="2161" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">大概4chan上最有名最有煽动性的留言板就是<em class="mx"> /pol </em>，或者'<em class="mx">政治上</em> <em class="mx">不正确的</em>。</p><p id="b82e" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">在过去的几年里，为了自然语言处理的目的，我一直在尝试各种社交媒体API。</p><p id="70c9" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">在这段时间里，我阅读了许多不同平台的评论，4chan是迄今为止最有趣和最独特的。</p><p id="cfcf" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">4chan有自己的术语和价值体系。</p><div class="my mz gp gr na nb"><a href="https://www.datadriveninvestor.com/2019/02/21/best-coding-languages-to-learn-in-2019/" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ja gy z fp ng fr fs nh fu fw iz bi translated">2019年最值得学习的编码语言|数据驱动的投资者</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">在我读大学的那几年，我跳过了很多次夜游去学习Java，希望有一天它能帮助我在…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ky nb"/></div></div></a></div><p id="5d7f" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">没有进入具体的条款，(你知道我的意思，对不对？)从机器学习的角度来看，这很有意思。</p><p id="0e49" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">由于这些原因，存在于互联网这个非常特殊角落的自然语言是独一无二的。</p><blockquote class="nq nr ns"><p id="4719" class="lw lx mx ly b lz ms ka mb mc mt kd me nt mu mh mi nu mv ml mm nv mw mp mq mr ij bi translated"><strong class="ly ja"><em class="iq">‘用4chan线程训练出来的聊天机器人会是什么样子？’</em> </strong></p></blockquote><p id="4bed" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">我们大概可以想象出上述问题的答案。</p><p id="979f" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">有一个关于<strong class="ly ja"> Tay </strong>的精彩故事，这是一个由微软创造的聊天机器人，用户用Twitter数据进行训练。</p><p id="8547" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">不到24小时，它就开始在推特上发布一些相当冒犯的内容。</p><p id="c866" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">无论推特上的推文有多极端，与4chan相比都是苍白无力的，人们只能想象其可能性。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="e9b6" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated">概述:</h1><p id="960e" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">大约在2019年10月1日，4chan API团队更新了他们在Github上的文档，为他们的JSON端点提供了一些很棒的文档。</p><p id="e9e5" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">我们将使用的端点是目录:<a class="ae oi" href="https://a.4cdn.org/pol/catalog.json" rel="noopener ugc nofollow" target="_blank">https://a.4cdn.org/pol/catalog.json</a></p><p id="97b8" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">学习解析任何JSON API的棘手部分不一定是您必须编写的代码的复杂性，而是理解不同字段和端点之间的结构和关系。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="873a" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated">参考资料:</h1><h2 id="7c58" class="oj lf iq bd lg ok ol dn lk om on dp lo mf oo op lq mj oq or ls mn os ot lu iw bi translated"><strong class="ak"> Python库</strong></h2><ul class=""><li id="a05d" class="ou ov iq ly b lz ma mc md mf ow mj ox mn oy mr oz pa pb pc bi translated"><a class="ae oi" href="https://docs.python.org/3.8/library/datetime.html" rel="noopener ugc nofollow" target="_blank">日期时间</a></li><li id="5ce9" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://docs.python.org/3.8/library/pprint.html" rel="noopener ugc nofollow" target="_blank"> pprint </a></li><li id="b4e9" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://2.python-requests.org/en/master/user/quickstart/#response-content" rel="noopener ugc nofollow" target="_blank">请求:r.json() </a></li><li id="ceef" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://docs.python.org/3.8/library/json.html" rel="noopener ugc nofollow" target="_blank"> json </a></li></ul><h2 id="f84c" class="oj lf iq bd lg ok ol dn lk om on dp lo mf oo op lq mj oq or ls mn os ot lu iw bi translated"><strong class="ak"> Python内置函数</strong></h2><ul class=""><li id="2a69" class="ou ov iq ly b lz ma mc md mf ow mj ox mn oy mr oz pa pb pc bi translated"><a class="ae oi" href="https://www.python.org/dev/peps/pep-0279" rel="noopener ugc nofollow" target="_blank">枚举()</a></li><li id="541e" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://www.python.org/dev/peps/pep-0281" rel="noopener ugc nofollow" target="_blank">范围()</a></li><li id="6f7c" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://www.python.org/dev/peps/pep-0255" rel="noopener ugc nofollow" target="_blank">产量</a></li><li id="c238" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://docs.python.org/3.7/library/stdtypes.html#mapping-types-dict" rel="noopener ugc nofollow" target="_blank">。获取()</a></li></ul><h2 id="599f" class="oj lf iq bd lg ok ol dn lk om on dp lo mf oo op lq mj oq or ls mn os ot lu iw bi translated"><strong class="ak"> Python异常</strong></h2><ul class=""><li id="1790" class="ou ov iq ly b lz ma mc md mf ow mj ox mn oy mr oz pa pb pc bi translated"><a class="ae oi" href="https://docs.python.org/3/library/exceptions.html" rel="noopener ugc nofollow" target="_blank">按键错误</a></li></ul><h2 id="f1a6" class="oj lf iq bd lg ok ol dn lk om on dp lo mf oo op lq mj oq or ls mn os ot lu iw bi translated"><strong class="ak"> Python生成器函数</strong></h2><ul class=""><li id="9557" class="ou ov iq ly b lz ma mc md mf ow mj ox mn oy mr oz pa pb pc bi translated"><a class="ae oi" href="https://docs.python.org/3/reference/expressions.html#yield-expressions" rel="noopener ugc nofollow" target="_blank">发电机</a></li><li id="0e3d" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://wiki.python.org/moin/Generators" rel="noopener ugc nofollow" target="_blank">发电机功能</a></li></ul><h2 id="1f23" class="oj lf iq bd lg ok ol dn lk om on dp lo mf oo op lq mj oq or ls mn os ot lu iw bi translated"><strong class="ak"> 4chan API文档</strong></h2><ul class=""><li id="c72e" class="ou ov iq ly b lz ma mc md mf ow mj ox mn oy mr oz pa pb pc bi translated"><a class="ae oi" href="https://github.com/4chan/4chan-API" rel="noopener ugc nofollow" target="_blank"> 4chan API文档</a></li><li id="58c3" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated"><a class="ae oi" href="https://github.com/4chan/4chan-API/blob/master/pages/Catalog.md" rel="noopener ugc nofollow" target="_blank"> 4chan API目录端点</a></li></ul></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="46ca" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated">第一步:</h1><p id="0dc1" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">进口我们的进口产品。</p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="4743" class="oj lf iq pj b gy pn po l pp pq">import requests<br/>import json<br/>from pprint import pprint<br/>from datetime import datetime as dt</span></pre></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="6c2e" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated">第二步:</h1><p id="746f" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">使用<a class="ae oi" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求</a>库建立到4chan目录端点的连接。</p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="a5a9" class="oj lf iq pj b gy pn po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json')</span></pre></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="2a57" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated">第三步:</h1><p id="a6d8" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">有几种不同的方法来转换来自服务器的响应。</p><p id="ef25" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">方法一:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="b57d" class="oj lf iq pj b gy pn po l pp pq">import json <br/>import requests<br/>from pprint import pprint </span><span id="51c9" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json') <br/>r = json.loads(r.text) </span><span id="585c" class="oj lf iq pj b gy pr po l pp pq">pprint(r)</span></pre><p id="b4fe" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">方法二:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="76cf" class="oj lf iq pj b gy pn po l pp pq">import requests <br/>from pprint import pprint </span><span id="6aae" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json') <br/>r = r.json() </span><span id="d76c" class="oj lf iq pj b gy pr po l pp pq">pprint(r)</span></pre><p id="fdeb" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="f729" class="oj lf iq pj b gy pn po l pp pq">{'page': 11,</span><span id="9d69" class="oj lf iq pj b gy pr po l pp pq">'threads': [{'bumplimit': 0,</span><span id="3061" class="oj lf iq pj b gy pr po l pp pq">'com': 'Thread OP'</span><span id="c10a" class="oj lf iq pj b gy pr po l pp pq">'country': 'US',</span><span id="f542" class="oj lf iq pj b gy pr po l pp pq">'country_name': 'United States',</span><span id="312d" class="oj lf iq pj b gy pr po l pp pq">'ext': '.png',</span><span id="a648" class="oj lf iq pj b gy pr po l pp pq">'filename': 'picture.png',</span><span id="7520" class="oj lf iq pj b gy pr po l pp pq">'fsize': 287315,</span><span id="6efa" class="oj lf iq pj b gy pr po l pp pq">'h': 1000,</span><span id="441e" class="oj lf iq pj b gy pr po l pp pq">'imagelimit': 0,</span><span id="bb22" class="oj lf iq pj b gy pr po l pp pq">'images': 1,</span><span id="a13b" class="oj lf iq pj b gy pr po l pp pq">'last_modified': 1575651990,</span><span id="5290" class="oj lf iq pj b gy pr po l pp pq">'last_replies': [{'com': 'Comment to Thread OP</span><span id="1fce" class="oj lf iq pj b gy pr po l pp pq">'country': 'US',</span><span id="b959" class="oj lf iq pj b gy pr po l pp pq">'country_name': 'United States',</span><span id="ab45" class="oj lf iq pj b gy pr po l pp pq">'name': 'Anonymous',</span><span id="2864" class="oj lf iq pj b gy pr po l pp pq">{'com': '&lt;a href="#p235356550" '</span><span id="9c0e" class="oj lf iq pj b gy pr po l pp pq">'class="quotelink"&gt;&amp;gt;&amp;gt;235356550&lt;/a&gt;&lt;br&gt;&lt;span '</span><span id="b23b" class="oj lf iq pj b gy pr po l pp pq">'class="quote"&gt;&amp;gtn&lt;/span&gt;',</span><span id="5cc7" class="oj lf iq pj b gy pr po l pp pq">'country': 'US',</span><span id="fc28" class="oj lf iq pj b gy pr po l pp pq">'country_name': 'United States',</span><span id="eb3f" class="oj lf iq pj b gy pr po l pp pq">'ext': '.jpg',</span><span id="e95a" class="oj lf iq pj b gy pr po l pp pq">'filename': 'AnotherPic.jpg',</span><span id="621b" class="oj lf iq pj b gy pr po l pp pq">'fsize': 65516,</span><span id="f006" class="oj lf iq pj b gy pr po l pp pq">'h': 600,</span><span id="86e4" class="oj lf iq pj b gy pr po l pp pq">'id': '9PriyurA',</span><span id="ed60" class="oj lf iq pj b gy pr po l pp pq">'md5': 'UmA62vBYEKcDREnJDL+FCw==',</span><span id="9b98" class="oj lf iq pj b gy pr po l pp pq">'name': 'Anonymous',</span><span id="0b2d" class="oj lf iq pj b gy pr po l pp pq">'tim': 1575651990509,</span><span id="303d" class="oj lf iq pj b gy pr po l pp pq">'time': 1575651990,</span><span id="3a4b" class="oj lf iq pj b gy pr po l pp pq">'tn_h': 125,</span><span id="2e5f" class="oj lf iq pj b gy pr po l pp pq">'tn_w': 125,</span><span id="d985" class="oj lf iq pj b gy pr po l pp pq">'w': 600}],</span><span id="2f77" class="oj lf iq pj b gy pr po l pp pq">'md5': 'rSv4H+6jrvu7zenf3gQ6DQ==',</span><span id="b7ca" class="oj lf iq pj b gy pr po l pp pq">'name': 'Anonymous',</span><span id="4b0e" class="oj lf iq pj b gy pr po l pp pq">'now': '12/06/19(Fri)11:25:54',</span><span id="23f3" class="oj lf iq pj b gy pr po l pp pq">'replies': 2,</span><span id="589c" class="oj lf iq pj b gy pr po l pp pq">'resto': 0,</span><span id="2b49" class="oj lf iq pj b gy pr po l pp pq">'tn_h': 250,</span><span id="15b7" class="oj lf iq pj b gy pr po l pp pq">'tn_w': 225,</span><span id="ea2f" class="oj lf iq pj b gy pr po l pp pq">'w': 900}]}]</span></pre><p id="8d73" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">正如您所看到的，方法2利用了内置的请求功能，而不是必须导入JSON标准库。我用的是方法2。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="b251" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated">步骤4:访问键/值对</h1><p id="b9db" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">下一步是“解析”我们的数据，这意味着以一种易于处理的方式重新排列数据。</p><p id="0fe2" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">有几种方法可以做到这一点，使用pandas是我的第一直觉，但是我发现使用标准库工具对于这方面的<strong class="ly ja">Extract Transform Load(ETL)</strong>过程更加实用。</p><p id="9db1" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">来自<a class="ae oi" href="https://2.python-requests.org/en/master/user/quickstart/#response-content" rel="noopener ugc nofollow" target="_blank"> r.json() </a>的response对象给了我们一个字典列表，也称为<strong class="ly ja">嵌套JSON </strong>，有时候整理起来真的很痛苦。</p><p id="e05a" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="ec82" class="oj lf iq pj b gy pn po l pp pq">import requests</span><span id="7ce7" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json')<br/>r = r.json()</span><span id="bd76" class="oj lf iq pj b gy pr po l pp pq">for items in r:<br/>   print(items.keys())<br/>   print(items['page'])<br/>   print(items['threads'])</span></pre><p id="92ec" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="a28d" class="oj lf iq pj b gy pn po l pp pq">#print(items.keys())</span><span id="0427" class="oj lf iq pj b gy pr po l pp pq">dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])<br/>dict_keys(['page', 'threads'])</span></pre><p id="e5e8" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="6481" class="oj lf iq pj b gy pn po l pp pq">#print(items['page'])</span><span id="e83b" class="oj lf iq pj b gy pr po l pp pq">1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11</span></pre><p id="5732" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="bc4a" class="oj lf iq pj b gy pn po l pp pq">#print(items['threads'])<br/>{'page': 11, 'threads': [{'bumplimit': 0, <br/>                          'com': 'Thread OP Comment', <br/>                          'country': 'US', <br/>                          'country_name': 'United States', <br/>                          'ext': '.png', <br/>                          'filename': 'pic.png', <br/>                          'fsize': 287315, <br/>                          'h': 1000, <br/>                          'imagelimit': 0, <br/>                          'images': 1, <br/>                          'last_modified': 1575651990,                   </span></pre><p id="0838" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">好了，现在我们来看些好东西。</p><p id="dd88" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">我们已经成功剥离了JSON的外层，现在我们可以访问核心的JSON API数据。</p><p id="a207" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">但是只有一个问题，我们只得到第一页的线程。我们想要的是用一个get请求访问所有11个页面的所有帖子。</p><p id="a0a1" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="60d8" class="oj lf iq pj b gy pn po l pp pq">import requests</span><span id="40bf" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json')<br/>r = r.json()</span><span id="6a0f" class="oj lf iq pj b gy pr po l pp pq">for items in r:<br/>    for thread in items['threads']<br/>        print(thread.keys())</span></pre></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="e1e0" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated"><strong class="ak">步骤5:用一个get请求访问所有页面和键/值字段。</strong></h1><p id="1fcf" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">让我们回顾一下我在第四步中所做的事情，并制定一个行动计划。</p><ul class=""><li id="3f1a" class="ou ov iq ly b lz ms mc mt mf ps mj pt mn pu mr oz pa pb pc bi translated">对于整个/pol板，我们在任何给定时间都有<strong class="ly ja">10-11页的线程</strong>。</li><li id="64b2" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated">我们每页有<strong class="ly ja">~ 18-20篇文章</strong>。</li><li id="8d64" class="ou ov iq ly b lz pd mc pe mf pf mj pg mn ph mr oz pa pb pc bi translated">每个页面都有自己的<strong class="ly ja">页面/线程键对</strong>，必须同时访问它们才能访问数据。</li></ul><p id="866b" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">所以我们的问题如下:</p><p id="1375" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">我们如何用一个get请求访问所有的页面和线程？</p><p id="0d8d" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">通过使用<strong class="ly ja"/><a class="ae oi" href="https://www.python.org/dev/peps/pep-0279/" rel="noopener ugc nofollow" target="_blank"><strong class="ly ja">枚举()</strong> </a> <strong class="ly ja">和一个</strong> <a class="ae oi" href="https://docs.python.org/3/reference/expressions.html#yield-expressions" rel="noopener ugc nofollow" target="_blank"> <strong class="ly ja">生成器</strong> </a> <strong class="ly ja">功能当然！！</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="2689" class="oj lf iq pj b gy pn po l pp pq">import requests</span><span id="2111" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json')<br/>r = r.json()</span><span id="f7f7" class="oj lf iq pj b gy pr po l pp pq">def gen_chan():<br/>    for idx, page in enumerate(r):<br/>        for thread in r[idx]['threads']:<br/>            yield thread</span></pre><p id="af4a" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">生成器本身就是一个完整的讨论，但是正如你所看到的，使用yield语句，而不是return，给了我们一个<a class="ae oi" href="https://wiki.python.org/moin/Generators" rel="noopener ugc nofollow" target="_blank">生成器函数</a>。</p><p id="db14" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">在不跑题的情况下，这是一个谈论常见python“反模式”的好机会。</p><p id="2a53" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">有两种方法可以做到这一点，这两种方法都达到了同样的目的。</p><p id="652e" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">方法一(不那么伟大的方式):</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="431c" class="oj lf iq pj b gy pn po l pp pq">import requests</span><span id="b360" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json')<br/>r = r.json()</span><span id="d2c9" class="oj lf iq pj b gy pr po l pp pq">for pages in range(0, len(r)):<br/>    for threads in r[pages]['threads']:<br/>        print(threads)</span></pre><p id="686d" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="0e56" class="oj lf iq pj b gy pn po l pp pq">0<br/>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</span></pre><p id="f970" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">通过使用嵌套的for循环，我们的第一个循环索引了<strong class="ly ja"> ['pages'] </strong>键的长度。</p><p id="fd40" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">然后，我们可以使用该索引作为pages字典的关键字，并访问每个页面上的所有帖子。</p><p id="3762" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">在这种情况下，使用<a class="ae oi" href="https://www.python.org/dev/peps/pep-0281/" rel="noopener ugc nofollow" target="_blank"> range() </a>就可以了，但是更好的方法是在生成器函数中使用<a class="ae oi" href="https://www.python.org/dev/peps/pep-0279/" rel="noopener ugc nofollow" target="_blank"> enumerate() </a>。</p><p id="9a36" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">方法二(更好的方法):</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="ca27" class="oj lf iq pj b gy pn po l pp pq">import requests</span><span id="772d" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json')<br/>r = r.json()</span><span id="0812" class="oj lf iq pj b gy pr po l pp pq">def gen_chan():<br/>    for idx, page in enumerate(r):<br/>        for thread in r[idx]['threads']:<br/>            yield thread</span></pre><p id="09d2" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><strong class="ly ja">出局:</strong></p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="4b62" class="oj lf iq pj b gy pn po l pp pq">0<br/>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</span></pre><p id="5a77" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">同样，如果我们在第一个for循环中<strong class="ly ja"> print(idx) </strong>，我们将同时接收所有页面。</p><p id="1f42" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">我们可以使用该输出来迭代地索引每个页面，并提取所有内容，使用第二个for循环来访问线程键。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="779d" class="le lf iq bd lg lh od lj lk ll oe ln lo kf of kg lq ki og kj ls kl oh km lu lv bi translated">第六步:从每个帖子中提取评论。</h1><p id="1d6b" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">现在让我们来看看每个帖子的评论。</p><p id="be40" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">它们存储在名为<strong class="ly ja"> ['last_replies'] </strong>的密钥中。</p><p id="00bb" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">这很棘手，因为不是所有的帖子都有评论，如果有的话，从帖子被创建到存档，它们总是在更新。</p><p id="e5f5" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">为此，我选择了<a class="ae oi" href="https://docs.python.org/3.7/library/stdtypes.html#mapping-types-dict" rel="noopener ugc nofollow" target="_blank">。get() </a>内置的dictionary方法，这样我们就不会在键不存在的情况下收到任何<a class="ae oi" href="https://docs.python.org/3/library/exceptions.html" rel="noopener ugc nofollow" target="_blank"> KeyErrors </a>，因为线程上还没有注释。</p><p id="d680" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">这是我做的一个小辅助函数，以防以后我想改变我们的提取方法。</p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="27b3" class="oj lf iq pj b gy pn po l pp pq">def get_threads(key: str, default='NaN'):<br/>    return threads.get(key, default)</span></pre><p id="e182" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">现在我们终于有了完整的代码。</p><pre class="kp kq kr ks gt pi pj pk pl aw pm bi"><span id="41a4" class="oj lf iq pj b gy pn po l pp pq">import requests<br/>from datetime import datetime as dt</span><span id="de82" class="oj lf iq pj b gy pr po l pp pq">r = requests.get('https://a.4cdn.org/pol/catalog.json')<br/>r = r.json()</span><span id="edb1" class="oj lf iq pj b gy pr po l pp pq">def gen_chan():<br/>    for idx, page in enumerate(r):<br/>        for thread in r[idx]['threads']:<br/>            yield thread</span><span id="e197" class="oj lf iq pj b gy pr po l pp pq">def get_threads(key: str, default='NaN'):<br/>    return threads.get(key, default)</span><span id="5c5b" class="oj lf iq pj b gy pr po l pp pq">for threads in gen_chan():<br/>    no = get_threads('no')<br/>    now = get_threads('now')<br/>    time = get_threads('time')<br/>    my_time = dt.today()<br/>    com = TextMaster.strip_html(get_threads('com'))<br/>    name = get_threads('name')<br/>    trip = get_threads('trip')<br/>    ids = get_threads('id')<br/>    capcode = get_threads('capcode')<br/>    filename = get_threads('filename') + get_threads('ext')<br/>    resto = get_threads('resto')<br/>    semantic_url = get_threads('semantic_url')<br/>    replies = get_threads('replies')<br/>    images = get_threads('images')<br/>    url = TextMaster.extract_url(get_threads('com'))<br/>    sent = TextMaster.textblob_sentiment(get_threads('com'))<br/>    if 'last_replies' in threads:<br/>        for comment in threads['last_replies']:<br/>            com_com = comment.get('com', 'NaN')<br/>            resto_com = comment.get('resto', 'NaN')<br/>            now_com = comment.get('now', 'NaN')<br/>            time_com = comment.get('time', 'NaN')<br/>            fname_com = comment.get('filename', 'NaN')<em class="mx"><br/>            </em>url_com = comment.get('com')<br/>            sent_com = comment.get('com')</span></pre><p id="c9b8" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">如果你想知道TextMaster类是什么，请继续关注第二部分。</p><p id="8da5" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">这篇文章基本上总结了这一点。</p><p id="e779" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">我们现在可以构建一个NLP预处理管道，并将数据插入数据库。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="fe74" class="pw-post-body-paragraph lw lx iq ly b lz ms ka mb mc mt kd me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated"><em class="mx">原载于【https://alexjslessor.com】<a class="ae oi" href="https://alexjslessor.com/blog/4chan_p1" rel="noopener ugc nofollow" target="_blank"><em class="mx"/></a><em class="mx">。</em></em></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pv pw l"/></div></figure></div></div>    
</body>
</html>