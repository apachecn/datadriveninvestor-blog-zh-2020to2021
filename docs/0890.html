<html>
<head>
<title>Securing Web-REST-APIs with JWT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JWT保护Web-REST-API</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/securing-web-rest-apis-with-jwt-787c75229cee?source=collection_archive---------2-----------------------#2020-02-21">https://medium.datadriveninvestor.com/securing-web-rest-apis-with-jwt-787c75229cee?source=collection_archive---------2-----------------------#2020-02-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ea01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">平衡网络安全性和便利性的正确方法</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/9d90e07c2c2907b8abfa44d4e0ad3e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEntcQXETv0cOGR8d2YB9g.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">source: the Independent: the US to call for a worldwide tightening of airport security measures over fears of ‘new generation’ of Syrian terror attacks</figcaption></figure><p id="a1fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi lb translated"><span class="l lc ld le bm lf lg lh li lj di">J</span><strong class="jp ir">SON Web Token(JWT)</strong>是一个开放标准，它定义了一种紧凑的自包含方式，以JSON对象的形式在各方之间安全地传输信息。<br/>这个信息可以被验证和信任，因为它是数字签名的。<br/>jwt可以使用秘密(使用<strong class="jp ir"> HMAC </strong>算法)或使用<strong class="jp ir"> RSA </strong>或<strong class="jp ir"> ECDSA </strong>的公钥/私钥对进行签名。</p><div class="lk ll gp gr lm ln"><a href="https://www.datadriveninvestor.com/2019/01/23/which-is-more-promising-data-science-or-software-engineering/" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab fo"><div class="lp ab lq cl cj lr"><h2 class="bd ir gy z fp ls fr fs lt fu fw ip bi translated">数据科学和软件工程哪个更有前途？数据驱动的投资者</h2><div class="lu l"><h3 class="bd b gy z fp ls fr fs lt fu fw dk translated">大约一个月前，当我坐在咖啡馆里为一个客户开发网站时，我发现了这个女人…</h3></div><div class="lv l"><p class="bd b dl z fp ls fr fs lt fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb kv ln"/></div></div></a></div><p id="56d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JWT是强大的，可以携带大量的信息，但它仍然很容易使用，即使它的大小相对较小。<br/>链接任何其他令牌，JWT可用于在身份提供者和服务提供者<br/>(不一定是同一个系统)之间传递认证用户的身份。它还可以携带用户的所有声明，如授权数据，因此服务提供商不需要进入数据库或外部系统来验证用户对每个请求的角色和权限；~该数据是从令牌中提取的。</p><h1 id="3380" class="mc md iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated"><strong class="ak"> JWT认证流程</strong></h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/7ae0f77d27575b6c3c3525562434d62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F8-3pDWmVnW__SW4TP3suQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">source: toptal blog: Spring Security</figcaption></figure><ul class=""><li id="1f0a" class="nb nc iq jp b jq jr ju jv jy nd kc ne kg nf kk ng nh ni nj bi translated">客户端通过将其凭据发送给身份提供者来登录。</li><li id="9954" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">身份提供者验证凭证；如果一切正常，它将检索用户数据，生成一个包含用户详细信息和权限的JWT，用于访问服务，它还设置JWT的到期时间(可能是无限的)。</li><li id="c60a" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">客户端存储JWT的时间有限或无限，具体取决于身份提供者设置的到期时间。</li><li id="a30b" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">客户端将每个请求的授权头中存储的JWT发送给服务提供者。</li><li id="659c" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">对于每个请求，服务提供者从授权头中取出JWT，并解密它，如果需要，验证签名，如果一切正常，提取用户数据和权限。仅基于该数据，并且同样不需要在数据库中查找进一步的细节或联系身份提供者，它可以接受或拒绝客户端请求。唯一的要求是身份和服务提供者有一个关于加密的协议，以便服务可以验证签名或者甚至解密哪个身份被加密。</li></ul><p id="79c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JWT和其他任意令牌的主要区别在于令牌内容的标准化。<br/>另一个推荐的方法是使用承载方案在授权报头中发送JWT令牌。<br/>标题的内容应该是这样的；</p><blockquote class="np nq nr"><p id="7c2f" class="jn jo ns jp b jq jr js jt ju jv jw jx nt jz ka kb nu kd ke kf nv kh ki kj kk ij bi translated">:授权:无记名<token/></p></blockquote><h1 id="94fa" class="mc md iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">什么时候应该使用JSON Web令牌？</h1><p id="3a60" class="pw-post-body-paragraph jn jo iq jp b jq nw js jt ju nx jw jx jy ny ka kb kc nz ke kf kg oa ki kj kk ij bi translated"><strong class="jp ir">授权</strong>:</p><p id="cba9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi lb translated">这是使用JWT最常见的情况。用户登录后，每个后续请求都将包含JWT，允许用户访问该令牌允许的路由、服务和资源。单点登录是目前广泛使用JWT的一个特性，因为它的开销很小，并且能够很容易地跨不同的域使用。</p><p id="6a50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">信息交换:</strong></p><p id="f438" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JSON Web令牌是在各方之间安全传输信息的好方法。因为jwt可以是签名的——例如，使用公钥/私钥对——所以您可以确保发送者就是他们所说的那个人。此外，由于签名是使用头部和有效载荷计算的，因此您还可以验证内容没有被篡改。</p><h2 id="6cb9" class="ob md iq bd me oc od dn mi oe of dp mm jy og oh mq kc oi oj mu kg ok ol my om bi translated">JSON Web Token结构是什么？</h2><p id="e40e" class="pw-post-body-paragraph jn jo iq jp b jq nw js jt ju nx jw jx jy ny ka kb kc nz ke kf kg oa ki kj kk ij bi translated">在其压缩形式中，JSON Web令牌由三部分组成。)<br/>其中有:</p><blockquote class="np nq nr"><p id="50b8" class="jn jo ns jp b jq jr js jt ju jv jw jx nt jz ka kb nu kd ke kf nv kh ki kj kk ij bi translated">1.割台<br/> 2。有效载荷<br/> 3。签名</p></blockquote><p id="4c9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，jwt如下所示:</p><p id="96c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="ns">xxxx . yyyyyy . zzzzz</em></strong></p><p id="d12f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来分解不同的部分。</p><p id="5a15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> a .表头</strong></p><p id="2522" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">报头通常由两部分组成:令牌的类型(JWT)和使用的签名算法(如HMAC SHA256或RSA)。</p><p id="8410" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><h2 id="efa9" class="ob md iq bd me oc od dn mi oe of dp mm jy og oh mq kc oi oj mu kg ok ol my om bi translated">{ <br/> "alg": "HS256 "，<br/> "typ": "JWT" <br/> }</h2><p id="5a8d" class="pw-post-body-paragraph jn jo iq jp b jq nw js jt ju nx jw jx jy ny ka kb kc nz ke kf kg oa ki kj kk ij bi translated">然后这个JSON被Base64Url编码形成第一个JWT。</p><p id="73e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> b .有效载荷</strong></p><p id="e9df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令牌的第二部分是有效负载，它包含声明。声明是关于实体(通常是用户)和附加数据的声明。这三种债权，即公共债权、注册债权和私人债权。</p><p id="279f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">丙.签名</strong></p><p id="619f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建签名部分，您必须获取编码的报头、编码的有效载荷、秘密、报头中指定的算法并签名。</p><p id="b340" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是三个由点分隔的BASE64-URL字符串可以在HTML和HTTP环境中轻松传递，同时与基于XML的标准如SAML相比更加紧凑。</p><h2 id="2f24" class="ob md iq bd me oc od dn mi oe of dp mm jy og oh mq kc oi oj mu kg ok ol my om bi translated"><strong class="ak">JSON Web令牌是如何工作的？—客户端</strong></h2><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi on"><img src="../Images/ae761a5b9242f6a7cc0c0f4449cb2f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FIIiDS6DP6itkcQrZmFG5Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk"><a class="ae oo" href="https://www.toptal.com/java/rest-security-with-jwt-spring-security-and-java" rel="noopener ugc nofollow" target="_blank">https://www.toptal.com/java/rest-security-with-jwt-spring-security-and-java</a></figcaption></figure><p id="1dd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在身份验证中，当用户使用他们的凭证成功登录时，将返回一个JSON Web令牌。因为令牌是凭证，所以必须非常小心以防止安全问题。一般来说，令牌的保留时间不应超过需要的时间。</p><p id="3baf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当用户想要访问受保护的路由或资源时，用户代理应该发送JWT，通常是在使用承载模式的授权报头中。标题的内容应该如下所示:</p><p id="a24c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">授权:持有人<token/></p><p id="adcb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务器的受保护路由将检查授权头中的有效JWT，如果存在，将允许用户访问受保护的资源。</p><p id="a86f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果令牌是在授权头中发送的，跨源资源共享(CORS)将不会是一个问题，因为它不使用cookies。</p><h2 id="ffd6" class="ob md iq bd me oc od dn mi oe of dp mm jy og oh mq kc oi oj mu kg ok ol my om bi translated"><strong class="ak">为什么要使用JSON Web令牌？</strong></h2><p id="b50f" class="pw-post-body-paragraph jn jo iq jp b jq nw js jt ju nx jw jx jy ny ka kb kc nz ke kf kg oa ki kj kk ij bi translated">JWT比基于XML的SAML(安全标记语言令牌)更紧凑。<br/> SWT(简单Web令牌)只能使用HMAC算法通过共享秘密进行对称签名。JWT和SAML可以使用公钥/私钥<br/>对。</p><p id="b106" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JWT的主要优势是以无状态的方式处理用户认证，因此是可扩展的方式，同时通过最新的<strong class="jp ir">加密标准</strong>保持一切安全。</p><p id="45ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">支持我，看看我的小应用:<a class="ae oo" href="https://thelifeplanner.co" rel="noopener ugc nofollow" target="_blank">人生规划师</a></p><p id="abed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干杯！</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="op oq l"/></div></figure></div></div>    
</body>
</html>