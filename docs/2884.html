<html>
<head>
<title>Self-Driven Databases: Intelligent Parameter Tuning for Alibaba Databases Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自驱动数据库:阿里巴巴数据库的智能参数调整</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/self-driven-databases-intelligent-parameter-tuning-for-alibaba-databases-explained-e11cf8dc4b1c?source=collection_archive---------16-----------------------#2020-05-20">https://medium.datadriveninvestor.com/self-driven-databases-intelligent-parameter-tuning-for-alibaba-databases-explained-e11cf8dc4b1c?source=collection_archive---------16-----------------------#2020-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/4a641ecc3280f2265e96ad1dfd9203f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*zavXF94Yf9MFRluv.jpeg"/></div></figure><p id="f43b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">本文撰稿人包括:陈杰(在阿里巴巴昵称为“爱傲”)、张平()、乔宏林(、)、齐星、张()。</em></p><p id="74a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">VLDB 2019会议(第45届超大规模数据库国际会议)于2019年8月26日至30日在加利福尼亚州洛杉矶举行。本次大会上，阿里云数据库产品团队的多篇论文入选研究赛道和产业赛道。</p><p id="7e19" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本文详细介绍了“iBTune:针对大规模云数据库的个性化缓冲区调优”，这是一篇入围论文。</p><h1 id="ea16" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">背景</h1><p id="ac6f" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">大约五六年前，阿里巴巴数据库团队尝试将数据库管理员的经验应用到产品中，为业务发展提供更高效、更智能的数据库服务。云数据库管理员自2014年以来一直提供自助智能诊断和调优服务，经过四年的不断研究，于2018年发展成为下一代自动驾驶数据库平台(SDDP)。</p><p id="6605" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">SDDP是一个智能数据库平台，它为平台上运行的数据库提供自驱动能力，使这些数据库能够独立感知、决策、恢复和优化，以实现持续和不可感知的服务供应。除了自动诊断、恢复和优化的核心功能，SDDP还提供了一系列其他功能，如物理资源管理、实例生命周期管理、安全性和自动扩展。</p><p id="e6c4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">2017年底，SDDP实现了所有数据库实例的全自动端到端优化，涵盖大型数据库的自动化慢速SQL查询、空间和参数优化。本文描述了大型数据库的自动参数调优。</p><p id="bd95" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">近年来，智能数据库调优技术主要是通过使用数据驱动和机器学习算法来调优数据库参数。然而，这给开发者带来了重大的技术挑战。要解决的问题是如何在满足服务水平协议(SLA)要求的同时，以最优的性价比和最低的资源成本，自动配置大型数据库中运行不同服务的数百万个数据库实例。这种智能数据库调优技术对于云服务提供商来说具有巨大的价值。</p><p id="24a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">学术界在过去的一两年里研究了智能数据库调优。比如卡耐基梅隆大学开发了<a class="ae lw" href="https://db.cs.cmu.edu/projects/ottertune/" rel="noopener ugc nofollow" target="_blank"> OtterTune </a>，这是一个自动调优工具，它依赖于以前手动调优的经验，无法针对大型数据库进行缩放。Azure SQL数据库和AWS也投资了智能数据库调优，但没有发表任何论文或产品。</p><p id="5597" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">阿里巴巴从2018年开始探索智能数据库参数调优。多个团队合作取得技术突破，并最终实现了广泛的调优，从问题定义和核心算法设计、评估和改进到端到端的自动化调优。</p><p id="f6f9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">论文“iBTune:大规模云数据库的个性化缓冲调优”入选VLDB 2019大会的研究轨道，这标志着阿里巴巴数据库智能业务的一个重要里程碑。该论文由覃健、铁英、飞刀、艾敖、齐星、池源、洪林、时越、宋明和张睿共同撰写。</p><p id="8494" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本文提出了智能数据库参数调整的创新想法，这些想法已在阿里巴巴集团的约10，000个实例上广泛实施，并帮助减少了约12%的内存资源使用。这使得阿里巴巴成为业内唯一一家广泛实施数据库参数调优的公司。</p><h1 id="9f1d" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">问题定义</h1><p id="f47a" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">参数调优是数据库调优的重要手段，随着数据库参数数量的增加，它变得越来越复杂。比如最新版本的MySQL提供了500多个参数，甚至PostgreSQL也提供了290个左右的参数。数据库调优侧重于影响性能的参数。在这些参数中，缓冲池设置的影响最大。</p><p id="38e0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">目前，阿里巴巴采用的部署是多个数据库实例共享同一个主机。这导致了服务器资源的浪费，因为尽管有冗余的CPU和存储资源，主机内存仍然经常不足。因此，内存资源短缺是阻碍数据库实例部署密度提高的瓶颈。</p><p id="b6f9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，我们将重点放在缓冲池的智能参数调优上，因为它使用了最多的内存资源。我们需要优化缓冲池配置，因为它是降低整体服务器成本和提高数据库实例性能的关键因素。</p><p id="25a5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于大型数据库，挑战在于如何将每个数据库实例的缓冲池大小设置为适当的值，以便在不影响实例性能的情况下最小化实际的缓冲池大小。静态配置模板通常用于设置数据库实例参数，从而实现对传统大型数据库的统一管理和控制。</p><p id="3846" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">阿里巴巴提供了10种缓冲池规格的数据库实例供业务伙伴选择。在应用实例时，开发人员通常使用默认或高级规范，而不定义服务所需的缓冲池大小。这导致了严重的资源浪费。</p><p id="20e1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">服务的多样性和不断变化使得DBA无法手动调优大型数据库的参数。这促使我们研究使用数据驱动和机器学习算法，根据数据库负载和性能的变化动态调整数据库缓冲池。</p><h1 id="d67c" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">问题分析</h1><p id="f4c2" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">缓冲池大小和命中率是直接相关的。如果我们可以找到一个公式，如<em class="ks">缓冲池大小=函数(命中率)</em>，并确定业务合作伙伴或数据库管理员可以接受的命中率，我们可以在不影响服务的情况下减少缓冲池的大小。</p><p id="23ad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在操作系统的缓存研究领域，我们发现了大量关于缓冲池大小和命中率之间关系的研究。一些研究表明，这种关系在长尾部分遵循幂律分布，即:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lx"><img src="../Images/9ee4e91e68ae1b2b0b171b803eb97cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qja_6pudE1ESS-u0.png"/></div></div></figure><p id="1c3d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们使用阿里巴巴数据库管理员开发的工具Frodo，在阿里巴巴的主要在线交易处理(OLTP)场景中对不同的缓冲池配置进行了压力测试，例如添加到购物车和交易支付。测试结果证明MySQL的缓冲池在长尾部分符合幂律分布的假设。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mg"><img src="../Images/a675906a39f61629c46cc6801e2a25be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JMci_uufwtgIxL5w.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mh"><img src="../Images/b20585507e353b40f28cc91a5a671986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/0*rThwVR4zhg4w99Kx.png"/></div></div></figure><h1 id="1d29" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">确定适当的失误率</h1><p id="ab55" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">阿里巴巴拥有超过30，000个数据库实例的主节点。我们考虑在这些数据库实例中找到与目标实例相似的实例的方法，以基于相似实例的缺失率来确定目标实例的缺失率。</p><p id="9923" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们选择了CPU使用率、逻辑读取、I/O读取、未命中率和响应时间等特性作为描述服务工作负载的性能指标。我们还选择了统计项目，如平均值、中间值、第70百分位和第90百分位来测量这些特征的值。</p><p id="30fb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了减少工作日和周末性能差异的影响，我们选择了跨越四周的性能数据进行相似性计算。下图显示了两对相似实例的示例。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mi"><img src="../Images/3eca51b3a90326b90ff14563ad47e7f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zEflJiMR4gBOaMV0.png"/></div></div></figure><h1 id="2348" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">算法挑战</h1><p id="1574" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">现在，我们可以使用基于定义的参数和目标未命中率的公式来计算缓冲池大小。下一个挑战在于将这种算法应用到工程过程中。</p><p id="b785" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从业务伙伴和数据库管理员的角度来看，命中率并不能直接反映数据库的服务影响，也不能用来衡量数据库服务的稳定性。由于稳定性要求，我们无法在服务级别应用该算法，因为我们无法量化服务影响。</p><p id="6fd4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在与数据库管理员和业务合作伙伴反复讨论后，我们发现数据库响应时间对数据库管理员和业务合作伙伴非常重要，尤其是数据库实例在与应用程序交互时的最大响应时间。</p><p id="4b05" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们可以预测数据库实例响应时间的最大值(上限),那么我们就可以量化缓冲池调优后的服务影响。这消除了缓冲池调优中的一个困难，并使得在生产环境中应用该算法成为可能。因此，我们使用该算法来预测数据库实例的响应时间上限。</p><h1 id="dec6" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">RT预测模型</h1><p id="ecac" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们提出了用于RT预测的成对深度神经网络(DNN)模型，如下图所示。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mj"><img src="../Images/d5bc0ffb16c9ac1d8bc5e36d915c1840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9oFG6SVCs20wV5yI.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/b947301e11c680c6285c5d43d7a7d6e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/0*i9O0duWlaWW3rNkK.png"/></div></figure><p id="fc41" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">DNN是一个完全连接的网络，ReLU作为激活功能。隐藏层1、隐藏层2和隐藏层3分别有100、50和50个节点。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/aefd274a10bd3d9335294a7016cc3562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/0*0N8auoSGKwJi5eX9.png"/></div></figure><h1 id="5d5c" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">实验</h1><p id="1829" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在RT预测实验中，我们比较了回归算法，如线性回归(LR)、XGBoost、随机样本一致性(RANSAC)、决策树(DTree)、ENet、自适应增强(AdaBoost)、梯度增强决策树(GBDT)、K近邻回归(KNR)、Bagging回归器(BR)、极端随机化树回归器(ETR)、随机森林(RF)和稀疏子空间聚类(SSC)。我们添加了深度学习算法，包括嵌入层的实例到向量(I2V)-DNN模型和成对DNN模型。</p><p id="e3f5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下图显示了I2V-DNN模型的结构。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mm"><img src="../Images/1c2da35212397343d3685dc7922eecc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A2IgzXtq32K7O7X5.png"/></div></div></figure><p id="2803" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了证明算法的通用性，我们从阿里巴巴内部的几个主要数据库业务场景中选取了1000个实例，包括只读实例、只写实例、读写平衡实例等不同读写比的实例。</p><p id="670c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们通过使用以下三个指标来评估算法性能:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/8af657ceab65d2f8b00207ae1d25cf29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/0*_BaNcjOwoKPuTMV2.png"/></div></figure><p id="e6a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">AMRAE测量响应时间预测结果中的错误百分比，MAE测量响应时间预测中的平均错误，而UMAE测量响应时间预测的低估。</p><p id="9d30" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下图比较了基于实验数据的响应时间预测结果。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mo"><img src="../Images/1dc447f55d4fa8dd240dfa66dc103891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HyEZzd-uwhufS-5i.png"/></div></div></figure><p id="5437" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如上图所示，成对DNN算法在AMRAE性能上超过了其他算法，并在其他指标上表现出最佳性能。因此，我们选择了成对DNN算法进行响应时间预测。</p><h1 id="1d7d" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结果呢</h1><p id="6a0c" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">为了直观地显示缓冲池调优前后的变化，我们选择了10个实例，并测量了它们在调优前后的数据库指标，如下图所示。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lx"><img src="../Images/a5c6da575d191618dfd9fe7c80410a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*of4-1hBqOLSzcJbA.png"/></div></div></figure><p id="b3b7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如上图所示，不同实例类型(除了实例1)的响应时间在缓冲池调优前后没有太大差别。每秒查询数和CPU使用率指标显示，每秒查询数在缓冲池调优前后没有太大差异，实例消耗的资源量几乎相同。但是，这些实例显示了不同程度的内存使用减少。</p><p id="45d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">优化后，实例1的响应时间大幅增加。这种情况下，每秒的查询数通常非常低，单个查询占用了大部分处理时间。优化后为此查询返回的值不同于优化前的值。优化显著增加了逻辑读取和物理读取的数量，并进一步增加了平均响应时间。但是，优化后响应时间的绝对值并不大，也不会出现缓慢的SQL查询。对于服务来说，这种情况是可以接受的。因此，不会触发回滚。</p><h1 id="0169" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">履行</h1><p id="b8c5" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们实现了一个端到端的算法应用过程，从数据收集到执行缓冲池调优命令。该系统有四个模块:指标收集、数据处理、决策制定和执行。下图显示了模块设计。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mp"><img src="../Images/48e4018853be0c1176ac4da97b2d25ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*34JCqbqJ7m87nxLc.png"/></div></div></figure><ul class=""><li id="f011" class="mq mr iq jw b jx jy kb kc kf ms kj mt kn mu kr mv mw mx my bi translated">指标收集:数据库控制平台收集阿里巴巴内部所有数据库实例的指标，包括算法使用的所有指标。</li><li id="199a" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">数据处理:在流操作后，对收集到的不同窗口维度的度量进行统计，统计结果存储在MaxCompute中，供算法使用。</li><li id="8d89" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">决策制定:该模块从MaxCompute读取度量统计信息，并通过使用算法来计算它们，以确定目标缓冲池大小。</li><li id="8617" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">执行:数据控制平台运行调优命令并调度相关的时间窗口，以按照发布约束高效地执行调优。</li></ul><h1 id="37e4" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">稳定性挑战</h1><p id="5839" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">降级缓冲池配置会影响稳定性。操作不当可能会增加数据库管理员的工作量，甚至导致服务失败。缓冲池调优项目给数据库管理员和相关业务部门中负责服务稳定性的其他同事带来了巨大的挑战和负担。</p><p id="13e1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们采取了一系列措施来确保服务的稳定性，包括:</p><ol class=""><li id="e05c" class="mq mr iq jw b jx jy kb kc kf ms kj mt kn mu kr ne mw mx my bi translated">算法模型:调整缓冲池大小与命中率映射关系的敏感系数αα，使调优结果更加保守。</li><li id="962a" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr ne mw mx my bi translated">在线调优:只调优支持在线调优的实例的参数，以避免MySQL内核导致的MySQL崩溃。</li><li id="14ca" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr ne mw mx my bi translated">分阶段调优策略:在广泛的网络范围参数调优期间，实施严格的分阶段调优策略。首先，服务DBA根据算法确定的缓冲池大小调优少量实例，以确保服务的稳定性。然后，服务DBA将大量实例添加到白名单中，允许自动调整缓冲池大小。最后，服务DBA对已确认的非核心实例执行广泛的自动化调优，每次调优操作中限制实例的数量。</li><li id="3efa" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr ne mw mx my bi translated">闭环过程:整个调优过程是一个闭环，从数据收集、关于缓冲池大小的决策、自动缓冲池调优到调优后的量化和回滚。每天都会发布调优后的统计分析报告。</li></ol><h1 id="53d4" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结果</h1><p id="877b" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">经过算法探索和端到端自动化缓冲池调优，2019财年阿里巴巴内部约有10，000个实例被调优，整体内存使用量从217 TB降至190 TB，节省了12.44% (27 TB)的内存资源。</p><h1 id="8940" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">未来计划</h1><ul class=""><li id="6f57" class="mq mr iq jw b jx lr kb ls kf nf kj ng kn nh kr mv mw mx my bi translated">在业务方面，2020财年，我们将对更多实例实施缓冲池调优，以节省更多内存资源，并通过混合云数据库管理(HDM)在公共云上优化和应用算法模型，为云用户提供选择数据库实例类型的建议。</li><li id="048c" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">在技术方面，除了缓冲池之外，我们还将调整与数据库性能相关的其他参数，探索多个性能相关参数的关系和影响，并根据数据库负载和性能影响之间的关系创建一个模型，以在数据库实例级别调整数据库参数。</li></ul><h1 id="fea3" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">原始来源:</h1><div class="ni nj gp gr nk nl"><a href="https://www.alibabacloud.com/blog/self-driven-databases-intelligent-parameter-tuning-for-alibaba-databases-explained_595932" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">自驱动数据库:阿里巴巴数据库的智能参数调整</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">ApsaraDB 2020年3月3日324本文撰稿人包括:陈杰(在阿里巴巴昵称为艾傲)、张平…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.alibabacloud.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz js nl"/></div></div></a></div></div></div>    
</body>
</html>