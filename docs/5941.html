<html>
<head>
<title>Developing a performance monitoring component in my fully automated algorithmic trading system (part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在我的全自动算法交易系统中开发性能监控组件(第1部分)</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/developing-a-performance-monitoring-component-in-my-fully-automated-algorithmic-trading-system-88f5afae05cd?source=collection_archive---------6-----------------------#2020-10-06">https://medium.datadriveninvestor.com/developing-a-performance-monitoring-component-in-my-fully-automated-algorithmic-trading-system-88f5afae05cd?source=collection_archive---------6-----------------------#2020-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6738716ca7a99881d8ee338f19aa1bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cse5P1iJJ6DZzPNnNkIlSg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Equity curve for 1 of my strategies based on returns captured by my algorithmic trading system</figcaption></figure><p id="29a5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">根据历史数据对你的信号和预测进行回溯测试是一回事，但就执行而言，这是完全不同的另一回事。我已经在这里写了这个<a class="ae ld" href="https://medium.com/datadriveninvestor/designing-and-building-a-fully-automated-algorithmic-trading-portfolio-management-system-6945c6c87620/" rel="noopener"/>。</p><p id="206e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">建立算法交易系统的另一个重要部分是性能监控。在开发这个组件时，我想到了一些重要的问题，</p><ol class=""><li id="1630" class="le lf it kh b ki kj km kn kq lg ku lh ky li lc lj lk ll lm bi translated">我如何衡量我的滑点？支付佣金？</li><li id="812e" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc lj lk ll lm bi translated">我的每日回报率是多少？在考虑账户现金流入和流出的同时，我如何衡量我的策略的绩效？</li></ol></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="3bc0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">我如何衡量我的滑点？</strong></p><p id="e0da" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在这方面，我使用ib_insync的<a class="ae ld" href="https://ib-insync.readthedocs.io/_modules/ib_insync/flexreport.html" rel="noopener ugc nofollow" target="_blank"> FlexReport </a>函数(使用REST API)来查询当天的交易。该函数将查询来自交互式代理的XML报告，我随后将该报告格式化以用于日常报告。queryId规范必须通过IB网络帐户管理系统进行设置。不幸的是，它每年都会过期，这意味着您必须想办法提醒自己每年手动刷新这个queryId。</p><p id="22d3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">``<br/> ##从IB查询的代码<br/> report = FlexReport(token，queryId) <br/>` '</p><p id="3a1c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后编写一些简单的代码将我的电子邮件通知的XML格式化成下面的格式，</p><figure class="ma mb mc md gt ju gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/439b1ebef2ae70b6b3888302d75d349c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*Z9afi47sRvAmvv81UfoUCw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Trades and slippage</figcaption></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="0150" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我的每日回报率是多少？在考虑账户现金流入和流出的同时，我如何衡量我的策略的绩效？</p><p id="71b5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">过去，我会降低绩效监控的优先级，将其放在待办事项的底部，因为我可以很容易地从IB查询复杂的绩效数据。你可能会在我的<a class="ae ld" href="https://jironghuang.github.io/portfolio/portfolio" rel="noopener ugc nofollow" target="_blank">博客</a>中找到一些数据。</p><p id="2252" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然而，我越来越发现，通过工具和策略来理解投资组合表现的表现驱动因素是很重要的。为了在这个粒度级别进行分析，我必须捕捉工具和策略的日/小时级别和回报。</p><p id="90cb" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为此，系统会触发一个请求，要求每小时拍摄一次投资组合的会计快照，</p><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/4df84d5857d968f5d8be30b7d1b07c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qYGxF5VVteZunFWyzAArqw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Snapshot tables</figcaption></figure><p id="cbd8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">但是如果有现金的流入和流出呢——你可能会问？我简单地依靠时间加权回报(TWR)公式。</p><div class="mf mg gp gr mh mi"><a href="https://www.datadriveninvestor.com/2020/09/23/why-most-people-lose-money-day-trading-and-how-to-not-be-one-of-them/" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd iu gy z fp mn fr fs mo fu fw is bi translated">为什么大多数人在日内交易中亏损(以及如何不成为他们中的一员)|数据驱动的投资者</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">日内交易很难，大多数人都赔钱。我确实有。事实上，我曾经在一个单一的损失更多的钱…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw jz mi"/></div></div></a></div><p id="dc10" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">TWR = [(1+HP1) X…(1+HPN)]-1</p><ul class=""><li id="3ab2" class="le lf it kh b ki kj km kn kq lg ku lh ky li lc mx lk ll lm bi translated">其中TWR =时间加权回报率</li><li id="c168" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc mx lk ll lm bi translated">n =子周期的数量</li><li id="1e03" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc mx lk ll lm bi translated">HP =(日终值-日初值+现金流)/(初值+现金流)</li><li id="0598" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc mx lk ll lm bi translated">HPN =子期间n的回报</li></ul><p id="6d66" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="my">来源:</em>【https://www.investopedia.com/terms/t/time-weightedror.asp】T2</p><p id="a182" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在投资组合层面，流入和流出是账户的净现金流入。在工具层面，流入和流出将是当天的净买入/卖出交易。您还必须通过整体投资组合杠杆系数缩减规模，将工具资产价值调整为“权益价值”。</p><p id="e648" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您可以在附录中找到在整个投资组合层面衡量时间加权回报的实施方法。</p><p id="f8fa" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">说了这么多，做了这么多，我还能做什么呢？我可以画一些奇特的股票曲线，如下所示，</p><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/36086347fe8e53dfcadd9829b09b35aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FflGFOon7QAPlzCLz_ubYw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Fancy equity curve for strategy 1</figcaption></figure><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6738716ca7a99881d8ee338f19aa1bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cse5P1iJJ6DZzPNnNkIlSg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Fancy equity curve for strategy 2</figcaption></figure><p id="80ab" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有了详细的回报流，我还可以测量已实现的滚动波动性，并做一些疯狂的事情(但在我看来不重要)，如fama-french 3、5或gazillion factors分析。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="c231" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">我的待办事项中有哪些需要进一步增强的性能监控组件？</strong></p><ul class=""><li id="7532" class="le lf it kh b ki kj km kn kq lg ku lh ky li lc mx lk ll lm bi translated">执行价格和自适应限价订单的偏差。</li><li id="410c" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc mx lk ll lm bi translated">利用获取的数据系统地理解绩效驱动因素，即按照战略、工具和时间框架将总体投资组合回报分解为加权绩效驱动因素。</li><li id="96e7" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc mx lk ll lm bi translated">将数据文件推入关系或非关系数据库。但我会尽可能地限制交易时间内交易系统和数据库之间的交互。过去，我在使用SQLite和数据库服务器‘挂起’时观察到了并发性问题，而使用关系数据库如Mysql。另一种选择是将服务器托管在云中。但这意味着我必须支付额外的费用，并担心连接问题。有时候普通的旧文件就可以了？</li><li id="2790" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc mx lk ll lm bi translated">每天在具有冗余功能的网络连接存储(NAS)中备份参数和数据文件。</li><li id="0435" class="le lf it kh b ki ln km lo kq lp ku lq ky lr lc mx lk ll lm bi translated">汇率效应对投资组合绩效的影响。我以前写过并创建了一个知识库。您可以访问<a class="ae ld" href="https://github.com/jironghuang/RemoveExchangeRateEffects" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多信息。</li></ul><p id="47c8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">【2020年11月10日更新:如果你喜欢这篇文章，你可能会发现这里的<a class="ae ld" href="https://link.medium.com/DOu0ryy8hbb" rel="noopener"><em class="my"/></a><em class="my">和这里的</em><a class="ae ld" href="https://jironghuang.medium.com/performance-monitoring-component-in-my-fully-automated-algorithmic-trading-system-part-3-3d41f14005" rel="noopener"><em class="my"/></a><em class="my">也很有趣！在续集中，我加入了额外的特征，如汇率效应、滚动波动性、提款、各自策略对整体权益曲线的回报贡献。</em></p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="bd4b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">附录</strong></p><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/6f80ce56d1ca9d0748f354292b80dcf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hDv6bHf8UnokFKahjJ6EXQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Time weighted return embedded in function to derive equity curve</figcaption></figure><h2 id="1576" class="na nb it bd nc nd ne dn nf ng nh dp ni kq nj nk nl ku nm nn no ky np nq nr ns bi translated">访问专家视图— <a class="ae ld" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank">订阅DDI英特尔</a></h2></div></div>    
</body>
</html>