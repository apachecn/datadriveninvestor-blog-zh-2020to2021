<html>
<head>
<title>End to End Project on Used Car Price Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">二手车价格预测的端到端项目</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/end-to-end-project-on-used-car-price-prediction-3dc412d24aa0?source=collection_archive---------1-----------------------#2020-12-28">https://medium.datadriveninvestor.com/end-to-end-project-on-used-car-price-prediction-3dc412d24aa0?source=collection_archive---------1-----------------------#2020-12-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/78151ce3e4e64482a798f7dd75294a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qBCwqXW4m6TOD3FL.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://www.google.com/search?q=neeraj+kumar+pic+with+renault+duster&amp;tbm=isch&amp;ved=2ahUKEwjgmZS09OjtAhUIIisKHczuDiIQ2-cCegQIABAA&amp;oq=neeraj+kumar+pic+with+renault+duster&amp;gs_lcp=CgNpbWcQAzoECCMQJ1DtkwFYoLIBYKyzAWgAcAB4AIAB_gGIAc8WkgEGMC4xNy4ymAEAoAEBqgELZ3dzLXdpei1pbWfAAQE&amp;sclient=img&amp;ei=9bzlX6DLDojErAHM3buQAg&amp;bih=625&amp;biw=1366#imgrc=e12zkXTXgPw95M" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><h2 id="033c" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">概述</strong></h2><p id="d815" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">该数据集包含cardekho.com上市二手车信息。它有9列，每列包含关于具体特征的信息，如<strong class="lb ir">汽车名称</strong>给出汽车公司的信息。新车是哪一年<strong class="lb ir">购买的。汽车的销售价格这将是进一步预测价格的目标标签。<strong class="lb ir"> km_driven </strong>汽车行驶的公里数。<strong class="lb ir">燃料</strong>这表示汽车的燃料类型(CNG、汽油、柴油等)。<strong class="lb ir">卖家_类型</strong>告知卖家是个人还是经销商。<strong class="lb ir">变速器</strong>给出汽车是自动还是手动的信息。<strong class="lb ir">车主</strong>该车之前车主的编号。<strong class="lb ir"> Present_price </strong>该车目前的展厅价格是多少。</strong></p><h2 id="e8ef" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤1:设置虚拟环境</h2><p id="dace" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">这应该是构建端到端项目的第一步。我们需要新的虚拟环境，因为每个项目需要不同的集合和不同版本的库，所以通过为一个特定的项目创建一个单独的环境，我们可以为该环境提供所有必要的库。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="4c1c" class="kd ke iq lz b gy md me l mf mg">conda create -n carfare python=3.6<br/>#some essential package for the environment will be installed  #automatically then you will get option<br/>[y/n] ---&gt; y   #click y<br/></span></pre><p id="ee43" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">之后，我们将通过使用来激活环境</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="ed98" class="kd ke iq lz b gy md me l mf mg">&gt;&gt; activate carfare<br/>&gt;&gt; jupyter notebook #run jupyter notebook on newly created env</span></pre><p id="ae6f" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">我们可能会遇到缺少jupyter笔记本的问题，因为我们必须多做一步</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="68b5" class="kd ke iq lz b gy md me l mf mg">&gt;&gt; pip install jupyter notebook # installing jupyter notebook on env<br/>&gt;&gt; jupyter notebook</span></pre><p id="74bd" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">我们的环境已经创建，现在我们将在这个环境上完成我们的项目。</p><h2 id="6f56" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">第二步:-获取数据集并导入所有必要的库</strong></h2><p id="e5ff" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">我从<a class="ae kc" href="https://www.kaggle.com/nehalbirla/vehicle-dataset-from-cardekho?select=car+data.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir">这里取了数据集</strong> </a> &amp;数据集是csv格式的。现在，我将导入这个项目所需的所有基本库。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="ec7c" class="kd ke iq lz b gy md me l mf mg">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>from sklearn.preprocessing import StandardScaler<br/>from sklearn.model_selection import train_test_split</span></pre><h2 id="92eb" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">步骤3 :-数据预处理</strong></h2><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="ad1a" class="kd ke iq lz b gy md me l mf mg">df=pd.read_csv("car data.csv")<br/>df.head()   #Printing first five rows </span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/21eb523491036fb42de0d128480c438a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*ouKMtoBDB8pIYHuBsiQnqg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 1</figcaption></figure><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="75b7" class="kd ke iq lz b gy md me l mf mg">len(df["Car_Name"].unique())</span><span id="7304" class="kd ke iq lz b gy mn me l mf mg">[out]&gt;&gt; 98</span></pre><p id="ea30" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">在这里，我们有98个不同公司的汽车，公司的名称不会影响汽车的价格，价格取决于它使用了多少年，燃料类型等。因此，我将从原始数据帧中删除列<strong class="lb ir"> car_name </strong>。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="4e97" class="kd ke iq lz b gy md me l mf mg">df.shape  #number of rows and columns present in a dataset</span><span id="7878" class="kd ke iq lz b gy mn me l mf mg">[out] &gt;&gt; (301, 9)</span><span id="53ac" class="kd ke iq lz b gy mn me l mf mg">--------------------------------------------------------------------<br/>df.columns  #printing index of all the columns</span><span id="2bc7" class="kd ke iq lz b gy mn me l mf mg">[out]&gt;&gt;Index(['Car_Name', 'Year', 'Selling_Price', 'Present_Price', 'Kms_Driven','Fuel_Type', 'Seller_Type', 'Transmission', 'Owner'],<br/>      dtype='object')</span><span id="faca" class="kd ke iq lz b gy mn me l mf mg">-------------------------------------------------------------------<br/>#dropping the car_name column<br/>df.drop("Car_Name",axis=1,inplace=True)</span><span id="6024" class="kd ke iq lz b gy mn me l mf mg">--------------------------------------------------------------------<br/>df.isnull().values.any()  #is there any null value present </span><span id="a499" class="kd ke iq lz b gy mn me l mf mg">[out]&gt;&gt; False    # there is no null value present in dataset</span></pre><p id="0ca5" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">现在，我们将检查每一列的数据类型，如果数据类型是数字，那么我们就没有这样的问题，但如果数据类型是分类的，那么我们需要将所有这些分类特征转换成数字值。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="39ef" class="kd ke iq lz b gy md me l mf mg">df.dtypes</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/4461ad93001e80eeaaa34185cf71db3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*Q6egJhoqXQ0Ef_A2WlHDjA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 2</figcaption></figure><p id="7e48" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">如果我们观察上面的输出，我们可以说现在有一些具有对象数据类型的特征，在我的下一步中，我将创建一个<strong class="lb ir"> cat_df </strong>并将所有分类特征存储到<strong class="lb ir"> cat_df </strong>中。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="c6ce" class="kd ke iq lz b gy md me l mf mg">list1=[]  #storing all the features having categorical datatype<br/>for i in df.columns :<br/>    if df[df[i]=="object"]:<br/>         list1.append(i)</span><span id="ee58" class="kd ke iq lz b gy mn me l mf mg">[out]&gt;&gt; ['Fuel_Type', 'Seller_Type', 'Transmission']</span></pre><p id="40c4" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">现在，我们将创建包含所有具有分类变量的特征的分类数据框架，并将从原始数据框架中删除所有分类特征。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="055a" class="kd ke iq lz b gy md me l mf mg">cat_df=df[list1]<br/>cat_df.head() #top five rows of cat_df</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/55bb7068d776962dd791fe75674e1b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*oSVjHweqndqjIHwtAgltfQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 3</figcaption></figure><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="d773" class="kd ke iq lz b gy md me l mf mg">df.head()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/6f58f70488fab9f3348bc6c488b0a2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*P99FJt8uMrPK-1Fwdjn23Q.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 4</figcaption></figure><p id="895c" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">年份代表购买汽车的年份，那么我们如何估计汽车的使用年限呢？</p><p id="e6d2" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><code class="fe mr ms mt lz b">number of year car has been used = current year — previous year</code></p><p id="1713" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">因此，我们是在2020年，汽车是在2014年，那么它已经使用的年数将是:- <code class="fe mr ms mt lz b">number of year car has been used=2020–2014=6</code>要打印汽车已经使用的年数，我们需要添加一个表示当前年份的列。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="273a" class="kd ke iq lz b gy md me l mf mg">df["Current_Year"]=2020</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/e85c0e755a0070924641c5ff246b3d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hYU2V1HE4hPo_vAsKXPloA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 5</figcaption></figure><p id="6ed4" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">我们已经成功添加了<code class="fe mr ms mt lz b"> <strong class="lb ir">current_ year </strong></code>，现在我们将添加<strong class="lb ir">年数</strong>列，并删除<strong class="lb ir">年</strong>和<strong class="lb ir">当前年</strong>列。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="52e7" class="kd ke iq lz b gy md me l mf mg">df["No_of_years"]=df["Current_Year"]-df["Year"]<br/>df=df.drop(["Current_Year","Year"],axis=1)<br/>df.head()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/502d09a90cde6d2617b0fed8884779e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*em2pe7GvpLhsLpygusuXXA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 5</figcaption></figure><p id="a7d6" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">获取数据的统计描述</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="027f" class="kd ke iq lz b gy md me l mf mg">df.describe()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/82dbce5f70e722816771cc0e24cdf0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*w8RP9hQfGvY5D7aNlSVc_g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 6</figcaption></figure><p id="64ce" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">一辆汽车平均行驶36947公里，最大行驶距离是500000公里。数据集中最高前展厅售价的汽车为92.6万卢比。汽车使用并出售的最长年限是17年，拥有一辆汽车的最长年限是3年。二手车的最高售价是350万卢比。这就是我们如何用数据集的统计描述得出结论。</p><h2 id="cd1b" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤4 :-数据可视化</h2><p id="980f" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">这是数据科学生命周期中最重要的一步，在这里我们理解数据的行为，并试图从中获得某些有意义的见解。让我们通过做…来理解它</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="01b2" class="kd ke iq lz b gy md me l mf mg">sns.set_style("darkgrid")<br/>sns.FacetGrid(df,hue="No_of_years",height=6).map(plt.scatter,"Present_Price","Selling_Price").add_legend()<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/852a8ae4787a46941cc8e15bdccbc8bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*vnnWxkG6-64n6JUOdyEoIw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 7</figcaption></figure><p id="0fd0" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">你使用汽车的年数越多，你得到的就越少。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="b7cc" class="kd ke iq lz b gy md me l mf mg">sns.set_style("darkgrid")<br/>sns.FacetGrid(df,hue="Present_Price",height=6).map(plt.scatter,"Kms_Driven","Selling_Price")<br/>plt.xlabel("Present Price",fontsize=20)<br/>plt.ylabel("Selling Price",fontsize=20)<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/e23d074123e3b376019538591c6f20ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*xAdN2c-OUdkYD3gyWCqW7w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 8</figcaption></figure><p id="f231" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">当我们在最大距离处看到图表时，即:- 500000公里，汽车的成本接近于零，或者我们可以说没有人愿意为这些汽车支付任何金额。</p><p id="2643" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><strong class="lb ir">绘制成对图</strong></p><p id="7c11" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">我们不能可视化多维散点图，因此通过使用对图，我们可以精确地可视化多维数据的每一个维度。</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/ac511bf9b0115bea75151932b21354af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9JSSc9-HsbvvE4a-Usyqw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 9</figcaption></figure><p id="988f" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">正如我们所见，数据集中的重叠非常少，因此我们不能使用knn、线性回归、svm，并且由于数据集的动态特性，我们甚至不能使用决策树，因此我们将使用随机森林和xgboost。</p><p id="65b9" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">单变量分析:-当分析主要涉及单个变量时，它用于在数据集中寻找模式。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9568" class="kd ke iq lz b gy md me l mf mg">sns.set_style("darkgrid")<br/>sns.FacetGrid(df,height=6).map(sns.histplot,"Selling_Price")<br/>plt.xlabel()<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/27e565c30e0f1f15fc3f9411d9dd1dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*t0DbaI52a2vDZxya45zG9g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 10</figcaption></figure><p id="f65c" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">大多数汽车都是在100万到100万的价格范围内售出的，而在250万到350万的价格范围内，顾客的数量可以忽略不计</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9d3f" class="kd ke iq lz b gy md me l mf mg">sns.set_style("darkgrid")<br/>sns.FacetGrid(df,height=6).map(sns.histplot,"Kms_Driven")<br/>plt.xlabel("Distance Travel",Fontsize=20)<br/>plt.ylabel("Demand",Fontsize=20)<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/d9c4abf93f9474c2baaae16c881acd6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*nPAtuu_HkvGAAnFkMa8-Ww.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 11</figcaption></figure><p id="1dbd" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">对那些行驶距离较短汽车的需求更大，特别是如果汽车行驶距离在0-5000公里范围内，人们更容易被它们吸引。</p><h2 id="7e33" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">C.D.F图</h2><p id="0735" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">它定义了小于等于相应x轴值的变量的百分比。让我们以上面的例子为例，有多少百分比的车辆的售价低于150万卢比，然后我们可以通过使用C.D.F找到这种答案。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="2ab7" class="kd ke iq lz b gy md me l mf mg">df_Selling_Price=df.loc[:,"Selling_Price"]<br/>count,bin_edges=np.histogram(df_Selling_Price,bins=10,density=True)  #density=True gives normalized form od bin_edges and count<br/>print(count)<br/>print(bin_edges)<br/>PDF=count/sum(count)<br/>CDF=np.cumsum(PDF)  #cdf is sum of all pdf values<br/>plt.figure(figsize=(8,6))<br/>plt.plot(bin_edges[1:],PDF,label="PDF")<br/>plt.plot(bin_edges[1:],CDF,label="CDF")<br/>plt.yticks(np.linspace(0,1,20))<br/>plt.legend(loc="lower left")<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/817beff1e1f686cdb552ff3df39c8514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*-wD6pTaxkmOysTeE3D2TVA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 12</figcaption></figure><p id="9b4e" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">我们可以看到，cardekho上94.7%的汽车价格≤150万卢比。所以有一点很清楚，如果我们想购买价格在20-25英镑之间的二手车，我们不会选择去cardekho.com，因为在那里我们没有太多的选择。</p><p id="cf87" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">多变量分析:-当我们分析两个或多个变量时。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="0095" class="kd ke iq lz b gy md me l mf mg">sns.set_style("darkgrid")<br/>sns.jointplot("Present_Price","Selling_Price",data=df,kind="kde")<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/2be7c04e17a65afd2a068610e67ff330.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*9qzHgiawvmws1rKKge4QyQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 13</figcaption></figure><p id="3f8f" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">如果我们看到上面的图表，我们可以理解，对于那些原价在0-200万之间的车辆，当他们在使用一段时间后出售他们的汽车时，他们可以获得大约50%的资金。</p><div class="ne nf gp gr ng nh"><a href="https://www.datadriveninvestor.com/2020/11/19/how-machine-learning-and-artificial-intelligence-changing-the-face-of-ecommerce/" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">机器学习和人工智能如何改变电子商务的面貌？|数据驱动…</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">电子商务开发公司，现在，整合先进的客户体验到一个新的水平…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv jw nh"/></div></div></a></div><h2 id="46ca" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤5:-特征工程</h2><p id="dfcd" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">由于我们已经制作了具有所有分类特征的<strong class="lb ir"> cat_df </strong>，因此我们将从原始数据帧中删除所有包含分类变量的特征，最后，在<strong class="lb ir"> cat_d </strong> f中使用特征工程后，我们将<strong class="lb ir">将cat_df </strong>与<strong class="lb ir">原始数据帧</strong>连接起来，这样我们就能够将所有变量转换成数字形式。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5559" class="kd ke iq lz b gy md me l mf mg">df=df.drop(list1,axis=1)</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/53075cafffc53d4a8e61d75ca7ccf3d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*2-5LQxBwA7h6RpM3N7T2JQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 14</figcaption></figure><p id="04a8" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">现在我们将在c <strong class="lb ir"> at_df </strong>上进行特征工程，将分类变量转换成数值变量。但在此之前，我们将检查每个特征包含多少个唯一分类变量。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="0838" class="kd ke iq lz b gy md me l mf mg">dict1={}<br/>for index,col in enumerate(cat_df.columns):<br/>    dict1[col]=cat_df[col].unique().tolist()<br/>dict1   #key is feature and values will be cat variables</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d010c8330b56eb2b2a1bc2c6f4a1a675.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*WKO0o7v_0NVoMNfy3NAMXQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 15</figcaption></figure><p id="1dc8" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">由于<strong class="lb ir">燃料类型、销售者类型、传输</strong>都是名义特征，且具有少量分类变量，我们将使用一个热编码。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="8ea0" class="kd ke iq lz b gy md me l mf mg">cat_df=pd.get_dummies(cat_df,drop_first=True)<br/>cat_df.head()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/8fcb86cfc70dfd6038c7fc26578bc7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*QUNznByHOtMt6ie8nqGZXg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 16</figcaption></figure><p id="e3f8" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">现在，我们将把编码的<strong class="lb ir"> cat_df </strong>与原始的<strong class="lb ir"> df </strong>连接起来，还将删除分类变量列。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="dc71" class="kd ke iq lz b gy md me l mf mg">df=df.drop(["Fuel_Type","Seller_Type","Transmission"],axis=1)<br/>df=pd.concat([df,cat_df],axis=1)<br/>df.head()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/58a0f1635752e5b3296a42b877412d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RALKkqDoCKeCKAt8g96Spg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 17</figcaption></figure><p id="8fed" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">现在我们已经把所有的特征转换成数值变量。在这里，我们将检查要素之间的相关性，但对于此数据集，我们不会进行要素选择，因为当数据集中有大量要素时会使用要素选择，但在此数据集中，我们仅检查数据集中的要素如何相互关联。</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/059a5d70029ca58e35429dc0f3bcb5c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*nBbJJ-xQLxK-K2RsMtBVbQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 18</figcaption></figure><p id="131a" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><strong class="lb ir">步骤6:预建模步骤</strong></p><p id="acf5" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">将数据集分为因变量和自变量。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="646e" class="kd ke iq lz b gy md me l mf mg">X=df.iloc[:,1:]<br/>Y=df.iloc[:,0]<br/>print(X.shape)<br/>print(Y.shape)</span><span id="8848" class="kd ke iq lz b gy mn me l mf mg">[out] &gt;&gt; (301, 11)<br/>         (301,)</span></pre><p id="ef1b" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">将数据集分为训练集和测试集</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9368" class="kd ke iq lz b gy md me l mf mg">X_train,X_test,Y_train,Y_test=train_test_split(X,Y,test_size=0.2,random_state=1)<br/>print(X_train.shape)<br/>print(Y_train.shape)<br/>print(X_test.shape)<br/>print(Y_test.shape)</span><span id="24fd" class="kd ke iq lz b gy mn me l mf mg">[out]&gt;&gt; (240, 11)<br/>        (240,)<br/>        (61, 11)<br/>        (61,)</span></pre><p id="0039" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><strong class="lb ir">为我们的数据集选择最佳模型:</strong></p><p id="dd2a" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">从pair plot中检查哪个模型最适合我们的数据集很明显，我们必须采用对非线性以及分类和数字数据组合进行预测的模型，即决策树、随机森林和xgboost，然后我们将检查哪个模型将具有高准确性，基于此我们选择模型。我们可以使用交叉验证分数来选择最适合的模型。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="d40f" class="kd ke iq lz b gy md me l mf mg">from sklearn.tree import DecisionTreeRegressor<br/>from sklearn.neighbors import KNeighborsRegressor<br/>from sklearn.ensemble import RandomForestRegressor<br/>from xgboost import XGBRegressor<br/>from sklearn import model_selection<br/>models=[]<br/>models.append(('CART', DecisionTreeRegressor()))<br/>models.append(("KNN",KNeighborsRegressor()))<br/>models.append(("RF", RandomForestRegressor()))<br/>models.append(("XGBOOST", XGBRegressor()))<br/>names=[]<br/>result=[]<br/>for name,model in models:<br/>    k_fold=model_selection.KFold(n_splits=10,shuffle=True,random_state=7)<br/>    score=model_selection.cross_val_score(model,X_train,Y_train,cv=k_fold,scoring="r2")<br/>    result.append(score)<br/>    names.append(name)<br/>    print(name,score.mean(),score.std())</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/a2adb8e8c090c1c44f03491b4681a094.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*Dst4hd2IHqBxhDODbHcyKA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 19</figcaption></figure><p id="9a41" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">让我们通过箱线图来了解每个算法的得分变化</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5b4b" class="kd ke iq lz b gy md me l mf mg">fig = plt.figure(figsize=(10,6))<br/>plt.boxplot(result,labels=names)<br/>plt.title('Algorithm Comparison',fontsize=25)<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/755545fdb8bad24cbda67c6c5ac3278f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*5zVp9E7gBeGINFsT0CFvkQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 20</figcaption></figure><p id="4e37" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">正如我们在上面的准确度得分结果中看到的，我们可以说XGboost以非常低的标准偏差提供了更好的准确度，因此我们应该选择XGboost。</p><p id="a665" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><strong class="lb ir">特征重要性</strong> :-检查所有给定特征中哪些特征对输出特征是重要的。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="e7bd" class="kd ke iq lz b gy md me l mf mg">plt.figure(figsize=(8,6))<br/>model=XGBRegressor()<br/>model.fit(X,Y)<br/>importance=np.sort(model.feature_importances_)<br/>plt.barh(X.columns,importance)<br/>plt.show()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/383eed7d9d4d01552dae8ed33ed91858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*nzTpJ99mjBK4Gd9mV0YY6g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 21</figcaption></figure><p id="bf9e" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">变速器_手动、卖方_类型_个人、燃料_类型_汽油、燃料_类型_柴油、年数对产量预测影响最大。</p><p id="1d44" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><strong class="lb ir">超参数调谐:</strong></p><p id="50b3" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">通过使用超参数，我们搜索给定模型的最佳参数，以便从给定模型中获得最佳结果。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9e26" class="kd ke iq lz b gy md me l mf mg">param_grid={"n_estimators":[100,120,130,140,150],<br/>            "max_depth":range(1,12),<br/>            "booster":["gbtree","gblinear","dart"]<br/>           }<br/>from sklearn.model_selection import RandomizedSearchCV<br/>xgb=XGBRegressor()<br/>random_cv=RandomizedSearchCV(estimator=xgb,param_distributions=param_grid,n_iter=100,cv=10)<br/>random_cv.fit(X_train,Y_train)</span></pre><p id="560d" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">让我们检查一下用于预测的最佳参数。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a8a9" class="kd ke iq lz b gy md me l mf mg">random_cv.best_params_</span><span id="c611" class="kd ke iq lz b gy mn me l mf mg">[out] &gt;&gt; {'n_estimators': 130, 'max_depth': 3, 'booster': 'dart'}</span></pre><p id="685d" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">检查数据集的训练测试准确性</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="639b" class="kd ke iq lz b gy md me l mf mg">from sklearn.metrics import r2_score <br/>xgb=XGBRegressor(n_estimators= 130, max_depth=3,booster= 'dart')<br/>xgb.fit(X_train,Y_train)<br/>Y_train_predicted=xgb.predict(X_train)<br/>Y_test_predicted=xgb.predict(X_test)<br/>print("Train set accuracy: ",r2_score(Y_train,Y_train_predicted))<br/>print("Test set accuracy : ",r2_score(Y_test,Y_test_predicted))</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/91591b094d9fdc7ed141a254b7c3b6fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*um4rUC6rcNW2FgcZu59uxg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 22</figcaption></figure><p id="1fe3" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">理解预测值；</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="6ae4" class="kd ke iq lz b gy md me l mf mg">Result=pd.DataFrame({"Actual":Y_test,"Predicted":Y_test_predicted})<br/>Result.head(10)</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/0c22cddc9d6bd3415c6a05c14ec17f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/1*JseE9ee13d7HY-50zsXvjg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 23</figcaption></figure><p id="470c" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">绘制Kde图，查看实际值和预测值之间的差异。</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/72764dc8065d7c06b8b363e1fcfb94b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*dOmgWi-gonK8ZkHsKH-jYw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Figure 24</figcaption></figure><p id="b4ba" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><strong class="lb ir">以序列化格式保存模型:</strong> <br/>以序列化格式保存模型，当我们需要进行预测时，我们只需加载pickle文件，并使用该序列化文件进行预测，我们不需要再次创建新模型来预测新的测试数据。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="7575" class="kd ke iq lz b gy md me l mf mg">import pickle</span><span id="4ff1" class="kd ke iq lz b gy mn me l mf mg">with open("car_price_prediction.pkl","wb) as file: #save pickle file<br/>pickle.dump(xgb_ran,file)<br/>with open "cat_price_prediction.pkl","rb") as file #load pickle file<br/>pickle.load(file)</span></pre><p id="c98d" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated"><strong class="lb ir">结论:- </strong></p><p id="5089" class="pw-post-body-paragraph kz la iq lb b lc mh le lf lg mi li lj km mj ll lm kq mk lo lp ku ml lr ls lt ij bi translated">如果你对这个博客有任何建议，请在下面评论。继续学习，继续探索…..</p><h2 id="efa4" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">访问专家视图— <a class="ae kc" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank">订阅DDI英特尔</a></h2></div></div>    
</body>
</html>