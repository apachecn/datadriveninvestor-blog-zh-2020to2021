# å¦‚ä½•åœ¨ä½ çš„ C++åº”ç”¨ä¸­å¿«é€ŸåµŒå…¥ python

> åŸæ–‡ï¼š<https://medium.datadriveninvestor.com/how-to-quickly-embed-python-in-your-c-application-23c19694813?source=collection_archive---------0----------------------->

![](img/6c16c7589a8ad469b6281c5c697ae507.png)

å°† python åµŒå…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å…è®¸æ‚¨ç”¨ Python è€Œä¸æ˜¯çº¯ C æˆ– C++å®ç°ä¸€äº›åŠŸèƒ½ã€‚è¿™æ˜¯æœ‰ç›Šçš„ï¼ŒåŸå› æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å…è®¸ç”¨æˆ·é€šè¿‡è¿è¡Œå®šåˆ¶è„šæœ¬æˆ–ç®€åŒ–æ‚¨å¿…é¡»ç¼–å†™çš„ä»£ç æ¥å®šåˆ¶åº”ç”¨ç¨‹åºä»¥æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚ã€‚å¯¹äºé‚£äº›æ‡’å¾—é˜…è¯»æ•´ä¸ª API çš„äººæ¥è¯´ï¼Œæœ¬æ•™ç¨‹å°†æ˜¯ä¸€ä¸ªå…³äºåµŒå…¥ python çš„å¿«é€Ÿç®€å•çš„é€Ÿæˆè¯¾ç¨‹ã€‚

# **ç¼–è¯‘å™¨è®¾ç½®**

ä¸ºäº†ä½¿ç”¨ Python-C APIï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆåœ¨ä»£ç ä¸­å¯¼å…¥å®ƒã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­æ·»åŠ # includeâ€œpython . hâ€æ¥å®ç°ã€‚ç„¶è€Œï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å°† python åŒ…å«æ–‡ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ç¼–è¯‘å™¨æœç´¢ç›®å½•ä¸­ã€‚åœ¨ Visual Studio 2019 ä¸­ï¼Œè¿™æ˜¯é€šè¿‡å°†åŒ…å«ç›®å½•ä» python å®‰è£…æ·»åŠ åˆ°å±æ€§> C/C++ >å¸¸è§„>é™„åŠ åŒ…å«ç›®å½•æ¥å®Œæˆçš„ã€‚

![](img/c8e58b8aa20f6eaa288ae33fde55838f.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°† python åº“æ·»åŠ åˆ°æˆ‘ä»¬çš„é“¾æ¥å™¨ä¸­ã€‚å°† python å®‰è£…ä¸­çš„*åº“*ç›®å½•æ·»åŠ åˆ°å±æ€§>é“¾æ¥å™¨>å¸¸è§„>é™„åŠ åº“ç›®å½•ä¸­ã€‚

![](img/e4db0646ae2f4b4ddefa608588e3d771.png)

æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºé“¾æ¥å™¨æŒ‡å®šåº“åã€‚åœ¨ Visual Studio ä¸­ï¼Œè¿™æ˜¯é€šè¿‡å°† python åº“çš„åç§°(å–å†³äºæ‚¨çš„ python ç‰ˆæœ¬ï¼Œå¯åœ¨{python å®‰è£…ç›®å½•} \libs ä¸­æ‰¾åˆ°)æ·»åŠ åˆ°å±æ€§>é“¾æ¥å™¨>è¾“å…¥>é™„åŠ ä¾èµ–é¡¹æ¥å®Œæˆçš„:

![](img/35f492116bef7a9ed3544e0df28c5b46.png)

åšå®Œè¿™äº›ï¼Œæˆ‘ä»¬ç»ˆäºå‡†å¤‡å¥½å¼€å§‹ç¼–ç äº†ï¼

# **åˆå§‹åŒ– python å®ä¾‹**

ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº†ç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ– python è§£é‡Šå™¨ï¼Œç„¶åæ‰èƒ½åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚è¿™æ˜¯é€šè¿‡æ·»åŠ ä»¥ä¸‹å†…å®¹å®ç°çš„:

```
//Initialize the python instancePy_Initialize();
```

è¿™å¿…é¡»åœ¨ä»£ç ä¸­ä½¿ç”¨ python ä¹‹å‰å®Œæˆã€‚

# **è¿è¡Œä¸€ä¸ª python å­—ç¬¦ä¸²**

## C++:

```
//Run a simple stringPyRun_SimpleString("from time import time,ctime\n""print('Today is',ctime(time()))\n");
```

## è¾“å‡º:

```
Today is Wed Aug 19 11:09:38 2020
```

PyRun _ SimpleString çš„åŠŸèƒ½ä»åå­—ä¸Šçœ‹å¾ˆç›´è§‚ã€‚å®ƒå…è®¸ä½ ç”¨ python è¿è¡Œä¸€æ®µä»£ç ã€‚å¦‚æœè¦è¿è¡Œå¤šè¡Œä»£ç ï¼Œè¯·åœ¨å­—ç¬¦ä¸²æœ«å°¾ä½¿ç”¨æ¢è¡Œç¬¦(" \n ")ã€‚

[](https://www.datadriveninvestor.com/2020/07/07/introduction-to-time-series-forecasting-of-stock-prices-with-python/) [## ç”¨ Python |æ•°æ®é©±åŠ¨æŠ•èµ„è€…è¿›è¡Œè‚¡ç¥¨ä»·æ ¼æ—¶é—´åºåˆ—é¢„æµ‹ç®€ä»‹

### åœ¨è¿™ä¸ªç®€å•çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•å°†æ—¶é—´åºåˆ—æ¨¡å‹åº”ç”¨äºè‚¡ç¥¨ä»·æ ¼ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œä¸€ä¸ªâ€¦

www.datadriveninvestor.com](https://www.datadriveninvestor.com/2020/07/07/introduction-to-time-series-forecasting-of-stock-prices-with-python/) 

# ä»æ–‡ä»¶è¿è¡Œå‡½æ•°

## **Python (script.py):**

```
def test(person): return "What's up " + person;
```

## **C++:**

```
//Run a python functionPyObject *pName, *pModule, *pFunc, *pArgs, *pValue;pName = PyUnicode_FromString((char*)"script");pModule = PyImport_Import(pName);pFunc = PyObject_GetAttrString(pModule, (char*)"test");pArgs = PyTuple_Pack(1, PyUnicode_FromString((char*)"Greg"));pValue = PyObject_CallObject(pFunc, pArgs);auto result = _PyUnicode_AsString(pValue);std::cout << result << std::endl;
```

## è¾“å‡º:

```
What's up Greg
```

ä» C++è¿è¡Œ python å‡½æ•°åŸºæœ¬ä¸Šæœ‰ä¸‰ä¸ªæ­¥éª¤

1.  å¯¼å…¥å‡½æ•°
2.  è°ƒç”¨å‡½æ•°
3.  è·å–å‡½æ•°çš„è¿”å›å€¼

è®©æˆ‘ä»¬ä¸€æ¬¡åˆ†è§£ä¸€è¡Œä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºå˜é‡è®¿é—®å¹¶è°ƒç”¨å‡½æ•°ï¼Œæ³¨æ„æ‰€æœ‰ç±»å‹éƒ½æ˜¯ PyObject æŒ‡é’ˆã€‚å˜é‡ *pName* å¯¹åº”äºæˆ‘ä»¬æƒ³è¦è®¿é—®ä»¥è·å¾—å‡½æ•°çš„ python æ–‡ä»¶çš„åç§°ï¼Œæ³¨æ„è¿™é‡Œæ²¡æœ‰ã€‚æ–‡ä»¶åçš„ py æ‰©å±•åã€‚ *pModule* å¯¼å…¥æˆ‘ä»¬çš„ python interpeter ä¸­æŒ‡å®šä¸ºæ¨¡å—çš„æ–‡ä»¶ã€‚ *pFunc* å¯¹åº”äºæˆ‘ä»¬æƒ³è¦ä» python æ–‡ä»¶ä¸­è°ƒç”¨çš„å‡½æ•°çš„åç§°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨ PyTuple_Pack åœ¨ *pArgs* ä¸­æŒ‡å®šå‡½æ•°çš„å‚æ•°ã€‚å‡½æ•°çš„ç¬¬ä¸€ä¸ªå€¼å¯¹åº”äºæˆ‘ä»¬å¸Œæœ›æŒ‡å®šç»™å‡½æ•°çš„å‚æ•°çš„æ•°é‡ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„ Python å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ã€‚PyTuple_Pack å‡½æ•°çš„ä»¥ä¸‹å‚æ•°æ˜¯æˆ‘ä»¬ä½œä¸º python å¯¹è±¡è¯·æ±‚çš„ python å‡½æ•°çš„å®é™…å‚æ•°ã€‚æ‚¨éœ€è¦é˜…è¯» API æ¥å¼„æ¸…æ¥šå¯¹äºæ‚¨æƒ³è¦åœ¨ä»£ç ä¸­ä½¿ç”¨çš„æ•°æ®ç±»å‹ï¼Œå¯¹åº”çš„ Python å¯¹è±¡æˆ–å‡½æ•°æ˜¯ä»€ä¹ˆã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ PyUnicode_FromString å‘ python å‘é€ä¸€ä¸ªå€¼ä¸ºâ€œGregâ€çš„å­—ç¬¦ä¸²å‚æ•°ã€‚ *pValue* å¯¹åº”äºå‡½æ•°æ‰§è¡Œå®ŒæŒ‡å®šå‚æ•°åçš„è¿”å›å€¼ã€‚ç„¶è€Œï¼Œ *pValue* çš„ç±»å‹ç›®å‰æ˜¯ä¸€ä¸ª pyObjectã€‚æˆ‘ä»¬ä½¿ç”¨ _PyUnicode_AsString å°†å‡½æ•°çš„è¿”å›å€¼è½¬æ¢ä¸º const char*ç±»å‹ï¼Œæ‚¨å°†å†æ¬¡éœ€è¦åœ¨ API å‚è€ƒä¸­æŸ¥æ‰¾æ‰€éœ€çš„ Python å‡½æ•°/å¯¹è±¡ã€‚

# **è¿è¡Œä¸€ä¸ªå®Œæ•´çš„ python æ–‡ä»¶**

## **Python (test.py):**

```
print("Hello from file")
```

## **C++:**

```
//Run a simple fileFILE* PScriptFile = fopen("test.py", "r");if(PScriptFile){PyRun_SimpleFile(PScriptFile, "test.py");fclose(PScriptFile);}
```

## **è¾“å‡º:**

```
Hello from file
```

è¿è¡Œæ•´ä¸ª python è„šæœ¬çš„æ­¥éª¤å¾ˆç®€å•:

1.  ä»¥åªè¯»æ–¹å¼åŠ è½½ python æ–‡ä»¶
2.  æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
3.  ç”¨ PyRun _ SimpleFile è¿è¡Œæ–‡ä»¶
4.  å…³é—­æ–‡ä»¶

# å…³é—­ python å®ä¾‹

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®Œæˆäº†å¯¹ python ä»£ç çš„è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦å…³é—­æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ python å®ä¾‹ã€‚è¿™æ˜¯é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å®Œæˆçš„:

```
//Close the python instancePy_Finalize();
```

# å®Œæ•´çš„ä»£ç 

# ç»“è®º

è¿™å°±æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­åµŒå…¥ python çš„åŸºç¡€ï¼åœ¨åé¢çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†ä»‹ç»å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºã€å¯¹è±¡å’Œç»§æ‰¿ä¸­è¿›è¡Œ python çš„â€œä½çº§â€åµŒå…¥ï¼Œä¸ Cython æ¥å£å¹¶ä½¿ç”¨ Boost Pythonã€‚å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹å¹¶æƒ³çœ‹æ›´å¤šï¼Œè¯·é¼“æŒå¹¶åœ¨ç¤¾äº¤åª’ä½“ä¸Šåˆ†äº«è¿™ç¯‡æ–‡ç« ï¼æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼

*è°¢è°¢æ‚¨çš„é˜…è¯»ï¼Œè¯·ğŸ‘å¹¶åˆ†äº«å‡ºæ¥å¸®åŠ©åˆ«äººæ‰¾åˆ°ã€‚åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘çš„æ–°å†…å®¹*[*@ gregcodesstuff*](https://twitter.com/gregcodesstuff)

å›å¤´è§ã€‚ğŸ˜ƒ

**è®¿é—®ä¸“å®¶è§†å›¾â€”** [**è®¢é˜… DDI è‹±ç‰¹å°”**](https://datadriveninvestor.com/ddi-intel)