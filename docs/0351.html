<html>
<head>
<title>Hyperledger Fabric Best Practices- #1 Encrypting State Database With Chaincode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hyperledger结构最佳实践-使用链码加密状态数据库排名第一</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/hyperledger-fabric-best-practices-in-production-1-encrypting-state-database-with-chaincode-8369b0bc345a?source=collection_archive---------0-----------------------#2020-01-26">https://medium.datadriveninvestor.com/hyperledger-fabric-best-practices-in-production-1-encrypting-state-database-with-chaincode-8369b0bc345a?source=collection_archive---------0-----------------------#2020-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4a84ead654fcb6347b81091b31af8c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xnORJc2dqj0f6lbzMUDEew.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">A Photo By <a class="ae kf" href="https://www.pexels.com/@life-of-pix" rel="noopener ugc nofollow" target="_blank">Life Of Pix</a> in <a class="ae kf" href="https://www.pexels.com" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><figure class="kg kh ki kj gt ju"><div class="bz fp l di"><div class="kk kl l"/></div></figure><p id="751a" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">由于区块链技术令人难以置信的受欢迎程度，IBM的Hyperledger Fabric项目触及天空，不仅仅是因为它是区块链框架之一。拥有一些很棒的独特特性，如许可架构、即插即用组件、对机密事务的通道支持、模块化和可伸缩性。由于所有这些事实，Hyperledger Fabric在这个区块链时代变得具有革命性。它有改变行业的巨大潜力，我们现在已经看到了。在过去的几个月里，Hyperledger Fabric取得了很大进展。无论你是hyperledger fabric的新手，还是有一些经验，并希望快速掌握Hyperledger Fabric生产和开发的最佳实践，这篇文章都适合你。这是一系列文章，我将在这个系列中添加更多的实践和技巧。现在，我想发布我的第一个选择<strong class="ko iu">“# 1用Nodejs Chaincode加密和解密状态数据库”</strong>今天！</p><figure class="kg kh ki kj gt ju gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/af7b0af251fc8457c7bc8a18803e8992.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*oQOelBG4-9Us_k8EqJn40Q.jpeg"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Google Image of Cat Doing Science</figcaption></figure><h2 id="5175" class="ll lm it bd ln lo lp dn lq lr ls dp lt kx lu lv lw lb lx ly lz lf ma mb mc md bi translated">特种宽银幕电影</h2><p id="28e1" class="pw-post-body-paragraph km kn it ko b kp me kr ks kt mf kv kw kx mg kz la lb mh ld le lf mi lh li lj im bi translated">有些情况下，我们会处理敏感数据，如存储信用卡数据、银行信息、生物特征数据、健康信息等..作为分布式分类帐中业务应用程序的一部分。最终用户总是希望保护这些机密信息，即使数据库遭到破坏。在相当多的应用中，我们会要求对数据库中的数据进行加密，这样即使有人进入了数据库，他们也可能不知道数据是什么。然而，在区块链，数据库被黑客攻击的可能性微乎其微。尽管黑客入侵区块链数据库的可能性较小，但在存储到区块链数据库时加密用户数据是一个很好的做法。加密在许多应用中至关重要。随着Hyperledger Fabric最近越来越受欢迎，让我们看看如何使用Nodejs链码加密进入数据库的数据。</p><div class="mj mk gp gr ml mm"><a href="https://www.datadriveninvestor.com/2019/03/08/top-10-blockchain-courses/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd iu gy z fp mr fr fs ms fu fw is bi translated">2019年十大区块链课程|数据驱动的投资者</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">渴望在区块链发展吗？你想知道区块链是如何工作的，但不知道在哪里？或者就是太多了…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na jz mm"/></div></div></a></div><p id="9df8" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">在任何生产级应用程序上尝试这种方法之前，您需要知道的一件事是，这将会减慢速度。这个过程涉及到两个额外的步骤——加密和解密数据。这将使您的应用程序变慢一点，并且根据您的数据库读写量，这可能会对您的应用程序的性能产生重大影响。在决定加密数据库中的所有内容之前，请记住这一点。</p><h2 id="4d30" class="ll lm it bd ln lo lp dn lq lr ls dp lt kx lu lv lw lb lx ly lz lf ma mb mc md bi translated">该过程</h2><p id="d04f" class="pw-post-body-paragraph km kn it ko b kp me kr ks kt mf kv kw kx mg kz la lb mh ld le lf mi lh li lj im bi translated">在我们开始加密之前，首先让我解释一下我在这里使用的链码逻辑。实际上，我们的链代码在这里做的是简单的用户注册和登录。用户将通过提供用户名和密码在我们的应用程序上注册。这些凭据将以纯文本形式存储在数据库中，每当用户使用这些凭据登录时，将使用存储在数据库中的凭据对提供的凭据进行验证。因此，我们将为这些凭据添加加密和解密层。容易吗？？我们开始吧。</p><p id="df37" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">对于这个例子，我保持这个超级简单，并为Nodejs使用一个内置的加密库。根据您正在使用的应用程序，您可以自定义加密的实现，并尽可能使它变得复杂。</p><p id="d5e6" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">注意:</strong>我将在本文中演示的这些加密和解密方法工作在Nodejs运行时v 10 . 0 . 0(Nodejs链码的当前运行时环境)下。— Hyperledger Fabric 1.4.3)但是，在未来的版本中，链码的Nodejs运行时将迁移到v12.13.0，因此我们可以使用更好的方法来加密和解密数据。但是，技术是一样的。为此，我还在这个演示存储库中添加了v12.13.0兼容的加密和解密方法。</p><p id="ee9f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">更新:</strong>出于安全和隐私考虑，我们不应该通过交易明确传递机密信息(即密码)，因为这涉及到将这些密码存储在特定的交易头中。如果网络中的其他用户可以扫描这些块，他们就可以读取你的机密信息(如密码)。相反，您可以散列密码并通过事务传递它(这是另一个故事)。我在这里描述的例子(注册和登录)是为了解释只用链码加密/解密的概念。</p><p id="bad3" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu"> 1。加密:</strong></p><p id="8333" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">这个示例项目的整个加密实用程序如下:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="6673" class="ll lm it nc b gy ng nh l ni nj">function encrypt(data){   <br/>  const cipher = crypto.createCipher('aes256', password);  <br/>  let encrypted = cipher.update(data, 'utf8', 'hex');<br/>  encrypted += cipher.final('hex');   <br/>  return encrypted;<br/>}</span></pre><p id="2d63" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">方法<strong class="ko iu"> encrypt() </strong>会做您认为它会做的事情。它只是使用内置的基本加密器的五行代码。encrypt()函数将通过环境变量(<code class="fe nk nl nm nc b">.env</code>)使用预定义的加密密码获取参数<code class="fe nk nl nm nc b">data</code>，它将基于给定的算法<code class="fe nk nl nm nc b">aes256</code>创建一个加密密钥，并使用该加密密钥加密<code class="fe nk nl nm nc b">data</code>并返回加密的数据。这是encrypt()函数背后的全部思想。如果您想了解更多关于每一行的具体功能，请点击这里的<a class="ae kf" href="https://nodejs.org/api/crypto.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3cba" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu"> 2。解密:</strong></p><p id="ebf2" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">下面是这个示例项目的解密实用程序:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="0e59" class="ll lm it nc b gy ng nh l ni nj">function decrypt(cipherData)  {    <br/>   const decipher = crypto.createDecipher('aes256', password);    <br/>   let decrypted = decipher.update(cipherData, 'hex', 'utf8');<br/>   decrypted += decipher.final('utf8');   <br/>   return decrypted.toString();</span><span id="64ca" class="ll lm it nc b gy nn nh l ni nj">}</span></pre><p id="3913" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">方法<strong class="ko iu"> decrypt() </strong>将对加密的数据进行解密。<strong class="ko iu"> decrypt() </strong>函数将再次接受一个参数— cipherData。有了密码，它将根据给定的算法<code class="fe nk nl nm nc b">aes256</code>创建一个解密密钥，并用解密密钥解密<code class="fe nk nl nm nc b">cipherData</code>并返回普通数据。<a class="ae kf" href="https://nodejs.org/api/crypto.html" rel="noopener ugc nofollow" target="_blank">了解更多。</a></p><p id="8345" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu"> 3。链码实现:</strong></p><p id="bb4c" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">注意:</strong>术语密码代表两个不同的参数。一个是业务应用程序的注册/登录密码，另一个是加密/解密密码(通过<code class="fe nk nl nm nc b">.env</code>提供给环境)来加密/解密数据</p><p id="4145" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们以前见过我们的链码逻辑。因此，当用户提交他的凭证(用户名和密码)时，我们应该在将它们放入数据库之前对它们进行加密。所以我们的第一个任务是将它们传递给encrypt()方法。一旦数据被加密，encrypt()方法将返回加密的数据。现在我们需要将这些加密的数据放在数据库中，密钥为username。迷茫？看看代码中的<strong class="ko iu"> signUp() </strong>函数。</p><p id="4c5f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">类似地，当用户登录时，我们的chaincode需要验证用户名是否存在于数据库中，如果存在，它应该检查提交的密码是否正确。因此，为了检查密码是否正确，应该首先解密与特定密钥(用户名)相关联的数据，因为它是加密的。所以，我们需要将这个加密的数据传递给<code class="fe nk nl nm nc b">decrypt()</code>方法。解密后，如果提供的登录密码与特定密钥(用户名)相关的密码匹配，它将验证用户登录。这是完整的代码。</p><figure class="kg kh ki kj gt ju"><div class="bz fp l di"><div class="no kl l"/></div></figure><p id="1637" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">快速演示</strong></p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="5010" class="ll lm it nc b gy ng nh l ni nj">git clone <a class="ae kf" href="https://github.com/Salmandabbakuti/hlf-encryption.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Salmandabbakuti/hlf-encryption.git</a></span><span id="2c5a" class="ll lm it nc b gy nn nh l ni nj">cd hlf-encryption </span><span id="6316" class="ll lm it nc b gy nn nh l ni nj">chmod 777 node-start.sh &amp;&amp; chmod 777 go-start.sh</span><span id="c6de" class="ll lm it nc b gy nn nh l ni nj">./node-start.sh #nodejs chaincode encryption model (credentials storing and validation logic) head over to fauxton UI http://localhost:5984/_utils</span><span id="69d1" class="ll lm it nc b gy nn nh l ni nj">./go-start.sh #golang chaincode encryption model (tuna supplychain logic)</span></pre><figure class="kg kh ki kj gt ju gh gi paragraph-image"><div class="gh gi np"><img src="../Images/1c5f2ac1ddaad0787f75d0cdc48e4584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*QRPpnxPeHxo9AePqUYHORA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Plain Data in Database without Encryption.</figcaption></figure><figure class="kg kh ki kj gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/9043a4bef339bcb72e74c6e5e9b5e869.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*UbLloqGzxjdLeoM6aWisOg.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Database With Added Encryption.</figcaption></figure><p id="f89a" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">如你所见，加密和解密的魔力正在发挥作用。</p><p id="2014" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">如果你对直接进入代码感兴趣，你可以从<a class="ae kf" href="https://github.com/Salmandabbakuti/hlf-encryption" rel="noopener ugc nofollow" target="_blank">这里</a>分叉出完整的项目。如果您对此有任何疑问或建议，请随时在下面留下评论。</p><p id="64b4" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我准备发表一系列关于“Hyperledger Fabric在生产中的最佳实践”的文章。在下一篇文章中，我将解释如何通过三个简单的步骤将hyperledger explorer连接到您的网络。</p><p id="b00e" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">你们有兴趣吗？跟我来..</p><p id="bfb7" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">快乐超帐织物🙌</p><figure class="kg kh ki kj gt ju"><div class="bz fp l di"><div class="nr kl l"/></div></figure></div></div>    
</body>
</html>