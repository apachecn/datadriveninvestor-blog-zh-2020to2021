<html>
<head>
<title>Centralized Log Management (CLM) Using EFK Stack and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用EFK堆栈和Docker的集中式日志管理(CLM)</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/centralised-log-management-clm-using-efk-stack-and-docker-32b693df9432?source=collection_archive---------6-----------------------#2020-12-18">https://medium.datadriveninvestor.com/centralised-log-management-clm-using-efk-stack-and-docker-32b693df9432?source=collection_archive---------6-----------------------#2020-12-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5e1d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第二季|第一集</h2></div><p id="67b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">拥有适当的集中式日志管理基础设施将有助于我们调查或调试系统中出现的问题。此外，借助CLM，我们可以提高应用程序/系统的安全性。在本地设置之前，让我们看看什么是日志记录和跟踪，</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/4f4c6efbe21d611f5366e68c12abfae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zlNfmSBlxM5Rfsxrs_euDQ.png"/></div></div></figure></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="c046" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated"><strong class="ak"> 1。伐木业</strong></h2><p id="38cd" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">它是一段时间内事件的记录，或者是带有相关时间戳的截屏。</p><h2 id="18c2" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">2.描摹</h2><p id="b129" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">简单来说，这就像是坠机时的飞机黑匣子。它有助于您了解碰撞过程中的情况，并发现导致问题的一连串事件。简而言之，您将获得应用程序的360度视图。</p><p id="1f53" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个博客中，我们正在使用Fluentd、Elasticsearch和Kibana构建一个CLM。让我们看看这些服务是什么，</p><ol class=""><li id="7689" class="ms mt iq kh b ki kj kl km ko mu ks mv kw mw la mx my mz na bi translated">1.<strong class="kh ir">弹性搜索</strong></li></ol><p id="ecd2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个高度可扩展的开源全文搜索和分析引擎。它允许您快速、近乎实时地存储、搜索和分析大量数据。</p><p id="480f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1.2.<strong class="kh ir">基巴纳</strong></p><p id="3ad8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Kibana是一个免费开放的用户界面，可以让你可视化你的Elasticsearch数据并浏览Elastic Stack。</p><p id="57e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1.3.<strong class="kh ir">流体</strong></p><p id="48ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它是一个开源数据收集器，使您能够统一数据收集和消费，以便更好地使用和理解数据。</p><p id="56ed" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有许多数据收集器可用，但我选择fluentd是因为它的可靠性和性能得到了验证。</p><h2 id="a42c" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">体系结构</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nb"><img src="../Images/f559fb6d09473902a76b4122e25f926d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hIZF4tEqsDUYxIiZ-sHiHA.png"/></div></div></figure><h2 id="26a3" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">本地设置</h2><p id="e85c" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">我们将暂时使用Docker来管理我们的服务。</p><h2 id="d5c9" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">先决问题</h2><p id="fbce" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">从Docker hub下载所有三张官方<strong class="kh ir">图片</strong></p><ol class=""><li id="96a4" class="ms mt iq kh b ki kj kl km ko mu ks mv kw mw la mx my mz na bi translated"><a class="ae nc" href="https://hub.docker.com/_/kibana" rel="noopener ugc nofollow" target="_blank">基巴纳</a></li><li id="e53e" class="ms mt iq kh b ki nd kl ne ko nf ks ng kw nh la mx my mz na bi translated"><a class="ae nc" href="https://hub.docker.com/_/elasticsearch" rel="noopener ugc nofollow" target="_blank">弹性搜索</a></li><li id="e1f7" class="ms mt iq kh b ki nd kl ne ko nf ks ng kw nh la mx my mz na bi translated"><a class="ae nc" href="https://hub.docker.com/r/fluent/fluentd/" rel="noopener ugc nofollow" target="_blank">流动的</a></li></ol><p id="1a36" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的版本是7 . 10 . 1(kibana和elastic search都有)，fluentd是最新版本。注意-确保使用相同版本的Kibana和Elasticsearch。</p><h2 id="ee88" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">弹性搜索</h2><p id="3a56" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">使用以下命令运行ElasticSearch。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="c184" class="lu lv iq nj b gy nn no l np nq">docker run -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" --name myES <a class="ae nc" href="http://docker.elastic.co/elasticsearch/elasticsearch:7.10.1" rel="noopener ugc nofollow" target="_blank">docker.elastic.co/elasticsearch/elasticsearch:7.10.1</a></span></pre><p id="d9fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以使用下一个curl来检查容器状态</p><p id="570e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nr ns nt nj b">curl -X GET "localhost:9200/_cat/nodes?v&amp;pretty"</code></p><h2 id="c773" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">基巴纳</h2><p id="469a" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">使用下面的命令运行Kibana，这里我们已经使用<code class="fe nr ns nt nj b">--link</code>命令将弹性搜索与kibana链接起来</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="2639" class="lu lv iq nj b gy nn no l np nq">docker run --link myES:elasticsearch -p 5601:5601 <a class="ae nc" href="http://docker.elastic.co/kibana/kibana:7.10.1" rel="noopener ugc nofollow" target="_blank">docker.elastic.co/kibana/kibana:7.10.1</a></span></pre><p id="1824" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我们访问时，我们会看到这样的基巴纳仪表板</p><p id="20b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nr ns nt nj b"><a class="ae nc" href="http://localhost:5601/app/kibana" rel="noopener ugc nofollow" target="_blank">http://localhost:5601/app/kibana</a></code></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nu"><img src="../Images/ad4a6755888f47886a4464b8b4a4deaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qsi3hKzjLlp6RLGRpdzZ_Q.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Kibana Dashboard</figcaption></figure><h2 id="cd60" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">流体d</h2><p id="7286" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">我们将创建fluentd容器及其依赖项，而不是构建一个定制的Docker映像。因为这是一个简单的方法，所以我像这样运行我的数据收集器，但是你可以选择你最好的方法！</p><p id="94c4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在此创建带有所需输入插件的配置文件；我的配置文件包含了<strong class="kh ir"> HTTP </strong>和<strong class="kh ir"> forwards </strong>输入插件。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="6438" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">发布此命令后，运行以下命令来启动fluentd docker映像</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="03b3" class="lu lv iq nj b gy nn no l np nq">docker run -ti --rm -p 9880:9880  -p 24224:24224 -v /{fluentd_config_file_path}/:/fluentd/etc fluentd  sh -c "fluent-gem install fluent-plugin-elasticsearch --user-install;/usr/bin/ruby /usr/bin/fluentd -c /fluentd/etc/fluent.conf -p /fluentd/plugins"</span></pre><p id="7185" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CLM基础设施准备张贴数据；一旦你完成了输入<a class="ae nc" href="https://docs.fluentd.org/input" rel="noopener ugc nofollow" target="_blank">插件</a>的配置并发布了数据，按照下面的步骤在kibana中可视化你的日志。</p><p id="f30a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在可以管理空间并单击索引模式来创建新的索引</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ob"><img src="../Images/d009144c6534889a838440ccb5e19743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Y4DXskhYvKUS3_fIRLJUA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Index pattern creation</figcaption></figure><p id="7c0f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单击下一步；现在，您已经成功地创建了一个默认索引名为fluentd的索引模式；对于自定义索引名称，您必须在运行fluentd容器之前在fluentd配置文件中指定。弹性搜索使用动态映射来预测索引拥有的字段。下面的截图将帮助你理解映射。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oc"><img src="../Images/f1dbddbeba1ccac04d4b9889be470d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3Fw6xdETkN4PWudJOErTA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Elasticsearch Mapping</figcaption></figure><p id="1155" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以导航到discover部分，然后选择过滤器来查看您发送的日志。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi od"><img src="../Images/dceca24010fbb4f14dda811f703fc505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zcZ9I19i3LO3RKIZHS1PgA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Kibana Dashboard</figcaption></figure><p id="6688" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要区分收到的日志/添加验证/添加标记或标签，请参考fluentd官方<a class="ae nc" href="https://docs.fluentd.org/configuration" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="1ab5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就这样了，伙计们。我们的CLM从这里准备好了；您可以为您的用例实现这一点。我参考了一些官方文档和许多博客，并以这种简化的方式创建了这个博客。如有任何反馈，请通过<a class="ae nc" href="https://twitter.com/muni_offl" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae nc" href="http://linkedin.com/in/muniyappanmani/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>联系我。谢谢！</p></div></div>    
</body>
</html>