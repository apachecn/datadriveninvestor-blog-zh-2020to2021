<html>
<head>
<title>Dockerize and Deploy your Machine Learning Application on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS上整理和部署您的机器学习应用程序</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/dockerize-and-deploy-your-machine-learning-application-on-aws-e2537bd3df21?source=collection_archive---------1-----------------------#2020-06-24">https://medium.datadriveninvestor.com/dockerize-and-deploy-your-machine-learning-application-on-aws-e2537bd3df21?source=collection_archive---------1-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7c90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我之前的<a class="ae ko" href="https://medium.com/datadriveninvestor/build-and-deploy-your-machine-learning-application-with-docker-f6ec5acdf2ff" rel="noopener">帖子</a>中，我谈到了如何使用Docker封装你的机器学习应用程序，但不幸的是，我只能在我的机器上本地构建和部署该应用程序。在本文中，我将向您展示如何使用AWS EC2实例通过AWS将dockerized映像部署到云中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/69d42b810501f88a0505b6c0f6b9f1ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZ1U6RH-i_eZPug9onXLjQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">credit: Geekylane</figcaption></figure><h1 id="2c47" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">将图像推送到Docker Hub</h1><p id="298c" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">第一步是将您的自定义映像推送到一个容器注册中心，在本例中，我将使用Docker Hub。要使用Docker Hub，你必须创建一个账户，你可以在这里做这个<a class="ae ko" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">。然后在您的终端上运行以下命令:</a></p><p id="76fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要检查本地的所有图像，请输入以下命令:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="33a8" class="mn lg it mj b gy mo mp l mq mr">israel@israel:~$ sudo docker images</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/7963a4cf4cd80edad8cecef779607d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3GlSExhtmUG6Za8qph_iA.jpeg"/></div></div></figure><p id="315d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我将向Docker Hub推送的图片是<em class="mt">以色列/糖尿病预测模型。为了检查我是如何建立这个图像的，你可以在这里查看<a class="ae ko" href="https://medium.com/datadriveninvestor/build-and-deploy-your-machine-learning-application-with-docker-f6ec5acdf2ff" rel="noopener"/>。</em></p><div class="mu mv gp gr mw mx"><a href="https://www.datadriveninvestor.com/2020/02/19/cognitive-computing-a-skill-set-widely-considered-to-be-the-most-vital-manifestation-of-artificial-intelligence/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">认知计算——一套被广泛认为是……</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">作为它的用户，我们已经习惯了科技。这些天几乎没有什么是司空见惯的…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl kz mx"/></div></div></a></div><p id="6c32" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您是第一次这样做，您必须使用下面的命令登录Docker Hub:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="2569" class="mn lg it mj b gy mo mp l mq mr">israel@israel:~$ sudo docker login --username=yourhubusername</span></pre><p id="0dcd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，复制该特定图像的图像ID，并使用以下命令对其进行标记:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="f400" class="mn lg it mj b gy mo mp l mq mr">israel@israel:~$ sudo docker tag b4bacf7fb8a4 yourhubusername/model-deployment:latest</span></pre><p id="7cbd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">字母数字必须与该映像的映像ID相匹配，<em class="mt">your Hub username/model-deployment</em>表示您在Docker Hub上创建的存储库，<code class="fe nm nn no mj b">:latest</code>是标签。</p><p id="c9af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后使用您通过以下命令创建的存储库将您的映像推送到Docker Hub:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="b056" class="mn lg it mj b gy mo mp l mq mr">israel@israel:~$ sudo docker push yourhubusername/<em class="mt">model-deployment</em></span></pre><p id="a9f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到以下输出:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="7eb1" class="mn lg it mj b gy mo mp l mq mr">The push refers to repository [docker.io/israelaminu/<em class="mt">model-deployment</em>]<br/>dc29bdeebb3b: Pushed <br/>87397f1e0ca2: Pushed <br/>0b2a46dd78d7: Pushed<br/>abe258d83872: Pushed <br/>21fe8a57cd01: Pushed <br/>0f3ecf0004ca: Pushed </span><span id="8e79" class="mn lg it mj b gy np mp l mq mr">...</span><span id="7b5a" class="mn lg it mj b gy np mp l mq mr">55109ad1bdfa: Pushed<br/>46829331b1e4: Pushed <br/>d35c5bda4793: Pushed <br/>a3c1026c6bcc: Pushed<br/>f1d420c2af1a: Pushed <br/>461719022993: Pushed <br/>latest: digest: sha256:221424ffd34434c7834504980b845889722d3aa1bed0535fe666dbae25072357 size: 3676</span></pre><p id="ced3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你去Docker Hub，你会在你的存储库中看到你的Docker映像</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/22993719f6d28e3735d55abe42ba343e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HSqMQdrbtgCcJCjGNHGfcQ.png"/></div></div></figure><h1 id="f941" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">设置AWS EC2例程</h1><p id="37e4" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">登录AWS控制台仪表板，点击<strong class="js iu"> EC2 </strong></p><p id="cc42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">滚动到启动实例并点击<strong class="js iu">启动实例</strong>按钮</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nq"><img src="../Images/e881a560ae94f1b58fc5063c0f6bd874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiz3VNqWjThsVmRCB5NSnA.jpeg"/></div></div></figure><p id="705a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，选择一个Amazon机器映像(AMI)，对于我的情况，我选择了<strong class="js iu">Amazon Linux AMI 2018 . 03 . 0(HVM)</strong>，因为它具有所有的依赖项，并且是免费层，这意味着我可以以很少的成本或零成本运行实例。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/3ada76152cecd1beea9ab76399f6ddaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cbIGWn_WJwi9S8_TbkshhQ.jpeg"/></div></div></figure><p id="81e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于实例类型，我选择了通用的t2.micro</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/e3ebca22c42497977db490faa38a4f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BTmdR_B6golp2631GUV-bQ.jpeg"/></div></div></figure><p id="e52e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样在配置安全组部分，我创建了一个新的安全组。SSH允许我连接到我的机器上的实例，HTTP将我的服务器IP路由到DNS，以便我可以在任何地方访问DNS。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/ad1ec7fc1b0b110c856776f6527849ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sw8zRgi9NPXgBjeMiayJtQ.jpeg"/></div></div></figure><p id="971d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些是我要做的配置。您也可以选择设置其他配置。</p><p id="d6e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击查看并启动。</p><p id="55bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统将提示您创建或使用一个现有的对密钥，该密钥允许您通过SSH连接到本地机器上的实例。选择首选选项后，点击<strong class="js iu">启动实例</strong></p><p id="f087" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到下图:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/5acfa9aed6aa5dc3a1a6ba1709f2e035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dn2uRaewiE-8wrQ3SeqF8A.jpeg"/></div></div></figure><h1 id="d81b" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">在EC2实例上运行Docker映像</h1><p id="d4c5" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">使用下面的命令SSH到您机器上的EC2实例:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="0f09" class="mn lg it mj b gy mo mp l mq mr">sudo ssh -i yourpairkey.pem <a class="ae ko" href="mailto:ec2-user@ec2-34-203-29-67.compute-1.amazonaws.com" rel="noopener ugc nofollow" target="_blank">ec2-user</a>@<em class="mt">my-instance-public-dns-name</em></span></pre><p id="5c60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您将看到以下输出:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/8fa0bbd9fb69ac5789c096c9e89e1069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHmxycnt89wAEbvrxdnEHw.png"/></div></div></figure><p id="d350" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行以下命令来更新实例包</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="f5d8" class="mn lg it mj b gy mo mp l mq mr">[ec2-user@ip-172–31–52–68 ~]$ sudo yum update</span></pre><p id="7040" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装Docker:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="371b" class="mn lg it mj b gy mo mp l mq mr">[ec2-user@ip-172–31–52–68 ~]$ <!-- -->sudo yum install docker</span></pre><p id="d2b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完成后，将我们推送的docker映像拉至存储库。</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="e945" class="mn lg it mj b gy mo mp l mq mr">[ec2-user@ip-172–31–52–68 ~]$ docker pull israelaminu/model-deployment:latest</span></pre><p id="c4fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可能会遇到如下错误:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="58ff" class="mn lg it mj b gy mo mp l mq mr">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span></pre><p id="806d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要解决这个问题，只需使用下面的命令:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="a4b4" class="mn lg it mj b gy mo mp l mq mr">[ec2-user@ip-172–31–52–68 ~]$ sudo service docker start</span></pre><p id="b4c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后再拉图像。</p><p id="440f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到以下输出:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="44ce" class="mn lg it mj b gy mo mp l mq mr">latest: Pulling from israelaminu/model-deployment<br/>7e2b2a5af8f6: Pull complete <br/>09b6f03ffac4: Pull complete <br/>dc3f0c679f0f: Pull complete <br/>fd4b47407fc3: Pull complete <br/>b32f6bf7d96d: Pull complete <br/>3940e1b57073: Pull complete <br/>cabba05798b6: Pull complete <br/>abe267d9b00c: Pull complete <br/>b327ce3e08b8: Pull complete <br/>7865c684e647: Pull complete <br/>29f11117a112: Pull complete <br/>0f5c2847ba27: Pull complete <br/>e36cccfef176: Pull complete <br/>3f1641cdd547: Pull complete <br/>9cbaf6cfc5c1: Pull complete <br/>865a221af195: Pull complete <br/>Digest: sha256:221424ffd34434c7834504980b845889722d3aa1bed0535fe666dbae25072357<br/>Status: Downloaded newer image for israelaminu/diabetes-model-deployment:latest<br/>docker.io/israelaminu/model-deployment:latest</span></pre><p id="3313" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过运行以下命令确认映像已下载</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="c77e" class="mn lg it mj b gy mo mp l mq mr">[ec2-user@ip-172–31–52–68 ~]$ sudo docker images</span></pre><p id="7f9d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输出:</p><p id="bff3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要运行Docker映像，请使用以下命令:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="74bc" class="mn lg it mj b gy mo mp l mq mr">[ec2-user@ip-172–31–52–68 ~]$ sudo docker run --name deploy_model -p 80:8080 israelaminu/model-deployment</span></pre><p id="9588" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到以下输出:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="7378" class="mn lg it mj b gy mo mp l mq mr">Serving Flask app “app” (lazy loading)<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a       production deployment.<br/> Use a production WSGI server instead.<br/> * Debug mode: off<br/> * Running on <a class="ae ko" href="http://0.0.0.0:8080/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8080/</a> (Press CTRL+C to quit)</span></pre><p id="b767" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您的容器完全运行在AWS实例上</p><p id="a79d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用实例的公共DNS在浏览器上测试API，您将看到以下输出:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/af5d50dae9fcb810edc7b03434cc863d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dz_AvOSmFNO19tQc1s3FEA.png"/></div></div></figure><h1 id="a58a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用POSTMAN进行测试和预测</h1><p id="520a" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">我通过传入特征和值来测试端点，以获得患者的糖尿病类型和置信度得分，它花费了492毫秒来返回响应，这是足够公平的。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/d223a39295f983c146865b2391a50f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iR2J5BhutgfUJ9FTC1Q-XA.png"/></div></div></figure><p id="d09c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到目前为止，我们已经能够通过在Docker容器上运行它并在AWS EC2实例上托管它来部署机器学习模型。</p><p id="f85c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">访问专家视图— </strong> <a class="ae ko" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>