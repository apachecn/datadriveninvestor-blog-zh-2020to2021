<html>
<head>
<title>Tech: Implement Virtual Scrolling with MatList in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">技术:在Angular中用MatList实现虚拟滚动</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/implement-virtual-scrolling-with-matlist-in-angular-c900dc0d489f?source=collection_archive---------5-----------------------#2020-11-10">https://medium.datadriveninvestor.com/implement-virtual-scrolling-with-matlist-in-angular-c900dc0d489f?source=collection_archive---------5-----------------------#2020-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8c10" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">轻松处理大型项目列表</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8bbff409b737ce7194b3f048af48264d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rAHLjpgaOh9oS_zz40ppiw.jpeg"/></div></div></figure><p id="e472" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你从未听说过或使用过MatList，它是Angular Material提供的一个容器组件，用于在UI上显示一个简单的项目列表。除了文本渲染，MatList还提供了一些很酷的特性，比如导航列表、动作列表、选择列表、图标列表等等。然而，使用这个组件的主要缺点是它只是为一小部分项目设计的。如果列表非常大(&gt; 1000个条目)，可能会影响性能，有时会导致浏览器崩溃。幸运的是，Angular CDK有一个名为虚拟滚动的软件包可以帮助解决这个问题。在这个循序渐进的教程中，我们将向您展示如何在MatList中添加虚拟滚动来处理应用程序中相对较大的数据列表。</p><h1 id="8741" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">建立一个简单的列表</h1><p id="3667" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们从构建一个简单的没有虚拟滚动的小列表开始本教程。在您的模块中导入<strong class="kt ir"> MatListModule </strong>以使用MatList组件。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="41b5" class="mp lo iq ml b gy mq mr l ms mt">import {Component} from '@angular/core';</span><span id="77c4" class="mp lo iq ml b gy mu mr l ms mt">@Component({<br/>  selector: 'list-overview-example',<br/>  templateUrl: `<br/>    &lt;mat-list dense role="list"&gt;<br/>      &lt;mat-list-item <br/>        *ngFor="let item of list" <br/>        role="listitem"&gt;   <br/>       {{item}}<br/>      &lt;/mat-list-item&gt;<br/>    &lt;/mat-list&gt;<br/>  `<br/>})</span><span id="0cd6" class="mp lo iq ml b gy mu mr l ms mt">export class ListOverviewExample {</span><span id="85ac" class="mp lo iq ml b gy mu mr l ms mt">  list = Array.from(Array(10).keys());<br/>}</span></pre><p id="96cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请注意，数据数组是动态生成的，您可以使用这行代码更改列表的大小:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="123e" class="mp lo iq ml b gy mq mr l ms mt">list = Array.from(Array(<strong class="ml ir">10</strong>).keys());</span></pre><h1 id="b90e" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">向列表添加虚拟滚动</h1><p id="93eb" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">通过在mat-list组件中添加<strong class="kt ir">CDK-virtual-scroll-viewport</strong>指令，可以很容易地用MatList实现虚拟滚动。确保<strong class="kt ir"> ScrollingModule </strong>必须被导入到你的模块中。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="2937" class="mp lo iq ml b gy mq mr l ms mt">&lt;!-- html --&gt;</span><span id="c07d" class="mp lo iq ml b gy mu mr l ms mt">&lt;mat-list dense role="list"&gt;<br/>  <strong class="ml ir">&lt;cdk-virtual-scroll-viewport <br/>    [itemSize]="10" <br/>    class="example-viewport"&gt;</strong></span><span id="de13" class="mp lo iq ml b gy mu mr l ms mt"><strong class="ml ir">    &lt;mat-list-item<br/>      *cdkVirtualFor="let item of list; <br/>                      let odd = odd;"<br/>      [class.example-alternate]="odd"<br/>      role="listitem"&gt;</strong></span><span id="f3f4" class="mp lo iq ml b gy mu mr l ms mt"><strong class="ml ir">      {{item}}<br/>    &lt;/mat-list-item&gt;</strong><br/><strong class="ml ir">  &lt;/cdk-virtual-scroll-viewport&gt;</strong><br/>&lt;/mat-list&gt;</span></pre><p id="6765" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的模板中，的<strong class="kt ir"> *ngFor被替换为<strong class="kt ir"> *cdkVirtualFor </strong>，使其与<strong class="kt ir">CDK-virtual-scroll-viewport</strong>指令兼容。</strong></p><p id="eae1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，在下面添加这些css样式，以使虚拟滚动列表正确显示。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="4c26" class="mp lo iq ml b gy mq mr l ms mt">&lt;!-- css --&gt;</span><span id="7e3e" class="mp lo iq ml b gy mu mr l ms mt">.example-viewport {<br/>  height: 200px;<br/>  width: 100%;<br/>  border: 1px solid black;<br/>}</span><span id="1c21" class="mp lo iq ml b gy mu mr l ms mt">.example-alternate {<br/>  background: rgba(127, 127, 127, 0.3);<br/>}</span></pre><p id="061a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还将列表的大小增加到10，000项，以便有效地使用虚拟滚动。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="5008" class="mp lo iq ml b gy mq mr l ms mt">list = Array.from(Array(<strong class="ml ir">10</strong>).keys());</span></pre><p id="20e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了呈现虚拟滚动列表，这些都是您需要添加的步骤。点击查看完整演示<a class="ae mv" href="https://stackblitz.com/edit/virtual-scrolling-basic-list?file=src/main.ts" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="b797" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">带有选择列表的虚拟滚动</h1><p id="1b11" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们能按照上面的方法用选择列表实现虚拟滚动吗？答案是肯定的，也是否定的。是的，我们仍然使用<strong class="kt ir">CDK-virtual-scroll-viewport</strong>指令进行虚拟滚动，但也需要构造一个选择数据源，以便在用户对列表(尤其是多选列表)进行更改时保留所有项目的状态。这很重要，因为虚拟滚动仅显示当前视图中项目的子集，当用户滚动列表时，该数据集之前和之后的所有项目都将丢失。</p><h2 id="07ac" class="mp lo iq bd lp mw mx dn lt my mz dp lx la na nb lz le nc nd mb li ne nf md ng bi translated">构建选择模型</h2><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="d96b" class="mp lo iq ml b gy mq mr l ms mt">export class ListSelectionExample {</span><span id="21ad" class="mp lo iq ml b gy mu mr l ms mt">  // declare multi select model<br/>  selection = new SelectionModel(true);<strong class="ml ir"><br/>  <br/></strong>  ...</span><span id="b371" class="mp lo iq ml b gy mu mr l ms mt">}</span></pre><h2 id="4620" class="mp lo iq bd lp mw mx dn lt my mz dp lx la na nb lz le nc nd mb li ne nf md ng bi translated">构建虚拟滚动选择列表</h2><p id="01c6" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">要将基本列表转换为选择列表，请替换:</p><ul class=""><li id="b3ea" class="nh ni iq kt b ku kv kx ky la nj le nk li nl lm nm nn no np bi translated">带有mat-selection-list的mat-list</li><li id="e93a" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm nm nn no np bi translated">带有物料清单选项的物料清单项目</li></ul><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="62d9" class="mp lo iq ml b gy mq mr l ms mt">&lt;!-- html --&gt;</span><span id="d484" class="mp lo iq ml b gy mu mr l ms mt">&lt;<strong class="ml ir">mat-selection-list </strong>dense&gt;<br/>  &lt;cdk-virtual-scroll-viewport <br/>    [itemSize]="20" <br/>    class="example-viewport"&gt;</span><span id="2fb7" class="mp lo iq ml b gy mu mr l ms mt">    &lt;<strong class="ml ir">mat-list-option</strong><br/>       *cdkVirtualFor="let item of list; let odd = odd;"<br/>       [class.example-alternate]="odd"<br/><strong class="ml ir">       [value]="item" <br/>       [selected]="selection.isSelected(item)"</strong>&gt;<br/>       {{item}}<br/>    &lt;/<strong class="ml ir">mat-list-option</strong>&gt;<br/>  &lt;/cdk-virtual-scroll-viewport&gt;<br/>&lt;/<strong class="ml ir">mat-selection-list</strong>&gt;</span></pre><p id="3fdd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的模板中，我们将两个新属性绑定到mat-list-option，<strong class="kt ir"> value </strong>和<strong class="kt ir"> selected </strong>，以控制复选框的状态。</p><h2 id="c716" class="mp lo iq bd lp mw mx dn lt my mz dp lx la na nb lz le nc nd mb li ne nf md ng bi translated">添加SelectionChange事件处理器</h2><p id="6ec9" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在模板中，将<strong class="kt ir">选择改变</strong>事件附加到mat-selection-list</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="796d" class="mp lo iq ml b gy mq mr l ms mt">&lt;!-- html --&gt;</span><span id="c721" class="mp lo iq ml b gy mu mr l ms mt">&lt;mat-selection-list dense<strong class="ml ir"><br/>  (selectionChange)="onSelectionChange($event)"</strong>&gt;</span><span id="bb16" class="mp lo iq ml b gy mu mr l ms mt"><strong class="ml ir">...<br/></strong>&lt;/mat-selection-list&gt;</span></pre><p id="d572" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">选择变化</strong>的实现见下图:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="c678" class="mp lo iq ml b gy mq mr l ms mt">// Component</span><span id="c60d" class="mp lo iq ml b gy mu mr l ms mt">...<br/><strong class="ml ir">onSelectionChange(selection) {</strong></span><span id="92e1" class="mp lo iq ml b gy mu mr l ms mt">  // update selection model when selection changes<br/>  <strong class="ml ir">selection.option.selected ?<br/>    this.selection.select(selection.option.value) :<br/>    this.selection.deselect(selection.option.value);<br/>}</strong><br/>...</span></pre><h1 id="e062" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">带全选的MatList</h1><p id="1cf3" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如何将“全选”或“取消全选”与上一节中的虚拟滚动列表集成在一起？这里的要点是，我们需要捕获全选的点击事件，并相应地更新选择模型。</p><h2 id="7fea" class="mp lo iq bd lp mw mx dn lt my mz dp lx la na nb lz le nc nd mb li ne nf md ng bi translated">添加全选按钮</h2><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="8a42" class="mp lo iq ml b gy mq mr l ms mt">&lt;!-- html --&gt;</span><span id="4c60" class="mp lo iq ml b gy mu mr l ms mt">&lt;mat-checkbox<br/>  labelPosition="before" <br/>  (change)="onSelectAll($event)"&gt;Select All<br/>&lt;/mat-checkbox&gt;</span></pre><h2 id="c038" class="mp lo iq bd lp mw mx dn lt my mz dp lx la na nb lz le nc nd mb li ne nf md ng bi translated">更新选择模型</h2><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="dbf5" class="mp lo iq ml b gy mq mr l ms mt">// Component</span><span id="0eaf" class="mp lo iq ml b gy mu mr l ms mt">onSelectAll(e: MatCheckboxChange) {</span><span id="a61f" class="mp lo iq ml b gy mu mr l ms mt">  e.checked ?<br/>    this.selection.select(...this.list) : <br/>    this.selection.clear();<br/>}</span></pre><h2 id="17c1" class="mp lo iq bd lp mw mx dn lt my mz dp lx la na nb lz le nc nd mb li ne nf md ng bi translated">虚拟滚动丢失选择的上下文</h2><p id="1545" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">默认情况下，虚拟滚动使视图缓存能够更快地呈现项目。这个特性不能很好地处理选择列表，因为当用户滚动内容时，它不会更新每个复选框的状态。要暂时解决这个问题，我们需要禁用缓存，以便每个复选框的状态都可以正确更新。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="1670" class="mp lo iq ml b gy mq mr l ms mt">&lt;!-- html --&gt;</span><span id="37d6" class="mp lo iq ml b gy mu mr l ms mt">&lt;mat-selection-list dense&gt;<br/>  &lt;cdk-virtual-scroll-viewport <br/>    [itemSize]="20" <br/>    class="example-viewport"&gt;</span><span id="8788" class="mp lo iq ml b gy mu mr l ms mt">    &lt;mat-list-option<br/>       *cdkVirtualFor="let item of list; <br/>                       let odd = odd;<br/>                       <strong class="ml ir">templateCacheSize: 0</strong>"<br/>       [class.example-alternate]="odd"<br/>       [value]="item" <br/>       [selected]="selection.isSelected(item)"&gt;<br/>       {{item}}<br/>    &lt;/mat-list-option&gt;<br/>  &lt;/cdk-virtual-scroll-viewport&gt;<br/>&lt;/mat-selection-list&gt;</span></pre><p id="8f8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击此处查看完整的<a class="ae mv" href="https://stackblitz.com/edit/virtual-scrolling-selection-list?file=src/app/list-selection-example.html" rel="noopener ugc nofollow" target="_blank">演示</a>。</p><h1 id="b208" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">最终想法</h1><p id="9f8d" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我希望这个简短的教程能帮助你开始使用虚拟滚动列表。当显示一长串数据时，你的应用程序会运行得更快更流畅。欢迎在评论区提问。</p></div></div>    
</body>
</html>