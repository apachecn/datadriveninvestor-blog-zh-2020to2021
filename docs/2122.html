<html>
<head>
<title>The power of Shapes, Hashing, and Column Transformers in Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习中形状、散列和列转换器的力量</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/the-power-of-shapes-hashing-and-column-transformers-in-machine-learning-44b6a0c65cc2?source=collection_archive---------8-----------------------#2020-04-15">https://medium.datadriveninvestor.com/the-power-of-shapes-hashing-and-column-transformers-in-machine-learning-44b6a0c65cc2?source=collection_archive---------8-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2375" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对我来说，兴奋有多种形式。可以是看EPL，或者看国际足联。然而，最让我兴奋的是编写一个模型，当我通过深度学习模型传递图像时，它可以预测未来发生的事情或正确预测我最喜欢的谷物(水果和纤维)。我怎么这么快就到了深度学习？我们刚刚在谈论EPL，GoT，FIFA，lol！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/89d61cd92f4b842a2a6c006ec4f8d4eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_7I31UUB8ss1WdKXN3edrQ.png"/></div></div></figure><p id="9e71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我想从回忆之旅开始。作为一名数据科学家/机器学习工程师，当你面临解决业务问题时，当你有很多疯狂的想法，你在本地机器上做了很多工作，但没有任何东西被推向生产时，情况会变得很紧张(简单来说，<strong class="js iu">可用的</strong>想法/工作/产品)。你真的开始担心，可能会有很大的压力(不一定像你想的那样被解雇)。这是我早期的许多问题之一，对我来说，关键问题是当我想在我训练的模型上使用测试数据集或通过API将其暴露给实时数据(具有全新属性的真实用户)时，再现我的数据预处理步骤(例如，修复形状错误)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi la"><img src="../Images/5894e08f4013bb7b468e943b17d9d107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ngFci1cHDLTuYBRgTFWhZw.png"/></div></div></figure><p id="bd7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我说的形状是什么意思？它只是你的数据的维度。在二维上下文中，这可能意味着您熟悉的excel中的按列排列的行或表格数据。在图像中，它可以是灰度图像(二维)或彩色图像(三维)。这里有趣的是，形状可以有任何形式，在测试时应该考虑训练模型时使用的属性(在逻辑意义上)。最终，当引入新事物时，您希望您的模型仍然能够执行所需的操作(根据您的目标进行分类或预测)。</p><div class="lb lc gp gr ld le"><a href="https://www.datadriveninvestor.com/2020/02/19/cognitive-computing-a-skill-set-widely-considered-to-be-the-most-vital-manifestation-of-artificial-intelligence/" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd iu gy z fp lj fr fs lk fu fw is bi translated">认知计算——一套被广泛认为是……</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">作为它的用户，我们已经习惯了科技。这些天几乎没有什么是司空见惯的…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls ky le"/></div></div></a></div><p id="19f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了切入正题，我将展示可能出现的与数据帧和张量的形状误差有关的不同问题。出于本文的目的，我将更多地关注数据帧。我将以PyTorch为例，从构建简单网络时常见的张量错误开始。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lt"><img src="../Images/caccc96f23c87177c7ad8926236729cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0klPAfO6akmDe99tpLfu0w.png"/></div></div><figcaption class="lu lv gj gh gi lw lx bd b be z dk">The diagram above shows a shape mismatch between two tensors</figcaption></figure><p id="bc81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里发生的是，张量的形状不适合执行矩阵乘法。重要的是，第一个张量中的列数必须等于第二个张量中的行数。要解决这个问题，有三个选项:</p><ul class=""><li id="ef46" class="ly lz it js b jt ju jx jy kb ma kf mb kj mc kn md me mf mg bi translated">tensor . shape(a，b)</li><li id="7093" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">tensor.resize(a，b)</li><li id="dcb1" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">张量视图(a，b)</li></ul><p id="6348" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用tensor.view(a，b)，上述代码的解决方案将是让我们的输出<strong class="js iu">" y = activation(torch . mm(features，weights.view(10，1)) + bias)" </strong>。这种方法的一个典型应用是在任何图像分类问题的图像预处理中(例如，许多人熟悉的猫和狗)。</p><p id="455c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于张量不是本文的核心，我将更多地关注数据帧错误。对模型工件(已被定型并保存为对象的模型)运行预测时出现的一个常见问题如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mm"><img src="../Images/d9b8e1c9ed1c851e004d7696ea3d2f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XZIgA6wzNDS1p4BnfPkKDQ.png"/></div></div><figcaption class="lu lv gj gh gi lw lx bd b be z dk">The model expected 187 features but got 619 instead</figcaption></figure><p id="d316" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此类错误的常见原因有:</p><ul class=""><li id="e9f8" class="ly lz it js b jt ju jx jy kb ma kf mb kj mc kn md me mf mg bi translated">用于定型模型的输入数与测试数据集的输入数不同(在尝试预测时)</li><li id="cd94" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">训练或测试数据集中类别列表中的偏差(属性的增加/减少)</li><li id="70ee" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">库更新以及在新更新中如何处理数据</li></ul><p id="7a81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要解决这个问题，有几种解决方案。这里有两个对我很有效的解决方案:</p><ul class=""><li id="de3f" class="ly lz it js b jt ju jx jy kb ma kf mb kj mc kn md me mf mg bi translated">使用pandas category数据类型——虽然不可伸缩，但它需要预先了解您的分类属性</li><li id="a1b8" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">sci kit-学习管道和列转换器(数值、分类和散列)-圣杯</li></ul><p id="3ec3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我会给出更多关于管道的细节，因为它给我<em class="mn">省了很多</em>压力。拥有管道背后的想法是拥有一系列将在数据集上执行的转换步骤。管道更有趣的地方在于，您可以将其保存为可重用的对象。为了更清楚地描述我的意思，请考虑如何对训练数据进行归一化，填充NaN值，并对分类数据进行一次性编码。然后，当测试数据或外部数据(实时用户)被引入模型时，这些步骤被重复；这可能有点麻烦。Scikit-learn在其预处理包中有内置函数来处理许多这样的场景。我根据下面的属性类型对pipeline的几个应用程序进行了分组:</p><ul class=""><li id="477a" class="ly lz it js b jt ju jx jy kb ma kf mb kj mc kn md me mf mg bi translated">数字特征</li><li id="727c" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">分类特征</li><li id="1f6d" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">哈希特征</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mo"><img src="../Images/5155ceaac7419f6305b837df190f408d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRSWGwgD6o4vDa9JT3XPOA.png"/></div></div></figure><p id="9e7e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上图中，我们有三类管道。num_features类别包含数据集中出现的所有数字数据。此外，结合了类别和散列特征的猫特征；这里的区别在于,“CATEGORIES features”具有中等基数，本质上是静态的，而“hash_features”具有高基数，也是动态的。我将对下面的每个特性及其各自的管道给出更多的上下文。</p><h1 id="9a2b" class="mp mq it bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">数字管道(数字管道)</h1><p id="0f03" class="pw-post-body-paragraph jq jr it js b jt nn jv jw jx no jz ka kb np kd ke kf nq kh ki kj nr kl km kn im bi translated">数字属性的典型问题是缺失值或异常值。如果有一个值缺失，您可能希望像大多数人一样用平均值、中值或众数来替换它。当您有异常值时(这可能会扭曲您的数据)，您基本上想要缩放您的值(有不同的缩放选项)。简单估算器可用于替换缺失值，最小最大缩放器可用于缩放数值，如果您想使用标准缩放器，您的数据必须呈正态分布。</p><h1 id="177d" class="mp mq it bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">分类管道(目录管道)</h1><p id="730d" class="pw-post-body-paragraph jq jr it js b jt nn jv jw jx no jz ka kb np kd ke kf nq kh ki kj nr kl km kn im bi translated">要使用数据集来构建机器学习模型，有必要处理分类变量，最流行的技术是标签编码或一次性编码。在下图中，假设我们使用尼日利亚西南地区的六个州来训练模型，并且在进行预测时，我们将阿布贾作为测试/实况数据集中的州的一部分，那么模型肯定会抛出错误(形状错误),因为训练数据集中没有阿布贾。使用一键编码时，维数也是一个大问题。这就是hash_pipeline派上用场的地方。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/0fe3f992c6458798a229687ead00f479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_M1hBZ-J4TF8IaNuP_DBrQ.png"/></div></div></figure><h1 id="7b97" class="mp mq it bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">哈希管道(哈希管道)</h1><p id="1caa" class="pw-post-body-paragraph jq jr it js b jt nn jv jw jx no jz ka kb np kd ke kf nq kh ki kj nr kl km kn im bi translated">许多数据科学家都熟悉一种热编码(OHE)，如果您必须处理大型数据集，维度就会成为一个问题(当然，当您有大型计算时除外)。但是，使用hash_pipeline，您可以为高基数数据建立单独的管道。哈希的概念类似于OHE，但维度更少，并且由于冲突会丢失一些信息。除非有很多重叠，否则冲突不会对性能产生很大影响。这背后的逻辑是，对于非常稀疏的特征来说，很少特征看起来是信息丰富的，并且总的来说，任何散列冲突都有可能影响信息较少的特征。</p><p id="3802" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">特征散列背后的核心思想相对简单；我们使用哈希函数来确定特征在低维向量中的位置，而不是保持分类特征值与特征向量中位置的一对一映射。简而言之，OHE不会产生100 000个新属性，而是会产生100 00个散列向量(低维)。这在解决<strong class="js iu">形状错误</strong>时也会派上用场，因为对于任何给定的输入，它都会生成相同的哈希值。通过使用列转换器(在scikit-learn中可用)，可以将所有转换放在一起，并最终保存为单个管道对象，该对象可以在任何时间点重用(如下图所示)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nt"><img src="../Images/c346ce627f4d109a5ef370777d538818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_Z6F1RneUVx2jK8vtZr2A.png"/></div></div><figcaption class="lu lv gj gh gi lw lx bd b be z dk">Full pipeline object (a combination of numerical, categorical and hash features)</figcaption></figure><p id="05d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，为了重用管道对象，从保存文件的目录中打开该文件，并对您想要使用的新数据集进行. transform操作(这可能是您的测试数据集，也可能是进行API调用时的实时数据)。总之，此工作流程的主要优势如下:</p><ul class=""><li id="0840" class="ly lz it js b jt ju jx jy kb ma kf mb kj mc kn md me mf mg bi translated">它们强制执行项目中的步骤顺序</li><li id="d87a" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">你的工作很容易复制，不那么麻烦</li><li id="5833" class="ly lz it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">你不会遇到不必要的形状误差</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div></div>    
</body>
</html>