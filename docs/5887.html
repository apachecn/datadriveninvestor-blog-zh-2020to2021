<html>
<head>
<title>Get real-time updates from the financial market with your own bot on Telegram</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Telegram上的您自己的机器人获得金融市场的实时更新</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/get-real-time-updates-from-the-financial-market-with-your-own-bot-on-telegram-9f9c47449ce8?source=collection_archive---------1-----------------------#2020-10-04">https://medium.datadriveninvestor.com/get-real-time-updates-from-the-financial-market-with-your-own-bot-on-telegram-9f9c47449ce8?source=collection_archive---------1-----------------------#2020-10-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2db9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Python和Metatrader 5构建一个机器人来接收实时市场数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7d0fa40cc687cead05845affe3fbbd46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QajDwnfTj46zoeXj"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Austin Distel</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d05d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发展投资自动化策略的一个最重要的优势是，你不必一直站在电脑屏幕前寻找市场上的最佳机会。考虑到这一点，我为电报开发了一个机器人，通知我哪些资产在一天中遭受了最多的下跌或上涨，我将一步一步地向您展示，以便您可以开发您的资产！</p><p id="39cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇博客中，我们将重点开发一个简单的应用程序，它在Telegram上向Bot发送请求，并返回股票资产当天的前五名和后五名百分比回报。最后的结果会像下面的视频:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Video by Author</figcaption></figure><p id="0753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了开发您的机器人，我们将遵循以下步骤:</p><ol class=""><li id="2fd0" class="lx ly it lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated">在Telegram中创建您的机器人</li><li id="15c3" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">在Python中创建主要函数</li><li id="ee43" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">从交易所收集数据</li><li id="e887" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">向机器人发送信息</li></ol><div class="ml mm gp gr mn mo"><a href="https://www.datadriveninvestor.com/2020/09/17/five-financial-applications-of-natural-language-processing/" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd iu gy z fp mt fr fs mu fu fw is bi translated">自然语言处理的五种金融应用|数据驱动的投资者</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">过去的五年对于自然语言处理领域来说是革命性的。我们从荣耀的ctrl-f…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc ks mo"/></div></div></a></div><h1 id="9449" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">在Telegram中创建您的机器人</h1><p id="3586" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">要在Telegram中创建您的机器人，找到用户@BotFather，并发送命令“/start。”将出现以下屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/4fdf72cbb533460970300934d46b2ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3hML1G4VzKv7xrTN"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">BotFather — Image by Author</figcaption></figure><p id="65bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们向机器人父亲发送“/newbot”命令。机器人爸爸会要求我们为我们的机器人起一个名字。你可以随意给它取任何你喜欢的名字。在这种情况下，我们创建了一个所谓的tutobot。之后，我们需要为机器人创建一个用户，并且必须在末尾插入_bot。</p><p id="a780" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建用户后，BotFather将授予一个令牌，以便我们可以发送请求。请复制并粘贴此令牌以备后用，并妥善保管。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/652645f6e868aee8a22c8d9af12c4113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/0*ABPDjPUwAYTSFHhu"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Image by Author</figcaption></figure><h1 id="8413" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">用Python创建主要的bot函数</h1><p id="d0c3" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">我不会详细介绍为机器人创建的每一行代码。毛罗·德·卡瓦略已经在他的岗位上完成了这项工作:</p><div class="ml mm gp gr mn mo"><a href="https://medium.com/@mdcg.dev/desenvolvendo-o-seu-primeiro-chatbot-no-telegram-com-python-a9ad787bdf6" rel="noopener follow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd iu gy z fp mt fr fs mu fu fw is bi translated">聊天机器人没有电报com Python</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">这是一个聊天机器人的第一个声音。Se…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">medium.com</p></div></div><div class="mx l"><div class="oc l mz na nb mx nc ks mo"/></div></div></a></div><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="884b" class="oi ne it oe b gy oj ok l ol om">def main():<br/>    updater = Updater(token=TELEGRAM_TOKEN)<br/>    dp = updater.dispatcher<br/>    dp.add_handler(CommandHandler('altas', altas))<br/>    dp.add_handler(CommandHandler('baixas', bop))<br/>    updater.start_polling()<br/>    updater.idle()</span></pre><p id="c4a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在变量中插入机器人父亲给出的令牌。</p><p id="1757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个主要函数执行以下操作:等待用户发送一个列出的命令(/altas，/baixas)并返回相应方法的结果。</p><h1 id="1121" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">收集库存数据</h1><p id="1e86" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">为了收集股票市场数据，我们将使用MetaTrader5库，正如我在以前的帖子中演示的那样。</p><div class="ml mm gp gr mn mo"><a href="https://medium.com/datadriveninvestor/build-your-trading-strategies-in-5-minutes-with-python-and-metatrader-3e9fd5c62956" rel="noopener follow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd iu gy z fp mt fr fs mu fu fw is bi translated">使用Python和MetaTrader在5分钟内开始构建您的交易策略</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">整合收集和分析金融市场数据的最快方法。</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">medium.com</p></div></div><div class="mx l"><div class="on l mz na nb mx nc ks mo"/></div></div></a></div><h2 id="5d70" class="oi ne it bd nf oo op dn nj oq or dp nn li os ot np lm ou ov nr lq ow ox nt oy bi translated">●功能:</h2><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="6d8f" class="oi ne it oe b gy oj ok l ol om">def bop(bot, update):<br/>    chat_id = update.message.chat_id<br/><br/>    mt5.initialize()<br/>    tickers = pd.read_csv('tickers_cheios.csv')<br/>    tickers['x'] = tickers['x'].astype(str)<br/>    symbols = tickers['x']<br/>    d = pd.DataFrame()<br/>    s = pd.DataFrame()<br/><br/>    for i in symbols:<br/>        rates = mt5.copy_rates_from_pos(i, mt5.TIMEFRAME_D1, 1, 1)<br/>        d[i] = [y['close'] for y in rates]<br/><br/>    for i in symbols:<br/>        rates = mt5.copy_rates_from_pos(i, mt5.TIMEFRAME_M2, 0, 1)<br/>        s[i] = [y['close'] for y in rates]<br/><br/>    f = d.append(s)<br/><br/>    returns = f.pct_change().dropna().transpose()<br/>    returns['tickets'] = returns.index<br/>    returns.columns = ['return_pct', 'tickets']<br/>    returns['porcentagem'] = returns.return_pct * 100<br/>    returns['porcentagem'] = returns['porcentagem'].round(2)<br/><br/>    returns = returns.sort_values(by=['return_pct'])<br/><br/>    temp_mais_baixas = returns.head(5)<br/>    bot.send_message(chat_id=chat_id, text='As ações com maiores baixas de hoje foram:')<br/><br/>    for i in range(len(temp_mais_baixas)):<br/>        ticket = temp_mais_baixas['tickets'][i]<br/>        valor_por = temp_mais_baixas['porcentagem'][i]<br/>        text = '\U0001F4C9' + " : " + str(ticket) + " : " + str(valor_por) + " %"<br/>        print(text)<br/>        bot.send_message(chat_id = chat_id, text = text)<br/><br/>    mt5.shutdown()</span></pre><h2 id="180a" class="oi ne it bd nf oo op dn nj oq or dp nn li os ot np lm ou ov nr lq ow ox nt oy bi translated">高级功能</h2><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="6dc6" class="oi ne it oe b gy oj ok l ol om">def altas(bot, update):<br/>    chat_id = update.message.chat_id<br/><br/>    mt5.initialize()<br/>    tickers = pd.read_csv('tickers_cheios.csv')<br/>    tickers['x'] = tickers['x'].astype(str)<br/>    symbols = tickers['x']<br/>    d = pd.DataFrame()<br/>    s = pd.DataFrame()<br/><br/>    for i in symbols:<br/>        rates = mt5.copy_rates_from_pos(i, mt5.TIMEFRAME_D1, 1, 1)<br/>        d[i] = [y['close'] for y in rates]<br/><br/>    for i in symbols:<br/>        rates = mt5.copy_rates_from_pos(i, mt5.TIMEFRAME_M2, 0, 1)<br/>        s[i] = [y['close'] for y in rates]<br/><br/>    f = d.append(s)<br/><br/>    returns = f.pct_change().dropna().transpose()<br/>    returns['tickets'] = returns.index<br/>    returns.columns = ['return_pct', 'tickets']<br/>    returns['porcentagem'] = returns.return_pct * 100<br/>    returns['porcentagem'] = returns['porcentagem'].round(2)<br/><br/>    returns = returns.sort_values(by=['return_pct'])<br/><br/>    temp_mais_altas = returns.tail(5)<br/>    bot.send_message(chat_id=chat_id, text='As ações com maiores altas de hoje foram:')<br/><br/>    for i in range(len(temp_mais_altas)):<br/>        ticket = temp_mais_altas['tickets'][i]<br/>        valor_por = temp_mais_altas['porcentagem'][i]<br/>        text = '\U0001F4C8' + " : " + str(ticket) + " : " + str(valor_por) + " %"<br/>        print(text)<br/>        bot.send_message(chat_id = chat_id, text = text)<br/>    mt5.shutdown()</span></pre><h1 id="69af" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">向Bot发送数据</h1><p id="eefb" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">现在，您所要做的就是发送您已经配置好的命令，以获得股票报价的实时回报！一旦软件运行，你将获得当天最好和最差结果的实时信息！</p><p id="b239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！下一篇帖子再见！</p><h2 id="cf67" class="oi ne it bd nf oo op dn nj oq or dp nn li os ot np lm ou ov nr lq ow ox nt oy bi translated">访问专家视图— <a class="ae ky" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank">订阅DDI英特尔</a></h2></div></div>    
</body>
</html>