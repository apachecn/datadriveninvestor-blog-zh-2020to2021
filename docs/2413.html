<html>
<head>
<title>A simple contextual chatbot to predict a reply with pre-trained DialoGPT model from Huggingface</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个简单的上下文聊天机器人，通过预先训练的对话模型预测来自Huggingface的回复</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/a-simple-contextual-chatbot-to-predict-an-reply-with-pre-trained-dialogpt-model-from-huggingface-f681b550cd60?source=collection_archive---------4-----------------------#2020-04-29">https://medium.datadriveninvestor.com/a-simple-contextual-chatbot-to-predict-an-reply-with-pre-trained-dialogpt-model-from-huggingface-f681b550cd60?source=collection_archive---------4-----------------------#2020-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/0a143388d8c46622779774113d6af339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*GM4EMgHKXHQG2e8zPtDm7A.png"/></div></figure><p id="7452" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">大多数聊天机器人会根据自己看过的<strong class="jz iu">最后一句话</strong>提供自动回复建议。然而，为了进行引人入胜的自然对话，聊天机器人必须记住之前的对话，并做出恰当的回应。</p><p id="0243" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">今天，我们将了解如何利用最先进的<a class="ae kv" href="https://www.microsoft.com/en-us/research/project/large-scale-pretraining-for-response-generation/" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu"> DialoGPT </strong> </a> NLP模型，生成高质量的对话响应。</p><p id="0133" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们将使用的例子显示在左边的Whatsapp图片上。我们将预测“<strong class="jz iu">比赛在哪里进行？”这个问题的理想答案</strong>通过之前的对话为模型提供背景。</p><p id="9dd6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们开始吧！</p><p id="8f24" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在Jupyter笔记本中安装最新版本的<a class="ae kv" href="https://huggingface.co/transformers/" rel="noopener ugc nofollow" target="_blank">变形金刚</a>库-</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="7af4" class="lf lg it lb b gy lh li l lj lk">!pip install transformers==2.8.0<br/>!pip install torch==1.4.0</span></pre><p id="d701" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">必要的代码改编自<a class="ae kv" href="https://huggingface.co/microsoft/DialoGPT-medium" rel="noopener ugc nofollow" target="_blank">此处</a>。这是我们程序的所有代码-</p><figure class="kw kx ky kz gt ju"><div class="bz fp l di"><div class="ll lm l"/></div></figure><h2 id="5ef6" class="lf lg it bd ln lo lp dn lq lr ls dp lt ki lu lv lw km lx ly lz kq ma mb mc md bi translated">输出:</h2><p id="1097" class="pw-post-body-paragraph jx jy it jz b ka me kc kd ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku im bi translated">作为回答的预测句子是— <strong class="jz iu">在墨尔本市。</strong></p><p id="dae4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请注意，聊天机器人预测了<strong class="jz iu">墨尔本</strong>，因为我们之前提到过一些对话，这场比赛是与<strong class="jz iu">澳大利亚人</strong>(澳大利亚)进行的。</p><h2 id="42d9" class="lf lg it bd ln lo lp dn lq lr ls dp lt ki lu lv lw km lx ly lz kq ma mb mc md bi translated">解释:</h2><p id="f74e" class="pw-post-body-paragraph jx jy it jz b ka me kc kd ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku im bi translated">把所有的句子按顺序列出来。列表中的每个元素都应该对应于来自单个用户的消息。该列表应该在每个用户之间交替出现。例如:“用户1”和“用户2”</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="ac53" class="lf lg it lb b gy lh li l lj lk">sentence_list = [<br/>    "I heard you won the cricket match.",     # user 1<br/>    "I did!",                                 # user 2<br/>    "Awesome. Who did you play against?",     # user 1<br/>    "I played against the Aussies.",          # user 2<br/>    "Wow ! Was it a tough game?",             # user 1<br/>    "It was a tough game. It went on till the last over. They almost won.",                                        # user 2<br/>    "Where was the match?"                    # user 1<br/>]</span></pre><p id="eef2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">将一个<strong class="jz iu">单用户</strong>的所有<strong class="jz iu">顺序消息</strong>串联成一条。例如，如果用户连续键入3条独立的消息“这是一场艰难的比赛”，“它一直持续到最后一场比赛结束”和“他们几乎赢了”——将单个用户的所有连续消息连接成一条。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="5044" class="lf lg it lb b gy lh li l lj lk">sentence_list = [<br/>    ...</span><span id="cd52" class="lf lg it lb b gy mj li l lj lk">    "<strong class="lb iu">It was a tough game</strong>. <strong class="lb iu">It went on till the last over</strong>. <strong class="lb iu">They almost won</strong>.",                                        # user 2<br/>    ....<br/>]</span></pre><p id="d58e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在，我们将列表中的所有句子与来自tokenizer的句尾EOS标记(<strong class="jz iu"> tokenizer.eos_token </strong>)连接起来。<strong class="jz iu"> all_sentences_string </strong>的输出是-</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="b3aa" class="lf lg it lb b gy lh li l lj lk">I heard you won the cricket match.<strong class="lb iu">&lt;|endoftext|&gt;</strong>I did!<strong class="lb iu">&lt;|endoftext|&gt;</strong>Awesome. Who did you play against?<strong class="lb iu">&lt;|endoftext|&gt;</strong>I played against the Aussies.<strong class="lb iu">&lt;|endoftext|&gt;</strong>Wow ! Was it a tough game?<strong class="lb iu">&lt;|endoftext|&gt;</strong>It was a tough game. It went on till the last over. They almost won.<strong class="lb iu">&lt;|endoftext|&gt;</strong>Where was the match?<strong class="lb iu">&lt;|endoftext|&gt;</strong></span></pre><p id="34f7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们现在<strong class="jz iu">将<strong class="jz iu"> all_sentences_string </strong>标记化</strong>并将其传递给<strong class="jz iu">model . generate</strong>to<strong class="jz iu">T33】generate&amp;解码最终的输出字符串(<strong class="jz iu">decoded _ reply _ predicted _ with _ input</strong>)</strong></p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="987a" class="lf lg it lb b gy lh li l lj lk">I heard you won the cricket match.I did!Awesome. Who did you play against?I played against the Aussies.Wow! Was it a tough game?It was a tough game. It went on till the last over. They almost won.Where was the match?<strong class="lb iu">It was in the city of Melbourne.</strong></span></pre><p id="b278" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请注意，<strong class="jz iu"> model.generate </strong>生成连接输入字符串的回复。因此，我们小心地将回复从生成的句子中分离出来，如下所示</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="3241" class="lf lg it lb b gy lh li l lj lk">decoded_reply_predicted = tokenizer.decode(reply_predicted[:,<strong class="lb iu">prefix_length:</strong>][0], skip_special_tokens=True)</span></pre><p id="eb63" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们从聊天机器人的变量<strong class="jz iu"> decoded_reply_predicted </strong>中得到预测回复，作为<strong class="jz iu"> - </strong></p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="752a" class="lf lg it lb b gy lh li l lj lk"><strong class="lb iu">It was in the city of Melbourne.</strong></span></pre><div class="mk ml gp gr mm mn"><a href="https://www.datadriveninvestor.com/2020/02/19/five-data-science-and-machine-learning-trends-that-will-define-job-prospects-in-2020/" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">将定义2020年就业前景的五大数据科学和机器学习趋势|数据驱动…</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">数据科学和ML是2019年最受关注的趋势之一，毫无疑问，它们将继续发展…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb jv mn"/></div></div></a></div><figure class="kw kx ky kz gt ju"><div class="bz fp l di"><div class="nc lm l"/></div></figure></div></div>    
</body>
</html>