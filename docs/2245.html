<html>
<head>
<title>Stock Market Data Analysis: Building Candlestick Interactive Charts with Plotly and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">股市数据分析:用Plotly和Python构建烛台互动图表</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/stock-market-data-analysis-building-candlestick-interactive-charts-with-plotly-and-python-bd7866dcb4c1?source=collection_archive---------1-----------------------#2020-04-21">https://medium.datadriveninvestor.com/stock-market-data-analysis-building-candlestick-interactive-charts-with-plotly-and-python-bd7866dcb4c1?source=collection_archive---------1-----------------------#2020-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4caf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">金融交易分析和故事讲述的强大工具</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/1618fc580fd451fb48ff5e668e3ff481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lK5soSWgKsd0LXlO"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo by <a class="ae le" href="https://unsplash.com/@jsnbrsc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jason Briscoe</a> on <a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="98fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文是金融数据分析系列文章的第一篇，在这篇文章中，我将展示股票市场专业人士、数据分析师和交易员使用的一些有用的工具。由于Python在各个领域的使用和适用性不断增加，所以整个方法都是使用Python完成的。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="979d" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">烛台诠释</h1><p id="766b" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">也许是显示给定时间框架内商品价格行为的最常见的图形方式，<strong class="js iu">蜡烛图让我们对股票的表现有一个快速而直观的感知</strong>。每根蜡烛线代表一个特定的分析周期(本文将使用日周期),并显示开盘价和收盘价，以及最高价和最低价。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/041e9db0fe37ab4873346914760d349b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*flCy2Ph8liP8EAWN4WONFw.jpeg"/></div></div></figure><p id="7f8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所谓的<strong class="js iu">“蜡烛体”</strong>，由开盘价和收盘价之间较厚的区域表示，以两种不同的颜色显示——通常的方法:<strong class="js iu">绿色/白色表示<em class="mq">看涨</em>行为</strong>，收盘价高于开盘价，<strong class="js iu">红色/黑色表示<em class="mq">看跌</em>行为</strong>，价格跌至低于开盘价。第三种可能的情况是被称为<strong class="js iu">“多吉蜡烛”</strong>的“扁平体”类型。当活跃收盘价格与开盘价相同(或非常接近)时，这种形状的烛台出现<strong class="js iu"> </strong>。</p><div class="mr ms gp gr mt mu"><a href="https://www.datadriveninvestor.com/2020/03/25/using-google-search-trends-to-predict-initial-jobless-claims/" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">使用谷歌搜索趋势预测首次申请失业救济人数|数据驱动的投资者</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">几年来，我的重点一直是使用多种替代数据来预测宏观经济统计数据…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni ky mu"/></div></div></a></div><p id="8d66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，蜡烛的<strong class="js iu">【影子】</strong>是一条线，可以显示在蜡烛体的上部和/或下部。当它出现在主体上方时，它代表该时期的最高实现价格。如果低于烛台主体，阴影表示该时期的最低价格。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="4c9f" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">什么是Plotly，为什么有用？</h1><p id="4234" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">Python的库，如<strong class="js iu"> matplotlib </strong>和<strong class="js iu"> seaborn </strong>经常被用于数据可视化相关的工作，然而，技术和基本面股票市场分析师通常需要大量的指标和动态可视化工具。在这个场景中，Plotly ( <a class="ae le" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> plotly.py </a>)作为一个免费的开源图形python库，能够制作交互式的、出版物质量的图形。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/0e1badf36687d70fa4070b5952873e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wg3qu3-dFtBKscjs_93b6w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk"><a class="ae le" href="https://plotly.com/python/getting-started/" rel="noopener ugc nofollow" target="_blank">https://plotly.com/python/getting-started/</a></figcaption></figure><blockquote class="nk nl nm"><p id="41ee" class="jq jr mq js b jt ju jv jw jx jy jz ka nn kc kd ke no kg kh ki np kk kl km kn im bi translated">“plotly.py构建在Plotly JavaScript库(plotly.js)之上，使Python用户能够创建漂亮的交互式基于web的可视化效果，可以在Jupyter笔记本中显示，保存到独立的HTML文件中，或作为使用Dash的纯Python构建的web应用程序的一部分。”</p></blockquote><p id="8738" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了图形工具之外，金融分析主要需要长时间序列和特定数据片段的可视化，这些都可以通过plotly.py特性轻松处理，例如范围滑块和选择器。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="be60" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">构建图表(循序渐进)</h1><p id="d65f" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">首先，我们将导入<strong class="js iu">熊猫</strong>来设置我们的数据框架，导入<strong class="js iu">来构建图表。</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8df7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，如果您希望在plotly的dash中保存您的图形，使用plotly chart-studio的库可能会很有用(这样做还可以更容易地共享和编辑您的图形)。</p><p id="5ea5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们将使用pandas " <strong class="js iu"> datareader </strong>函数从<a class="ae le" href="https://finance.yahoo.com/" rel="noopener ugc nofollow" target="_blank">雅虎财经</a>收集我们所选股票的数据。在这个练习中，我们将与Banco do Brasil S/A合作，它是巴西最传统的公司之一，普通股的符号为“BBAS3”。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="50fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">熊猫。head()方法返回给我们下表:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/1d6e8dfd25c4829c667af246d2dbad0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*2AjDSodBsqkAKeUM0XhjuA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">.head() return top n (5 by default) rows of a data frame or series.</figcaption></figure><p id="c421" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到‘date’列已经被设置为我们的数据库索引，并且已经采用了<strong class="js iu"> datetime格式</strong>，所以我们可以开始了！</p><p id="0fc7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于图表的情节和支线剧情，我们需要定义轨迹。第一个踪迹应该建立我们的情节的主要设定，如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5ece" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从那里，我们随后的跟踪将绘制出我们选择的所有分析工具。最常见的指标之一是移动平均值，在我们的示例中，它将被设置为30和50个周期。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="7042" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">需要注意的是，平均值是在收盘价的基础上计算的，而“window”属性接受我们想要求和以提取平均值的周期数。</p><p id="d51a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从这里，我们可以定义轨迹2和3中的移动平均线的子图，使用一个简单的散点图并通过颜色区分彼此。另外，默认情况下会显示图例。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="258b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到目前为止，我们已经得到了绘制蜡烛图的所有信息，它给出了每根日线的开盘价、收盘价、最高价和最低价，同时也给出了两条移动平均线。</p><p id="5510" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们快到了！下一步是将所有的轨迹聚集到一个“数据”变量中，这个变量将包含所有的支线剧情。然后，我们可以随心所欲地设置图表的布局。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4758" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，作为有趣的最后一部分，我们将创建图的图形并调用show函数。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8de8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">搞定了。结果如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nt nr l"/></div></figure><h1 id="35d8" class="lm ln it bd lo lp nu lr ls lt nv lv lw lx nw lz ma mb nx md me mf ny mh mi mj bi translated">结论</h1><p id="48fa" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">Plotly library只需几行代码，甚至允许初级python用户定制和绘制一个装备良好的交互式烛台图表，用于股票市场分析。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="b1d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如有任何更正或反馈，请发表评论或通过<a class="ae le" href="https://www.linkedin.com/in/caio-milani-correa-87b00b17a/" rel="noopener ugc nofollow" target="_blank"> linkedin </a>联系我。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nz nr l"/></div></figure></div></div>    
</body>
</html>