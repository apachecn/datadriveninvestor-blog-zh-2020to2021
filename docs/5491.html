<html>
<head>
<title>Third-party cookies alternatives</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第三方cookies替代品</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/alternatives-to-third-party-cookies-in-2020-857609f8f2bb?source=collection_archive---------0-----------------------#2020-09-22">https://medium.datadriveninvestor.com/alternatives-to-third-party-cookies-in-2020-857609f8f2bb?source=collection_archive---------0-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8c5b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">第一部分</h2><div class=""/><div class=""><h2 id="c0dc" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">不使用第三方cookies的跨域跟踪</h2></div><h1 id="7107" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">饼干面包店</h1><p id="0b6c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现代网络是曲奇饼店。广告商使用cookies来提供令人毛骨悚然的广告。网站所有者使用cookies来衡量他们的受众。开发人员使用cookies来存储用户设置。</p><p id="ebde" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">天哪，即使是那些cookie信息弹出窗口也是基于cookie的(否则网站怎么知道你已经看过了呢？).</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Video fragment of <a class="ae mv" href="https://www.youtube.com/watch?v=tCnj-uiRCn8" rel="noopener ugc nofollow" target="_blank">asdfmovie5</a></figcaption></figure><p id="5b9b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">自从mighty cookies发明以来，整个行业都在依靠跟踪网站用户的能力。第三方cookies是广告商用来在域之间识别用户的最流行的机制。</p><p id="edf6" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">所以难怪，这个机制在讨论中。出于隐私考虑。</p><p id="8f18" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><a class="ae mv" href="https://fischerbach.medium.com/membership" rel="noopener">🔔想要更多这样的文章？在这里签名。</a></p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="3385" class="kr ks it bd kt ku nd kw kx ky ne la lb ki nf kj ld kl ng km lf ko nh kp lh li bi translated">谷歌饼干怪兽</h1><p id="3d60" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">2019年8月，Chrome的团队宣布，他们将在两年内从浏览器中删除第三方cookies。Chrome是最后一个开始限制第三方cookies的浏览器。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/263bbad0f008435118fb7d58900dc6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NN9YAOjWCiij_VisGilf7w.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Image by Author</figcaption></figure><p id="a954" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">虽然Safari和Firefox已经内置了减少跨站点跟踪的解决方案，但Chrome占据了浏览器市场的大部分份额，对市场的影响也相应更大。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="40c9" class="kr ks it bd kt ku nd kw kx ky ne la lb ki nf kj ld kl ng km lf ko nh kp lh li bi translated">寻求替代方案</h1><p id="4305" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">然而，仍然有符合<a class="ae mv" href="https://en.wikipedia.org/wiki/Web_standards" rel="noopener ugc nofollow" target="_blank">网络标准</a>的替代方案。为了找到它们，让我们在web标准文档中搜索“隐私问题”。</p><p id="4a14" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在这一部分中，我重点介绍了使用会话存储的机制、基于存储的机制和web缓存。</p><p id="95e8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><strong class="ll jd">基于存储的</strong></p><ul class=""><li id="6843" class="np nq it ll b lm mf lp mg ls nr lw ns ma nt me nu nv nw nx bi translated">局部存储器</li><li id="4700" class="np nq it ll b lm ny lp nz ls oa lw ob ma oc me nu nv nw nx bi translated">会话存储</li><li id="3c89" class="np nq it ll b lm ny lp nz ls oa lw ob ma oc me nu nv nw nx bi translated">索引b</li></ul><p id="3c5b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><strong class="ll jd">网络缓存</strong></p><ul class=""><li id="4429" class="np nq it ll b lm mf lp mg ls nr lw ns ma nt me nu nv nw nx bi translated">在缓存的文档中嵌入标识符</li><li id="dc99" class="np nq it ll b lm ny lp nz ls oa lw ob ma oc me nu nv nw nx bi translated">负载性能测试</li><li id="5225" class="np nq it ll b lm ny lp nz ls oa lw ob ma oc me nu nv nw nx bi translated">ETag &amp;上次修改时间</li></ul><p id="1331" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在接下来的部分，我将调查更先进的方法，如指纹和点击劫持。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi od"><img src="../Images/1fb5c70f6361819c007123ddf0d8a8a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l-sPyU7Lm1fh1gadUgr9wQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Table of possible tracking mechanisms (based on <a class="ae mv" href="https://www.google.com/url?q=https://arxiv.org/pdf/1507.07872.pdf&amp;sa=D&amp;ust=1600595720426000&amp;usg=AFQjCNGtsk4VjcBF5QbMB-C5B4Lf3-ANaQ" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1507.07872.pdf</a>, moderated by Author)</figcaption></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="3834" class="kr ks it bd kt ku nd kw kx ky ne la lb ki nf kj ld kl ng km lf ko nh kp lh li bi translated">唯一标识符的存储</h1><p id="64ec" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">让我们考虑这个用例。</p><p id="3799" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">你是一个出版商，拥有三个不同领域的网站。您需要实现在用户之间识别用户的机制(例如，确定有多少用户至少访问过每个站点一次)。</p><p id="5676" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">由于你的网站都没有登录功能，你必须使用某种匿名标识符。</p><p id="91e6" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">例如，当用户第一次访问您的网站时，您将生成一个<a class="ae mv" href="http://ekonomia.wne.uw.edu.pl/ekonomia/getFile/778" rel="noopener ugc nofollow" target="_blank"> UUIDv4 </a>，并使用所有可用的方法将其保存在用户的计算机上。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/6e9a55eb77fe3eb0f51a904f9a9e9523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wr5-zsOoWGptVX3kjMXeCw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Image by Author</figcaption></figure><p id="d919" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后，你的每个网站都应该能够在用户每次访问它的时候检索这个标识符。</p><p id="cd70" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">无论获取ID的网站是什么，恢复的ID都应该是相同的。</p><h1 id="6e82" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">基于存储的机制</h1><p id="b500" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">HTML5标准支持客户端的一系列结构化数据存储机制。这些是最广为人知的一代追踪技术，基于用户计算机上的持久存储。</p><p id="ac6b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">Cookies就属于这一类，它还包括本地存储、索引数据库和文件API。</p><p id="72c4" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这些机制都是对用户隐私的最大威胁。因此，默认情况下，它们都不能在跨域环境中工作，大多数浏览器会根据用户的请求清除这些存储。</p><h2 id="a1fb" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">局部存储器</h2><p id="9a88" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">本地存储是一种机制，类似于cookies，用于在客户端存储对象。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi op"><img src="../Images/5ccad378d8a3e6bf3486cb1933368bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRCe9DDeI7i3qwQMkSak8w.jpeg"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Local storage, a part of the web storage API, is a type of persistent storage built into the browser. (source: <a class="ae mv" href="https://www.boldare.com/blog/everything-you-need-to-know-about-local-storage/" rel="noopener ugc nofollow" target="_blank">Everything You Need To Know About Local Storage</a>)</figcaption></figure><p id="c14e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这些对象(键值对)被永久存储，直到用户或网站删除它们。一个对象可以有5 MB大，这比cookies有很大的优势。</p><p id="ec48" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">正如我之前提到的，<a class="ae mv" href="https://www.w3.org/TR/webstorage/#user-tracking" rel="noopener ugc nofollow" target="_blank">标准网络存储(也叫本地存储)不允许跨域数据共享。</a>访问本地存储甚至比cookies更难，因为你甚至不能指定有权访问数据的子域。它们被视为完全不同的领域。</p><p id="0da2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">当某人有许多(子)域，并希望在它们之间共享数据时，这可能会有问题。</p><p id="25ed" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">但是这个问题有一个解决方案——post message。</p><p id="f02d" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><a class="ae mv" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank"> postMessage </a>方法安全地支持页面和嵌入其中的iframe之间的跨来源通信。后消息传递功能旨在允许来自不同域的文档之间共享数据，同时仍然是安全的。</p><p id="d2c7" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">只需在所有域中嵌入一个iframe，使用它将数据保存在localStorage中，然后所有域都可以通过这个iframe访问同一个存储。</p><p id="dbf8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">不幸的是，还有另一个障碍。</p><p id="5a60" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">有的浏览器(<em class="oq">是的Safari，我说的就是你！</em>)阻止第三方设置和读取存储(无论是cookie、本地存储还是其他)。</p><p id="ac80" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">通过将用户重定向到第三方网站，可以很容易地绕过“仅第一方”的限制。这个中间站点可以设置或读取cookies，因为它的内容出现在第一方上下文中。</p><p id="7f36" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">接下来，用户被重定向到他最初访问的网站。</p><h2 id="e633" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">会话存储</h2><p id="e820" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">HTML5会话存储类似于本地存储，但是存储的对象只对当前浏览器窗口可用，并且在窗口关闭时被删除。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi or"><img src="../Images/1cfe3e49200b31440baa0c903c2663ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*ptq2XMkHUBPItL4ei5iV_A.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">(source: <a class="ae mv" href="https://theburningmonk.com/2010/12/having-fun-with-html5-local-storage-and-session-storage/" rel="noopener ugc nofollow" target="_blank">Having fun with HTML5 — Local Storage and Session Storage</a>)</figcaption></figure><p id="cc53" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">尽管本地存储和会话存储是同一标准的一部分。</p><p id="0efb" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">除了它的临时性，它还可以用来恢复用户ID，当用户在网站仍然打开的情况下清除其他存储时。</p><h2 id="3758" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">索引b</h2><p id="c18f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">IndexedDB 是一个内置在浏览器中的NoSQL数据库。它比本地存储强大得多。缺点是IndexedDB使用起来比cookies或本地存储稍微复杂一些。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi os"><img src="../Images/cd44d523c65a16d5d00cb2b24c6f7f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*Q9Q2dhbklt8NAHpCFGeeLA.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">IndexedDB is a <strong class="bd kt">large-scale object store</strong> built into the browser. (source: <a class="ae mv" href="https://www.javascripttutorial.net/web-apis/javascript-indexeddb/" rel="noopener ugc nofollow" target="_blank">JavaScript IndexedDB</a>)</figcaption></figure><p id="96e8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">但是这个问题你可以通过使用像<a class="ae mv" href="https://dexie.org/" rel="noopener ugc nofollow" target="_blank">这样的库来规避。</a></p><p id="8a03" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">当然，不同的域不能访问彼此的数据库。但是用于共享本地存储的解决方案也可以用于共享来自IndexedDB的数据。</p><h2 id="14b8" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">文件API</h2><p id="08a8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我想知道是否将该机制列入清单。</p><p id="25a4" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">问题是API需要用户的明确操作(从磁盘中选择一个文件)。这是一个很大的限制，因为大多数用户不想共享他们的数据。</p><p id="8927" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然而，我认为文件API可能是出版商的某种备份，作为跨网站交换数据的最后机会。通过一些努力，它甚至可以为用户增加新的功能。例如，用户可以获得一个包含其帐户密钥的文件，作为双因素身份验证。</p><p id="66fb" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">但是在这一点上，你应该把它当作一个更深奥的解决方案。</p><h2 id="b081" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">不朽b</h2><p id="3586" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">要将您的存储游戏提升到一个新的水平，您可以使用ImmortalDB。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/b427da8e8b4190ebe4cfeddd5d670c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*py9l05FKd_RNhrm8Z1Q5og.png"/></div></figure><p id="a669" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">正如本库的作者所说:</p><blockquote class="ou ov ow"><p id="d3b8" class="lj lk oq ll b lm mf kd lo lp mg kg lr ox mh lu lv oy mi ly lz oz mj mc md me im bi translated">ImmortalDB是在浏览器中存储持久键值数据的最佳方式。保存到ImmortalDB的数据冗余地存储在Cookies、IndexedDB和LocalStorage中，如果其中的任何数据被删除或损坏，它们会毫不留情地自我修复。</p><p id="7a22" class="lj lk oq ll b lm mf kd lo lp mg kg lr ox mh lu lv oy mi ly lz oz mj mc md me im bi translated">例如，清除cookies是一个常见的用户操作，即使对于非技术用户也是如此。在存储压力下，浏览器会在没有警告的情况下随意删除IndexedDB、LocalStorage和/或SessionStorage。</p><p id="6639" class="lj lk oq ll b lm mf kd lo lp mg kg lr ox mh lu lv oy mi ly lz oz mj mc md me im bi translated">面对这样的事件，ImmortalDB是有弹性的。</p></blockquote><p id="be23" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">关于不朽的更多信息https://github.com/gruns/ImmortalDB<a class="ae mv" href="https://github.com/gruns/ImmortalDB" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="292a" class="kr ks it bd kt ku nd kw kx ky ne la lb ki nf kj ld kl ng km lf ko nh kp lh li bi translated">基于缓存的机制</h1><p id="e4ba" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">另一组跟踪方法也使用基于客户端的存储。根据设计，缓存用于存储很少更改的数据。</p><p id="ed4b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">该功能限制了不必要的网络数据传输，对于基础设施带宽维护至关重要。因此，浏览器将很难在不影响用户体验和互联网性能的情况下限制基于缓存的跟踪机制。</p><p id="9592" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">缓存所需的机制也可以用作用户标识数据的存储。</p><h2 id="bdcc" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">在缓存的文档中嵌入标识符</h2><p id="7c3b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在我们的基本场景中，服务器可能会返回一个JavaScript文档，该文档的主体中嵌入了一个惟一的标识符(例如，作为变量值或者甚至在注释中)。</p><p id="37aa" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这个JS文件可以附加到所有3个域。这个id将在服务器端被请求时生成。</p><p id="3d24" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">但是为了存储曾经生成的标识符，服务器将Expires/max-age=设置为遥远未来的日期。</p><h2 id="9bbc" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">负载性能测试</h2><p id="92f8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">让我们暂时放弃基本的场景，假设我们只想知道一个给定站点的用户曾经访问过我们的其他站点。</p><p id="2550" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">网站可以使用JavaScript来检测从任何URL加载任何对象(例如，图像)的时间。所测量的加载时间可以被报告给服务器，服务器可以评估对象是否存在于高速缓存中(因此，用户先前访问过网站)。</p><p id="5ca7" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">但是你只需要记住用户体验，因为这种“敲打”可能会迅速降低网站的加载速度。</p><h2 id="6c36" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">ETag &amp;上次修改时间</h2><p id="9f9d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">ETag和Last-Modified是HTTP响应头。它们的目的是优化性能和增强客户端-服务器通信过程。</p><p id="2564" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">ETag字段是资源的特定版本的标识符(例如，文档内容的散列)。它可以包含大约10kb的数据。这足以储存我们的UUID。</p><p id="0c9c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">理论上，Last-Modified头应该包含DateTime，但实际上也接受任何字符串。但是我不建议这么用。</p><p id="79bd" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">更好的方法是用一组DateTime值构建一个自定义散列函数。它</p><p id="7207" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在我们的例子中，如何使用ETag和Last-Modified？</p><p id="6698" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">当用户第一次从服务器请求一些资源时，响应头包含ETag和Last-Modified字段。在下一次访问网站时，浏览器在请求头中发送If-Modified-Since和If-None-Match。</p><p id="fd66" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这些头包含来自先前缓存的资源的Last-Modified和ETag字段的值。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi pa"><img src="../Images/a3b4b4ca690422d16b9efd7713238ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mOs5AVpReFT2RNGNq1TWmQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">ETag diagram (Image by Author)</figcaption></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi pa"><img src="../Images/c7e73d20d464e5efaf8ebc3c6fb7bd82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAKuaWyzXYVHEwhnbKg8Sg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Last-Modified diagram (Image by Author)</figcaption></figure><p id="8f4e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我提到过它可以跨域工作吗？</p><p id="fe60" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">有趣的是，即使在单个私人浏览会话期间，跟踪也是可能的，因为缓存一直保持到最后一个浏览器窗口关闭。</p><p id="05f0" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">唯一的挑战是开发一种机制，将来自ETag/Last-Modified的服务器端唯一id插入到客户端JavaScript代码中。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="5ba8" class="kr ks it bd kt ku nd kw kx ky ne la lb ki nf kj ld kl ng km lf ko nh kp lh li bi translated">外卖食品</h1><p id="8346" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在本文中，我们重点关注严格基于在用户设备上存储数据的跟踪方法。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi pb"><img src="../Images/bd6d04058e128f4ec0fe986419dcf8ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2uvKF-rsq4F29upwgfGgZQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Comparison of tracking methods (Image by Author)</figcaption></figure><p id="4bc3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在cookie启示的背景下，最有前途的是基于缓存的HTTP头和iframes之间的<code class="fe pc pd pe pf b">postMessaging</code>。</p><p id="918d" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">但是，总会有关于用户隐私的讨论。不管网站所有者使用什么方法。</p><p id="032d" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在下一部分中，我将关注更复杂的方法。<a class="ae mv" rel="noopener ugc nofollow" target="_blank" href="/fingerprinting-aba640862019">指纹识别</a>结合统计方法可以提供几乎和cookie跟踪一样好的结果。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi pg"><img src="../Images/22e1b0bc54a738bc156fba54cff2eda0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwZvfADZ0PWLBXDCdIWjBg.png"/></div></div></figure><p id="abef" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">感谢您的阅读。我希望你喜欢阅读，就像我喜欢为你写这篇文章一样。</p><blockquote class="ph"><p id="29b2" class="pi pj it bd pk pl pm pn po pp pq me dk translated"><a class="ae mv" href="https://fischerbach.medium.com/membership" rel="noopener">https://fischerbach.medium.com/membership</a></p></blockquote><p id="cccf" class="pw-post-body-paragraph lj lk it ll b lm pr kd lo lp ps kg lr ls pt lu lv lw pu ly lz ma pv mc md me im bi translated"><strong class="ll jd"> <em class="oq"> Pro提示:</em> </strong>注册Medium，就可以完全访问我所有的内容以及成千上万像我一样的内容创作者。如果你喜欢你看到的，使用<a class="ae mv" href="https://fischerbach.medium.com/membership" rel="noopener">我的链接</a>支持我的写作。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi pg"><img src="../Images/22e1b0bc54a738bc156fba54cff2eda0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwZvfADZ0PWLBXDCdIWjBg.png"/></div></div></figure><h1 id="5e6f" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">参考</h1><div class="pw px gp gr py pz"><a rel="noopener  ugc nofollow" target="_blank" href="/fingerprinting-aba640862019"><div class="qa ab fo"><div class="qb ab qc cl cj qd"><h2 class="bd jd gy z fp qe fr fs qf fu fw jc bi translated">指纹识别</h2><div class="qg l"><h3 class="bd b gy z fp qe fr fs qf fu fw dk translated">不使用第三方cookies的跨域跟踪</h3></div><div class="qh l"><p class="bd b dl z fp qe fr fs qf fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="qi l"><div class="qj l qk ql qm qi qn nn pz"/></div></div></a></div><h2 id="f3d2" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">跟踪机制</h2><p id="36f3" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae mv" href="https://arxiv.org/pdf/1507.07872.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1507.07872.pdf</a><br/>T3】http://www . chromium . org/Home/chromium-security/client-identificati on-mechanisms<br/><a class="ae mv" href="https://github.com/gruns/ImmortalDB" rel="noopener ugc nofollow" target="_blank">https://github.com/gruns/ImmortalDB</a></p><h2 id="2133" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">局部存储器</h2><p id="c197" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae mv" href="https://www.w3.org/TR/webstorage/" rel="noopener ugc nofollow" target="_blank">https://www.w3.org/TR/webstorage/</a><br/><a class="ae mv" href="https://caniuse.com/mdn-api_window_localstorage" rel="noopener ugc nofollow" target="_blank">https://caniuse.com/mdn-api_window_localstorage</a><br/><a class="ae mv" href="https://levelup.gitconnected.com/share-localstorage-sessionstorage-between-different-domains-eb07581e9384" rel="noopener ugc nofollow" target="_blank">https://level up . git connected . com/share-local storage-session storage-between-different-domain-EB 07581 e 9384</a></p><h2 id="e5fe" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">索引b</h2><p id="66e7" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae mv" href="https://www.w3.org/TR/IndexedDB-2/" rel="noopener ugc nofollow" target="_blank">https://www.w3.org/TR/IndexedDB-2/</a><br/><a class="ae mv" href="https://caniuse.com/indexeddb" rel="noopener ugc nofollow" target="_blank">https://caniuse.com/indexeddb</a><br/>T22】https://github.com/localForage/localForage</p><h2 id="2768" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">文件API</h2><p id="9633" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae mv" href="https://www.w3.org/TR/2019/WD-FileAPI-20190911/" rel="noopener ugc nofollow" target="_blank">https://www.w3.org/TR/2019/WD-FileAPI-20190911/</a><br/>T27】https://caniuse.com/mdn-api_file</p><h2 id="a92f" class="oe ks it bd kt of og dn kx oh oi dp lb ls oj ok ld lw ol om lf ma on oo lh iz bi translated">ETag &amp;上次修改时间</h2><p id="fe04" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae mv" href="https://caniuse.com/mdn-http_headers_etag" rel="noopener ugc nofollow" target="_blank">https://caniuse.com/mdn-http_headers_etag</a>T31】T32】https://caniuse.com/mdn-http_headers_last-modified</p></div></div>    
</body>
</html>