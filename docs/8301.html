<html>
<head>
<title>Question Answering through BERT in 10 steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过BERT 10步回答问题</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/question-answering-through-bert-in-10-steps-d2bc2d4a4d98?source=collection_archive---------4-----------------------#2021-01-07">https://medium.datadriveninvestor.com/question-answering-through-bert-in-10-steps-d2bc2d4a4d98?source=collection_archive---------4-----------------------#2021-01-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/637bd9afc8f49a53244e3fe49b859a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yShixt7GO1FG7W4qEd_Kjw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Image <a class="ae kc" href="https://unsplash.com/photos/0CvHQ62gwY8?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="0128" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有一大堆网站或一大堆pdf文件，并且你想知道你的问题的答案，这看起来是一项艰巨的任务。</p><p id="3511" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们能用BERT用几行代码就能做到呢？</p><p id="3318" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">BERT是一个预先训练好的基于变压器的模型。这里我们将使用bert-squad1.1，这个模型是在squad(斯坦福问答数据集)数据集上预先训练的，这是问答模型的典型基准问题。它由基于维基百科片段的10万多个问题组成。此外，它还标注了相应的文本范围，即标记了答案的开始和结束。</p><p id="1ee7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有一个名为distilbert的较轻版本，但它需要训练的参数要少40%。</p><p id="edb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它会更快，但精度会更低。</p><p id="2172" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们开始，首先决定输入的类型(pdf或网站或任何东西)。</p><p id="50f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我将向你展示两种方法。</p><p id="3c0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 1)第一步是安装cdqa。</strong></p><p id="43fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> CDQA软件包有将PDF文件转换成数据框中可搜索文本的软件包</strong></p><p id="84ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">封闭域问答是一个端到端的开源软件套件，使用经典的信息检索方法和预训练模型BERT进行迁移学习来回答问题</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="1ed9" class="lk ll iq lg b gy lm ln l lo lp">pip install cdqa</span></pre><p id="943d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 2) CDQA也有QAPipeline </strong>，文件将被放入其中。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="7604" class="lk ll iq lg b gy lm ln l lo lp">import os<br/>import pandas as pd<br/>from ast import literal_eval<br/>from cdqa.utils.converters import pdf_converter  #converts to pandas dataframe<br/>from cdqa.pipeline import QAPipeline     #Question Answer Pipeline<br/>from cdqa.utils.download import download_model   #to download the pre-trained model</span></pre><p id="215e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 3)下载模型是下载一个我们将使用的预先训练好的模型。</strong></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="17dc" class="lk ll iq lg b gy lm ln l lo lp">download_model(model='bert-squad_1.1', dir='./models')</span></pre><p id="9ccf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 4) </strong> <strong class="kf ir">现在创建一个目录，将所有的pdf文件下载到这个目录中。</strong></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="1e99" class="lk ll iq lg b gy lm ln l lo lp">!mkdir docs</span></pre><p id="f8f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">5)</strong>T14】将所有文件下载到此路径</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="ab74" class="lk ll iq lg b gy lm ln l lo lp">!wget -P ./docs/ <a class="ae kc" href="https://s2.q4cdn.com/299287126/files/doc_financials/2020/q3/AMZN-Q3-2020-Earnings-Release.pdf" rel="noopener ugc nofollow" target="_blank">https://s2.q4cdn.com/299287126/files/doc_financials/2020/q3/AMZN-Q3-2020-Earnings-Release.pdf</a><br/>!wget -P ./docs/ <a class="ae kc" href="https://s2.q4cdn.com/299287126/files/doc_financials/2020/Q1/AMZN-Q1-2020-Earnings-Release.pdf" rel="noopener ugc nofollow" target="_blank">https://s2.q4cdn.com/299287126/files/doc_financials/2020/Q1/AMZN-Q1-2020-Earnings-Release.pdf</a><br/>!wget -P ./docs/ <a class="ae kc" href="https://s2.q4cdn.com/299287126/files/doc_financials/2020/q2/Q2-2020-Amazon-Earnings-Release.pdf" rel="noopener ugc nofollow" target="_blank">https://s2.q4cdn.com/299287126/files/doc_financials/2020/q2/Q2-2020-Amazon-Earnings-Release.pdf</a></span></pre><p id="e14b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 6) </strong> <strong class="kf ir">使用pdf Converter将pdf </strong>文本转换为pandas数据框并可视化数据集。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e498" class="lk ll iq lg b gy lm ln l lo lp">df=pdf_converter(directory_path='./docs/')<br/>df.head()</span></pre><p id="16f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 7)调用管道读取模型</strong></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="4f10" class="lk ll iq lg b gy lm ln l lo lp">cdqa_pipeline=QAPipeline(reader='./models/bert_qa.joblib',max_df=1.0)</span></pre><p id="954b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 8)将管道安装到创建的数据帧上</strong></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e34b" class="lk ll iq lg b gy lm ln l lo lp">cdqa_pipeline.fit_retriever(df=df)</span></pre><p id="9f56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 9)现在你可以开始提问，答案将会被预测</strong></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="ebd2" class="lk ll iq lg b gy lm ln l lo lp">query='How many full time employees are on Amazon roll?'<br/>prediction=cdqa_pipeline.predict(query)</span></pre><p id="9203" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="b568" class="lk ll iq lg b gy lm ln l lo lp">650,000<br/>Q2-2020-Amazon-Earnings-Release<br/>paragraph:Supporting Employees• Amazon’s top priority is providing for the health and safety of our employees and partners, and the company ----</span></pre><p id="173c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，为了将这个答案转换成更好的格式，我们可以写成:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="5254" class="lk ll iq lg b gy lm ln l lo lp">print('query:{}'.format(query))<br/>print('answer:{}'.format(prediction[0]))<br/>print('title:{}'.format(prediction[1]))<br/>print('paragraph:{}'.format(prediction[2]))</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/9b5a8b65f36f9594c90f3e44631679e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1KXMqkzO1HPsn5U9.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Image by Author</figcaption></figure><p id="9dd8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将回答问题，甚至显示它搜索了哪个文档以及它所在的段落。</p><p id="7d9b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于其他类型的数据库，您也可以通过beautifulsoup抓取数据并使用它，或者下载数据并将其转换为CSV格式，然后工作。一个例子如下:</p><p id="fd7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在步骤2中，添加这一行。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="b63a" class="lk ll iq lg b gy lm ln l lo lp">from cdqa.utils.filters import filter_paragraphs</span></pre><p id="d4f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在步骤4和5中，这样做</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3435" class="lk ll iq lg b gy lm ln l lo lp">from cdqa.utils.download import download_model, download_bnpp_data<br/>download_bnpp_data(dir='./data/bnpp_newsroom_v1.1/')</span></pre><p id="2c70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代替第6步，你可以做如下。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="f59f" class="lk ll iq lg b gy lm ln l lo lp">df = pd.read_csv('./data/bnpp_newsroom_v1.1/bnpp_newsroom-v1.1.csv', converters={'paragraphs': literal_eval})<br/>df.head()</span></pre><p id="8cb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">结论</strong></p><p id="3ae4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记住，如果你有很多数据，不要忘记打开你的图形处理器，伯特也可能需要一点时间来响应，虽然它的效率非常好，因为它的注意力范围和位置编码质量。你可能已经在我的博客中读到过关于变形金刚的内容。我们将很快讨论更多关于聊天机器人的有效模型，甚至是聊天机器人。</p><p id="4e27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读！</p><p id="c674" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">访问专家视图— </strong> <a class="ae kc" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅DDI英特尔</strong> </a></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="1a70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ly">最初发表于2021年1月7日https://www.numpyninja.com</em><em class="ly">的</em> <a class="ae kc" href="https://www.numpyninja.com/post/question-answering-through-bert-in-10-steps" rel="noopener ugc nofollow" target="_blank"> <em class="ly">。</em></a></p></div></div>    
</body>
</html>