<html>
<head>
<title>Make Money With Python — The Sports Arbitrage Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python赚钱——体育套利项目</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/make-money-with-python-the-sports-arbitrage-project-3b09d81a0098?source=collection_archive---------0-----------------------#2020-12-06">https://medium.datadriveninvestor.com/make-money-with-python-the-sports-arbitrage-project-3b09d81a0098?source=collection_archive---------0-----------------------#2020-12-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6e91" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">充分代码，使额外的钱与体育套利。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3f670f269874717c7b05f092d55787b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qb4lNdkzwTq8CFho"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@heathergill?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Heather Gill</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="edb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以你终于完成了一门教你Python基础的课程；你已经学习了列表、字典、循环和条件如何工作，但是你仍然不能用你的Python技能赚钱。我学Python 1年后也遇到过这种情况；幸运的是，你可以用一些Python、Selenium和体育套利的知识来赚外快。</p><p id="0e0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">体育套利或surebets是利用博彩公司在计算同一体育赛事的赔率时出现的错误的做法。当这种情况发生时，无论结果如何，你都可以通过向不同的庄家下注来获利。</p><p id="75f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我将指导你通过<strong class="lb iu">的完整代码</strong>，你需要从3个投注网站收集<strong class="lb iu">现场投注数据，</strong>将为我们找到sure bets<strong class="lb iu">。</strong>有两种surebet:预赛和现场sure bet。我们将专注于实时surebets，因为这是最有利可图的，但由于数据是“动态的”，因此有点难以收集。</p><p id="806b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程将分为4个部分:</p><ol class=""><li id="cafa" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">用Selenium抓取现场投注数据</strong>:在Selenium中，我们会用到<code class="fe me mf mg mh b">WebdriverWait</code>、<code class="fe me mf mg mh b">Expected Conditions(EC) </code>和<code class="fe me mf mg mh b">Select</code>。此外，我们将自定义chromedriver的默认选项，以便在后台抓取。我们需要的一些Python必需品是<code class="fe me mf mg mh b">try-except</code>块和列表。</li><li id="0a9c" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated"><strong class="lb iu">清理和转换实时赔率数据</strong>:来自不同博彩公司的赔率数据以不同的形式出现，因此我们需要对它们进行适当的格式化，以便能够比较它们并找到确定的赌注。熊猫图书馆在这方面派上了用场。</li><li id="d81c" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated"><strong class="lb iu">匹配队名</strong>:博彩公司对相同队名的写法各不相同。有些人可能会写纽约市足球俱乐部，而其他人只会把它称为纽约足球俱乐部，所以我们需要先做一些字符串匹配。我们将使用Fuzzywuzzy。</li><li id="0c2c" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated"><strong class="lb iu">寻找确定赌注并计算赌注</strong>:我们将创建Python函数来寻找确定赌注，为我们计算赌注，并告诉我们潜在的利润。</li></ol><p id="55bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您以前从未使用过Selenium或库(如Pandas或Fuzzywuzzy)上的高级工具，您也不必担心。当我们需要它们时，我会一步一步地解释它们是如何工作的。</p><p id="bbfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，要学习本教程，一些关于Selenium的基础知识是必要的；否则解释就太长了。我制作了另一个教程，以赛前surebets为例解释了网络抓取的基础知识。教程可以在下面的链接中找到，我创建的一个<strong class="lb iu">网页抓取备忘单</strong>可以在这个<a class="ae ky" href="https://medium.com/geekculture/web-scraping-cheat-sheet-2021-python-for-web-scraping-cad1540ce21c" rel="noopener">链接</a>中找到。</p><div class="mn mo gp gr mp mq"><a href="https://medium.com/swlh/web-scraping-basics-scraping-a-betting-site-in-10-minutes-8e0529509848" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">网络抓取基础——10分钟内抓取一个赌博网站</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">在这10分钟的教程中，我将向你展示如何用Python来抓取网站，即使你根本不编码！</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ks mq"/></div></div></a></div><p id="ad7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，在我们开始编码之前，请确保您完全熟悉surebets 的<a class="ae ky" href="https://medium.com/swlh/how-to-make-money-from-web-scraping-without-selling-data-92c1f961b25" rel="noopener">概念，这样我们将要编写的代码对您来说才有意义。</a></p><p id="b1c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="nf">注</em> </strong> <em class="nf">:我用Python的硒和熊猫搭建了一个盈利的投注工具。在下面的文章中，我展示了完整的代码，并解释了我是如何做到的。</em></p><div class="mn mo gp gr mp mq"><a href="https://frank-andrade.medium.com/i-used-to-pay-180-yr-for-a-profitable-betting-tool-this-year-i-built-one-in-python-dda1a9b9581f" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">我曾经每年花180美元购买一个有利可图的赌博工具。今年我用Python做了一个</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">完整的代码创建一个足球博彩工具与熊猫和硒。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">frank-andrade.medium.com</p></div></div><div class="mz l"><div class="ng l nb nc nd mz ne ks mq"/></div></div></a></div><p id="cb5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">法律免责声明:</strong>网站的大量抓取会导致高流量，并可能给网站带来负担。如果您正在访问网站，您应该始终考虑他们的服务条款，并检查“robots.txt”文件，以了解网站应该如何被抓取。此外，我不提倡赌博，不管是哪种赌博。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="958f" class="no np it bd nq nr ns nt nu nv nw nx ny jz nz ka oa kc ob kd oc kf od kg oe of bi translated">编码时间到了</h1><p id="d205" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">在3个博彩网站中，我认为这是最难获得数据的一个，所以一旦你能够从这一个中获得实时赔率，你就能够很容易地理解其他2个网站的代码，并创建自己的博彩网站刮刀。</p><p id="b61f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始编码吧！完整的代码可在第4部分的结尾获得。</p><p id="6aa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如果你已经学习了本教程，突然代码停止工作</strong>，下面你可以找到我对代码做的一些更新，因为对网站做了一些改动。</p><p id="e4d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"><em class="nf">2021年3月21日更新:</em> </strong></p><ol class=""><li id="19f5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><em class="nf">我将Tipico、Betfair和Bwin刮刀的CSV输出示例上传到我的</em><a class="ae ky" href="https://github.com/ifrankandrade/the-sports-arbitrage-project.git" rel="noopener ugc nofollow" target="_blank"><em class="nf">Github</em></a><em class="nf">中，这样您就可以了解第1节(</em>用Selenium刮活投注数据)<em class="nf">的输出是什么样子了。然而，在找到surebets之前，这些数据仍然需要在第2和第3节中进行预处理。</em></li><li id="90de" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated"><em class="nf">Tipico博彩网站下拉列表中的名称略有变化。最初的名字是，“两个队都得分？”但现在是“两队得分”，下面的代码考虑新的名字。</em></li></ol><p id="6ce2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"><em class="nf">2021年4月22日更新:</em> </strong> <em class="nf">(仅限Tipico网站)</em></p><ol class=""><li id="1f79" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><em class="nf">显然，从某些国家访问该网站是不可能的。如果是这种情况，使用一个</em><strong class="lb iu"><em class="nf">VPN</em></strong><em class="nf">连接到欧洲的某个国家(TunnelBear对我很有用，而且是免费的)</em></li><li id="43ad" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">网站对直播部分做了一些重大改动。现在prematch和live部分在一个名为“Program_UPCOMING”的容器中，所以为了保持scraper工作，我必须删除和添加一些代码行，这些代码行是我在文章结尾的完整代码以及下面的代码片段中指定的。</li><li id="9945" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated"><em class="nf">看起来网站现在有了一些功能，不允许所有事件显示在直播部分(除非你一直向下滚动)。如果你看到不是所有的事件都被废弃了，使用下面的代码一直向下滚动并抓取所有的事件。(我只在完整的代码中包含了这一点，以防你需要)</em></li></ol><pre class="kj kk kl km gt ol mh om on aw oo bi"><span id="4a41" class="op np it mh b gy oq or l os ot">#scroll down to the bottom to load all matches<br/>driver.execute_script("window.scrollTo(0, document.body.scrollHeight)")<br/>time.sleep(3) #implicit wait to let the page load all the matches</span></pre><p id="da0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nf"> 4。我把网站网址更新为scrape，所以现在直接进入“足球”部分(有助于简化代码)</em></p><p id="3d52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果代码停止工作，请在评论中告诉我！</p><pre class="kj kk kl km gt ol mh om on aw oo bi"><span id="d2f5" class="op np it mh b gy oq or l os ot"><strong class="mh iu">Table of Contents<br/></strong>1. <a class="ae ky" href="#f1fd" rel="noopener ugc nofollow">Scraping live betting data with Selenium</a><br/> - <a class="ae ky" href="#eed6" rel="noopener ugc nofollow">Importing libraries</a><br/> - <a class="ae ky" href="#3f81" rel="noopener ugc nofollow">Changing Chromedriver default options</a><br/> - <a class="ae ky" href="#6355" rel="noopener ugc nofollow">Select values from dropdown menus</a><br/> - <a class="ae ky" href="#ad81" rel="noopener ugc nofollow">Looking for 'live events' and 'sports titles'</a><br/> - <a class="ae ky" href="#f66f" rel="noopener ugc nofollow">Scheme for scraping live games</a> <br/> - <a class="ae ky" href="#3078" rel="noopener ugc nofollow">Find 'empty events'</a> <br/> - <a class="ae ky" href="#f130" rel="noopener ugc nofollow">Remove empty_events from single_row_events</a><br/> - <a class="ae ky" href="#6b82" rel="noopener ugc nofollow">Getting live odds</a><br/>2. <a class="ae ky" href="#3eaa" rel="noopener ugc nofollow">Clean and transform live odds data with Pandas</a><br/>3. <a class="ae ky" href="#fe02" rel="noopener ugc nofollow">String matching with Fuzzywuzzy</a><br/>4. <a class="ae ky" href="#9b4a" rel="noopener ugc nofollow">Find surebets and calculate stakes</a> <br/> - <a class="ae ky" href="#712d" rel="noopener ugc nofollow">Find surebets</a><br/> - <a class="ae ky" href="#c645" rel="noopener ugc nofollow">Calculate the stakes</a><br/> - <a class="ae ky" href="#d60c" rel="noopener ugc nofollow">Final Step: Automate the Python Script</a><br/>5. <a class="ae ky" href="#96f6" rel="noopener ugc nofollow">Full Code of 3 Bookmakers</a><br/>6. <a class="ae ky" href="#125b" rel="noopener ugc nofollow">Final Note</a></span></pre><h1 id="f1fd" class="no np it bd nq nr ou nt nu nv ov nx ny jz ow ka oa kc ox kd oc kf oy kg oe of bi translated">1.用Selenium抓取实时赌博数据</h1><h2 id="eed6" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">导入库</h2><p id="89b5" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">我们需要导入<code class="fe me mf mg mh b">Options</code>来改变chromedriver的默认选项；<code class="fe me mf mg mh b">Select</code>用于下拉菜单中的选择，以及<code class="fe me mf mg mh b">By</code>、<code class="fe me mf mg mh b">WebDriverWait</code>、<code class="fe me mf mg mh b">EC</code>、<code class="fe me mf mg mh b">time</code>用于等待特定条件的发生。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="3f81" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">更改Chromedriver默认选项</h2><p id="8eee" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">为了在计算机上做其他事情的同时继续抓取，我们需要使用无头模式。为此，我们编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="fdea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="1007" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">options = Options()</code>创建选项类的实例</li><li id="eaa7" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">options.headless = True </code>开启无头模式</li><li id="d447" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">options.add_argument(‘window-size=1920x1080’) </code>在背景上以自定义大小打开窗口</li><li id="e4dc" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">webdriver.Chrome(path, options = options) </code>应用我们在chromedriver中所做的更改</li><li id="5e31" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">driver.get </code>打开浏览器</li><li id="0205" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">web </code>代表博彩网站的网址，而<code class="fe me mf mg mh b">path </code>代表chrome驱动程序在你电脑中的路径</li></ul><p id="e24e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不想在无头模式下工作，那么写<code class="fe me mf mg mh b">option.headless=False </code>并使用<code class="fe me mf mg mh b">driver.maximize_window()</code>而不是<code class="fe me mf mg mh b">options.add_argument(‘window-size=1920x1080’) </code>，如完整代码所示。</p><h2 id="6355" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">从下拉菜单中选择值</h2><p id="d4b8" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">我们需要选择我们想要从中获取数据的博彩市场。我们用<code class="fe me mf mg mh b">Select </code>和下拉列表的Xpath来实现。要获取Xpath，请执行以下操作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/31592d7fee6273bf013d1f4ceef4f105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*s1evOXLSqoyNJ8H9XxGELA.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Image by author</figcaption></figure><p id="7da5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但首先要记住，每次你打开一些博彩网站时，都会显示一个cookies横幅。我们需要通过点击“接受按钮”来删除它们</p><p id="aad5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要单击“accept button ”,然后在下拉菜单中进行选择，我们编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="2c3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="0e8a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">WebDriverWait(driver, 5).until(EC.element_to_be_clickable((By.XPATH, '//*[@id="_evidon-accept-button"]')))</code>让驱动等待，直到cookie横幅上的“确定按钮”可以点击。如果这引发了一个错误，那么使用“选项2”来代替。要获取Xpath，右键单击“ok按钮”,然后像我们之前一样检查下拉菜单。</li><li id="0adb" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">WebDriverWait(driver,5).until(EC.presence_of_all_elements_located((By.CLASS_NAME, '...')))</code>让驾驶员等待几秒钟，直到找到下拉菜单</li><li id="42cc" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">Select('...') </code>选择<code class="fe me mf mg mh b">dropdowns</code>菜单</li><li id="5a25" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">first_dropdown </code>包含博彩市场的三个下拉列表之一</li><li id="21c8" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">first_dropdown.select_by_visible_text() </code>在博彩市场名称的帮助下选择下拉菜单中的一个元素。</li></ul><p id="c7d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我特别选择了“两队得分”和“过/欠”,因为它们代表了我认为容易找到确定赌注的博彩市场。</p><h2 id="ad81" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">寻找“现场事件”和“体育标题”</h2><p id="baac" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">在获得数据之前，我们需要首先寻找现场事件。此外，为了简化分析，我们将只选择“足球”作为运动名称。为此，我们编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="0166" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="ff4c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">box</code>代表包含体育赛事的盒子。该网站还包含即将举行的活动，这是我们不需要的分析。</li><li id="c688" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">driver.find_<strong class="lb iu">element</strong>_by_xpath()</code>通过元素的“Xpath”帮助我们找到网站中的元素。</li></ul><p id="2c0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与我们之前处理过的大多数元素的Xpaths不同,‘live events’元素更难获得。为此，我们需要非常具体。然后我们使用<code class="fe me mf mg mh b">contains </code>选项来匹配一个在<code class="fe me mf mg mh b">div </code>标签内的<code class="fe me mf mg mh b">testid </code>内包含<code class="fe me mf mg mh b">Program_LIVE</code>的元素。查看下图找到<code class="fe me mf mg mh b">Program_UPCOMING</code> ( <code class="fe me mf mg mh b">Program_LIVE </code>在网站更改后不再显示)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/ae750271d4ca52de133c1b8576dfcbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6icAi6gXNEMHc2TTBBsl3w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Program_live — Image by author</figcaption></figure><ul class=""><li id="e4f6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">sport_title</code>代表各部分的运动名称。</li><li id="69a8" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">driver.find_<strong class="lb iu">element</strong>_by_class_name() </code>通过元素的“class_name”帮助我们找到网站中的元素。要获得类名，只需按照我们之前用于下拉菜单的相同步骤，但在这种情况下，单击“足球”标题并复制类名<code class="fe me mf mg mh b">‘SportTitle-styles-sport’.</code></li></ul><p id="f366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们继续编写代码之前，我们需要理解将帮助我们收集实时数据的方案。</p><h1 id="f66f" class="no np it bd nq nr ou nt nu nv ov nx ny jz ow ka oa kc ox kd oc kf oy kg oe of bi translated">抓取游戏直播的方案</h1><p id="2857" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">抓取直播游戏的方案类似于<a class="ae ky" href="https://medium.com/swlh/web-scraping-basics-scraping-a-betting-site-in-10-minutes-8e0529509848" rel="noopener">抓取赛前游戏</a>的方案。然而，博彩网站Tipico中的直播游戏包括我们需要排除的“双排事件”和“空事件”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/2b940e159b3c4144a6f0aebb44270e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLmUkG47ViQcbMflb_ZJUQ.png"/></div></div></figure><ul class=""><li id="bce4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated">体育标题:代表体育部分。网站上有很多运动，但我们将只关注足球，因为它是最受欢迎的运动。</li><li id="051c" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">双排赛事:上半场(0'-45 ')足球直播赛事有2排。第一行包含整场比赛的赔率，第二行只包含上半场的赔率。我们只和第一排合作。</li><li id="9050" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">单行事件:下半场(45'-90 ')的足球直播事件只有一行包含剩余比赛的赔率。</li><li id="3d27" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">odds_event:表示一行中可用的赔率。每行有1个“赔率事件”，每个“赔率事件”有3个框，默认为市场“三向”、“过/欠”和“差点”。</li><li id="9872" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">空事件:现场赔率可能会由于多种原因暂停几秒钟。为了简化分析，我们不考虑包含空事件的行。</li></ul><h2 id="3078" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">查找“空事件”</h2><p id="8e6b" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">与赛前游戏不同，现场游戏的赔率变化很快，随时可能暂停几秒钟。当投注赔率暂时暂停时，赔率要么被锁定，要么为空。锁定赔率容易刮，空赔率难。这就是为什么我们需要用下面的代码来定位那些空赔率:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="da6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="4dd7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">for sport in sport_title </code>循环浏览之前获得的运动列表(更新:不再需要)</li><li id="5d8c" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">parent</code>表示<code class="fe me mf mg mh b">sport</code>元素的‘父节点’,而<code class="fe me mf mg mh b">grandparent </code>是它的‘祖父节点’,表示实时事件中的整个‘足球’容器(更新:现在我们必须这样做3次才能到达代码中所示的目标节点)</li><li id="35df" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">empty_groups</code>代表每场赔率暂停或为空的足球比赛</li><li id="fe7f" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">granparent.find_elements_by_class_name()</code>给出了足球直播版块中所有类别名为‘EventOddGroup-styles-empty-group’的空赔率列表。您可以通过以下方式获得类名:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/754fb499af5b30fa88fb11c1c1d7b4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DCiH5qspPSz9on1K3HIpSA.gif"/></div></div></figure><ul class=""><li id="7fe9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">empty_events</code>代表至少有1个空赔率市场的每一排或足球比赛(3路、过/欠等。)</li><li id="0abc" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">[empty_group.find_element_by_xpath('./..') for empty_group in empty_groups] </code>是一个列表理解，它遍历<code class="fe me mf mg mh b">empty_groups </code>列表以获得每个元素的‘父节点’,即<code class="fe me mf mg mh b">empty_events</code></li><li id="ba07" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">except</code>处理在<code class="fe me mf mg mh b">try</code>程序块中可能遇到的错误。当没有赔率为空的游戏时，我们需要这个来处理错误</li></ul><h2 id="f130" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">从单行事件中删除空事件</h2><p id="86de" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">我们找到单行事件，并使用以下代码删除其中的所有空事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="c5d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="7699" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">single_row_events </code>代表双排项目的第一排或单行项目的唯一一排。正如我们之前所解释的，两者都代表了整个游戏的赔率，我们关注它们是因为在整个游戏的赔率计算中找到确定的赌注更常见。通过检查任何单行来查找单行事件的类名。你应该找到这个类名<code class="fe me mf mg mh b">'EventRow-styles-event-row'</code></li><li id="aeb0" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">[single_row_event for single_row_event in single_row_events if single_row_event not in empty_events] </code>列出排除<code class="fe me mf mg mh b">single_row_events</code>中任何空游戏的理解</li><li id="d9f9" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">try/except</code>处理没有赔率为空的游戏时可能出现的错误</li></ul><h2 id="6b82" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">获得实时赔率</h2><p id="4a69" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">之前选择的每个下拉列表将给出用以下代码提取的3个市场的赔率:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="0dc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="3a77" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">for match in single_row_events</code>遍历<code class="fe me mf mg mh b">‘single_row_events’</code>列表中的所有匹配项</li><li id="c68b" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">odd_events </code>代表每项赛事的可用赔率</li><li id="924c" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">帮助我们找到每场比赛中的所有“赔率事件”。要找到类名<code class="fe me mf mg mh b">‘EventOddGroup-styles-odd-groups’ </code>，只需右键单击并检查“赔率框”后面的代码，就像我们之前检查空赔率一样</li><li id="35c2" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">for team in match.find_elements_by_class_name(‘EventTeams-styles-titles’)</code>循环遍历‘匹配’节点中类名为<code class="fe me mf mg mh b">'EventTeams-styles-titles'</code>的元素。比赛有两个队(主队和客队)；这就是为什么我们需要遍历它们并用<code class="fe me mf mg mh b">team.text. </code>获得它们的名字，然后用<code class="fe me mf mg mh b">append</code>方法将它们存储在<code class="fe me mf mg mh b">teams</code>列表中</li><li id="a9ad" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">for odd_event in odds_events</code>循环查看投注网站上直播比赛的总数。</li><li id="d44b" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">for n, box in enumerate(odds_events)</code>循环一场比赛中的所有“赔率箱”。开始时，我们把下拉列表改成了“三向”、“超/欠”和“两队得分”，所以它们是我们能获得的赔率</li><li id="fbf1" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">rows = box.find_elements_by_xpath('.//*') </code>给出box元素内的所有子节点(odds)。</li><li id="51e5" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">n==0 </code>表示“仅从第一个框中取值”在这种情况下，第一个盒子是“3路”盒子，存储在<code class="fe me mf mg mh b">x12</code>列表中</li><li id="6bc1" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">rows[0] </code>告诉Python“只选择每个赔率框的第一行。”这样，我们忽略了双行事件中的第二行。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/a087f19acdbf04fb9873cd65d0026ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*jdzkn7GzJZt4kjc9qdmmiw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Goal-line Image by author</figcaption></figure><p id="fafd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe me mf mg mh b">n==1</code>(超额/不足)和<code class="fe me mf mg mh b">n==2</code> (BTTS)遵循相同的过程，但是在<code class="fe me mf mg mh b">n==1</code>中，我们还需要存储“<strong class="lb iu">目标行</strong>”这代表您赢得赌注所需的目标总数。</p><p id="69a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，超过2.5个目标意味着至少3个目标才能赢得赌注。让我们来分解一下<code class="fe me mf mg mh b">n==1.</code>的代码</p><ul class=""><li id="8e65" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">box.find_element_by_xpath('./..')</code>给出包含赔率的box元素的“父节点”。</li><li id="dfe8" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">goals = parent.find_element_by_class_name('EventOddGroup-styles-fixed-param-text').text </code>通过给出目标线的类名找到目标线。只需右击并检查目标线(如上图所示)即可获得其类名。然后我们用<code class="fe me mf mg mh b">.text</code>获取数据</li><li id="dc20" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">over_under.append(goals+'\n'+rows[0].text)</code>以标准格式附加目标行数据。超额/不足赔率格式将如下所示<code class="fe me mf mg mh b">2.5\n2.4\n1.5</code></li><li id="d9fe" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">关闭Chrome浏览器</li></ul><p id="78aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">至此，刮削部分完成！</strong>现在我们必须使数据可读，并对熊猫进行一些预清理。然后我们用Pickle保存数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="ef4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="4a95" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">dict_gambling </code>存储所有包含赔率的列表的字典是否被删除</li><li id="3293" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">pd.DataFrame.from_dict(dict_gambling) </code>把字典变成一个数据框架<code class="fe me mf mg mh b">df_tipico,</code>，这样我们就可以轻松地阅读和使用它</li><li id="3801" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">df_tipico.applymap(lambda x: x.strip() if isinstance(x, str) else x)</code>使用<code class="fe me mf mg mh b">strip </code>方法清除所有前导和尾随空格。</li><li id="b5ba" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">open('...', 'wb') </code>在“写入字节”(wb)模式下打开一个名为<code class="fe me mf mg mh b">df_tipico </code>的文件。我们将它保存在变量<code class="fe me mf mg mh b">output</code>中</li><li id="2634" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">pickle.dump(df_tipico, output) </code>保存在名为<code class="fe me mf mg mh b">df_tipico. </code>的文件中创建的数据帧。我们对文件和数据帧使用了相同的名称，但它们可以有不同的名称</li><li id="3ab5" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">output.close()</code>关闭文件</li></ul><p id="00c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了！我们刮完了第一个庄家。庄家2和3比较好刮。博彩公司1、2、3的完整代码在本文末尾。</p><p id="5c63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们用获得的数据自动找到一个可靠的赌注！</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="db6f" class="no np it bd nq nr ns nt nu nv nw nx ny jz nz ka oa kc ob kd oc kf od kg oe of bi translated">第2、3和4部分</h1><p id="e38e" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">从现在开始，我们将从另一个开始。py文件来收集和处理从博彩公司1、2和3收集的投注数据。在这个文件中，我们将导入以下库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="c355" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">子进程让我们并行运行脚本；也就是我们可以同时刮庄家1，2，3。Pickle让我们在每个书签中加载数据抓取；熊猫帮助我们清理和转换数据，FuzzyWuzzy匹配团队名称所需的字符串。</p><p id="6c3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我们涉猎了不同的博彩市场，但为了简单起见，我们将只关注“两队得分”(BTTS)市场。如果你愿意，你可以跟随任何其他市场。过程类似。</p><h1 id="3eaa" class="no np it bd nq nr ou nt nu nv ov nx ny jz ow ka oa kc ox kd oc kf oy kg oe of bi translated">2.<strong class="ak">清理和转换熊猫的实时赔率数据</strong></h1><p id="d6fd" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">正如我们之前提到的，暂停赔率要么被锁定，要么为空。当它们被<strong class="lb iu">锁定时，像<code class="fe me mf mg mh b">‘’</code>这样的</strong>空值将被清除，这不同于<strong class="lb iu">空值</strong>几率，空值不会给出任何值，并且会改变其他数据(这就是我们之前删除它的原因)</p><p id="d8d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">BTTS有两种可能的结果，所以赔率看起来像这样<code class="fe me mf mg mh b">1.8\n1.7.</code>由于这个原因，我们需要将每个锁定的赔率<code class="fe me mf mg mh b">‘’ </code>格式化为没有值的常规赔率<code class="fe me mf mg mh b">‘0\n0’.</code></p><p id="f894" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，偶尔，一种结果的几率很大，而另一种结果的几率很小，可能根本不会出现。它们看起来像这样的<code class="fe me mf mg mh b">40\n </code>，相当于<code class="fe me mf mg mh b">40\n1.01</code>在那种情况下，我们永远也找不到确定的赌注，所以我们需要把它们再次转换成<code class="fe me mf mg mh b">‘0\n0’ </code>我们用下面的代码来做这件事:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="f436" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="d38b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">pickle.load(open('df_tipico','rb'))</code>加载在第1部分创建的数据帧<code class="fe me mf mg mh b">df_tipico </code></li><li id="a162" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">df_tipico[['Teams', 'btts']] </code>选择我们将在本次分析中重点关注的2列</li><li id="e10d" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">df_tipico.replace(r'', '0\n0', regex=True) </code>将锁定的赔率变为<code class="fe me mf mg mh b">‘0\n0’</code></li><li id="aaba" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">df_tipico.replace(r'^\d+\.\d+$', '0\n0', regex=True) </code>把<code class="fe me mf mg mh b">40\n </code>这样的巨大赔率变成<code class="fe me mf mg mh b">‘0\n0’. </code>我们使用正则表达式来捕捉这些赔率的模式。</li></ul><p id="e7db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们为3个数据帧中的数据给出了相同的格式。</p><h1 id="fe02" class="no np it bd nq nr ou nt nu nv ov nx ny jz ow ka oa kc ox kd oc kf oy kg oe of bi translated">3.用Fuzzywuzzy进行字符串匹配</h1><p id="41b1" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">博彩公司通常不同意球队的名字。为了匹配看起来相似的队名，我们使用Fuzzywuzzy。这给出了一个介于1和100之间的分数，告诉我们两个名字有多相似。</p><p id="f5ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将用60作为考虑两个名字相同所需的最低分数。然而，有时这仍然可能匹配不同的团队。一旦确定无疑，用你的常识看看这两个队是不是真的一样。</p><p id="95ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在匹配字符串之后，我们合并数据帧，所以我们稍后寻找surebets。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="5abe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="acfc" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">df_tipico['Teams'].tolist()</code>将一个数组转换成一个名为<code class="fe me mf mg mh b">teams_1</code>的列表</li><li id="d19f" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">process.extractOne(x, teams_2, scorer=fuzz.token_set_ratio </code>将队伍名称<code class="fe me mf mg mh b">x</code>与带有名称<code class="fe me mf mg mh b">teams_2 </code>的列表进行比较，并给出两个输出:与队伍名称<code class="fe me mf mg mh b">x </code>最相似的<code class="fe me mf mg mh b">teams_2</code>中的名称及其得分</li><li id="a7bc" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">df_tipico['Teams'].apply(lambda x:process.extractOne(x, teams_2, scorer=fuzz.token_set_ratio)) </code>将前面的公式应用于数组的每一行<code class="fe me mf mg mh b">df_tipico[‘Teams']</code></li><li id="b327" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">.apply(pd.Series) </code>将2路输出转换成分配给各列的数据帧<code class="fe me mf mg mh b">df_tipico[[‘Teams_matched_bwin’, ‘Score_bwin’]]</code></li><li id="4229" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">pd.merge(df_tipico, df_bwin, left_on='Teams_matched_bwin', right_on='Teams') </code>使用团队名称作为关键字合并2个数据帧</li><li id="fa18" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">df _ sure bet[df _ sure bet[' Score _ bwin ']&gt; 60]过滤掉低于60的分数</li><li id="dafa" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">df_surebet[['Teams_x', 'btts_x', 'Teams_y', 'btts_y']] </code>选择我们稍后将使用的特定列</li></ul><p id="b438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3家博彩公司的字符串匹配是相同的。我们需要结成对子，以便以后找到可靠的赌注。对子是赌注1-赌注2、赌注1-赌注3和赌注2-赌注3。</p><h1 id="9b4a" class="no np it bd nq nr ou nt nu nv ov nx ny jz ow ka oa kc ox kd oc kf oy kg oe of bi translated">4.<strong class="ak">寻找确定的赌注并计算赌注</strong></h1><p id="df8f" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">为了找到确定的赌注并计算赌注，我们将使用两个公式。公式如下所示。如果你想知道我是如何得出这些公式的，可以看看这篇文章。</p><h2 id="712d" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">寻找确定的赌注</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="ba77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解公式<code class="fe me mf mg mh b">find_surebets</code>:</p><ul class=""><li id="0217" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">frame[['btts_x_1', 'btts_x_2']] = frame['btts_x'].apply(lambda x: x.split('\n')).apply(pd.Series).astype(float)</code>将几率分成两部分。第一个存储在列'<code class="fe me mf mg mh b">btts_x_1' </code>中，第二个存储在'<code class="fe me mf mg mh b">btts_x_2'. </code>中，这两个列都是在我们应用公式时创建的</li><li id="21e1" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">(1 / frame['btts_x_1']) + (1 / frame['btts_y_2']) </code>是求surebets的公式。您也可以在一对赔率<code class="fe me mf mg mh b">btts_x_2 </code>和<code class="fe me mf mg mh b">btts_y_1</code>中找到surebets</li><li id="28d6" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">frame[(frame['sure_btts1'] &lt; 1) | (frame['sure_btts2'] &lt; 1)] </code>只选择结果小于1的匹配，这是surebet的一个要求。<code class="fe me mf mg mh b">‘|’ </code>符号是一个“或”条件。</li><li id="4602" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">frame.reset_index(drop=True, inplace=True) </code>重置索引。我们需要它来识别代码找到的匹配项。</li></ul><p id="e279" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做之后，我们用<code class="fe me mf mg mh b">find_surebet('...')</code>将公式应用于每个庄家的数据框架。最后，帧被存储在字典中<code class="fe me mf mg mh b">dict_surebet.</code></p><h2 id="c645" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">计算赌注</h2><p id="d6c2" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">我们将把公式<code class="fe me mf mg mh b">beat_bookies</code>应用到字典的每个元素<code class="fe me mf mg mh b">dict_surebet .</code>中，这样做是为了找到下注所需的赌注和我们将获得的利润。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="154a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="3897" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated"><code class="fe me mf mg mh b">total_stake </code>是您在每场游戏中愿意下注的总金额。你必须确定适合你的数量。在这个例子中，我选择了100</li><li id="a713" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">for frame in dict_surebet </code>遍历我们搜到的所有赌博公司的框架</li><li id="c571" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">if len(dict_surebet[frame])&gt;=1: </code>过滤掉没有找到任何确定的帧</li><li id="16e8" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">for i, value in enumerate(dict_surebet[frame]['sure_btts1']): </code>循环遍历数据帧内的列'<code class="fe me mf mg mh b">sure_btts1'</code>'的每一行。<code class="fe me mf mg mh b">enumerate </code>给出两个输出:迭代次数<code class="fe me mf mg mh b">i</code>和行的<code class="fe me mf mg mh b">value</code>。我们需要<code class="fe me mf mg mh b">i </code>来标识surebet被发现的几率和团队名称(<code class="fe me mf mg mh b">i </code>相当于dataframe的索引)</li><li id="4228" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">if value&lt;1 </code>过滤掉<code class="fe me mf mg mh b">‘sure_btts1’</code>或<code class="fe me mf mg mh b">‘sure_btts2’</code>中的非确定赌注</li><li id="9b71" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">odds1 =float(dict_surebet[frame].at[i, 'btts_x'].split('\n')[0]) </code>借助<code class="fe me mf mg mh b"> .at</code>方法和索引<code class="fe me mf mg mh b">i</code>找到第一个赔率。由于赔率是成对的，我们必须将它们分开，然后通过<code class="fe me mf mg mh b">[0] </code>或<code class="fe me mf mg mh b"> [1]. </code>选择我们想要的一个。之后，我们确保获得的结果是一个带有<code class="fe me mf mg mh b">float</code>的数字</li><li id="9ec4" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">teams = dict_surebet[frame].at[i, 'Teams_x'].split('\n') </code>通过<code class="fe me mf mg mh b"> .at</code>方法和索引<code class="fe me mf mg mh b">i</code>找到队伍名称。当我们打印球队名称时，我们不需要<code class="fe me mf mg mh b">‘\n’</code>，所以我们用<code class="fe me mf mg mh b">split</code>去掉它们</li><li id="9e69" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">dict_1 = beat_bookies(odds1, odds2, total_stake)</code>将公式<code class="fe me mf mg mh b">beat_bookies </code>应用于我们找到的surebet。该公式返回字典</li><li id="0c64" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated"><code class="fe me mf mg mh b">print(str(i)+' '+'-'.join(teams)+ ' ----&gt; '+ ' '.join('{}:{}'.format(x, y) for x,y in dict_1.items()))</code>打印所有必要的数据，无论结果如何，都能获利。<code class="fe me mf mg mh b">.item()</code>解包所创建的字典中的元素。我们循环遍历元素，并以特定的格式打印它们</li></ul><p id="c246" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您可以在我们从第2部分开始工作的文件的开头添加此代码，以同时收集3个赌注登记经纪人:</p><pre class="kj kk kl km gt ol mh om on aw oo bi"><span id="2d36" class="op np it mh b gy oq or l os ot">subprocess.run("python3 bookie1_tipico_live.py &amp; python3 bookie2_bwin_live.py &amp; python3 bookie3_betfair_live.py &amp; wait", shell=True)</span></pre><p id="8fa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一段代码在Mac上运行。但是，Windows似乎有一个问题。如果它在Windows上对你有效，请告诉我。</p><p id="97b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝贺你！现在你可以在任何一家赌场找到可靠的赌注了！下面你有一个关于如何自动化这个脚本的教程，还有我们处理的2个文件的完整代码(code bookier 1+来自第2、3、4部分的代码)以及bookmaker 2和bookmaker 3的完整代码。</p><h2 id="d60c" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">最后一步:自动化Python脚本</h2><p id="8823" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">本教程的最后一步是自动化Python脚本，因此您可以每天、每周或在特定时间运行它。这里有一个关于如何通过3个简单的步骤在Mac和Windows上自动化Python脚本的教程。</p><div class="mn mo gp gr mp mq"><a href="https://towardsdatascience.com/how-to-easily-automate-your-python-scripts-on-mac-and-windows-459388c9cc94" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">如何在Mac和Windows上轻松自动化您的Python脚本</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">使用crontab和任务调度器来自动化您的脚本并节省时间</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">towardsdatascience.com</p></div></div><div class="mz l"><div class="pr l nb nc nd mz ne ks mq"/></div></div></a></div></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="6b93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想在不被屏蔽的情况下浏览网站，请查看这篇文章:</p><div class="mn mo gp gr mp mq"><a href="https://medium.com/datadriveninvestor/3-simple-ways-for-web-scraping-without-getting-blocked-34f3b1f885d1" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">3个简单的方法来抓取网页而不被阻塞</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">防刮擦机构操作指南。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="ps l nb nc nd mz ne ks mq"/></div></div></a></div><h1 id="96f6" class="no np it bd nq nr ou nt nu nv ov nx ny jz ow ka oa kc ox kd oc kf oy kg oe of bi translated">3个博彩公司的完整代码</h1><p id="53e4" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">在运行代码之前，请务必阅读下面的注释。</p><h2 id="0952" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">庄家1</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="fcac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意事项:</p><ul class=""><li id="50e5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated">在选项1或2之间切换，以防点击cookies横幅出现问题。</li></ul><h2 id="40dd" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">庄家2</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="8803" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">庄家3</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="74ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意事项:</p><ul class=""><li id="c0a1" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated">在选项1或2之间切换，以防点击cookies横幅出现问题。</li><li id="6b68" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">在评论“选择任何市场”下面，完全按照你的浏览器显示的那样写下市场。市场的名称可能会因浏览器的语言而改变。只需键入浏览器中显示的市场名称，或者通过检查元素来复制它。</li><li id="f827" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu pm mb mc md bi translated">在第66行，你必须找到“暂停赔率”是如何用博彩网站的语言书写的。将单词“Suspedido”更改为浏览器语言中的等效单词。</li></ul></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="fb4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你想知道更多关于如何击败庄家吗？如果有，看看我写的这篇文章:</p><div class="mn mo gp gr mp mq"><a href="https://medium.com/datadriveninvestor/can-we-beat-the-bookies-predicting-football-games-with-a-simple-model-43fe020fb384" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">我们能打败庄家吗？用简单模型预测足球比赛</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">预测英超、西甲、意甲和德甲的足球比赛结果。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="pt l nb nc nd mz ne ks mq"/></div></div></a></div><div class="mn mo gp gr mp mq"><a href="https://medium.com/@fg.andrade95/4-things-i-wish-i-knew-when-i-started-sports-betting-88f1e4ee56e5" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">开始体育博彩时我希望知道的4件事</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">以正确的方式开始您的赌博之旅。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="pu l nb nc nd mz ne ks mq"/></div></div></a></div><h2 id="0de8" class="op np it bd nq oz pa dn nu pb pc dp ny li pd pe oa lm pf pg oc lq ph pi oe pj bi translated">寻找并计算庄家1、2和3之间的保证赌注</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="f796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:</p><ul class=""><li id="bcba" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu pm mb mc md bi translated">第12行<code class="fe me mf mg mh b">'subprocess'</code>在Mac上并行运行多个进程。验证它是否在Windows上工作。</li></ul><h1 id="125b" class="no np it bd nq nr ou nt nu nv ov nx ny jz ow ka oa kc ox kd oc kf oy kg oe of bi translated">最后一个音符</h1><p id="91cf" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">现在你可以在3家博彩公司找到确定的赌注。这是一个很长的教程，但完全值得！如果有些解释不清楚，请告诉我。我很乐意澄清任何概念。</p></div></div>    
</body>
</html>