<html>
<head>
<title>SLS Machine Learning Best Practices: Similarity Analysis for Time Series</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SLS机器学习最佳实践:时间序列的相似性分析</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/sls-machine-learning-best-practices-similarity-analysis-for-time-series-6946f1e24a21?source=collection_archive---------11-----------------------#2020-12-14">https://medium.datadriveninvestor.com/sls-machine-learning-best-practices-similarity-analysis-for-time-series-6946f1e24a21?source=collection_archive---------11-----------------------#2020-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/356757e8e556baf13e93813a920b6240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*ftgGA3v_VQZYeoGa.png"/></div></figure><p id="3000" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://www.alibabacloud.com/product/log-service" rel="noopener ugc nofollow" target="_blank">阿里云日志服务</a> (SLS)为DevOps和AIOps提供了一系列工具，涵盖了异常检测、时序聚类、时序预测等方法。为了使服务更容易访问，我们已经将我们的算法集成到SQL中，以便以最低的成本进行相关的配置。本文介绍了时间序列聚类和相关性分析的最佳实践。</p><h1 id="c644" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">1)场景</h1><p id="cb14" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">本文涵盖了时间序列相似性分析的几个有用的函数，包括使用<a class="ae ks" href="https://www.alibabacloud.com/product/log-service" rel="noopener ugc nofollow" target="_blank">日志服务</a>的时间序列聚类和相似性计算。这些功能适用于以下情况:</p><ul class=""><li id="24a3" class="lw lx iq jw b jx jy kb kc kf ly kj lz kn ma kr mb mc md me bi translated">当我们有n台机器的指标数据，并希望快速找出一段时间内的CPU使用情况，以便更好地了解当前的系统状态时。</li><li id="68c1" class="lw lx iq jw b jx mf kb mg kf mh kj mi kn mj kr mb mc md me bi translated">当我们为一台机器指定一个度量的曲线，并想知道哪些机器对于指定的度量有相似的曲线时。</li><li id="6d97" class="lw lx iq jw b jx mf kb mg kf mh kj mi kn mj kr mb mc md me bi translated">当我们手动输入时间序列曲线(网站的访问延迟曲线)并想要确定哪个服务具有相似的访问延迟变化曲线以缩小故障排除范围时。</li></ul><p id="4311" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">前面的场景归结为两个方面:时间序列聚类(按形状和按值)和时间序列相似性的确定。</p><h1 id="37f1" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">2)描述</h1><p id="0499" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">SLS平台提供了两个功能。查看<a class="ae ks" href="https://www.alibabacloud.com/help/doc-detail/93235.htm" rel="noopener ugc nofollow" target="_blank">文档页面</a>了解更多详情。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="b0be" class="mt ku iq mp b gy mu mv l mw mx">ts_density_cluster<br/>ts_hierarchical_cluster</span></pre><p id="6545" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第一个功能目标是基于曲线形状的聚类，其底层核心聚类算法是基于密度的聚类(DBSCAN)算法。第二个函数的目标是基于原始曲线之间的相似性进行聚类，更强调曲线之间的欧几里德距离等因素。它的底层核心聚类算法是层次聚类算法。有关这些函数如何工作的更多信息，请参阅我以前的文章，或者在线搜索相关信息。以下部分描述了如何在SLS中使用这些功能。</p><h1 id="9f8c" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">3)案例研究</h1><h2 id="feec" class="mt ku iq bd kv my mz dn kz na nb dp ld kf nc nd lh kj ne nf ll kn ng nh lp ni bi translated">3.1)数据探索</h2><ul class=""><li id="9ba8" class="lw lx iq jw b jx lr kb ls kf nj kj nk kn nl kr mb mc md me bi translated">查询-01</li></ul><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="a83f" class="mt ku iq mp b gy mu mv l mw mx">* | select DISTINCT index_name, machine, region from log</span></pre><ul class=""><li id="94eb" class="lw lx iq jw b jx jy kb kc kf ly kj lz kn ma kr mb mc md me bi translated">查询-02</li></ul><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="989c" class="mt ku iq mp b gy mu mv l mw mx">* | select count(1) as num from (select DISTINCT index_name, machine, region from log)</span></pre><ul class=""><li id="0e26" class="lw lx iq jw b jx jy kb kc kf ly kj lz kn ma kr mb mc md me bi translated">查询-03</li></ul><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="01ca" class="mt ku iq mp b gy mu mv l mw mx">* and index_name : load | <br/>select <br/>  __time__, <br/>  value, <br/>  concat(<br/>    region, '#', machine, '#', index_name<br/>  ) as ins <br/>from log order by __time__ <br/>limit 10000</span></pre><ul class=""><li id="e05f" class="lw lx iq jw b jx jy kb kc kf ly kj lz kn ma kr mb mc md me bi translated">查询-04</li></ul><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="450a" class="mt ku iq mp b gy mu mv l mw mx">* <br/>and index_name : load | <br/>select <br/>  date_trunc('minute', __time__) as time, <br/>  region, <br/>  avg(value) as value <br/>from log group by time, region order by time limit 1000</span></pre><p id="7050" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过执行query01，我们获得了以下信息，这些信息表明了当前Logstore中包含的不同曲线的数量以及每条曲线的标识符。为了更好地观察1300条曲线，我们使用了流程图。然而，在一个图表中绘制所有这些曲线会消耗大量的浏览器资源，即使生成了图表，也很难从图表中获得洞察力。我们使用query04来观察一些曲线的可视化效果，并将它们的视觉效果与query03的效果进行比较。</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/23f3da4255bba91395554bbee9e78edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x10eov3YFYWkwgmf.jpeg"/></div></div></figure><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/1fd1e5ef7ed6e2a8061b007d09044799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M1_cdCYaxSdAFzFB.jpeg"/></div></div></figure><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/d7c4108262fcc360593ff6873f06f7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UdgPeaMoIPo05Ex1.jpeg"/></div></div></figure><h2 id="e2d0" class="mt ku iq bd kv my mz dn kz na nb dp ld kf nc nd lh kj ne nf ll kn ng nh lp ni bi translated">3.2)集群实践</h2><p id="7b56" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">根据前面的观察，我们是否可以将一些曲线进行聚类，并将相似的曲线分组，以减少可视化分析的维度？</p><div class="nr ns gp gr nt nu"><a href="https://www.datadriveninvestor.com/2020/11/19/how-machine-learning-and-artificial-intelligence-changing-the-face-of-ecommerce/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">机器学习和人工智能如何改变电子商务的面貌？|数据驱动…</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">电子商务开发公司，现在，整合先进的客户体验到一个新的水平…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="od l"><div class="oe l of og oh od oi js nu"/></div></div></a></div><p id="339d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以下SQL语句支持快速曲线聚类。在本例中，选择的指标是机器负载，因为我们想知道不同机器的使用情况如何变化。为此，我们使用<code class="fe oj ok ol mp b">ts_hierarchical_cluster</code>函数得到一个刻面图。为了使图表更直观，将其存储在仪表板中。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="300b" class="mt ku iq mp b gy mu mv l mw mx">* <br/>and index_name : load | <br/>select <br/>  ts_hierarchical_cluster(time, value, ins) <br/>from <br/>  (<br/>    select <br/>      __time__ as time, <br/>      value, <br/>      concat(<br/>        region, '#', machine, '#', index_name<br/>      ) as ins <br/>    from <br/>      log<br/>  )</span></pre><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/390e43ae68810b0cabc7d4260b4ca08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zVfJfMIF_supOBYl.jpeg"/></div></div></figure><h2 id="ecd4" class="mt ku iq bd kv my mz dn kz na nb dp ld kf nc nd lh kj ne nf ll kn ng nh lp ni bi translated">3.3)相似性查询</h2><p id="c127" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">通过执行下面的SQL语句，我们得到一个具有与<code class="fe oj ok ol mp b">aysls-pub-cn-beijing-k8s#192.168.7.254:9100#load</code>相似度量曲线的机器列表，并使用下面的流程图来可视化结果。相似性函数提供的用于确定相似性的选项包括形状、曼哈顿和欧几里德。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="c4cc" class="mt ku iq mp b gy mu mv l mw mx">* <br/>and index_name : load | <br/>select <br/>  cast(<br/>    cast(ts_value as double) as bigint<br/>  ) as ts_value, <br/>  cast(ds_value as double) as ds_value, <br/>  name <br/>from <br/>  (<br/>    select <br/>      tt[1][1] as name, <br/>      tt[2] as ts, <br/>      tt[3] as ds <br/>    from <br/>      (<br/>        select <br/>          ts_similar_instance(<br/>            time, value, ins, 'aysls-pub-cn-beijing-k8s#192.168.7.254:9100#load', <br/>            10,<br/>            'euclidean'<br/>          ) as res <br/>        from <br/>          (<br/>            select <br/>              __time__ as time, <br/>              value, <br/>              concat(<br/>                region, '#', machine, '#', index_name<br/>              ) as ins <br/>            from <br/>              log<br/>          )<br/>      ), <br/>      unnest(res) as t(tt)<br/>  ), <br/>  unnest(ts) as t(ts_value), <br/>  unnest(ds) as t(ds_value) <br/>order by <br/>  ts_value <br/>limit <br/>  10000</span></pre><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/41f09b14a8dc7d9c9df2c37104300a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZZmJmTNnV7NcsyOh.jpeg"/></div></div></figure><h1 id="c8ad" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">原始来源:</h1><div class="nr ns gp gr nt nu"><a href="https://www.alibabacloud.com/blog/sls-machine-learning-best-practices-similarity-analysis-for-time-series_596957" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">SLS机器学习最佳实践:时间序列的相似性分析</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk">悟冥 December 2, 2020 65 Alibaba Cloud Log Service (SLS) provides a series of tools for DevOps and AIOps, which cover…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">www.alibabacloud.com</p></div></div><div class="od l"><div class="om l of og oh od oi js nu"/></div></div></a></div><h2 id="bd4d" class="mt ku iq bd kv my mz dn kz na nb dp ld kf nc nd lh kj ne nf ll kn ng nh lp ni bi translated">获得专家视图— <a class="ae ks" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank">订阅DDI英特尔</a></h2></div></div>    
</body>
</html>