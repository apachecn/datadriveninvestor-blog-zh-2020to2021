<html>
<head>
<title>Using Analytics in Equity Investing — Understanding Philippines’ Property Stocks Through Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在股票投资中使用分析——通过分析了解菲律宾的房地产股票</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/using-analytics-in-equity-investing-understanding-philippines-property-stocks-through-analytics-32f30db638ed?source=collection_archive---------4-----------------------#2020-11-14">https://medium.datadriveninvestor.com/using-analytics-in-equity-investing-understanding-philippines-property-stocks-through-analytics-32f30db638ed?source=collection_archive---------4-----------------------#2020-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="3e14" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">菲律宾。金融分析。股票。房地产。</h2><div class=""/><div class=""><h2 id="d2b1" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Python和Fastquant包访问菲律宾股票数据</h2></div><p id="a106" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在本文中，我将尝试结合房地产、数据科学和金融这三个不同的领域。这将是一项艰巨的任务，我们需要确保我们这样做的方式，以加强所有这些领域的写作。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/73a978cfbd9c5b17f5d1e33d1dce41cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f-HeAoimotsrQlW_CxYerw.jpeg"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk">Photo by<a class="ae md" href="https://unsplash.com/@precondo" rel="noopener ugc nofollow" target="_blank"> Precondo CA</a> at <a class="ae md" href="https://unsplash.com/photos/OlSGcrLSYkw" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="43b1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为此，我们将使用fastquant包。Fastquant是由一组菲律宾开发人员开发的软件包。我对此感到非常自豪，这证明了我一直以来的想法:我们并不缺乏人才。所以让我们都来支持我们的菲律宾同胞，使用这个包！</p><p id="53f8" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">首先，我们需要导入fastquant。要安装它，只需输入你的powershell ( <em class="me">我用的是Windows </em>)。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="960d" class="mk ml it mg b gy mm mn l mo mp">pip install fastquant</span></pre><p id="991c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">之后，我们导入以下包:</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="b306" class="mk ml it mg b gy mm mn l mo mp">from fastquant import get_stock_data, get_stock_table<br/>import pandas as pd<br/>import numpy as np</span><span id="1b6a" class="mk ml it mg b gy mq mn l mo mp">#For Visualization<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline</span></pre><p id="1d16" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><em class="me"> get_stock_data </em>方法允许我们获取在菲律宾证券交易所上市的所有股票。它返回一个数据帧，然后我们可以使用pandas来操作它。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="2474" class="mk ml it mg b gy mm mn l mo mp">stocks = get_stock_table()</span></pre><p id="ab23" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为了只选择“地产股”，我们需要从股票表中过滤它。通过选择“扇区”==“属性”来分割数据帧。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="6c9f" class="mk ml it mg b gy mm mn l mo mp">property_stocks = stocks[stocks.Sector == "Property"]["Stock Symbol"].values</span></pre><p id="f006" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">确认你拥有的是地产股。</p><p id="fd4b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">令人惊讶的是，由于这一数据来自菲律宾证券交易所，AREIT ( <em class="me">最近上市的房地产投资信托基金</em>)已经包括在内。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="cb11" class="mk ml it mg b gy mm mn l mo mp">property_stocks</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mr"><img src="../Images/ca759dda750ec8710c1834e036362be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*b8E-eIh4jLUcNQpSaGp-Cw.png"/></div></div></figure><h1 id="f65f" class="ms ml it bd mt mu mv mw mx my mz na nb ki nc kj nd kl ne km nf ko ng kp nh ni bi translated"><strong class="ak">股票速成班测试版</strong></h1><p id="b34c" class="pw-post-body-paragraph kr ks it kt b ku nj kd kw kx nk kg kz la nl lc ld le nm lg lh li nn lk ll lm im bi translated">现在，让我们下载一些股票价格信息，并用它来计算贝塔系数。</p><p id="06e3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">股票贝塔揭示了股票对经济波动的敏感程度。贝塔系数为1意味着股票的走势与经济完全相关，如果经济增长5%，股票价格预计会增长5%。</p><p id="9258" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">小于一(1)的贝塔系数意味着股票受经济变化的影响较小(<em class="me">在这种情况下，我们指的是整个股票市场，它被用作经济的衡量标准，尽管并不完美</em>)。</p><p id="0798" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果菲律宾股市增长了10%，那只股票的增长不到10%。这样做的好处是，如果股市下跌10%，那只股票的跌幅小于10%。通常，我们称这些股票为“防御性股票”。它们尤其为减缓经济增长提供了很好的防御。公用事业、医疗保健和消费品等行业属于这一类。</p><p id="0735" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">对于贝塔系数大于1的股票，我们称之为“周期性”股票。因为它们往往随着菲律宾股市的整体涨跌而波动。如果股市增长10%，这些股票升值超过10%。</p><p id="05bc" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">计算贝塔</strong></p><p id="e16e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">计算贝塔的过程需要你得到两件事:股票收益的方差，股票收益和菲律宾股市收益的协方差。</p><p id="b13c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">对于时间段:理想情况下，<strong class="kt jd">我们想要一个覆盖整个商业周期的时间段</strong>。这意味着一个时期有扩张和衰退的子周期。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi no"><img src="../Images/080ed9eac1e64271d12f30bfca67cd74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JOnaho2TNwt_RyZi-eE6kA.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk">Taken from capital.com</figcaption></figure><p id="945c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">理想情况下，贝塔捕捉股票回报在所有时期如何随市场变动。</p><p id="8cd3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">虽然专业人士对此有不同的偏好，但我们可以说，2010年，世界正在从全球金融危机中复苏，到2020年，新冠肺炎标志着另一个衰退时期，我们完成了一个周期。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="2c72" class="mk ml it mg b gy mm mn l mo mp">#Ensure that the trading date is earlier than current date. You can choose an earlier date</span><span id="7d69" class="mk ml it mg b gy mq mn l mo mp">START_DATE = "2010-10-02"<br/>END_DATE = "2020-10-02"</span><span id="9f95" class="mk ml it mg b gy mq mn l mo mp">property_df = pd.DataFrame()<br/>for stock in property_stocks:<br/>    try:<br/>        df_ = get_stock_data(stock, START_DATE, END_DATE)<br/>    except:<br/>        continue<br/>    df_.columns = [stock]<br/>    property_df = pd.concat([property_df, df_], axis=1)</span></pre><p id="22c9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">fastquant包的未来开发将包括访问PSEI值的能力。现在，出于本练习的目的，让我们使用从第三方收集的信息。该文件可以从<a class="ae md" href="https://github.com/francisadrianviernes/Financial-Analytics/tree/master/Understanding%20Philippines'%20Property%20Stocks%20Through%20Analytics" rel="noopener ugc nofollow" target="_blank">我的Github页面</a>访问。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="3422" class="mk ml it mg b gy mm mn l mo mp">psei = pd.read_excel('data/PSEI.xlsx', index_col=0)</span><span id="2693" class="mk ml it mg b gy mq mn l mo mp">#Merge the two databases on similar indices, in this case, it is the datetime index.<br/>merged = psei.merge(property_df, on='dt')</span></pre><p id="befc" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">贝塔公式</strong></p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi np"><img src="../Images/994c8d50f2c305d981082517e9f6eb94.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/1*bq-p0VLc0BR6JYb7K0VnOg.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk">where 𝑟𝑖 refers to the returns of stock i and 𝑟𝑚 refers to the market returns represented by PSEi returns.</figcaption></figure><p id="4d39" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">幸运的是，<em class="me"> pandas </em>有一个内置的方法，可以简单地应用我们之前的公式。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="273a" class="mk ml it mg b gy mm mn l mo mp">#Calculate the returns<br/>ph_stocks_returns = merged.pct_change()</span><span id="4662" class="mk ml it mg b gy mq mn l mo mp">#This formulation returns a matrix object (similar to correlation matrix)<br/>beta_df = ph_stocks_returns.cov()/ph_stocks_returns.var()</span><span id="c4c0" class="mk ml it mg b gy mq mn l mo mp">#unstack would turn this into a series<br/>beta_df = beta_df.unstack()['PSEI'].to_frame()</span><span id="4bc0" class="mk ml it mg b gy mq mn l mo mp">#We reset the index because we plan to label the plot later. Labeling is easier with an integer index.<br/>beta_df = beta_df.reset_index()<br/>beta_df.columns = ['Stock','Beta']</span></pre><p id="b4c6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">将结果可视化</strong></p><p id="806f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在我们已经有了测试表，让我们可视化，看看我们是否能从可视化中获得洞察力。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="54fb" class="mk ml it mg b gy mm mn l mo mp">plt.figure(figsize=(12,12))<br/>ax = sns.scatterplot(x=beta_df.index, y=beta_df.Beta);</span><span id="78b3" class="mk ml it mg b gy mq mn l mo mp">ax.set_title('Beta Values for PSEi Property Stocks',<br/>            fontweight = 'heavy',<br/>            fontsize = 14)</span><span id="059f" class="mk ml it mg b gy mq mn l mo mp">#Drawing a horizontal line where the PSEI lies<br/>ax.axhline(1, c = 'red');</span><span id="5704" class="mk ml it mg b gy mq mn l mo mp">#Text<br/>ax.axes.get_xaxis().set_visible(False);<br/>texts = [ax.text(p[0], p[1]+.005,beta_df.loc[p[0], 'Stock']) for p in zip(beta_df.index, beta_df.Beta)];</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nq"><img src="../Images/a51791e3a933fc97f852a7618c2ee595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6abIqqSEXpxSjTQ0Svf-Rg.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk">Beta for PH Property Stocks</figcaption></figure><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/63c64952eed20a83e46584893178a909.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/format:webp/1*mL8yOhFTvd9dNIPgeo_4XQ.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk">Calculated Betas for PH Property Stocks</figcaption></figure><p id="018e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">计算β的第二种方法</strong></p><p id="5553" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">另一种获得股票贝塔系数的方法是做线性回归，目标值是股票的回报，因变量是PSEi的回报。</p><pre class="lo lp lq lr gt mf mg mh mi aw mj bi"><span id="11e1" class="mk ml it mg b gy mm mn l mo mp">from sklearn import linear_model</span><span id="bb19" class="mk ml it mg b gy mq mn l mo mp">#Create an empty dataframe to store our values<br/>regression_beta = pd.DataFrame(columns=['Stock', 'Beta'])</span><span id="b857" class="mk ml it mg b gy mq mn l mo mp">#list of stocks<br/>tickers = ph_stocks_return.columns.to_list()</span><span id="5f95" class="mk ml it mg b gy mq mn l mo mp">#Call on the method<br/>linear_regression = linear_model.LinearRegression()</span><span id="305b" class="mk ml it mg b gy mq mn l mo mp">#before calling fitting on the regression, ensure that the nan values are filled with "0"<br/>regression_df = ph_stocks_return.fillna(0)</span><span id="84c2" class="mk ml it mg b gy mq mn l mo mp">X = regression_df.loc[:,'PSEI'].values.reshape(-1, 1)<br/>for i in tickers:<br/>    y = regression_df.loc[:,i].values.reshape(-1, 1)<br/>    linear_regression.fit(X,y)<br/>    regression_beta.loc[len(regression_beta)] = [i,round(linear_regression.coef_[0][0],2)]<br/>regression_beta</span></pre><p id="c533" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">用领域知识分析结果</strong></p><p id="8278" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">那么在投资地产股时，这些结果告诉了我们什么呢？它告诉我们，有一些股票对PSEi的走势特别敏感，比如Ayala Land Inc .、Megaworld、Robinsons Land(RLC)和SM Prime Holdings (SMPH)。这意味着在经济衰退时期，这些股票的跌幅相对大于PSEi，因此一旦PSEi有望复苏，这些股票就会提供更多的上涨机会。</p><p id="c3dd" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">此外，这种做法质疑了金融界的通常观念，即贝塔系数较高的公司往往是那些在“奢侈品行业”经营的公司，贝塔系数较低的公司在更“防御性”的行业经营，被认为是“必需品”而不是“奢侈品”。事实上，一些知名开发商在“豪宅”领域表现出较低的贝塔系数(ROCK，SHNG)。</p><p id="a80b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，未来的研究实际上可能想看看公司的规模是否在贝塔系数的影响中发挥作用，或者跨房地产细分市场(酒店、商场、住宅、办公室)的多样化是否影响贝塔系数。然而，快速浏览一下，似乎可以告诉我们，两者都会影响it，因为我们发现一些公司也在进行综合开发(FLI)，拥有巨大的资产基础，如VLL，但贝塔系数较低。</p><p id="4df1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">让我知道你的想法和你想知道的关于这个主题的其他事情。</p><p id="1cee" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">完整代码:<a class="ae md" href="https://github.com/francisadrianviernes/Financial-Analytics/tree/master/Understanding%20Philippines'%20Property%20Stocks%20Through%20Analytics" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p></div></div>    
</body>
</html>