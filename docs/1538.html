<html>
<head>
<title>Tracking Corona on your Smartphone Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python在智能手机上追踪电晕</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/tracking-corona-on-your-smartphone-using-python-b217118b6015?source=collection_archive---------3-----------------------#2020-03-22">https://medium.datadriveninvestor.com/tracking-corona-on-your-smartphone-using-python-b217118b6015?source=collection_archive---------3-----------------------#2020-03-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="72ab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用网络抓取获取关于新冠肺炎的每日更新</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c9b4bd47be07cb6eab4ab203ff0b956b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h32FHyFujPfoaYtL"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@cdc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">CDC</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="946b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3月11日，世界卫生组织(T2)宣布迅速传播的冠状病毒爆发为疫情。在写这篇文章的时候，新冠肺炎(冠状病毒疾病)已经在世界范围内杀死了超过7000人(来源:<a class="ae ky" href="https://www.who.int/health-topics/coronavirus" rel="noopener ugc nofollow" target="_blank">世卫组织</a>)。许多来自不同国家的同事目前都生活在自我隔离状态中。</p><p id="3468" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个患有焦虑症的人，我每天早上在twitter上发布消息的习惯越来越有害。</p><p id="3b38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保持理智，我决定编写一个python脚本，每天早上通过电子邮件向我发送我国疫情统计的简明更新。这封邮件看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/848609baa53f20c3424e664a3b3999b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*DBFwHNXYdyMGZZ99JUkR9g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Email update sent. Final Output. Source: Author</figcaption></figure><p id="e625" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我将解释如何用Python编写这些电子邮件更新。如果你只需要代码，可以在这里获得:<a class="ae ky" href="https://github.com/ChaitanyaBaweja/COVID-19" rel="noopener ugc nofollow" target="_blank">新冠肺炎Github Repo </a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6eec" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置</h1><p id="cc19" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">本教程中使用的代码是在装有<a class="ae ky" href="https://www.python.org/downloads/release/python-369/" rel="noopener ugc nofollow" target="_blank"> Python 3.6.9 </a>的Ubuntu系统上测试的。</p><p id="24f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我强烈建议预先建立一个<a class="ae ky" href="https://realpython.com/python-virtual-environments-a-primer/" rel="noopener ugc nofollow" target="_blank">虚拟环境</a>和所有需要的库。下面是如何在终端上实现这一点。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="cf1f" class="nf me it nb b gy ng nh l ni nj">$ mkdir covid_track<br/>$ cd covid_track<br/>$ virtualenv covid_python<br/>$ source ./covid_python/bin/activate<br/>$ pip3 install tabulate selenium schedule</span></pre><p id="6c51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，我们需要安装<a class="ae ky" href="https://sites.google.com/a/chromium.org/chromedriver/getting-started" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> ChromeDriver </strong> </a>。<strong class="lb iu"> </strong>它是一个独立的可执行文件，将帮助我们控制<a class="ae ky" href="https://www.google.co.in/chrome/" rel="noopener ugc nofollow" target="_blank"> Chrome浏览器</a>。</p><p id="6873" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你下载完<a class="ae ky" href="https://sites.google.com/a/chromium.org/chromedriver/downloads" rel="noopener ugc nofollow" target="_blank"> ChromeDriver，</a>把它解压到我们刚刚创建的同一个目录中:<code class="fe nk nl nm nb b">covid_track</code>。</p><blockquote class="nn no np"><p id="6695" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">注意:你可以将ChromeDriver保存在任何文件夹中。但是，您需要在我们的代码中添加它的位置。将它添加到同一个文件夹中只是为了方便。</p></blockquote></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="71c8" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">收集数据</h1><p id="5da3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在我们开始编写程序之前，我们需要收集数据。</p><p id="8427" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假新闻、诈骗和网络钓鱼是我们这个时代的瘟疫。越来越难确定哪些网站提供的是真实信息。</p><p id="05d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过大量研究，我决定用<a class="ae ky" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a>。它已经确立了自己作为一个可信的，真实的来源。它被超过<a class="ae ky" href="https://www.google.com/search?q=worldometers&amp;btnG=Search+Books&amp;tbm=bks&amp;tbo=1&amp;gws_rd=ssl" rel="noopener ugc nofollow" target="_blank"> 10，000本出版书籍</a>和超过<a class="ae ky" href="http://scholar.google.com/scholar?hl=en&amp;q=worldometers&amp;btnG=&amp;as_sdt=1%2C22&amp;as_sdtp=" rel="noopener ugc nofollow" target="_blank"> 6，000篇专业期刊文章</a>引用。</p><p id="4fd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Worldometers </a>为我们提供了许多有趣的数据点，我们将在本教程的后面看到。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4438" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用Selenium的网页抓取</h1><p id="06f2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在，我们将使用<a class="ae ky" href="https://www.selenium.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Selenium </strong> </a>包<strong class="lb iu"> </strong>从Worldometers网站提取数据。这个过程叫做<a class="ae ky" href="https://www.webharvy.com/articles/what-is-web-scraping.html" rel="noopener ugc nofollow" target="_blank">刮网</a>。如果你以前从未听过这个术语，我会推荐你浏览一下这个<a class="ae ky" href="https://towardsdatascience.com/web-scraping-using-selenium-python-8a60f4cf40ab" rel="noopener" target="_blank">教程</a>。</p><p id="8fae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8842" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nb b">webdriver.Chrome()</code>对象将打开一个新的Chrome浏览器窗口。<code class="fe nk nl nm nb b">get()</code>方法将加载所需的URL。</p><blockquote class="nn no np"><p id="0a51" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">注意:Chrome知道它正在被一个软件控制。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/fa6335615b4415ecfdca9334bf3922bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vVM4GhS6sEHUJo-6lcgOUw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Driver loads the required URL. Bot detected. Source: Author</figcaption></figure><p id="6ae6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Worldometer网站有一个表格，提供了每个国家的<strong class="lb iu">确诊病例和死亡信息。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/b5bb6f7e7058284b5783d5cf98e840cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*reu6AF7pWgmhZkV5lVhEaw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Confirmed Cases and Deaths by Country. Source: <a class="ae ky" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank">Worldometers</a></figcaption></figure><p id="4961" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将使用该表的id将其从网站中提取出来。<strong class="lb iu">右击表格，选择</strong> <code class="fe nk nl nm nb b"><strong class="lb iu">Inspect</strong></code> <strong class="lb iu">，即可找到表格id。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/5771800b62b7e05dc0d6d4bf42f7ab93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ffwiWmsZBYiGDu4eqiWoCw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Output received when clicking on Inspect. Source: Author</figcaption></figure><p id="71cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上图我们可以看到，桌子id是<code class="fe nk nl nm nb b">main_table_countries_today</code>。我们现在将使用<code class="fe nk nl nm nb b"><a class="ae ky" href="https://dev.to/razgandeanu/selenium-cheat-sheet-9lc" rel="noopener ugc nofollow" target="_blank">find_element_by_xpath()</a></code>来提取这个id。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="7b83" class="nf me it nb b gy ng nh l ni nj">table = driver.find_element_by_xpath(‘//*[<a class="ae ky" href="http://twitter.com/id" rel="noopener ugc nofollow" target="_blank">@id</a>=”main_table_countries_today”]/tbody[1]’)</span></pre><p id="e73f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nb b">table</code>变量指向包含Worldometers网站上的表格的web元素。</p><p id="5997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将询问用户需要哪个国家的信息。然后我们将再次使用<code class="fe nk nl nm nb b">xpath</code>从表中提取该国家的行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="af6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，由于我们有一个指向所需行的指针，我们将从该行的每个单元格中提取数据。所有的值都存储在一个列表中。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="cc95" class="nf me it nb b gy ng nh l ni nj">col_data = row.find_elements_by_tag_name("td")<br/>data_val = [x.text for x in col_data]</span></pre><p id="3ef1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们看看整个代码。我在最后添加了一小段代码，这样使用<a class="ae ky" href="https://pypi.org/project/tabulate/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">制表库</strong> </a>将输出格式化成一个漂亮的表格。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/1afc96b3548f339f275a1d88cc645674.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*vWrG4nFtGzsROLYAyRAo5A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Output from code above. Source: Author</figcaption></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6957" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">通过电子邮件发送数据</h1><p id="2eea" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">既然我们已经将提取的数据保存在python字典中，我们可以每天早上通过电子邮件更新发送这些数据。</p><p id="539a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，你需要登录我们的Gmail账户，进入<a class="ae ky" href="https://myaccount.google.com/apppasswords" rel="noopener ugc nofollow" target="_blank">应用密码</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/c6be5700facce7b6b50bb51a2bb469ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMRn8yPIG-mcZFNBp_dgoA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Generate a new password for your app. Source: <a class="ae ky" href="https://myaccount.google.com/apppasswords" rel="noopener ugc nofollow" target="_blank">Google App Passwords</a></figcaption></figure><p id="05e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，设置一个新的应用程序并生成一个新的密码。在下面代码的<code class="fe nk nl nm nb b">server.login()</code>中使用它。这个脚本可能看起来有点复杂。这只是因为我想将数据格式化为表格。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1016" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">安排每天早上的电子邮件</h1><p id="8820" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在我们有了发送电子邮件的功能，我们需要将所有这些打包到一个时间表中。这将基本上允许脚本继续运行，并在每天的特定时间发送电子邮件更新。我们使用<a class="ae ky" href="https://schedule.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">进度库</strong> </a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="6e9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<a class="ae ky" href="https://linuxize.com/post/linux-nohup-command/" rel="noopener ugc nofollow" target="_blank"> nohup </a>在我们的终端上运行它，</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="edc8" class="nf me it nb b gy ng nh l ni nj">$ nohup python3 covid_mail.py &amp;</span></pre><p id="3087" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里下载整个源代码<a class="ae ky" href="https://github.com/ChaitanyaBaweja/COVID-19/blob/master/COVID_Mail/covid_mail.py" rel="noopener ugc nofollow" target="_blank">。如果重新启动，不要忘记再次启动代码。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="b832" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="8161" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">请注意<strong class="lb iu"/><a class="ae ky" href="https://github.com/ChaitanyaBaweja/COVID-19/tree/master/COVID_Mail" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Github repo</strong></a>会经常更新新的有用特性。我欢迎任何有兴趣加入这个项目的人的意见。希望你觉得这很有趣！</p><blockquote class="ob"><p id="264b" class="oc od it bd oe of og oh oi oj ok lu dk translated">注意安全，洗手。</p></blockquote><h1 id="4790" class="md me it bd mf mg ol mi mj mk om mm mn jz on ka mp kc oo kd mr kf op kg mt mu bi translated">重要链接</h1><ul class=""><li id="b0ee" class="oq or it lb b lc mv lf mw li os lm ot lq ou lu ov ow ox oy bi translated"><a class="ae ky" href="https://github.com/ChaitanyaBaweja/COVID-19" rel="noopener ugc nofollow" target="_blank">新冠肺炎Github回购</a></li><li id="3785" class="oq or it lb b lc oz lf pa li pb lm pc lq pd lu ov ow ox oy bi translated"><a class="ae ky" href="https://www.worldometers.info/" rel="noopener ugc nofollow" target="_blank"> Worldometers网站</a></li><li id="cb31" class="oq or it lb b lc oz lf pa li pb lm pc lq pd lu ov ow ox oy bi translated"><a class="ae ky" href="https://dev.to/razgandeanu/selenium-cheat-sheet-9lc" rel="noopener ugc nofollow" target="_blank">硒教程</a></li></ul></div></div>    
</body>
</html>