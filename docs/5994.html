<html>
<head>
<title>Getting Starting with Algorithmic Trading with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python算法交易入门</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/getting-starting-with-algorithmic-trading-with-python-1ae169cc1705?source=collection_archive---------1-----------------------#2020-10-08">https://medium.datadriveninvestor.com/getting-starting-with-algorithmic-trading-with-python-1ae169cc1705?source=collection_archive---------1-----------------------#2020-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e58a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Python进行金融分析和定量交易的基础。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/125dd5203f6345de9d03401a049c9b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*hJfuczUVL6P4siSVqSwXdw.jpeg"/></div></div></figure><p id="77c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">金融代表了资本、商业模式、投资和其他金融工具的系统。金融的一个非常重要的部分是交易。你可以交易金融证券、股票或有形产品，如黄金或石油。</p><p id="11da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">算法或定量交易是基于数学和统计分析设计和开发交易策略的过程。这是一个极其复杂的金融领域。</p><p id="f868" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本教程是Python量化交易的入门指南。你会发现这篇文章非常有帮助，如果你是:</p><ol class=""><li id="5eda" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">学生或希望成为基金或银行定量分析师的人。</li><li id="e310" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">有人正计划开始你自己的量化交易业务。</li></ol><p id="25e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将在本帖中讨论以下主题:</p><ol class=""><li id="d44f" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><a class="ae me" href="https://www.codementor.io/blog/quantitative-trading-6i4dw8wj4z#what-are-stocks-what-is-stock-trading" rel="noopener ugc nofollow" target="_blank">股票和交易基础</a></li><li id="b647" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><a class="ae me" href="https://www.codementor.io/blog/extracting-data-from-the-quandl-api" rel="noopener ugc nofollow" target="_blank">从Quandl API中提取数据</a></li><li id="7404" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><a class="ae me" href="https://www.codementor.io/blog/quantitative-trading-6i4dw8wj4z#exploratory-data-analysis-on-stock-pricing-data" rel="noopener ugc nofollow" target="_blank">股票定价数据的探索性数据分析</a></li><li id="1ab7" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><a class="ae me" href="https://www.codementor.io/blog/quantitative-trading-6i4dw8wj4z#moving-averages-in-trading" rel="noopener ugc nofollow" target="_blank">移动平均线</a></li><li id="06ec" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><a class="ae me" href="https://www.codementor.io/blog/quantitative-trading-6i4dw8wj4z#formulating-a-trading-strategy" rel="noopener ugc nofollow" target="_blank">用Python制定交易策略</a></li><li id="e627" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><a class="ae me" href="https://www.codementor.io/blog/quantitative-trading-6i4dw8wj4z#visualize-the-performance-of-the-strategy" rel="noopener ugc nofollow" target="_blank">可视化战略的绩效</a></li></ol><p id="d71d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们深入研究股票定价数据的细节和动态之前，我们必须首先了解金融的基础知识。如果你熟悉金融和交易，你可以跳过这一节，点击这里进入下一节。</p><h1 id="0f53" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">什么是股票？什么是股票交易？</h1><h1 id="7771" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">股票</h1><p id="f268" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">股票是公司所有权的一种表现，它以一定的数量发行。这是一种财务担保，确立了你对公司资产和业绩的要求权。一个组织或公司发行股票来筹集更多的资金/资本，以便扩大规模和从事更多的项目。这些股票随后公开出售和购买。</p><h1 id="d768" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">股票交易和交易策略</h1><p id="22b4" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">买卖现有和以前发行的股票的过程称为股票交易。股票的买卖有一个价格，这个价格根据股票市场的供求关系不断波动。根据公司的业绩和行为，股价可能会上下波动，但股价的波动并不仅限于公司的业绩。</p><p id="1fee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">交易者付钱换取公司的所有权，希望进行一些有利可图的交易，并以更高的价格出售股票。交易员遵循的另一个重要技巧是卖空——借入股票，然后立即卖出，希望稍后以更低的价格买入，然后返还给贷方，并赚取保证金。所以，大多数交易者遵循一个计划和模型来交易。这就是所谓的交易策略。</p><p id="220d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对冲基金和投资银行的量化交易员设计和开发这些交易策略和框架，并对其进行测试。它需要深厚的编程专业知识和对构建自己的策略所需的语言的理解。</p><p id="01bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Python是C++、Java、R和MATLAB等最受欢迎的编程语言之一。由于其简单的语法、庞大的社区和第三方支持，它正被广泛应用于所有领域，尤其是数据科学领域。</p><p id="5a94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了充分利用本教程，您需要熟悉Python和统计学。请务必温习您的Python，并查看<a class="ae me" href="https://sites.google.com/site/fundamentalstatistics/unit-1-the-basics" rel="noopener ugc nofollow" target="_blank">统计学基础</a>。</p><h1 id="0616" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">从Quandl API中提取数据</h1><p id="27be" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">为了提取股票定价数据，我们将使用<a class="ae me" href="https://docs.quandl.com/" rel="noopener ugc nofollow" target="_blank"> Quandl API </a>。但在此之前，我们先设置一下工作环境。方法如下:</p><ol class=""><li id="fd2b" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">在您的终端中，为项目创建一个新目录(您可以随意命名):</li></ol><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="bee7" class="nh mg it nd b gy ni nj l nk nl">mkdir &lt;directory_name&gt;</span></pre><ol class=""><li id="879f" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">确保你的机器上安装了<a class="ae me" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python 3 </a>和<a class="ae me" href="https://pypi.org/project/virtualenv/" rel="noopener ugc nofollow" target="_blank"> virtualenv </a>。</li><li id="75ee" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">使用<code class="fe nm nn no nd b">virtualenv &lt;env_name&gt;</code>创建一个新的Python 3 virtualenv，并使用<code class="fe nm nn no nd b">source &lt;env_name&gt;/bin/activate</code>激活它。</li><li id="f0a6" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">现在，使用<a class="ae me" href="https://pip.pypa.io/en/stable/installing/" rel="noopener ugc nofollow" target="_blank"> pip </a>安装jupyter-notebook，并在终端键入<code class="fe nm nn no nd b">pip install jupyter-notebook</code>。</li><li id="4249" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">同样，安装<code class="fe nm nn no nd b">pandas</code>、<code class="fe nm nn no nd b">quandl</code>和<code class="fe nm nn no nd b">numpy</code>软件包。</li><li id="ba49" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">从终端运行您的<code class="fe nm nn no nd b">jupyter-notebook</code>。</li></ol><p id="7a03" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您的笔记本应该在本地主机上运行，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/d5a43c9cba92d27d8317f9d972fa1c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n0buNKfDRFmi2N58"/></div></div></figure><p id="dc7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以点击右边的<code class="fe nm nn no nd b">New</code>下拉菜单来创建你的第一个笔记本。确保您已经在<a class="ae me" href="https://docs.quandl.com/" rel="noopener ugc nofollow" target="_blank"> Quandl </a>上创建了一个帐户。按照这里提到的<a class="ae me" href="https://docs.quandl.com/docs/python-installation" rel="noopener ugc nofollow" target="_blank">步骤</a>创建你的API密匙。</p><p id="0b85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦你都准备好了，让我们开始吧:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="b2c2" class="nh mg it nd b gy ni nj l nk nl"><em class="nq"># importing required packages</em></span><span id="f3e3" class="nh mg it nd b gy nr nj l nk nl"><strong class="nd iu">import</strong> pandas <strong class="nd iu">as</strong> pd<br/><strong class="nd iu">import</strong> quandl <strong class="nd iu">as</strong> q</span></pre><p id="b96c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Pandas将是本教程中使用最严格的包，因为我们将进行大量的数据操作和绘图。</p><p id="ff59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">导入包之后，我们将使用Quandl包向Quandl API发出请求:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="0657" class="nh mg it nd b gy ni nj l nk nl"># set the API key<br/>q.ApiConfig.api_key = "&lt;API key&gt;”</span><span id="66f2" class="nh mg it nd b gy nr nj l nk nl">#send a get request to query Microsoft's end of day stock prices from 1st Jan, 2010 to 1st Jan, 2019<br/>msft_data = q.get("EOD/MSFT", start_date="2010-01-01", end_date="2019-01-01")</span><span id="150d" class="nh mg it nd b gy nr nj l nk nl"># look at the first 5 rows of the dataframe<br/>msft_data.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/9b0cf21bc329626ab38f6a662a99bf94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L5U8trG823IpMCF7"/></div></div></figure><p id="3380" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里我们有微软过去9年的EOD股票价格数据。您所要做的就是从Quandl包中调用<code class="fe nm nn no nd b">get</code>方法，并提供股票代码、MSFT和所需数据的时间范围。</p><p id="39eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这真的很简单，对吗？让我们进一步理解和探索这些数据。</p><h1 id="bf28" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">股票定价数据的探索性数据分析</h1><p id="a423" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">有了数据在手，我们首先要做的就是理解它代表了什么，它封装了什么样的信息。</p><p id="cb0e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打印数据帧的信息，我们可以看到它包含的所有内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/b59fd594986162ba762d0c0d42825f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LsizeR4bgy07maXI"/></div></div></figure><p id="3d34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如上面的截图所示，DataFrame包含DatetimeIndex，这意味着我们正在处理时间序列数据。索引可以被认为是一种有助于修改或引用数据的数据结构。时间序列数据是在连续的、等间隔的时间间隔内拍摄的一系列价格快照。</p><p id="a0ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在交易中，EOD股票定价数据通过定期记录的数据点来捕捉特定时间段内股票的某些参数(如股票价格)的变化。</p><h1 id="2099" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">重要术语</h1><p id="47b1" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">看看其他列，让我们试着理解每个列代表什么:</p><ul class=""><li id="2642" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nu lw lx ly bi translated">开盘价/收盘价—获取股票的开盘价/收盘价</li><li id="94b6" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">Adj_Open/Adj_Close —调整后的开盘价/收盘价是任何给定交易日的股票价格，该价格已被修改，以包括任何股息分配、股票分割和第二天开盘前任何时间发生的其他公司行为。</li><li id="2b48" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">成交量——它记录了在任何一个交易日交易的股票数量。</li><li id="26a9" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">高/低——它跟踪股票在特定交易日的最高价和最低价。</li></ul><p id="09fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些是我们此时将重点关注的重要栏目。</p><p id="ea58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以了解数据的汇总统计，它向我们显示行数、平均值、最大值、标准差等。尝试在Ipython单元格中运行以下代码行:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="0f18" class="nh mg it nd b gy ni nj l nk nl">msft_data.describe()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/6d0a97bdd6e22fdbd0a7434b0116f42c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rvIdaLaeojCMOhUW"/></div></div></figure><h1 id="a124" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">重新取样()</h1><p id="a4a0" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">Pandas的resample()方法用于促进对时间序列数据的频率转换的控制和灵活性。我们可以指定时间间隔，以每月、每季度或每年对数据进行重新采样，并对其执行所需的操作。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="2ef8" class="nh mg it nd b gy ni nj l nk nl">msft_data.resample('M').mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/6609c4cbaf4f87ae050ff6fcbd4e3ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BfgGIF8NJ3aDAGQk"/></div></div></figure><p id="2a5b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一种分析不同时间段股票表现的有趣方法。</p><div class="nx ny gp gr nz oa"><a href="https://www.datadriveninvestor.com/2020/07/07/introduction-to-time-series-forecasting-of-stock-prices-with-python/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">用Python |数据驱动投资者进行股票价格时间序列预测简介</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">在这个简单的教程中，我们将看看如何将时间序列模型应用于股票价格。更具体地说，一个…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><h1 id="90b1" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">计算回报</h1><p id="1452" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">财务回报就是在一项投资中赚或赔的钱。回报可以用投资额随时间的变化来表示。回报可以用利润与投资比率的百分比来计算。</p><p id="cf67" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，我们有pct_change()可供我们使用。以下是计算回报的方法:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="3bb1" class="nh mg it nd b gy ni nj l nk nl"># Import numpy package<br/>import numpy as np</span><span id="273e" class="nh mg it nd b gy nr nj l nk nl"># assign `Adj Close` to `daily_close`<br/>daily_close = msft_data[['Adj_Close']]</span><span id="66a9" class="nh mg it nd b gy nr nj l nk nl"># returns as fractional change<br/>daily_return = daily_close.pct_change()</span><span id="4004" class="nh mg it nd b gy nr nj l nk nl"># replacing NA values with 0<br/>daily_return.fillna(0, inplace=True)</span><span id="dc40" class="nh mg it nd b gy nr nj l nk nl">print(daily_return)</span></pre><p id="8f43" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将打印股票每天产生的收益。将这个数乘以100将得到百分比变化。</p><p id="1b46" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">pct_change()中使用的公式是:</p><blockquote class="op oq or"><p id="7fe8" class="ku kv nq kw b kx ky ju kz la lb jx lc os le lf lg ot li lj lk ou lm ln lo lp im bi translated">return = {(t时的价格)—(t-1时的价格)}/{ t-1时的价格}</p></blockquote><p id="146b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，要计算月回报率，你需要做的就是:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="182c" class="nh mg it nd b gy ni nj l nk nl">mdata = msft_data.resample('M').apply(lambda x: x[-1])<br/>monthly_return = mdata.pct_change()</span></pre><p id="175d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将数据重采样到月(工作日)后，我们可以使用<code class="fe nm nn no nd b">apply()</code>函数获得该月最后一天的交易。<code class="fe nm nn no nd b">apply()</code>接受一个函数，并将其应用于熊猫系列的每一行。<code class="fe nm nn no nd b">lambda</code>函数是Python中的匿名函数，可以不用名字定义，只接受以下格式的表达式:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="4b4c" class="nh mg it nd b gy ni nj l nk nl">Lambda: expression</span></pre><p id="f41c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，<code class="fe nm nn no nd b">lambda x: x * 2</code>就是一个lambda函数。这里，x是参数，<code class="fe nm nn no nd b">x * 2</code>是被求值并返回的表达式。</p><h1 id="2226" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">交易中的移动平均线</h1><p id="ab50" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">均线的概念将为我们基于动量的交易策略建立基础。在金融领域，分析师经常需要在一个滑动的时间窗口内不断评估统计指标，这被称为移动窗口计算。让我们看看如何计算50天时间窗内的滚动平均值，并将时间窗滑动1天。</p><h1 id="ed39" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">滚动()</h1><p id="1be5" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">这是为我们表演魔术的神奇功能:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="7926" class="nh mg it nd b gy ni nj l nk nl"># assigning adjusted closing prices to adj_prices<br/>adj_price = msft_data['Adj_Close']</span><span id="716f" class="nh mg it nd b gy nr nj l nk nl"># calculate the moving average<br/>mav = adj_price.rolling(window=50).mean()</span><span id="74ed" class="nh mg it nd b gy nr nj l nk nl"># print the result<br/>print(mav[-10:])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/87786ec0330f0f0320e926ef176dda54.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/0*ug8vQahkBNCbrOLP"/></div></figure><p id="39a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您将看到50天的滚动平均值(大约。2个月)。移动平均线有助于消除数据中的任何波动或峰值，并为公司业绩提供更平滑的曲线。</p><p id="44fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以画出图来看看区别:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="5212" class="nh mg it nd b gy ni nj l nk nl"># import the matplotlib package to see the plot<br/>import matplotlib.pyplot as plt<br/>adj_price.plot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/ce736e1cd50153abdeaa03d21e32ef02.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/0*_MT9IvHh-IMHgPLh"/></div></div></figure><p id="81a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您可以绘制滚动平均值()</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="0d42" class="nh mg it nd b gy ni nj l nk nl">mav.plot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/df3254da88ffb3f095bcf5b7adc2ae59.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/0*LFx-shwoVMjwQ4n9"/></div></figure><p id="b58c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以自己看到不同之处，数据中的峰值是如何被消耗的，以给出股票表现的总体情绪。</p><h1 id="34c8" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">制定交易策略</h1><p id="c3f5" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">最后也是最有趣的部分来了，设计和制定交易策略。这将是一步一步的指导开发一个基于动量的简单移动平均交叉(SMAC)策略。</p><p id="4d71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基于动量的策略是基于技术指标，利用市场趋势的持续性。我们购买有上升趋势的证券，卖空有下降趋势的证券。</p><p id="c028" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SMAC战略是众所周知的示意性势头战略。这是一个只做多的策略。这里的动量是股票的总回报，包括过去<em class="nq"> n </em>个月的股息。n个月的这段时间称为回望期。</p><p id="3e25" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回望期有三种主要类型:短期、中期和长期。我们需要为一个特定的时间序列定义两个不同的回顾期。</p><p id="6c45" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当较短的回望滚动平均线(或移动平均线)超过较长的回望移动平均线时，就会产生买入信号。当较短的回看移动平均线低于较长的移动平均线时，出现卖出信号。</p><p id="af6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们看看这个策略的代码是什么样子的:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="92a1" class="nh mg it nd b gy ni nj l nk nl"># step1: initialize the short and long lookback periods<br/>short_lb = 50<br/>long_lb = 120</span><span id="7ae4" class="nh mg it nd b gy nr nj l nk nl"># step2: initialize a new DataFrame called signal_df with the signal column<br/>signal_df = pd.DataFrame(index=msft_data.index)<br/>signal_df['signal'] = 0.0</span><span id="2bec" class="nh mg it nd b gy nr nj l nk nl"># step3: create a short simple moving average over the short lookback period<br/>signal_df['short_mav'] = msft_data['Adj_Close'].rolling(window=short_lb, min_periods=1, center=False).mean()</span><span id="6fc9" class="nh mg it nd b gy nr nj l nk nl"># step4: create long simple moving average over the long lookback period<br/>signal_df['long_mav'] = msft_data['Adj_Close'].rolling(window=long_lb, min_periods=1, center=False).mean()</span><span id="39f4" class="nh mg it nd b gy nr nj l nk nl"># step5: generate the signals based on the conditional statement<br/>signal_df['signal'][short_lb:] = np.where(signal_df['short_mav'][short_lb:] &gt; signal_df['long_mav'][short_lb:], 1.0, 0.0)   </span><span id="89e3" class="nh mg it nd b gy nr nj l nk nl"># step6: create the trading orders based on the positions column<br/>signal_df['positions'] = signal_df['signal'].diff()<br/>signal_df[signal_df['positions'] == -1.0]</span></pre><p id="100a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看这里发生了什么。我们创建了两个回望期，短期回望期<code class="fe nm nn no nd b">short_lb</code>为50天，长期移动平均线的长期回望期定义为<code class="fe nm nn no nd b">long_lb</code>120天。</p><p id="a21d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经创建了一个新的数据框架，该框架旨在捕捉每当短均线穿过长均线时产生的信号，使用<code class="fe nm nn no nd b">np.where</code>并指定<code class="fe nm nn no nd b">1.0</code>为真，如果条件为假，则指定<code class="fe nm nn no nd b">0.0</code>。</p><p id="e230" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">数据框中的<code class="fe nm nn no nd b">positions</code>列告诉我们是否有买入信号或卖出信号，或者留在原地。我们基本上是使用<a class="ae me" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.diff.html" rel="noopener ugc nofollow" target="_blank"> diff </a>来计算信号列与前一行的差异。</p><p id="de4e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在那里，我们用熊猫只用了6个步骤就实现了我们的战略。很简单，不是吗？</p><p id="7b37" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们试着用Matplotlib将它可视化。我们需要做的只是初始化一个图表，将调整后的收盘价、短期和长期移动平均线添加到图表中，然后使用上面<code class="fe nm nn no nd b">signal_df</code>中的持仓栏绘制买入和卖出信号:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="769e" class="nh mg it nd b gy ni nj l nk nl"># initialize the plot using plt<br/>fig = plt.figure()</span><span id="6063" class="nh mg it nd b gy nr nj l nk nl"># Add a subplot and label for y-axis<br/>plt1 = fig.add_subplot(111,  ylabel='Price in $')</span><span id="0aac" class="nh mg it nd b gy nr nj l nk nl">msft_data['Adj_Close'].plot(ax=plt1, color='r', lw=2.)</span><span id="b1cd" class="nh mg it nd b gy nr nj l nk nl"># plot the short and long lookback moving averages<br/>signal_df[['short_mav', 'long_mav']].plot(ax=plt1, lw=2., figsize=(12,8))</span><span id="ef49" class="nh mg it nd b gy nr nj l nk nl"># plotting the sell signals<br/>plt1.plot(signal_df.loc[signal_df.positions == -1.0].index, <br/>         signal_df.short_mav[signal_df.positions == -1.0],<br/>         'v', markersize=10, color='k')</span><span id="d20a" class="nh mg it nd b gy nr nj l nk nl"># plotting the buy signals<br/>plt1.plot(signal_df.loc[signal_df.positions == 1.0].index, <br/>         signal_df.short_mav[signal_df.positions == 1.0],<br/>         '^', markersize=10, color='m')<br/>         <br/># Show the plot<br/>plt.show()</span></pre><p id="a241" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Jupyter笔记本中运行上面的单元格将产生如下图所示的图形:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/8cb2cc73c644240eec9b196e53183cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oW3KwyuxFmER_s6K"/></div></div></figure><p id="318d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，你可以清楚地看到，每当蓝线(短均线)上涨并超过橙线(长均线)时，都有一个粉红色的向上标记，表示买入信号。卖出信号由黑色向下标记表示，这里的<code class="fe nm nn no nd b">short_mav</code>低于<code class="fe nm nn no nd b">long_mav</code>。</p><h1 id="be2f" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">在Quantopian上可视化策略的性能</h1><p id="c5fa" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated"><a class="ae me" href="https://www.quantopian.com/" rel="noopener ugc nofollow" target="_blank"> Quantopian </a>是一个Zipline驱动的平台，有多种用例。你可以编写自己的算法，访问免费数据，回测你的策略，为社区做贡献，如果你需要资本，可以与Quantopian合作。</p><p id="12cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们编写了一个算法来回测我们的SMA策略，结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/c1ea509f086ae80238bca98c1ae99505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v1VH9EJ16H58tOfe"/></div></div></figure><p id="737e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是对上述指标的解释:</p><ul class=""><li id="bdca" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nu lw lx ly bi translated">总回报:从回溯测试开始到结束，投资组合的总回报百分比。</li><li id="29ad" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">特定回报:投资组合的总回报和普通回报之间的差额。</li><li id="8473" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">共同回报:可归因于共同风险因素的回报。有11个部门和5个风格的风险因素构成了这些回报。风险部分的行业风险和风格风险图表提供了这些因素的更多详细信息。</li><li id="4cef" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">夏普:6个月滚动夏普比率。这是对风险调整投资的一种衡量。计算方法是将投资组合的超额收益除以无风险利率，再除以投资组合的标准差。</li><li id="eb48" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">最大跌幅:投资组合历史上所有峰谷波动中的最大跌幅。</li><li id="81f5" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated">波动性:投资组合回报的标准差。</li></ul><p id="1909" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">拍拍自己的背，因为你已经成功地实施了你的量化交易策略！</p><h1 id="db0a" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">从这里去哪里？</h1><p id="f7de" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">现在你的算法已经准备好了，你需要对结果进行回溯测试，并评估与策略和股票相关的风险相对应的<a class="ae me" href="https://www.investopedia.com/ask/answers/041415/what-are-some-common-measures-risk-used-risk-management.asp" rel="noopener ugc nofollow" target="_blank">指标。同样，你可以使用</a><a class="ae me" href="https://blueshift.quantinsti.com/" rel="noopener ugc nofollow" target="_blank"> BlueShift </a>和<a class="ae me" href="https://www.quantopian.com/" rel="noopener ugc nofollow" target="_blank"> Quantopian </a>来学习更多关于回溯测试和交易策略的知识。</p><h1 id="c292" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">更多资源</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/2d13f77959a67ba96382bc798b8c86d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*dPWfQNytv77JRxtUFHqyXA.png"/></div><figcaption class="pb pc gj gh gi pd pe bd b be z dk"><a class="ae me" href="https://quantra.quantinsti.com/course/introduction-to-data-science?utm_source=harshit_tyagi&amp;utm_medium=affiliate&amp;utm_campaign=data_science" rel="noopener ugc nofollow" target="_blank">https://quantra.quantinsti.com/course/introduction-to-data-science?utm_source=harshit_tyagi&amp;utm_medium=affiliate&amp;utm_campaign=data_science</a></figcaption></figure><p id="295d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Quantra 是QuantInsti的一个创意。该领域的专家提供了一系列免费和付费的课程，Quantra提供了一系列基本和高级交易策略的全面指导。</p><ul class=""><li id="0720" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nu lw lx ly bi translated"><a class="ae me" href="https://quantra.quantinsti.com/course/introduction-to-data-science?utm_source=harshit_tyagi&amp;utm_medium=affiliate&amp;utm_campaign=data_science" rel="noopener ugc nofollow" target="_blank">数据科学课程</a> —他们推出了一门关于数据科学的入门课程，帮助您为数据科学项目打下坚实的基础。</li><li id="1aef" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated"><a class="ae me" href="https://quantra.quantinsti.com/learning-track/algorithmic-trading-for-everyone?utm_source=harshit_tyagi&amp;utm_medium=affiliate&amp;utm_campaign=lt_everyone" rel="noopener ugc nofollow" target="_blank">新手交易课程</a>——从动量交易到基于机器和深度学习的交易策略，像Ernest P. Chan博士这样的交易界研究人员是这些利基课程的作者。</li></ul><h2 id="f49c" class="nh mg it bd mh pf pg dn ml ph pi dp mp ld pj pk mr lh pl pm mt ll pn po mv pp bi translated">免费资源</h2><p id="aaa8" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">要了解更多关于交易算法的知识，请查看以下博客:</p><ul class=""><li id="6f81" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nu lw lx ly bi translated"><a class="ae me" href="https://www.quantstart.com/" rel="noopener ugc nofollow" target="_blank">Quantstart</a>——它们涵盖了广泛的回溯测试算法、初学者指南等。</li><li id="77c3" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated"><a class="ae me" href="https://www.investopedia.com/" rel="noopener ugc nofollow" target="_blank">Investopedia</a>——你想知道的关于投资和金融的一切。</li><li id="5161" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nu lw lx ly bi translated"><a class="ae me" href="https://quantivity.wordpress.com/" rel="noopener ugc nofollow" target="_blank">Quantivity</a>——算法及其利弊的详细数学解释。</li></ul><p id="c574" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">沃伦·巴菲特说他每天阅读大约500页，这应该告诉你，为了在金融领域取得成功，阅读是必不可少的。开始这个交易之旅，你会过着充满兴奋、激情和数学的生活。</p><h2 id="7a37" class="nh mg it bd mh pf pg dn ml ph pi dp mp ld pj pk mr lh pl pm mt ll pn po mv pp bi translated">访问专家视图— <a class="ae me" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank">订阅DDI英特尔</a></h2></div></div>    
</body>
</html>