<html>
<head>
<title>Installing TensorFlow 2.4 on MacOS 11.0 without CUDA for both Intel and M1 based Macs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在不使用CUDA的MacOS 11.0上为基于英特尔和M1的MAC安装TensorFlow 2.4</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/installing-tensorflow-2-4-on-macos-11-0-without-cuda-for-both-intel-and-m1-based-macs-a1c4edf1dbab?source=collection_archive---------1-----------------------#2020-12-23">https://medium.datadriveninvestor.com/installing-tensorflow-2-4-on-macos-11-0-without-cuda-for-both-intel-and-m1-based-macs-a1c4edf1dbab?source=collection_archive---------1-----------------------#2020-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/704248fc2099aed36717c6494999df41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*__qgmBIfEQ0qKXMWooxWjw.jpeg"/></div></figure><p id="3df6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">两个流行的深度学习框架TensorFlow和PyTorch通过<a class="ae ks" href="https://developer.nvidia.com/cuda-zone" rel="noopener ugc nofollow" target="_blank"> CUDA工具包</a>支持<a class="ae ks" href="https://developer.nvidia.com/" rel="noopener ugc nofollow" target="_blank"> NVIDIA的</a>GPU进行加速。这给MAC上的深度学习开发带来了问题。</p><p id="9ca2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">但现在不是了！</strong></p><p id="adeb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">随着其基于ARM架构的定制硅芯片的最新发布，苹果公司宣布了一个新的<strong class="jw ir"> <em class="kt"> ML Compute </em> </strong>框架，该框架可用于ML和DL模型的加速训练，利用Apple Macs <strong class="jw ir"> <em class="kt">上现有的GPU，而无需CUDA支持。</em>T13】</strong></p><p id="7bd1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们现在有了Tensorflow 2.4的<a class="ae ks" href="https://github.com/apple/tensorflow_macos" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> </em> <strong class="jw ir"> <em class="kt"> Mac优化版</em> </strong> <em class="kt"> </em> </a>，我们可以将其安装在旧的基于英特尔的Mac电脑和最近推出的基于M1芯片的MacBooks上。</p><p id="93a5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有人声称<em class="kt">，在几个流行的神经网络基准上对优化的TensorFlow库进行的测试显示，与标准代码相比，训练时间“显著加快”，在苹果新的M1硬件上优化的库的性能提高了7倍。</em></p><p id="2287" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们看看如何在我们的Mac计算机上安装和测试这个最新的Tensorflow库。</p><blockquote class="ku kv kw"><p id="8a46" class="ju jv kt jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">请注意，在开始安装之前，请确保您已经更新到最新的macOS 11.0 (Big Sur)并且在系统中安装了Python 3.8(可从Xcode命令行工具中获得)。</p></blockquote><p id="c9c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">打开终端，按照如下所示的步骤操作。</p><p id="a3e8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第一步。用Python 3.8创建一个虚拟环境</strong></p><p id="00a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从终端本身，转到您想要安装该环境的目录，然后键入以下命令。</p><p id="f4b3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">注意，我将它安装在主目录(/Users/chirag/)中。</em></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="e509" class="lj lk iq lf b gy ll lm l ln lo">python3 -m venv my_env</span></pre><p id="dc6b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将使用<strong class="jw ir"> Python 3.8创建一个新的虚拟环境“<strong class="jw ir"> <em class="kt"> my_env </em> </strong>”。</strong>在下面的步骤中进行Tensorflow安装时，我们需要指定该环境的路径。</p><blockquote class="ku kv kw"><p id="9f6f" class="ju jv kt jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">要检查是否安装了所需的版本，即Python 3.8，您可以激活此环境，然后通过键入以下命令进行确认。</p><p id="4c9d" class="ju jv kt jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><strong class="jw ir">source my _ env/bin/activate<br/>python-version</strong></p></blockquote><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/5db19166a879e69f86997395454c41c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nqgv39vNyBtcPU5HMzlI4w.png"/></div></div></figure><p id="519e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">步骤二。运行安装脚本</strong>(取自<a class="ae ks" href="https://github.com/apple/tensorflow_macos" rel="noopener ugc nofollow" target="_blank"> apple/tensorflow_macos </a>资源库)</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="c9c8" class="lj lk iq lf b gy ll lm l ln lo">/bin/bash -c "$(curl -fsSL <a class="ae ks" href="https://raw.githubusercontent.com/apple/tensorflow_macos/master/scripts/download_and_install.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/apple/tensorflow_macos/master/scripts/download_and_install.sh</a>)"</span></pre><p id="5644" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装时，它会要求您提供现有Python环境的路径。指定您在步骤1中创建的环境的路径。</p><p id="2876" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于我的系统，路径如下。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="599b" class="lj lk iq lf b gy ll lm l ln lo">/Users/chirag/my_env</span></pre><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/803b071c9c64253ae33af3696dc86cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkWN5odWJnnzK7gN-o5VKg.png"/></div></div></figure><p id="a138" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将把Tensorflow2.4安装到我们系统的虚拟环境“my_env”中</p><p id="6b31" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第三步:激活环境。</strong></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="77e8" class="lj lk iq lf b gy ll lm l ln lo">source my_env/bin/activate</span></pre><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/165cafbfc3e201198c8012d93c5483c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkzOcEoRv05_BnqeLlbpOA.png"/></div></div></figure><p id="2a58" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第四步:检查TensorFlow安装是否成功。</strong></p><p id="8aac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过键入以下命令，进入python shell并导入Tensorflow。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="eb5a" class="lj lk iq lf b gy ll lm l ln lo">python3 -c 'import tensorflow as tf; print(tf.__version__)'</span></pre><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/8c62c07e6ca1065d3d37a94929916462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TbAIyB1EuMsuuXxKdTjylw.png"/></div></div></figure><p id="c2fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如您所见，没有任何错误，我们得到了输出。<strong class="jw ir">这意味着我们已经成功安装了MacOS优化版的Tensorflow！</strong></p><div class="lu lv gp gr lw lx"><a href="https://www.datadriveninvestor.com/2020/11/19/how-machine-learning-and-artificial-intelligence-changing-the-face-of-ecommerce/" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">机器学习和人工智能如何改变电子商务的面貌？|数据驱动…</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">电子商务开发公司，现在，整合先进的客户体验到一个新的水平…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml js lx"/></div></div></a></div></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h2 id="39ed" class="lj lk iq bd mt mu mv dn mw mx my dp mz kf na nb nc kj nd ne nf kn ng nh ni nj bi translated"><strong class="ak">使用Tensorflow安装测试深度学习模型:</strong></h2><p id="e3e7" class="pw-post-body-paragraph ju jv iq jw b jx nk jz ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr ij bi translated">我还将向您展示如何在CNN深度学习模型架构上测试和基准测试您的性能。代码摘自在<a class="ae ks" href="https://github.com/apple/tensorflow_macos/issues/25" rel="noopener ugc nofollow" target="_blank">https://github.com/apple/tensorflow_macos/issues/25</a>的讨论</p><p id="b1d9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">确保您的环境仍然处于激活状态。如果没有，请键入:</em></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="b1bf" class="lj lk iq lf b gy ll lm l ln lo">source my_env/bin/activate</span></pre><p id="cadc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">步骤a)使用pip </strong>安装<em class="kt">tensor flow _ datasets</em><strong class="jw ir"><em class="kt">模块</em></strong></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="dffb" class="lj lk iq lf b gy ll lm l ln lo">pip install tensorflow_datasets</span></pre><p id="44c8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">步骤b)在你的代码编辑器中创建一个新文件<strong class="jw ir"> <em class="kt"> test.py </em> </strong>。<strong class="jw ir">粘贴写在</strong>下面的代码，保存文件。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="d443" class="lj lk iq lf b gy ll lm l ln lo">import tensorflow.compat.v2 as tf<br/>import tensorflow_datasets as tfds<br/><br/>tf.enable_v2_behavior()<br/><br/>from tensorflow.python.framework.ops import disable_eager_execution<br/>disable_eager_execution()<br/><br/>from tensorflow.python.compiler.mlcompute import mlcompute<br/>mlcompute.set_mlc_device(device_name='gpu')<br/><br/><br/>(ds_train, ds_test), ds_info = tfds.load(<br/>    'mnist',<br/>    split=['train', 'test'],<br/>    shuffle_files=True,<br/>    as_supervised=True,<br/>    with_info=True,<br/>)<br/><br/>def normalize_img(image, label):<br/>  """Normalizes images: `uint8` -&gt; `float32`."""<br/>  return tf.cast(image, tf.float32) / 255., label<br/><br/>batch_size = 128<br/><br/>ds_train = ds_train.map(<br/>    normalize_img, num_parallel_calls=tf.data.experimental.AUTOTUNE)<br/>ds_train = ds_train.cache()<br/>ds_train = ds_train.shuffle(ds_info.splits['train'].num_examples)<br/>ds_train = ds_train.batch(batch_size)<br/>ds_train = ds_train.prefetch(tf.data.experimental.AUTOTUNE)<br/><br/><br/>ds_test = ds_test.map(<br/>    normalize_img, num_parallel_calls=tf.data.experimental.AUTOTUNE)<br/>ds_test = ds_test.batch(batch_size)<br/>ds_test = ds_test.cache()<br/>ds_test = ds_test.prefetch(tf.data.experimental.AUTOTUNE)<br/><br/><br/>model = tf.keras.models.Sequential([<br/>  tf.keras.layers.Conv2D(32, kernel_size=(3, 3),<br/>                 activation='relu'),<br/>  tf.keras.layers.Conv2D(64, kernel_size=(3, 3),<br/>                 activation='relu'),<br/>  tf.keras.layers.MaxPooling2D(pool_size=(2, 2)),<br/>#   tf.keras.layers.Dropout(0.25),<br/>  tf.keras.layers.Flatten(),<br/>  tf.keras.layers.Dense(128, activation='relu'),<br/>#   tf.keras.layers.Dropout(0.5),<br/>  tf.keras.layers.Dense(10, activation='softmax')<br/>])<br/>model.compile(<br/>    loss='sparse_categorical_crossentropy',<br/>    optimizer=tf.keras.optimizers.Adam(0.001),<br/>    metrics=['accuracy'],<br/>)<br/><br/>model.fit(<br/>    ds_train,<br/>    epochs=12,<br/>    validation_data=ds_test,<br/>)</span></pre><p id="c6a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">步骤c)执行这个脚本。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="7228" class="lj lk iq lf b gy ll lm l ln lo">python test.py</span></pre><p id="a290" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将开始在12个时期的MNIST数据集上训练CNN模型。</p><p id="4a18" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以更改batch_size或尝试模型架构，并在讨论页面上报告您的结果。</p><p id="69c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以下是我的系统在以下配置下的结果:</p><p id="af44" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> MacBook Air 2020 (M1芯片- 16GB RAM- 8核CPU- 7核GPU) </strong></p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/bb67e50e599818ed78dc656208e2915a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1B2AiRYMXUpD-uS1ZS9rQ.png"/></div></div></figure><ul class=""><li id="312a" class="np nq iq jw b jx jy kb kc kf nr kj ns kn nt kr nu nv nw nx bi translated">23秒/时代</li><li id="4cb5" class="np nq iq jw b jx ny kb nz kf oa kj ob kn oc kr nu nv nw nx bi translated">46毫秒/步</li><li id="8063" class="np nq iq jw b jx ny kb nz kf oa kj ob kn oc kr nu nv nw nx bi translated">97.9%的最终准确度</li></ul><p id="7a31" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">CPU和GPU的使用情况如下:</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi od"><img src="../Images/5fb869fef9c706dc08ac1c0dcdc9ff20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rbunpqi3sySd8OZMfGreAA.jpeg"/></div></div></figure><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi oe"><img src="../Images/c8de508284e8a3e6cffcf1f90de18190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gnPzFeAg2Dnly00WYeAqSA.jpeg"/></div></div></figure><p id="9c3f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是苹果硬件上ML执行新时代的开始。看看Mac上的机器学习的未来会是什么样子将会很有趣！</p><blockquote class="ku kv kw"><p id="2be6" class="ju jv kt jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">以上是我对这篇文章的看法。 </p><p id="81fe" class="ju jv kt jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">如果你喜欢这篇文章，或者在下面的回复框中有任何问题或建议，请告诉我。谢谢大家！</p><p id="de4d" class="ju jv kt jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">与我联系:<a class="ae ks" href="https://www.linkedin.com/in/chiragdaryani/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/chiragdaryani/</a></p></blockquote><h2 id="662c" class="lj lk iq bd mt mu mv dn mw mx my dp mz kf na nb nc kj nd ne nf kn ng nh ni nj bi translated">访问专家视图— <a class="ae ks" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank">订阅DDI英特尔</a></h2></div></div>    
</body>
</html>