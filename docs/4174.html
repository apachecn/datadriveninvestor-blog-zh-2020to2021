<html>
<head>
<title>Let a vintage radio become an online radio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让老式收音机成为在线收音机</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/let-a-vintage-radio-become-an-online-radio-85168aaef288?source=collection_archive---------3-----------------------#2020-07-27">https://medium.datadriveninvestor.com/let-a-vintage-radio-become-an-online-radio-85168aaef288?source=collection_archive---------3-----------------------#2020-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="8248" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你如何使用一个自由市场收音机+一个树莓派来构建一个功能齐全的在线收音机。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="kt ku l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">A video of my vintage online radio</figcaption></figure><p id="d0ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我妻子一直希望我有一台收音机</p><ol class=""><li id="f5ed" class="kz la it js b jt ju jx jy kb lb kf lc kj ld kn le lf lg lh bi translated">看起来不错</li><li id="7d2b" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">易于控制</li><li id="e0a9" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">音质很好</li><li id="b1d2" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">播放来自互联网的频道</li></ol><p id="ec6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以市场上有很多新奇的网络收音机。但所有这些都有触摸屏，花哨的液晶显示器或播放约1000个频道，你不需要990个。我妻子还有一台70年代的Universum收音机，是她在一个跳蚤市场花了不到5欧元买的。虽然声音很差，而且不太可靠。我坐下来发现，一个树莓派，一个hifi-berry和一些小芯片可以很容易地让这个成为一个在线收音机。我们开始吧！不仅我做到了，你也能做到！(看本文结尾)</p><h1 id="bb2d" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">如何开始？</h1><h2 id="b88d" class="mm lp it bd lq mn mo dn lu mp mq dp ly kb mr ms mc kf mt mu mg kj mv mw mk mx bi translated">硬件设置</h2><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/de21764ba17cf9fff5ed3e9eb811d650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F6M-Bmfa1U-YZSOQdFWIeg.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">vintage radio construction site</figcaption></figure><p id="1c88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">起初我打开收音机，向里面看了看。我想知道哪些零件可以重复使用。我发现巨大的频道转换轮，可以很容易地连接到KY040旋转开关，可以与树莓皮一起工作。此外，我想保留开/关开关和音量控制。由于音量控制只是一个简单的电位计，它可以用模拟数字转换器读取。一个<a class="ae ln" href="https://www.hifiberry.com/" rel="noopener ugc nofollow" target="_blank"> hifi-berry </a>会发出声音。树莓派将是核心。我将添加一个LED来显示当前是否一切正常。这应该是硬件设置。</p><div class="nf ng gp gr nh ni"><a href="https://www.datadriveninvestor.com/2020/07/07/introduction-to-time-series-forecasting-of-stock-prices-with-python/" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">用Python |数据驱动投资者进行股票价格时间序列预测简介</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">在这个简单的教程中，我们将看看如何将时间序列模型应用于股票价格。更具体地说，一个…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw nd ni"/></div></div></a></div><h2 id="502e" class="mm lp it bd lq mn mo dn lu mp mq dp ly kb mr ms mc kf mt mu mg kj mv mw mk mx bi translated">软件设置</h2><p id="74fa" class="pw-post-body-paragraph jq jr it js b jt nx jv jw jx ny jz ka kb nz kd ke kf oa kh ki kj ob kl km kn im bi translated">作为一名数据科学家，我想用一种简单的编程语言来构建无线电软件。有很多关于如何与raspberry pi和Python的引脚进行交互的教程。所以我用了Python。我需要什么样的软件。因此，我需要解释，我的妻子希望收音机如何工作。</p><ol class=""><li id="61b5" class="kz la it js b jt ju jx jy kb lb kf lc kj ld kn le lf lg lh bi translated"><em class="oc">转动频道轮</em>:将改变频道。它应该像一个旧的调频收音机一样工作，在频道之间有噪音。如果没有通道，LED应闪烁，如果有通道，则保持静止。</li><li id="cd63" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated"><em class="oc">转动音量控制:</em>改变音量</li></ol><p id="26ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">哇，听起来很简单。所有这些可以简单地在脚本中运行，该脚本对KY040被转动或音量控制被转动作出反应。这个脚本将需要运行一些并行进程，因为音量控制和KY040应该是独立的。但是仍然有一些问题留给我:</p><ol class=""><li id="f7af" class="kz la it js b jt ju jx jy kb lb kf lc kj ld kn le lf lg lh bi translated"><em class="oc">我们如何管理可用频道列表？</em></li><li id="f28d" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated"><em class="oc">我如何知道哪个频道正在播放？</em></li><li id="74e3" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated"><em class="oc">当前播放的是哪首歌？</em></li></ol><p id="a175" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这两个问题，我决定写一个Python脚本。我之前为这样一个简单的用例写了一个<a class="ae ln" href="https://github.com/zappingseb/BBCafterScrobbler" rel="noopener ugc nofollow" target="_blank"> FlaskApp，并认为这是一个很好的方法。</a></p><h1 id="4f5f" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">建造收音机</h1><p id="7179" class="pw-post-body-paragraph jq jr it js b jt nx jv jw jx ny jz ka kb nz kd ke kf oa kh ki kj ob kl km kn im bi translated">我坐在我的桌子旁，拿着一个焊接离子，首先将音量控制电位计与芯片连接起来。然后将频道开关粘到KY040上，最后但同样重要的是，将LED添加到树莓pi上。然后我开始从我所有的输入中读取信号。我花了一段时间才弄明白如何在Python中使用并行进程。但基本模式是这样的:</p><pre class="ko kp kq kr gt od oe of og aw oh bi"><span id="2bfb" class="mm lp it oe b gy oi oj l ok ol">import threading</span><span id="d835" class="mm lp it oe b gy om oj l ok ol">class VolumeControl:</span><span id="ea3d" class="mm lp it oe b gy om oj l ok ol">  def start(self):<br/>    while self._running:<br/>      #do sth e.g. read PIN<br/>      sleep(0.05)<br/>  def is_running(self):<br/>     self._running<br/>  def stop(self):<br/>     self._running = False<br/>  def set_running(self):<br/>     self._running = True</span><span id="212b" class="mm lp it oe b gy om oj l ok ol"># Define and start the VolumeControl in a separate thread                               volume = VolumeControl()                               volume.set_running()<br/>t_volume = threading.Thread(target=volume.start)                               t_volume.start()</span><span id="b908" class="mm lp it oe b gy om oj l ok ol"># Stop the thread<br/>volume.stop()<br/>t_volume.join()</span></pre><p id="bd28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里你可以看到，我为raspberry pi的GPIO引脚的每个监听器创建了一个类。这个类将在一个<code class="fe on oo op oe b">while</code>循环中运行它的所有代码。这意味着它将持续检查GPIO引脚。在循环中，将有代码检查pin，然后超时，等待再次读取pin。</p><p id="d32d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我发现如何让这些不同的过程相互作用之后，我有了下面的过程:</p><p id="7484" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="oc">检查频道滚轮是否转动:</em></p><p id="01f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是:让LED进程闪烁，让播放器进程播放噪音</p><p id="04bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">No/channel found:让LED进程保持开启，让Player进程在字典中查找频道并播放该频道。使用<a class="ae ln" href="https://onlineradiobox.com/deu/" rel="noopener ugc nofollow" target="_blank"> onlineradiobox </a>查找当前播放的歌曲。</p><p id="9ea3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="oc">检查音量控制是否打开</em></p><p id="c982" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查它是上升还是下降，改变系统音量</p><p id="3354" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将当前播放的歌曲和频道作为一个<code class="fe on oo op oe b">json</code>文件存储在raspberry pi的SD卡上。此外，我捕获了所有错误，并将它们写入raspberry pi上的日志文件中。</p><p id="38e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">收音机这部分的所有代码都可以在<a class="ae ln" href="https://github.com/zappingseb/radioflask/blob/master/ky40.py" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。如果你认为这些过程很简单，其实不然。我最终用了大约900行代码来运行这个收音机。</p><h1 id="93f1" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">构建WebApp</h1><p id="0dbc" class="pw-post-body-paragraph jq jr it js b jt nx jv jw jx ny jz ka kb nz kd ke kf oa kh ki kj ob kl km kn im bi translated">构建WebApp比摆弄收音机要容易得多。WebApp应该具有以下功能:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi oq"><img src="../Images/5ede65e69794039cb8f09e147f9fda00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*73R6VU5HXmFWw7Bw.png"/></div></div></figure><ol class=""><li id="3fc2" class="kz la it js b jt ju jx jy kb lb kf lc kj ld kn le lf lg lh bi translated">在顶部显示当前播放频道的内容<code class="fe on oo op oe b">json</code>文件</li><li id="cc54" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">包含人们可以向列表中添加频道的表单。该表单应包含频道url、名称和onlineradiobox url。</li><li id="3460" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">包含当前频道列表，用户可以使用“-”按钮来删除频道。</li><li id="ed56" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">包含一个按钮来存储当前显示的频道列表。</li><li id="89c6" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">包含一个按钮，用于恢复进入应用程序时显示的频道列表。</li><li id="7bcf" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn le lf lg lh bi translated">将所有设置存储在一个<code class="fe on oo op oe b">json</code>文件中，运行无线电的脚本可以访问该文件。</li></ol><p id="0436" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">烧瓶的一个很好的特性是模板。在本例中，我为当前通道创建了一个模板，一个用于添加通道，一个用于删除通道。基本上就是这样。</p><p id="1b14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对我来说，最难的部分是理解一个烧瓶一般是如何工作的。这些应用程序主要被认为是与REST-API交互的。所以通常REST-API处理很多逻辑。重要的一点是，当打开应用程序时，有一个<code class="fe on oo op oe b">session</code>对象，其中包含应用程序内部显示的最后信息。所以只有在第一次启动时，我才需要从<code class="fe on oo op oe b">json</code>加载我的频道列表。每当我告诉应用程序覆盖这个<code class="fe on oo op oe b">json</code>时，我也需要通过使用<code class="fe on oo op oe b">session.pop</code>来刷新<code class="fe on oo op oe b">session</code>对象。</p><p id="fe39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我解决了<code class="fe on oo op oe b">session</code>的问题后，使用Flask变得简单了。您创建包含特定值的对象。你把对象交给一个HTML模板，它会在某些占位符上显示值。</p><p id="6455" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的app的全部代码也在Github上:<a class="ae ln" href="https://github.com/zappingseb/radioflask/blob/master/views.py" rel="noopener ugc nofollow" target="_blank">https://Github . com/zapping SEB/radio flask/blob/master/views . py</a></p><h1 id="2e17" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">Raspberry Pi设置</h1><p id="a28b" class="pw-post-body-paragraph jq jr it js b jt nx jv jw jx ny jz ka kb nz kd ke kf oa kh ki kj ob kl km kn im bi translated">最后但并非最不重要的是，有一些东西安装在树莓派。</p><ul class=""><li id="eeea" class="kz la it js b jt ju jx jy kb lb kf lc kj ld kn or lf lg lh bi translated">将Hifi-Berry设为默认音频设备</li><li id="9ef3" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn or lf lg lh bi translated">添加一个共享文件夹，将代码添加到pi中</li><li id="4046" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn or lf lg lh bi translated">让覆盆子进入你的无线网络</li><li id="46fe" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn or lf lg lh bi translated">添加所有必要的Python库，例如flask或RPI。GPIO</li><li id="f034" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn or lf lg lh bi translated">将python3设为默认python</li><li id="227d" class="kz la it js b jt li jx lj kb lk kf ll kj lm kn or lf lg lh bi translated">让广播脚本在启动raspberry pi时运行</li></ul><h1 id="0ff4" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated"><strong class="ak">现在构建您自己的！</strong></h1><p id="bc7f" class="pw-post-body-paragraph jq jr it js b jt nx jv jw jx ny jz ka kb nz kd ke kf oa kh ki kj ob kl km kn im bi translated">这篇文章只是关于如何制造收音机的介绍。我把所有必要的代码放在Github上，然后把整个收音机作为DIY工具包放在易贝上。该工具包不仅包含所有你需要建造收音机的零件，还包含一份如何建造和修理收音机的详细计划。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi os"><img src="../Images/0eac138b8997d2b470d1ff6ca810a60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RJ4oRhNVSsAIT_ptFheXmQ.jpeg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Vintage Internet Radio Kit</figcaption></figure><p id="a931" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在易贝向我购买整套工具。</p><p id="815e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">访问专家视图— </strong> <a class="ae ln" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>