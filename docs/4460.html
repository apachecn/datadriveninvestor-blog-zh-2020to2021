<html>
<head>
<title>Angular / RxJS â€” Top 5 ways to unsubscribe from Observables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">angular/RxJSâ€”â€”å–æ¶ˆè®¢é˜…å¯è§‚é¡¹ç›®çš„5å¤§æ–¹æ³•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.datadriveninvestor.com/angular-rxjs-top-5-ways-to-unsubscribe-from-observables-6e8d0a7226c?source=collection_archive---------4-----------------------#2020-08-09">https://medium.datadriveninvestor.com/angular-rxjs-top-5-ways-to-unsubscribe-from-observables-6e8d0a7226c?source=collection_archive---------4-----------------------#2020-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9bf080cccda71b5fe567488293d0e726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGfAtBYiAfeZRjBgCxe34w.png"/></div></div></figure><h1 id="8e70" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">1.æ‰‹åŠ¨å‘¼å«å–æ¶ˆè®¢é˜…()</h1><p id="4cb2" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Angularæœ‰ä¸€ä¸ªåœ¨æ‹†å¸é˜¶æ®µè°ƒç”¨çš„<code class="fe lx ly lz ma b">ngOnDestroy</code>é’©å­ï¼Œæä¾›åƒåœ¾æ”¶é›†ã€‚</p><p id="e301" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated">å½“æˆ‘ä»¬åœ¨Angularçš„ç»„ä»¶ä¸­ä½¿ç”¨Observablesæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è®¾ç½®ngOnDestroyæ–¹æ³•ï¼Œå¹¶å¯¹æ‰€æœ‰Observablesè°ƒç”¨unsubscribeæ–¹æ³•ã€‚</p><pre class="mg mh mi mj gt mk ma ml mm aw mn bi"><span id="5ba8" class="mo kc it ma b gy mp mq l mr ms">@Component({...})<br/>export class MessageComponent implements OnInit, OnDestroy {<br/>  messageSub: Subscription;<br/>  <br/>  ngOnInit () {<br/>    const messages$ = this.messageService.getMessages();<br/>    this.messageSub = messages$.subscribe()</span><span id="c273" class="mo kc it ma b gy mt mq l mr ms">  ngOnDestroy() {<br/>    this.messageSub.unsubscribe()<br/>  }<br/>}</span></pre><p id="d205" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated">æˆ‘ä»¬å°†ngOnDestroyæ·»åŠ åˆ°AppCompoenntä¸­ï¼Œå¹¶åœ¨<code class="fe lx ly lz ma b">this.messageSub</code> Observableä¸Šè°ƒç”¨unsubscribeæ–¹æ³•ã€‚</p><p id="703d" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated">å¦‚æœæœ‰å¤šä¸ªè®¢é˜…ï¼Œè¯·è€ƒè™‘å°†å®ƒä»¬æ¨é€åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚AppComponentä¸­æœ‰ä¸¤ä¸ªè®¢é˜…ã€‚å®ƒä»¬éƒ½åœ¨ngOnDestroyé’©å­ä¸­è¢«å–æ¶ˆè®¢é˜…ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚</p><pre class="mg mh mi mj gt mk ma ml mm aw mn bi"><span id="6bbb" class="mo kc it ma b gy mp mq l mr ms">@Component({...})<br/>export class AppComponent implements OnInit, OnDestroy {<br/>  messages$: Subscription;<br/>  currentUser$: Subscription;<br/>  subscriptions: Subscription[];</span><span id="b730" class="mo kc it ma b gy mt mq l mr ms">  ngOnInit () {<br/>    const messages$ = this.messageService.getMessages();<br/>    const currentUser$ = this.userService.currentUser();<br/>    this.subscriptions.push(messages$, currentUser$);</span><span id="6362" class="mo kc it ma b gy mt mq l mr ms">  ngOnDestroy() {<br/>    [...this.subscriptions].map(sub =&gt; sub.unsubscribe());<br/>  }<br/>}</span></pre><h1 id="c0b2" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">2.ä½¿ç”¨å¼‚æ­¥<code class="fe lx ly lz ma b">|</code>ç®¡é“</h1><p id="5915" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated"><code class="fe lx ly lz ma b">async</code>ç®¡é“è®¢é˜…ä¸€ä¸ª<code class="fe lx ly lz ma b">Observable</code>æˆ–<code class="fe lx ly lz ma b">Promise</code>å¹¶è¿”å›æœ€æ–°å‘å‡ºçš„å€¼ã€‚å½“ç»„ä»¶è¢«ç ´åæ—¶ï¼Œ<code class="fe lx ly lz ma b">async</code>ç®¡é“ä¼šè‡ªåŠ¨å–æ¶ˆè®¢é˜…ï¼Œä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚</p><pre class="mg mh mi mj gt mk ma ml mm aw mn bi"><span id="7307" class="mo kc it ma b gy mp mq l mr ms">@Component({<br/>    ...,<br/>    template: `<br/>        &lt;div class="messages" *ngIf="<strong class="ma iu">messages$ | async as message</strong>"&gt;<br/>         &lt;div class="item" *ngFor="let message of messages"&gt;<br/>           &lt;span [innerText]="message.text"&gt;&lt;/span&gt;<br/>           &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    `<br/>})<br/>export class AppComponent implements OnInit {<br/>    messages$: Observale&lt;Messages[]&gt;<br/>    ngOnInit () {<br/>        this.messages$ = this.messageService.getMessages();<br/>    }<br/>}</span></pre><p id="6353" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated">å¦‚æœæˆ‘ä»¬åœ¨ç»„ä»¶ä¸­ä½¿ç”¨Observablesï¼Œä½¿ç”¨å¼‚æ­¥ç®¡é“æ˜¯ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨è®¢é˜…/å–æ¶ˆè®¢é˜…å®ƒä»¬ã€‚æˆ‘ä»¬ä¸å¿…æ‰‹åŠ¨å–æ¶ˆè®¢é˜…åº”ç”¨ç¨‹åºä¸­çš„å¯è§‚æµ‹é‡ã€‚</p><div class="mu mv gp gr mw mx"><a href="https://www.datadriveninvestor.com/2020/05/27/clean-code-is-crucial-in-software-development-heres-why/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">å¹²å‡€çš„ä»£ç åœ¨è½¯ä»¶å¼€å‘ä¸­è‡³å…³é‡è¦â€”â€”è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ|æ•°æ®é©±åŠ¨æŠ•èµ„è€…</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">å¹²å‡€çš„ä»£ç æ˜¯â€œå®¹æ˜“ç†è§£å’Œå®¹æ˜“æ”¹å˜çš„â€ï¼Œå®ƒæ˜¯å…³äºå¯¹ç»†èŠ‚çš„å…³æ³¨ã€‚ä½†æ˜¯å¼€å‘äººå‘˜ä¸ºä»€ä¹ˆè¦æ‹…å¿ƒâ€¦</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl jz mx"/></div></div></a></div><h1 id="914e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">3.ä½¿ç”¨RxJS <code class="fe lx ly lz ma b">take*</code>è¿ç®—ç¬¦</h1><p id="5456" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">RxJSæœ‰è®¸å¤šæœ‰ç”¨çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºä¸­å–æ¶ˆè®¢é˜…ã€‚ä»–ä»¬ç”±<code class="fe lx ly lz ma b">take*</code>ç³»åˆ—è¿è¥å•†ç»„æˆ:</p><ul class=""><li id="c37d" class="nm nn it lb b lc mb lg mc lk no lo np ls nq lw nr ns nt nu bi translated"><strong class="lb iu">å–(</strong>é‡‘é¢:æ•°é‡<strong class="lb iu"> ) </strong></li><li id="b84d" class="nm nn it lb b lc nv lg nw lk nx lo ny ls nz lw nr ns nt nu bi translated"><strong class="lb iu"> takeUntil( </strong>é€šçŸ¥è€…:å¯è§‚å¯Ÿ<strong class="lb iu"> ) </strong></li><li id="a23f" class="nm nn it lb b lc nv lg nw lk nx lo ny ls nz lw nr ns nt nu bi translated"><strong class="lb iu"> takeWhile( </strong>æ¡ä»¶:å¯è§‚å¯Ÿ)</li></ul><h1 id="5109" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">æ‹¿èµ°</h1><p id="2da6" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è¯¥è¿ç®—ç¬¦ä½¿è®¢é˜…æ‰§è¡Œä¸€æ¬¡ã€‚è¯¥æ“ä½œç¬¦ä½¿æºè®¢é˜…å‘ç”ŸæŒ‡å®šçš„æ¬¡æ•°<code class="fe lx ly lz ma b">n</code>å¹¶å®Œæˆã€‚</p><p id="91a7" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated"><code class="fe lx ly lz ma b">1</code>é€šå¸¸ä¸takeæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤è®¢é˜…å‘ç”Ÿä¸€æ¬¡å°±é€€å‡ºã€‚</p><p id="5b35" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated">å½“æˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªæºå¯è§‚å¯Ÿå¯¹è±¡å‘å‡ºä¸€æ¬¡ï¼Œç„¶åä»æµä¸­å–æ¶ˆè®¢é˜…æ—¶ï¼Œè¿™ä¸ªæ“ä½œç¬¦æ˜¯æœ‰æ•ˆçš„ï¼›åœ¨ä½¿ç”¨è·¯å¾„è§£æå™¨æ—¶å°¤å…¶æœ‰ç”¨ï¼Œåªéœ€è°ƒç”¨take(1)æ¥ç¡®ä¿è·å¾—ä¸€ä¸ªæ•°æ®æºï¼Œä»¥ä¾¿è§£æå™¨å¯ä»¥ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°æ®é›†ã€‚</p><pre class="mg mh mi mj gt mk ma ml mm aw mn bi"><span id="8f4a" class="mo kc it ma b gy mp mq l mr ms">@Component({<br/>    ...<br/>})<br/>export class MessageComponent implements OnInit {<br/>    ngOnInit () {<br/>        const messages$ = this.messageService.getMessages()<br/>        <br/>        messages$.pipe(take(1)).subscribe();<br/>     }<br/>}</span></pre><h1 id="e031" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">takeUntil(é€šçŸ¥ç¨‹åº)</h1><p id="93af" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è¯¥æ“ä½œç¬¦å‘å‡ºç”±æºå¯è§‚å¯Ÿå¯¹è±¡å‘å‡ºçš„å€¼ï¼Œç›´åˆ°é€šçŸ¥è€…å¯è§‚å¯Ÿå¯¹è±¡å‘å‡ºä¸€ä¸ªå€¼ã€‚</p><pre class="mg mh mi mj gt mk ma ml mm aw mn bi"><span id="1801" class="mo kc it ma b gy mp mq l mr ms">@Component({...})<br/>export class AppComponent implements OnInit, OnDestroy {<br/>    destroyed$ = new Subject&lt;boolean&gt;();</span><span id="af00" class="mo kc it ma b gy mt mq l mr ms">  ngOnInit () {<br/>    const messages$ = this.messageService.getMessages();    <br/>    messages$$.pipe(takeUntil(this.destroyed$)).subscribe();<br/>  }    <br/>  <br/>  ngOnDestroy() {<br/>    this.destroyed$.next(true);<br/>    this.destroyed$.unsubscribe();<br/>    }<br/>}</span></pre><p id="1eb9" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated">æˆ‘ä»¬æœ‰ä¸€ä¸ªé¢å¤–çš„é€šçŸ¥ä¸»é¢˜ï¼Œè¿™æ˜¯ç”¨æ¥è®©<code class="fe lx ly lz ma b">this.destroyed$</code>å–æ¶ˆè®¢é˜…çš„ã€‚åœ¨æˆ‘ä»¬è®¢é˜…ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨ç®¡é“æŠŠå¯è§‚å¯Ÿçš„ä¸œè¥¿è¾“é€åˆ°ã€‚takeUntilå°†å‘å‡ºé—´éš”å‘å‡ºçš„å€¼ï¼Œç›´åˆ°<code class="fe lx ly lz ma b">destroyed$</code>ä¸»é¢˜å‘å‡ºï¼Œç„¶åå®ƒå°†å–æ¶ˆè®¢é˜…<code class="fe lx ly lz ma b">messages$</code></p><h1 id="0e08" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">takeWhile(æ¡ä»¶)</h1><p id="8d82" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated"><code class="fe lx ly lz ma b">takeWhile</code>æ˜¯å¦ä¸€ä¸ªå¼ºå¤§çš„æ“ä½œç¬¦ï¼Œä½†æ˜¯å¦‚æœæ‚¨éœ€è¦æ¡ä»¶ä¸­çš„æ•°æ®ï¼Œå°±ä¸è¦ä½¿ç”¨å®ƒã€‚å¯¹äºé‚£äº›åœºæ™¯ï¼Œå»ºè®®åšæŒä½¿ç”¨<code class="fe lx ly lz ma b">takeUntil</code>ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªä¸»é¢˜å®ä¾‹æ¥è§¦å‘å®ƒã€‚</p><pre class="mg mh mi mj gt mk ma ml mm aw mn bi"><span id="3812" class="mo kc it ma b gy mp mq l mr ms">// 1, 2, 3, 4, 5<br/>const array$ = of(1, 2, 3, 4, 5);</span><span id="1171" class="mo kc it ma b gy mt mq l mr ms">array$.pipe(takeWhile(val =&gt; val &lt;= 4))</span></pre><h1 id="4b4d" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">å¦‚æœè¿™å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·é¼“æŒï¼ğŸ™</h1><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/310b4e51aaa4b87c9fd2261939a32732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6iaKPnfvW92K2LUrxempHw.gif"/></div></div></figure><p id="72eb" class="pw-post-body-paragraph kz la it lb b lc mb le lf lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw im bi translated"><strong class="lb iu">è®¿é—®ä¸“å®¶è§†å›¾â€” </strong> <a class="ae ob" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">è®¢é˜…DDIè‹±ç‰¹å°”</strong> </a></p></div></div>    
</body>
</html>