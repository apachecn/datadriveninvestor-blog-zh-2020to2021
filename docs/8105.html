<html>
<head>
<title>Authentication Flask API using Json Web Tokens</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Json Web令牌的身份验证Flask API</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/authentication-flask-api-using-json-web-tokens-50104f2f1533?source=collection_archive---------1-----------------------#2021-01-01">https://medium.datadriveninvestor.com/authentication-flask-api-using-json-web-tokens-50104f2f1533?source=collection_archive---------1-----------------------#2021-01-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ccad" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用JWT-Python进行身份验证的简单flask应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8c0f99b78df88495328adfeaf88f14db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bRy34ot5nZdvAvMHyEmH7g.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae ky" href="https://unsplash.com/s/photos/authentication?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cef5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个故事中，我们将看看如何在flask python中使用flask登录进行认证和授权。认证意味着你验证某人的凭证，而授权则决定他们是否可以访问网站的某个部分。</p><p id="75fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们弄清楚它是什么。</p><p id="9757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先让我们浏览一下我们将在本教程中使用的<strong class="lb iu">库</strong>。</p><ol class=""><li id="8329" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">使用的库</li></ol><p id="48e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Flask  : Flask是一个流行的Python web框架，这意味着它是一个用于开发web应用程序的第三方Python库。</p><p id="4039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> uuid </strong> : UUID，通用唯一标识符，是一个python库，帮助生成128位的随机对象作为id。</p><p id="100f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">Werkzeug</strong>:<em class="me">Werkzeug</em>是python库，其中包含了大量用于实现web应用程序网关接口(<code class="fe mf mg mh mi b">WSGI</code>)应用程序的开发和调试工具。在本教程中，我们使用它来生成和检查密码散列。</p><p id="5a5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PyJWT  : <code class="fe mf mg mh mi b">PyJWT</code>是一个Python库，允许你编码和解码JSON Web令牌(JWT)。</p><p id="fa40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> functools </strong> : functools是高阶函数(作用于或返回其他函数的函数)的标准Python模块。<code class="fe mf mg mh mi b">wraps()</code>是一个装饰器，应用于装饰器的包装函数。它通过复制诸如<code class="fe mf mg mh mi b">__name__</code>、<code class="fe mf mg mh mi b">__doc__</code>(文档字符串)等属性来更新<code class="fe mf mg mh mi b">wrapper</code>函数，使其看起来像<code class="fe mf mg mh mi b">wrapped</code>函数。</p><div class="mj mk gp gr ml mm"><a href="https://www.datadriveninvestor.com/2020/12/07/name-matching-techniques-with-python/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd iu gy z fp mr fr fs ms fu fw is bi translated">使用Python |数据驱动投资者的名称匹配技术</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">我们确实面临很多情况，我们必须匹配一个有很多变体的单词。这可能是因为错别字…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na ks mm"/></div></div></a></div><p id="2683" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">py mongo</strong>:py mongo发行版包含从Python与MongoDB数据库交互的工具。</p><p id="6ada" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们创建一个简单的flask应用程序，它有两条路线。因为这是一个教程，所以一个路由可以不经过认证而被访问，但是另一个路由需要认证。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="c164" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里你可以看到，当我运行这个烧瓶应用程序。我可以进入两条路线。见下图。</p><div class="kj kk kl km gt ab cb"><figure class="nd kn ne nf ng nh ni paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/a73b376ecd66646a4ad9f659c18eb0b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*uTixVxdlie1-kwLeA6MmrA.png"/></div></figure><figure class="nd kn nj nf ng nh ni paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/72d3d641c1bec7e34f4a1b6404c15629.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*c8t8Ukki9jG-DlRvQIox0A.png"/></div></figure><figure class="nd kn nk nf ng nh ni paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f0b9b150924b39347e42fca39cb10a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*wew0HdptboSPJt1Ns1srHw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk nl di nm nn">Generated By Author</figcaption></figure></div><p id="39f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我应该添加身份验证和授权。第一步是创建一个注册API。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们请求将<code class="fe mf mg mh mi b">name, emailid and password</code>作为API中的表单数据。我们还增加了一些验证电子邮件格式和密码的功能。现在，通过使用<code class="fe mf mg mh mi b">uuid</code>和<code class="fe mf mg mh mi b">werkzeug</code>，我们添加了一个唯一的<code class="fe mf mg mh mi b">userid</code>，并为用户提供的密码生成了一个散列。所有这些都用pymongo保存到<code class="fe mf mg mh mi b">mongodb</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/ec87ef941afece1d6268bddce667744a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*5M74tBHimjMTFde3rjmrgg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Generated By Author</figcaption></figure><p id="db9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在创建一个<strong class="lb iu">登录</strong> API来生成jwt令牌。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a4a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们创建了一条路线<code class="fe mf mg mh mi b">/login.</code>，将<code class="fe mf mg mh mi b">emailid, passwords</code>作为输入。首先，评估电子邮件id，并检查是否有具有相同电子邮件id的用户。之后，使用<code class="fe mf mg mh mi b">check_password_hash</code>函数对用户密码和输入密码进行哈希运算和检查。如果一切正常，<code class="fe mf mg mh mi b">jwt.encode</code>方法生成一个在<code class="fe mf mg mh mi b">‘exp’</code>时间内有效的令牌，我们将它作为参数提及，为了创建令牌<code class="fe mf mg mh mi b">userid</code>，必须给出一个<code class="fe mf mg mh mi b">secretkey</code>作为参数。这个密钥可以是任何数字。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/57799f0ef1463e9e2dabc079d47cf000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IvA3ApNRfJYv6TAnjfJZ0Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Generated By Author</figcaption></figure><p id="138e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在这个令牌可以用于授权。之前，我们创建了两个API路由。一个需要认证，另一个不需要。但是我们如何给API路由添加授权呢？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ea60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们需要认证的一个API添加了一个<code class="fe mf mg mh mi b">@token_required</code>装饰函数。上面也写了这个函数。它实际上检查request.headers部分中的“x-access-token”。这将检查API的授权。现在运行它并查看它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/9119fedea1eee65b93861f5225749375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hHgOTeXGln7rAUCNX8Ujw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Generated By Author</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/44a80e4fd311c1f2c90fbe083bf7414c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IZmg6Aj1NA9Gk7OWfRWRA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Generated By Author</figcaption></figure><p id="d2f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请通过gihub repo获取完整的代码库。</p><div class="mj mk gp gr ml mm"><a href="https://github.com/raoofnaushad/authentication_flask_api_jwt" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd iu gy z fp mr fr fs ms fu fw is bi translated">raoofnaushad/authentic ation _ flask _ API _ jwt</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">使用JWT-Python-raoofnaushad/authentic ation _ flask _ API _ jwt验证的简单flask应用程序</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">github.com</p></div></div><div class="mv l"><div class="ns l mx my mz mv na ks mm"/></div></div></a></div></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="db34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这个故事对你们所有人有用。谢谢你的时间。</p><p id="030a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">访问专家视图— <a class="ae ky" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>