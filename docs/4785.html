<html>
<head>
<title>How fast is JavaScript to C or C#?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript到C或C#有多快？</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/how-fast-is-javascript-to-c-or-c-29d104f4f255?source=collection_archive---------0-----------------------#2020-08-24">https://medium.datadriveninvestor.com/how-fast-is-javascript-to-c-or-c-29d104f4f255?source=collection_archive---------0-----------------------#2020-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f5972529ae811b644fbbda2bd4ffc504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZIdIUPhskjVuyUj7"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@hafidhsatyanto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Hafidh Satyanto</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f3d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">性能关键型应用应该选择哪种技术？节点是如何。NET核心，或者说电子相对于原生应用？</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="aa3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不同的语言和运行时在各自的领域中具有不同的优势；所以，苹果和橘子真的…</p><p id="27ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，不同的代码段在性能方面的转换也很有趣。</p><p id="b6a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有测试都在MacBook Pro 15英寸2018、2.2 GHz 6核英特尔酷睿i7–8750h和macOS Catalina上运行。</p><h2 id="4b6a" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">加法赋值运算符</h2><p id="69ae" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">首先，使用下面的代码段，用简单的算术将JavaScript、C和C#与2亿个加法赋值运算符进行比较:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="99c8" class="li lj iq ml b gy mp mq l mr ms">// C<br/>int temp = 1;<br/>for (int i = 0; i &lt; 200000000; i++)<br/>    temp += temp;</span><span id="b44a" class="li lj iq ml b gy mt mq l mr ms">// C#<br/>int temp = 1;<br/>for (var i = 0; i &lt; 200000000; i++)<br/>  temp += temp;</span><span id="131b" class="li lj iq ml b gy mt mq l mr ms">// JavaScript<br/>let temp = 1;<br/>for (let i = 0; i &lt; 200000000; i++)<br/>  temp += temp;</span></pre><p id="0bb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于C，我将使用CLion执行C11发布版本:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/b67924fce7747095ba091fceb52a002d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*og83uASSt9s7EHgLli9kpA.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">CLion execution resulting in 6,219,000 nanoseconds</figcaption></figure><p id="f818" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于C#，我将使用骑士执行。NET Core 3.1.301发布版本:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/38993dcb8516b6bdea046f471b62d5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BissBRDH77e1M7b41hA18w.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Rider execution resulting in 109 milliseconds</figcaption></figure><p id="23f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于JavaScript，我将使用在Node v14.8.0中执行的IntelliJ IDEA:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/1b066302de340266d592b2d06ee09ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2GryYV6qBn_hfqrLMHW6ew.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">IntelliJ IDEA execution resulting in ~476 milliseconds</figcaption></figure><p id="2ea3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/8df18885780c8bae11590212f1582b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lLLwU1dB5hAI8LDyfMX9A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="a9c3" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">C: 6.219毫秒，每秒大约160</li><li id="a474" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">C#: 109毫秒，大约9秒</li><li id="102b" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">JS: 202毫秒，大约每秒5秒</li></ul><h2 id="41be" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">对数</h2><p id="faf7" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">对于更复杂的数学运算，使用以下代码段将JavaScript、C和C#与1亿个对数进行比较:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="24ee" class="li lj iq ml b gy mp mq l mr ms">// C<br/>double n;<br/>for (int i = 0; i &lt; 100000000; i++)<br/>    n = log(i);</span><span id="3180" class="li lj iq ml b gy mt mq l mr ms">// C#<br/>double n;<br/>for (var i = 0; i &lt; 100000000; i++)<br/>  n = Math.Log(i);</span><span id="fdc8" class="li lj iq ml b gy mt mq l mr ms">// JavaScript<br/>let ret;<br/>for (let i = 0; i &lt; 100000000; i++)<br/>  n = Math.log(i);</span></pre><p id="5d1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/12005877cf40723f855ef20416ca2dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kECfUjrXj5Jku5yTKTWMSw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="1a74" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">C: 33.563毫秒，大约每秒30秒</li><li id="224e" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">C#: 465毫秒，大约每秒2秒</li><li id="b2cd" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">JS: 947毫秒，大约每秒1秒</li></ul><h2 id="8319" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">阵列总体</h2><p id="f583" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">使用以下代码段比较JavaScript、C和C#与1000万数组赋值:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="04e0" class="li lj iq ml b gy mp mq l mr ms">// C<br/>int a[10000000];<br/>for (int i = 0; i &lt; 10000000; i++)<br/>    a[i] = i;</span><span id="aec2" class="li lj iq ml b gy mt mq l mr ms">// C#<br/>int[] a = new int[10000000];<br/>for (var i = 0; i &lt; 10000000; i++)<br/>  a[i] = i;</span><span id="d337" class="li lj iq ml b gy mt mq l mr ms">// JavaScript<br/>let a = new Array(10000000);<br/>for (let i = 0; i &lt; 10000000; i++)<br/>  a[i] = i;</span></pre><p id="a51f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/e07ff06ceb8c3d29e7b7093d67c47408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZYybsj3MB22fYj_2wJ4Qw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="7923" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">C: 3.081毫秒，每秒大约325秒</li><li id="5f97" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">C#: 21毫秒，大约47秒</li><li id="69a9" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">JS: 9毫秒，大约111秒</li></ul><p id="752b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，以正确的大小初始化JavaScript数组至关重要；否则，依赖阵列增长会带来巨大的成本。</p><p id="b6f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果在没有初始数组大小的情况下重写JavaScript代码:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="b945" class="li lj iq ml b gy mp mq l mr ms">// JavaScript<br/>let a = [];<br/>for (let i = 0; i &lt; 10000000; i++)<br/>  a[i] = i;</span></pre><p id="1f3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/31177ea6c1094e6ca37d2099bd354ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SO2k1jSZr_kPX7Ij0fe0mQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="4a32" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">JS(未优化):270毫秒，大约每秒4次</li></ul><h2 id="7b05" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">随机数生成</h2><p id="d518" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">使用以下代码段比较JavaScript、C和C#与1000万个随机数的生成:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="0ae4" class="li lj iq ml b gy mp mq l mr ms">// C<br/>srand(time(0));<br/>for (int i = 0; i &lt; 10000000; i++)<br/>    rand();</span><span id="a569" class="li lj iq ml b gy mt mq l mr ms">// C#<br/>var rand = new Random();<br/>for (var i = 0; i &lt; 10000000; i++)<br/>  rand.Next();</span><span id="4adb" class="li lj iq ml b gy mt mq l mr ms">// JavaScript<br/>for (let i = 0; i &lt; 10000000; i++)<br/>  Math.random();</span></pre><p id="152d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/d00ef50f09ac58d23afd1d357979d973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZ6wm-Ia_KJbI3UvbL4Ttg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="8c42" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">C: 54.738毫秒，大约18秒</li><li id="50e6" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">C#: 87毫秒，大约12秒</li><li id="814e" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">JS: 69毫秒，大约15秒</li></ul><h2 id="22aa" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">串并置</h2><p id="eb08" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">使用以下代码段比较JavaScript、C和C#与一百万个字符串的连接:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="10e4" class="li lj iq ml b gy mp mq l mr ms">// C<br/>char* result = NULL;<br/>size_t resultSize = 0;<br/>FILE* stream = open_memstream(&amp;result, &amp;resultSize);<br/>for (int i = 0; i &lt; 1000000; i++)<br/>    fprintf(stream, "ab", i, i);<br/>fclose(stream);<br/>free(result);</span><span id="0214" class="li lj iq ml b gy mt mq l mr ms">// C#<br/>StringBuilder str = new StringBuilder();<br/>for (var i = 0; i &lt; 1000000; i++)<br/>  str.Append("ab");</span><span id="f32f" class="li lj iq ml b gy mt mq l mr ms">// JavaScript<br/>let str = '';<br/>for (let i = 0; i &lt; 1000000; i++)<br/>  str += 'ab';</span></pre><p id="7bf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/3ce1f0797721fb5588b2f894d89cdf75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qOrjs8Ig6FoXzZPqqhdNYg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="6bff" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">C: 71.243毫秒，大约14秒</li><li id="d4a0" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">C#: 6毫秒，大约每秒166次</li><li id="b4a4" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">JS: 48毫秒，大约每秒21秒</li></ul><p id="ec04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">C#有许多字符串连接操作，如<code class="fe nk nl nm ml b">+=</code>操作符、<code class="fe nk nl nm ml b">Concat</code>、<code class="fe nk nl nm ml b">Join</code>、<code class="fe nk nl nm ml b">Format</code>或插值，但以上利用了<code class="fe nk nl nm ml b">StringBuilder</code>来获得最高性能。</p><p id="17c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们用JavaScript示例中的<code class="fe nk nl nm ml b">+=</code>操作符替换它:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="98cd" class="li lj iq ml b gy mp mq l mr ms">// C#<br/>string str = "";<br/>for (var i = 0; i &lt; 1000000; i++)<br/>  str += "ab";</span></pre><p id="573a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/4bfb2d1aaa364f6cb4e18c420a4a23e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCQYyCv-GH4XtPtuBDUDfg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="1874" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">C#(未优化):7.9分钟</li></ul><p id="f366" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">c也需要优化，因为使用<code class="fe nk nl nm ml b">strcat</code>也很慢:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="a270" class="li lj iq ml b gy mp mq l mr ms">// C<br/>char *str1;<br/>str1 = malloc(1000001*2*sizeof(char));<br/>char *str2 = "ab";<br/>for (int i = 0; i &lt; 1000000; i++)<br/>    strcat(str1, str2);</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/2c9a2abe452409939305a695774d00d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41XDwQO7KO2TteNwuyXBGg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Time in milliseconds, lower is better</figcaption></figure><ul class=""><li id="2651" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">c(未优化):29秒</li></ul><h2 id="c0c8" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">结论</h2><p id="aa01" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">这个薄的横截面没有反映真实世界的例子，这里可以考虑进一步的优化。</p><p id="84d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">考虑到最初的JIT编译时间损失、并行并发能力或编译器自动应用的优化的成熟度，甚至性能速度的概念也是有争议的。</p><p id="e1d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这五个例子集中在数学和记忆管理上，同时揭示了实现中的思想如何极大地影响结果。</p><p id="3905" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看到像JavaScript这样的现代引擎逐渐接近本地性能也是令人兴奋的。</p><p id="60fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">进入专家视角— </strong> <a class="ae kc" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>