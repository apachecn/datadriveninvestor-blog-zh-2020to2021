# DevOps 灾难:过度使用工具和搞砸。

> 原文：<https://medium.datadriveninvestor.com/devops-disasters-overusing-tools-and-messing-up-7d8a37feeee?source=collection_archive---------13----------------------->

![](img/ea17d76c840cedcb1038cda18073d288.png)

# 这种现象

一个非常有趣的现象现在出现在我们的日常生活中。它与我们在环境中使用特定工具的方式有关。在许多情况下，当有任务要完成时，工程师根据他们的直觉行动。我们的理解和智慧往往仅限于一些工具。到我们最有经验的工具。我们试图将我们的知识联系起来，解决我们的工具不太适合甚至根本不适合的问题。当我们抓住当天的炒作时，情况完全不同。在这种炒作下，我们试图让新工具不符合它们的主要目的，也不符合它们不属于的环境。

问题的根源可能是不愿意看到工具真正的设计意图。知识库和专家之间缺乏沟通也是一个原因。

[](https://www.datadriveninvestor.com/2019/03/26/agile-management-the-good-the-bad-and-the-downright-ugly/) [## 敏捷管理:好的、坏的、丑陋的|数据驱动的投资者

### 公司不断重塑自己，以获得或保持竞争优势和市场份额。这是…

www.datadriveninvestor.com](https://www.datadriveninvestor.com/2019/03/26/agile-management-the-good-the-bad-and-the-downright-ugly/) 

DevOps 协作在这一点上失败了，我们处于这样一种情况:开发人员对操作了解较少，而运营人员对开发了解较少。他们每个人都试图过度使用熟知的工具。

结果是:

*   难以维护和调试的实用 BASH 程序。为什么我们这里不能用 Python，Ruby 或者 GO？。
*   CI 建立在带有本地执行自制模块的 Terraform 上，我们甚至不需要任何工具来实现这一点。
*   Ansible，Puppet，Chef 混沌与声明性工具上应用的命令式逻辑。
*   作为虚拟机的 Docker。程序设计语言的 exec 函数中的一种 Docker run 命令。

# 坏的，丑陋的

这里有一些过度使用工具的真实例子。

让我们看看在这个不可知的世界里事情是怎样的。

Ansible 是一个配置管理工具。它最大的优势之一是以声明的方式编写基础设施。你只需要声明你想要什么，你不需要关心 Ansible 怎么做。

许多组织中有大量的 Ansible 代码试图将 Bash 脚本的每一行翻译成 Ansible 代码。这些组织不愿意将他们的过程改变为可行的概念。通常他们会过度使用`shell`或`command`模块。为什么这样不好？这种做法给工具本身带来了许多问题。例如缺乏幂等性。因此，代码不会检查机器上的任何资源状态。这使我们失去了 Ansible 和其他配置工具的最大优势之一。我们可以预期更多的 CPU 消耗和最长的执行时间。这也使得我们的代码是可靠的，我们可以忘记 Ansible 的抽象能力。更重要的是，这很难调试、测试和维护。Ansible 并不打算将它的代码作为一步一步的命令来运行，但它是被迫的。最好使用声明式编程风格，该工具将决定如何以正确的方式完成。最佳实践是根本不使用 shell 或 command。这通常发生在工程师沉迷于新技术的宣传，但是按照他们所知道的写代码的时候。

现在是**码头工人**的时间

将 docker 包装成 bash 脚本的有趣例子。一个产品的多容器 docker 交付完全自动化成几个 bash 脚本，这是一个非常肮脏的自动化黑客。意图很好，但结果很糟糕，给生产中的这种特定产品带来了很多问题。自动化任务通过 docker 内部 IP 地址将应用程序链接到数据库容器。没什么特别的，一个经典的 docker 桥接网络。作为这种方法的结果，服务器重启导致 docker 容器 IP 地址改变。应用程序无法启动，它无法连接到数据库，因为数据库的 IP 已更改。bash 的过度使用不仅在生产中产生了真正的 bug。这也使得理解应用程序结构、调试和改变环境变量变得困难。不愿意学习新的东西，比如 docker-compose，另一方面，在 bash-scripting 方面有丰富的经验，这使得我们可以有这个过度使用 shell 脚本的好例子。

过度使用编程语言来运行 docker-compose 命令。不，当你用设计好的 API 来使用它的时候，它还不错。但是当我们在程序中使用 exec 函数来包装`docker-compose up`命令时，这种情况确实很糟糕。docker 无法启动，并且没有任何错误消息，是的，这就是发生的情况。“现在就做”的期限和舒适的环境(编程语言)起到了作用。更正确和更快速的方法是简单地使用 maven 插件、bash 脚本(以正确的方式)或者甚至是手动步骤。

过度使用 docker 的一个很好的例子是在生产环境中将它作为虚拟机使用。我发现的时候也是这样用 docker 的。在局部环境下进行一些实验，像 VM 一样使用 docker 并没有错。在生产环境中，当我们使用 docker 容器作为虚拟机时会带来很多问题。最佳实践是将 docker 用作单个流程服务。将它与 systemd 或其他进程管理工具一起使用，会使跟踪容器中的应用程序变得更加困难。这可能会给你的应用程序带来错误的运行状态。同样，如果你错误地设计了 docker 图片，传统的“CTRL-C”也将不起作用。

# 蝴蝶效应

过度使用工具正迫使我们，工程师，多年来停留在相同的自我发展水平，使我们成为 IT 世界的恐龙。我们很难跟上技术发展的步伐。其结果是另一种对最新技术的错误使用，因为我们几乎没有正确理解它们。

对于组织和项目来说，这带来了更多的问题。最大的一个是遗产。只有一个人知道“它是如何工作的”,因为它不像手册或文档中那样工作。代码中充满了杂乱无章的东西。维护它在时间、质量和金钱方面都是昂贵的。让新人加入项目既困难又耗时。在存在这种现象的项目中，新工程师的进入可能需要一年甚至更长时间。时间就是金钱。

然而，最危险的事情是把这种经历带到社区。在新人们学习的社区中，他们交流知识并推动事情向前发展。这件事发生在我个人的一个社区。很多工程师试图用工具去做他们不打算做的事情。例如，在 Terraform 的帮助下，在生产环境中保持代码“最新”。这种做法花了我很多时间通过丑陋和难以维护的变通方法解决问题。当然，这不仅会导致开支，还会导致有才华的团队和个人丧失热情。

# 表现得像个真正的德沃普。

最佳实践是仅将工具用于其设计目的。如果没有这样的工具，你最好写出来，为什么不把它带到社区里。

此外，建议不要偏离官方文件。有时我们在使用某些工具时并不那么灵活，但是你最好不要为了你的目的而修改它。更好的办法是将这个问题带到社区中，为这个工具开发一个真正酷的功能，或者一个插件。

如果你过度使用 DevOps 工具，不仅请停止。如果您只是按照预期方式使用技术，请为社区做出贡献。转到堆栈溢出，使它变得更好。走进社区去争论，要么你会学到，要么你会教很多人那才是正确的解决方案。

工具的正确使用是基础设施的代码质量。我们可以衡量这种情况的一个关键因素是组织中人员的切入点。代码和解决方案应该不言自明，不需要解释，没有隐藏的路径会发生奇迹。人们越快融入团队，越快修改你的解决方案，你就能越好地使用 DevOps 工具。

# 结论

众所周知，DevOps 不仅仅是工具，它让我们的生活变得更轻松、更精彩。这个世界现在太混乱了，我们必须解决它。设计正确的架构比编写代码行更重要。理解更适合我们的任务已经是解决方案的一半，就像理解问题本身一样。我们应该总是深入问题，选择最佳的解决方案，这将使我们远离麻烦。

有许多不断改进的 DevOps 工具目录可以帮助我们达到最佳效果。在该目录中，深入分析了所有工具对每个领域的影响。让每个工具适合正确的任务，并保持更新。因此，您将开始更快地整合人员，并且您的解决方案将基于技术和团队。你的解决方案不会集中在一个单一的未记录的知识来源上，也就是“无所不知的家伙”

让这个世界变得更美好是我们的力量。思考，编码，分享。

别忘了我们可以衡量 DevOps，而且我们应该使用正确的指标。