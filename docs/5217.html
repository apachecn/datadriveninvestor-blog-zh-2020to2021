<html>
<head>
<title>A simple algorithmic trading strategy in python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">python中一个简单的算法交易策略</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/a-simple-algorithmic-trading-strategy-in-python-aadb5326dcb8?source=collection_archive---------0-----------------------#2020-09-10">https://medium.datadriveninvestor.com/a-simple-algorithmic-trading-strategy-in-python-aadb5326dcb8?source=collection_archive---------0-----------------------#2020-09-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5041753317fe5ac82fb8cbec2632c174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EvtEjk3hoHka_yJX"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Austin Distel</a></figcaption></figure><p id="b12c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将建立在我之前的<a class="ae kc" href="https://medium.com/datadriveninvestor/the-types-of-automated-trading-algorithms-228d537254a8" rel="noopener">帖子</a>中描述的理论基础上，并向您展示如何构建您自己的策略实现算法。</p><p id="d3a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，这不是建立一个完全复杂的模型，使用各种人工智能算法和信号来获得竞争优势，我们将在后面的文章中实现这一点。我将展示一个简单的策略，希望能给你一个模板，让你将来学习和编写自己的策略。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="4eb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该策略使用布林线来定义欠买和超卖水平，并在这些区域进行交易。</p><p id="2f41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">约翰·布林格在80年代创造的布林线，给出了对一个工具的价格和波动性的简明的见解。由3条线组成，中间的线通常是20天简单移动平均线，上面的线和下面的线代表与SMA线的标准偏差，通常是标准偏差的2倍。</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/2ca4c263699d6a701fa1547a4a9502a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*d8h8pT69z4hPCupE3u1vQA.png"/></div></figure><p id="0658" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将编码的策略将在英镑/美元货币集上交易，并将涉及当价格突破<strong class="kf ir">下限</strong>时<strong class="kf ir">买入</strong>，当价格突破<strong class="kf ir">上限</strong>时<strong class="kf ir">卖出</strong>。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="221e" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">导入相关库并建立笔记本</h2><p id="812a" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">与所有python工作一样，第一步是导入我们需要的相关包。</p><pre class="lj lk ll lm gt ml mm mn mo aw mp bi"><span id="325a" class="ln lo iq mm b gy mq mr l ms mt">#import needed libraries<br/>import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import backtrader as bt<br/>from datetime import datetime<br/>import os<br/>from alpha_vantage.foreignexchange import ForeignExchange<br/>import warnings</span><span id="1f79" class="ln lo iq mm b gy mu mr l ms mt">#Configure certain elements to work best in Jupyterlab<br/>%matplotlib inline</span><span id="972c" class="ln lo iq mm b gy mu mr l ms mt">#I add the line below to let the plots take advantage of my Macbook Retina screen, feel free to remove</span><span id="5ba9" class="ln lo iq mm b gy mu mr l ms mt">%config InlineBackend.figure_format ='retina'<br/>plt.rcParams['figure.figsize'] = 16,9<br/>pd.set_option('display.max_colwidth', -1)<br/>warnings.filterwarnings('ignore')</span></pre><h2 id="5bf0" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">收集数据</h2><p id="f67e" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我使用Alpha vantage收集历史数据，为了让您自己收集数据，您需要创建一个免费帐户。访问网站<br/><a class="ae kc" href="https://www.alphavantage.co/" rel="noopener ugc nofollow" target="_blank">https://www.alphavantage.co/</a>并遵循那里的指示。</p><p id="46a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将您的凭证作为自由文本复制到您的代码中从来都不是一个好的做法。<br/>我已经将我的凭证放在本地的一个. env文件中。</p><p id="d482" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的代码将返回过去19年英镑/美元货币对的每日OHLC价格。</p><pre class="lj lk ll lm gt ml mm mn mo aw mp bi"><span id="494c" class="ln lo iq mm b gy mq mr l ms mt">cc = ForeignExchange(key=os.environ['alpha_vantage_token'],output_format='pandas')</span><span id="d490" class="ln lo iq mm b gy mu mr l ms mt"># We will retrieve daily OHLC prices, Alpha vantage also contains intraday results which are difficult to come by elsewhere</span><span id="60ea" class="ln lo iq mm b gy mu mr l ms mt">data_df, metadata_df = cc.get_currency_exchange_daily(from_symbol='GBP',to_symbol='USD', outputsize='full')</span><span id="5e8d" class="ln lo iq mm b gy mu mr l ms mt">#Plot what the data looks like</span><span id="6e69" class="ln lo iq mm b gy mu mr l ms mt">data_df['4. close'].plot()<br/>plt.tight_layout()<br/>plt.title('Intraday GBP/USD')<br/>plt.show()</span></pre><p id="656e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行上面的代码还应该创建一个收盘价图，以确保您下载了正确的数据。它应该看起来类似于下图。</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/f49576558236817073c8d72d6a36f279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iL-jCwRA0eEzMx3EGB5kdQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Ah the heyday of $2 to £1 pre-08 financial crash.</figcaption></figure><p id="83c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然您可以对您的策略进行整整19年的回溯测试，但我将过滤掉最近5年的例子。</p><div class="mw mx gp gr my mz"><a href="https://www.datadriveninvestor.com/2020/07/07/introduction-to-time-series-forecasting-of-stock-prices-with-python/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">用Python |数据驱动投资者进行股票价格时间序列预测简介</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">在这个简单的教程中，我们将看看如何将时间序列模型应用于股票价格。更具体地说，一个…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn jw mz"/></div></div></a></div><p id="452a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还将在这里重命名和重新排列列顺序，这是我们将使用的回溯测试包所必需的。</p><pre class="lj lk ll lm gt ml mm mn mo aw mp bi"><span id="5f45" class="ln lo iq mm b gy mq mr l ms mt"># Let's just look at 2015 onwards</span><span id="cd6c" class="ln lo iq mm b gy mu mr l ms mt">data_df.sort_index(inplace=True)</span><span id="29e8" class="ln lo iq mm b gy mu mr l ms mt">data_df = data_df.loc['2015-01-01':]</span><span id="9201" class="ln lo iq mm b gy mu mr l ms mt"># Rename &amp; rearrange the fields so they can be ingested by Backtrader</span><span id="ee36" class="ln lo iq mm b gy mu mr l ms mt">data_df = data_df.loc[:, ['2. high', '3. low', '1. open', '4. close']]<br/>data_df.columns = ['High', 'Low', 'Open', 'Close']</span></pre><h2 id="52c6" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">定义策略</h2><p id="76fe" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">为了进行回溯测试，我们将使用Backtrader Python包<a class="ae kc" href="https://www.backtrader.com/" rel="noopener ugc nofollow" target="_blank">https://www.backtrader.com/</a>。与Quantopian等其他平台相比，这是一个更大的学习曲线，但我真的很喜欢增加的灵活性，以及您可以轻松地与其他Python包/平台集成的事实。</p><p id="10b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我已经硬编码，当买入信号触发时，我们不在市场上(我们不持有当前的头寸)，我将进入3000美元的头寸，并在卖出信号触发时完全卖出该头寸。</p><pre class="lj lk ll lm gt ml mm mn mo aw mp bi"><span id="71ef" class="ln lo iq mm b gy mq mr l ms mt">class boll_bander(bt.Strategy):<br/># Set a bollinger band indicator, buy when the price exceeds the lower band, sell when price exceeds higher band.</span><span id="e669" class="ln lo iq mm b gy mu mr l ms mt"># Set the parameters for the bollinger band. I chose a 21 day period as that mimics the number of days in a trading month, a smaller standard deviation on the band<br/># gives more entry &amp; exit opportunities</span><span id="c6ce" class="ln lo iq mm b gy mu mr l ms mt">params = dict(<br/>        bperiod=21<br/>        ,dev=1.25)<br/>    <br/>    def __init__(self):<br/>        <br/>        #Define Bollinger band<br/>        <br/>        self.boll = bt.ind.BollingerBands(period=self.p.bperiod, devfactor=self.p.dev, plot=True, plotname='Bollinger Band', subplot=False)<br/>        <br/>        #Define cross-over points<br/>        <br/>        self.buysig = bt.indicators.CrossOver(self.data0, self.boll.lines.bot, plotname='buy signal', plot=True)<br/>        self.sellsig = bt.indicators.CrossOver(self.data0, self.boll.lines.top,plotname='sell signal', plot=True)</span><span id="3c29" class="ln lo iq mm b gy mu mr l ms mt">def next(self):<br/>        <br/>        if not self.position:  # not in the market<br/>            if self.buysig &gt; 0:  # if fast crosses slow to the upside<br/>                self.order_target_size(target=3000)   # enter long<br/>                <br/>        elif self.sellsig &gt; 0:  # in the market &amp; cross to the downside<br/>            self.order_target_size(target=0)   # close long position</span></pre><h2 id="dbc3" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">回溯测试</h2><p id="884c" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们准备好回测了！让我们看看这个策略在10，000美元的启动资金下效果如何。</p><pre class="lj lk ll lm gt ml mm mn mo aw mp bi"><span id="4214" class="ln lo iq mm b gy mq mr l ms mt">cerebro = bt.Cerebro()<br/>data = bt.feeds.PandasData(dataname=data_df)<br/>cerebro.adddata(data)<br/>cerebro.addobserver(bt.observers.Value)<br/>cerebro.addanalyzer(bt.analyzers.SharpeRatio, riskfreerate=0.0)<br/>cerebro.addanalyzer(bt.analyzers.Returns)<br/>cerebro.addanalyzer(bt.analyzers.DrawDown)<br/>cerebro.addstrategy(boll_bander)<br/>results = cerebro.run()</span></pre><p id="1e68" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在模型已经运行了，让我们看看我们做得怎么样。</p><pre class="lj lk ll lm gt ml mm mn mo aw mp bi"><span id="8715" class="ln lo iq mm b gy mq mr l ms mt">print(f"Sharpe: {results[0].analyzers.sharperatio.get_analysis()['sharperatio']:.3f}")<br/>print(f"Norm. Annual Return: {results[0].analyzers.returns.get_analysis()['rnorm100']:.2f}%")<br/>print(f"Max Drawdown: {results[0].analyzers.drawdown.get_analysis()['max']['drawdown']:.2f}%")<br/>cerebro.plot(iplot=False, volume=False, width=20)</span></pre><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/045ac73f6bcc22d255764648d98ddc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ISLxaSHXZwcKxKULlMiTQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">A visualisation showing: cash value position (top), each trades performance (2nd from top), value of capital over time (3rd from top), instrument price and when the backtest trades were triggered (4th from top) and the buy/sell signal triggers (bottom).</figcaption></figure><pre class="lj lk ll lm gt ml mm mn mo aw mp bi"><span id="a83e" class="ln lo iq mm b gy mq mr l ms mt">Sharpe: 0.938<br/>Norm. Annual Return: 1.32%<br/>Max Drawdown: 3.37%</span></pre><p id="bd5d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">夏普比率为0.938，年回报率为1.32%。这么简单的车型还不错！</p><p id="416c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，由于数据集较新，您的结果可能会略有不同。<br/>值得注意的是，这个策略有几个要点需要考虑:</p><ol class=""><li id="3efb" class="np nq iq kf b kg kh kk kl ko nr ks ns kw nt la nu nv nw nx bi translated">上面的回溯测试假设我们可以在下一个交易时段的开盘价买入我们的买入信号。实际上，我们会稍微低于这个价格，但会非常接近。</li><li id="8bec" class="np nq iq kf b kg ny kk nz ko oa ks ob kw oc la nu nv nw nx bi translated">回溯测试假设没有交易成本，交易成本会侵蚀你的利润。</li><li id="88aa" class="np nq iq kf b kg ny kk nz ko oa ks ob kw oc la nu nv nw nx bi translated">目前，这只是一个做多策略，但正如你所看到的，我们没有利用许多买入/卖出信号，因此我们可以将它转变为一个多空策略。请注意，这将使你的交易次数翻倍，因此交易成本也会翻倍。</li></ol><p id="8ae1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这有助于你开始编写自己的策略，让我知道你进展如何！</p><p id="17d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在这里找到完整的代码<a class="ae kc" href="https://github.com/akokaz1/Algo-Trading/blob/master/notebooks/scripts/Bollinger%20band%20Trading%20Strategy.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="56b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">访问专家视图— </strong> <a class="ae kc" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>