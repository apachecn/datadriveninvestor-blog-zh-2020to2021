<html>
<head>
<title>How Can Alibaba’s Newest Databases Support 700 Million Requests a Second?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿里巴巴的最新数据库如何支持每秒7亿次请求？</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/how-can-alibabas-newest-databases-support-700-million-requests-a-second-8895aeb208fc?source=collection_archive---------8-----------------------#2020-02-18">https://medium.datadriveninvestor.com/how-can-alibabas-newest-databases-support-700-million-requests-a-second-8895aeb208fc?source=collection_archive---------8-----------------------#2020-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4f0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自2019年以来，阿里巴巴的Lindorm引擎已开始服务于阿里巴巴集团的几个核心业务部门，包括淘宝和天猫的电子商务平台，蚂蚁金服，<a class="ae kl" href="https://www.youtube.com/watch?spm=a2c41.14005934.0.0&amp;v=bgHfEK34xYk" rel="noopener ugc nofollow" target="_blank">菜鸟</a>的物流网络，以及其他几个平台，包括<a class="ae kl" href="https://www.alizila.com/alimama/?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank">阿里妈妈</a>，优酷，<a class="ae kl" href="https://www.scmp.com/tech/enterprises/article/2167114/alibabas-autonavi-blazes-trail-first-chinese-maps-service-cross-100?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank"> Amap </a>，以及阿里巴巴媒体和娱乐部门，为这些系统带来了新的性能和可用性水平。事实上，在去年的<a class="ae kl" href="https://www.alibabacloud.com/blog/double-11-with-alibaba-cloud-%241b-gross-merchandise-volume-in-68-seconds-with-zero-downtime_595590?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank">双11 </a>购物节期间——中国的黑色星期五，轻松成为全球最大的在线购物活动——促销高峰时段的请求数量达到每秒7.5亿次，每天的请求吞吐量达到22.9万亿次。而且，平均响应时间不到3毫秒，总存储容量达到了数百Pb。</p><p id="a84c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些令人兴奋的数字反映了阿里巴巴HBase和Lindorm团队一年来的努力、辛勤工作和奉献。<a class="ae kl" href="https://www.alibabacloud.com/blog/how-alibaba-have-made-a-high-availability-solution-with-hbase_595529?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank"> Lindorm </a>是阿里巴巴HBase和Lindorm团队面对阿里巴巴集团巨大的规模和成本压力，在<a class="ae kl" href="https://hbase.apache.org/?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank"> HBase </a>的基础上重构升级的全新产品。该团队利用其过去多年来在处理数百Pb数据、管理数亿次请求和处理数千家企业方面的经验和专业知识。就性能、功能和可用性而言，Lindorm在许多方面代表了对HBase的重大改进和发展。</p><div class="km kn gp gr ko kp"><a href="https://www.datadriveninvestor.com/2019/01/25/why-data-will-transform-investment-management/" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">为什么数据将改变投资管理|数据驱动的投资者</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">有人称之为“新石油”虽然它与黑金没有什么相似之处，但它的不断商品化…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld le kp"/></div></div></a></div><p id="1adc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本帖中，我们将讨论Lindorm的核心能力，特别关注Lindorm在性能、功能和可用性方面的优势。最后，我们将描述一些正在进行的涉及Lindorm的项目。</p><h1 id="26ae" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Lindorm的优化性能</h1><p id="d59b" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">与HBase相比，Lindorm为远程过程调用、内存管理、缓存以及日志写入提供了全新级别的优化。同时也引入了很多新技术，通过阿里巴巴的几个业务系统，显著提高了读写速度。虽然使用相同的硬件，但Lindorm的吞吐量可以超过HBase的500%以上，而Lindorm只遭受过去困扰HBase的10%的故障。这个性能数据不是在实验室中生成的，但是它是通过Yahoo Cloud Serving Benchmark(YCSB)显示的，并且没有对原始参数进行任何修改。我们在阿里云的帮助文档中发布了测试工具和场景，因此任何人都可以通过遵循我们的指南获得相同的结果。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/2dba3e9b8fffa510e4482c35f7fae99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*0ab58PTghQkt-Y3q.jpeg"/></div></figure><p id="5585" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，我们所取得的成绩是由一些尖端技术支撑的，这些技术是由Lindorm多年来为其开发的。下面几节简要介绍了Lindorm内核中使用的一些技术。</p><h1 id="80ee" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">特里指数</h1><p id="db3d" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">首先，Lindorm文件LDFile，类似于HBase中的HFile，是在只读B+树结构中创建的，其中文件索引是至关重要的数据结构。块缓存中的索引具有高优先级，需要尽可能驻留在内存中。因此，如果可以减少索引空间，块缓存中索引所需的内存空间也可以减少。而且，如果索引空间保持不变，您可以增加索引密度并减小数据块大小来提高性能。在HBase中，索引块包含所有行键，而许多行键在一个排序文件中具有相同的前缀。</p><p id="dabe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">trie数据结构可以为具有相同前缀的行键仅保存一个前缀，这防止了通过重复存储操作造成浪费的可能性。然而，在传统的前缀树结构中，从一个节点到另一个节点的指针占用了过多的空间。你可以使用简洁的前缀树来解决这个问题。SuRF可以说是SIGMOD 2018年最好的论文，提出了简洁的前缀树来代替Bloom filter，并提供范围过滤功能。受到这篇论文的启发，我们的团队使用简洁的Trie来创建文件块索引。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/d1ab06d096a9c70231cd648edbed3440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*6xUHMSz7ocv0Qumn.jpeg"/></div></figure><p id="39a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前，我们在许多在线业务部门中使用由Trie index实现的索引结构。结果表明，Trie索引可以大大降低各种场景下的索引大小，减少的空间需求高达海量的1200%。节省的空间允许内存缓存中有更多的索引和数据文件，从而大大提高了请求性能。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/c752cc88dac546eaaa08e2439f6b7421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*Uz3bXsy1kSki38XN.jpeg"/></div></figure><h1 id="de67" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Z垃圾收集器</h1><p id="0545" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">Z垃圾收集器支持100 GB的5毫秒暂停。它由JDK龙井公司提供支持，是下一代无间断垃圾收集器算法。它使用Mutator通过读取内存障碍来识别指针变化，这样大多数标记和重定位操作可以并发执行，这是一个巨大的进步。</p><p id="3b38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过Lindorm团队和AJDK团队的多次改进和调整，Z垃圾收集器已经在Lindorm场景中实现了生产级可用性。他们的主要成就包括:</p><ul class=""><li id="6905" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">使用Lindorm的内存自我管理技术来减少对象数量和内存分配窗口。</li><li id="cc22" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">优化AJDK Z垃圾收集器页面缓存机制，特别是锁和页面缓存策略。</li><li id="64e8" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">优化AJDK Z垃圾收集器触发时间，没有任何并发故障。</li></ul><p id="98dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">特别是，这最后一点是一个相当大的成就，因为它意味着AJDK的Z垃圾收集器已经在Lindorm上稳定运行了两个月，并轻松处理了双11购物活动的流量高峰。JVM的暂停时间大约是5毫秒，从来不会超过8毫秒。z垃圾收集器大大改善了在线操作中的响应时间和故障指数，平均响应时间减少了15%到20%，P999响应时间减少了一半。此外，在去年的双11期间，通过Z垃圾收集器，蚂蚁风险控制集群中的P999响应时间从12毫秒减少到仅5毫秒，蚂蚁风险控制集群用于判断支付宝交易中涉及的风险。只需考虑下面的这个数字。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/724fec70aa64377ce55f26c1a85e030b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*gHP-CPQVw58ULIZo.jpeg"/></div></figure><p id="3a87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，对于这个图，使用的单位是微秒(us ),但是平均垃圾收集(GC)响应时间是5毫秒(ms)。</p><h1 id="511d" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">LindormBlockingQueue</h1><p id="775f" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">现在我们来讨论LindrormBlockingQueue。但是，在我们讨论它之前，提供一些背景知识是很重要的。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/f989586bbc33ed8fc67a40ef0c8ffb8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*9e_ReSHdkztdNl5y.jpeg"/></div></figure><p id="79d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上图显示了HBase的RegionServer从网络中读取远程过程调用(RPC)请求并将其分发到各个处理程序的过程。HBase中的RPC读取器从套接字读取RPC请求，并将它们放入BlockingQueue中。接下来，处理程序订阅BlockingQueue并执行请求。HBase使用的BlockingQueue是LinkedBlockingQueue，由Java的原生JDK提供。一般来说，LinkedBlockingQueue通过锁和条件来保证线程安全和线程间的同步。但是，当吞吐量增加时，LinkedBlockingQueue会导致严重的性能瓶颈。</p><p id="e43e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个问题，我们在Lindorm中设计了新的LindormBlockingQueue来维护插槽数组中的元素。它维护头指针和尾指针，并执行比较和交换(CAS)操作来读取和写入队列中的数据，这有助于消除不必要的区域。它还使用缓存行填充和脏读缓存进行加速，并且可以定制各种等待策略，包括旋转、产出和阻塞，以防止在队列为空或满时频繁进入暂停状态。所有这些都带来了明显的改进，LindormBlockingQueue的性能比LinkedBlockingQueue高四倍以上。为了直观起见，请考虑下图。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/a67779fa7bf7c4e268fd5715fb8dfad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*Rwp6PZNoaHWNPYpx.jpeg"/></div></figure><h1 id="6de5" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">版本基础同步程序</h1><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/9a7c2a815d28c0bdbb3f4ca971aa2ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*I534G90x3Skk1Ay-.jpeg"/></div></figure><p id="3ac1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上图所示，LDLog是Lindorm中使用的一种日志，用于系统故障转移时的数据恢复，确保数据的原子性和可靠性。所有数据必须首先写入Lindorm日志，简称LDLog。只有在LDLog写入成功后，才能执行写入MemStore等操作。因此，在预写日志(WAL)写入完成后，Lindorm中的所有处理程序都会被唤醒，以进行下一个操作。在高压力下，无用的唤醒会导致大量的CPU上下文切换，从而降低性能。因此，Lindorm团队开发了VersionBasedSynchronizer，这是一种基于版本的并发多线程同步机制，可以显著改善上下文切换。</p><p id="deaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">VersionBasedSynchronizer允许通知程序感知处理程序的等待条件，以减少通知程序的唤醒压力。根据模块测试结果，我们的VersionBasedSynchronizer的效率是官方java开发工具包的ObjectMonitor和java.util.concurrent (J.U.C)的两倍以上。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/9f00b2b65f2e4064c7b3be4a75cd5986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*gO7aRhJfIXLTXcmo.jpeg"/></div></figure><h1 id="85f6" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">完全无锁</h1><p id="c23a" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">HBase内核在关键路径上有大量锁，因此，在高并发场景中，这些锁会导致线程混乱和性能下降。Lindorm内核使关键链接无锁，完全消除了多版本并发控制(MVCC)和预写日志(WAL)模块中的锁。此外，在HBase操作期间会记录各种指标，如每秒查询数、响应时间和操作的缓存命中率。记录这些指标的操作有大量的锁。为了解决度量性能问题，Lindorm通过构建TCMalloc概念开发了LindormThreadCacheCounter。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/cb27ac8f2ccb159b4fef54779c85e16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*hlkrZwj-1wniyUNM.jpeg"/></div></figure><h1 id="e3b2" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">处理程序协程</h1><p id="c026" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在并发应用中，远程过程调用(RPC)请求涉及多个子模块和多个I/O操作。由于这些子模块之间的协作，系统中的上下文切换相当频繁。因此，有必要对高并发系统中的上下文切换进行优化。每个人都有自己的方式来做到这一点，这个行业充满了不同的想法和不同的现实实现。在这里，我们将重点关注协程和分阶段事件驱动架构(SEDA)解决方案。</p><p id="b195" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于对项目成本、可维护性和代码可读性的考虑，Lindorm使用协程解决方案进行异步优化。我们使用由Alibaba JVM团队提供的Dragonwell JDK的内置Wisp2.0函数来实现HBase处理程序的协同例程。Wisp2.0是一个简单易用的解决方案，可以有效降低系统资源消耗。客观地展示了优化结果。</p><h1 id="2787" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">新的编码算法</h1><p id="c21c" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">为了提高性能，HBase通常需要将元信息加载到块缓存中。如果块很小，大量元信息无法完全加载到缓存中，从而导致性能下降。如果块很大，编码后块的顺序查询性能可能会成为随机读取的性能瓶颈。为了解决这个问题，Lindorm开发了可索引Delta编码，它允许通过索引快速查询块，极大地提高了查找性能。下图显示了可索引增量编码的工作原理。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/3ca54a9223dd9d302c31b86a5fcca39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*dPh9H1w6r97AcBgg.jpeg"/></div></figure><p id="c4b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用可索引Delta编码后，HFile的随机查找性能提高了一倍。以一个64 KB的块为例，随机寻道性能和编码前差不多。请注意，当使用其他编码算法时，会出现性能损失。在缓存命中率为100%的随机Get场景中，与DIFF编码响应时间相比，响应时间减少了50%。</p><h1 id="e209" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">其他改进</h1><p id="6f72" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">今天的Lindorm的开发还包括其他一些性能优化和调整，以及许多新技术。鉴于本文篇幅有限，我们将只列出一些最重要的技术。</p><ul class=""><li id="b137" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">基于仲裁的写入可自动避免故障节点</li><li id="8472" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">高效的组提交</li><li id="fb4b" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">使用共享BucketCache的无碎片高性能缓存</li><li id="9843" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">MemStore BloomFilter</li><li id="a481" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">一种高效的读写数据结构</li><li id="aa43" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">GC-不可见内存管理</li><li id="96e7" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">分离的在线计算和离线作业架构</li><li id="1cc8" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">深入的Java开发套件和操作系统优化</li><li id="94e3" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">FPGA卸载压缩</li><li id="f90e" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">用户模式TCP加速</li></ul><h1 id="14d0" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">方便开发的多种查询模型</h1><p id="b7c6" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">本机HBase仅支持KV结构查询。这是一种简单的方法，但无法满足当今多种不同业务的复杂需求。因此，我们用Lindorm开发了基于不同业务单元特性的各种查询模型。Lindorm的特定场景API和索引设计使得开发比过去更容易。</p><h1 id="49da" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">宽列模型(本机HBase API)</h1><p id="cdc6" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">宽列模型是与HBase一致的访问模型和数据结构。同样使用宽列模型，Lindorm完全兼容HBase API调用。您可以使用Lindorm中高性能native client的宽列API来访问Lindorm，或者使用HBase客户端和API——不需要修改代码——通过alihbase-connector插件直接访问Lindorm。Lindorm还采用了轻量级的客户端设计，在服务器端实现了大量的逻辑操作，包括数据路由、批量分发、超时、重试等，并显著优化了网络传输层。这有助于减少应用程序的CPU消耗。与HBase相比，Lindorm的CPU使用效率提高了60%，带宽效率提高了25%，如下表所示。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/df81cd9d6bf981a1b4fa562e741e9bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q5JClW_a0yxWXeSS.png"/></div></div></figure><p id="76ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，表中的客户机CPU表示HBase或Lindorm客户机消耗的CPU资源。一般来说，CPU占用率越小越好。</p><p id="8bd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为独家，我们还支持HBase原生API中的高性能二级索引。当使用HBase native APIs写数据时，索引数据被透明地写到索引表中。鉴于此，可以在索引表而不是所有表中执行查询，从而大大提高查询性能。</p><h1 id="b53f" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">表服务模型(SQL和辅助索引)</h1><p id="1ff5" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">HBase只支持rowkey索引模式，使得多字段查询效率低下。这意味着你需要维护多个表来满足不同场景下的查询需求，使得开发应用和保证数据一致性和写效率变得困难。HBase只提供KV API，只允许简单的API操作，比如PUT、GET、SCAN，没有数据类型。因此，您需要手动转换和存储所有数据。习惯于SQL语言的开发人员不容易转换到HBase，很可能会出错。</p><p id="c23f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个困难，我们在Lindorm中添加了TableService模型。该模型提供了广泛的数据类型和结构化查询表达式API，并且本身支持SQL访问和全局二级索引。这解决了许多技术难题，并大大降低了普通用户的使用难度。通过使用SQL和SQL like API调用，您可以像使用关系数据库一样轻松地使用Lindorm。以下是Lindorm SQL的一个简单示例:</p><pre class="mj mk ml mm gt ni nj nk nl aw nm bi"><span id="3416" class="nn lg iq nj b gy no np l nq nr">-- 主表和索引DDL<br/>create table shop_item_relation (<br/>    shop_id varchar,<br/>    item_id varchar,<br/>    status varchar<br/>constraint primary key(shop_id, item_id)) ;<br/>create index idx1 on shop_item_relation (item_id) include (ALL);   -- 对第二列主键建索引，冗余所有列<br/>create index idx2 on shop_item_relation (shop_id, status) include (ALL);  -- 多列索引，冗余所有列<br/>-- 写入数据，会同步更新2个索引<br/>upsert into shop_item_relation values('shop1', 'item1',  'active');<br/>upsert into shop_item_relation values('shop1', 'item2',  'invalid');<br/>-- 根据WHERE子句自动选择合适的索引执行查询<br/>select * from shop_item_relation where item_id = 'item2';  -- 命中idx1<br/>select * from shop_item_relation where shop_id = 'shop1' and status = 'invalid'; -- 命中idx2</span></pre><p id="be4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与关系数据库中的SQL相比，Lindorm不支持多行事务和复杂分析，比如Join和Groupby。这就是他们之间的区别。</p><p id="b344" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且，与Phoenix在HBase上提供的二级索引相比，Lindorm的二级索引提供了更好的功能、性能和稳定性。下图显示了一个简单的性能比较。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/3ea358ad771f391e451df6306c164212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*iwarDyd_ji3j_ezl.jpeg"/></div></figure><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/ba379a488af4ceeb204e591ae8a576af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*Z5FIIaPJrWtXPTFI.jpeg"/></div></figure><p id="d702" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，这个模型已经在阿里云HBase Enhanced (Lindorm)中测试过了。可以联系阿里云HBase DingTalk账号或者提交机票进行咨询。</p><h1 id="ec93" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">进料流模型</h1><p id="8893" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在现代互联网体系结构中，消息队列在提高核心系统的性能和稳定性方面起着重要的作用。典型的应用场景包括系统解耦、削峰节流、日志收集、最终一致性保证以及分发和推送。</p><p id="03a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">常见的消息队列工具包括RabbitMQ、Kafka和RocketMQ。尽管这些数据库在架构、使用方法和整体性能上略有不同，但它们的基本应用场景是相似的。然而，传统的消息队列并不完美。在消息推送和订阅源流等场景中，它们存在以下问题:</p><ul class=""><li id="b501" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">存储:传统的消息队列不适合长期数据存储。通常，存储的数据会在几天后过期。</li><li id="b09f" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">删除:传统的消息队列不支持删除指定的数据条目。</li><li id="f30f" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">查询:传统的消息队列不支持复杂的查询和过滤条件。</li><li id="e51a" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">一致性和性能的保证:Kafka之类的数据库需要更高的吞吐量，因此数据可能会由于用于实现更高性能的方法而丢失。然而，具有更好事务处理能力的消息队列的吞吐量也是有限的。</li><li id="1236" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">快速分区扩展能力:通常，一个主题有固定数量的不支持快速扩展的分区。</li><li id="c10c" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">物理和逻辑队列:通常，只支持少量的物理队列。例如，每个分区可以被视为一个队列。然而，业务需要模拟基于物理队列的逻辑队列。例如，如果在即时消息(IM)系统中为每个用户维护一个逻辑消息队列，用户必须执行大量额外的工作。</li></ul><p id="6e4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了响应前面的需求，Lindorm推出了FeedStreamService队列模型，该模型可以解决大量用户场景中的消息同步、设备通知和自动递增ID分配等问题。</p><p id="453d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今年，FeedStream模型在淘宝移动的消息系统中扮演了重要角色，解决了消息推送过程中的顺序保持和幂等性等问题。去年双11期间，淘宝手机上的造楼活动和大红包赠送都使用了Lindorm。淘宝移动在高峰时段推送的消息数超过每秒百万条，几分钟内将消息推送给所有用户。</p><p id="82a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，这个模型已经在阿里云HBase Enhanced (Lindorm)中测试过了。可以联系阿里云HBase DingTalk账号或者提交机票进行咨询。</p><h1 id="aed1" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">全文搜索模型</h1><p id="e7e3" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">尽管Lindorm中的TableService模型提供了数据类型和辅助索引，但它仍然难以满足各种复杂条件查询和全文搜索的要求。SOLR和Elasticsearch是优秀的全文搜索引擎。通过使用Lindorm和SOLR或Elasticsearch，我们可以最大限度地发挥他们的优势，构建复杂的大数据存储和检索服务。Lindorm有一个内置的外部索引同步组件，可以自动将写入Lindorm的数据同步到外部索引组件，比如SOLR或Elasticsearch。这种模型适用于需要存储大量数据并需要使用各种查询条件组合和少量查询字段进行查询的企业。下面是三个例子。</p><ul class=""><li id="4e54" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">在常见的物流业务场景中，需要存储大量的轨道物流信息，查询条件可以由多个字段随机组合。</li><li id="5d14" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">在交通监控业务场景中，存储了大量的车辆通过记录，并且可以基于与车辆相关的信息的任意组合来检索感兴趣的记录。</li><li id="d3eb" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">在各种网站会员和产品信息检索场景中，存储了大量的产品或会员信息，可以支持网站用户使用少量条件进行复杂任意的查询。</li></ul><p id="0a2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">全文搜索模式已在阿里云推出，支持SOLR和Elasticsearch等外部搜索引擎。目前，您需要在Lindorm之前直接查询SOLR或Elasticsearch。稍后，我们将使用TableService语法对查询外部搜索引擎的过程进行打包，然后您将只需要与Lindorm进行交互来执行全文搜索。</p><h1 id="8dd3" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">正在进行的开发和更多即将推出的型号</h1><p id="6ee2" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">除了以上这些模型，我们还会根据业务需求和困难，开发更多易用的模型。我们将很快提供时间序列和图形模型。</p><h1 id="48ef" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">高可用性，零干扰，几秒钟内即可恢复</h1><p id="d6e8" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">感谢客户的信任，Ali-HBase在经历了无数困难后，已经从一个不起眼的原型发展成为一个强大的产品。经过九年的应用经验，阿里巴巴开发了很多高可用的技术，这些技术都应用到了Lindorm上。</p><h1 id="ba87" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">MTTR优化</h1><p id="19d9" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">HBase是基于Google发布的知名论文BigTable的开源实现。其核心特点是数据持久存储在<a class="ae kl" href="https://hadoop.apache.org/docs/r1.2.1/hdfs_design.html?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank"> Hadoop分布式文件系统</a> (HDFS)中。HDFS维护多个数据副本，以确保高可靠性。HBase不必担心多个副本和数据一致性，这有助于简化整个项目。但是，它也在服务中引入了单点故障(SPOF)。也就是说，当一个节点关闭时，只有在通过重放日志恢复内存状态并将数据重新分配到新节点并加载之后，才能恢复服务。</p><p id="fc29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当群集很大时，从HBase的SPOF中恢复需要10到20分钟。大规模集群可能需要几个小时才能恢复。然而，在Lindorm内核中，我们做了一系列优化来减少平均修复时间(MTTR)。例如，我们在回切之前首先使该区域在线，并行重放故障，并减少生成的小文件数量。这些优化将回切速度提高了1000%以上，接近HBase设计的原始理论值。</p><h1 id="89f4" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">多重可调稠度</h1><p id="0c6b" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在最初的HBase架构中，每个区域只能在一个RegionServer上联机。如果一个RegionServer出现故障，相应的区域需要经过重新分配、按区域进行WAL分段、WAL数据回放和其他步骤，然后才能恢复读写能力。这意味着恢复可能需要几分钟时间，这对要求高的企业来说是个问题。此外，虽然HBase中的主集群和辅助集群之间的数据是同步的，但您只能在出现故障时手动切换集群，主集群和辅助集群的数据只能实现最终一致性(EC)。然而，一些企业只接受强一致性(SC)，这对于HBase来说是无法实现的。</p><p id="e509" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Lindorm中实现了基于共享日志的一致性协议，通过分区的多副本机制支持故障时自动快速的服务恢复，完全适应存储和计算分离的架构。通过使用相同的系统，我们可以支持SC语义，并以牺牲一致性为代价获得更好的性能和可用性。这使我们能够提供多种功能，如多活动和高可用性。</p><p id="9224" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lindorm架构提供了以下一致性级别，您可以根据自己的业务情况从中进行选择。但是请注意，这个功能目前在Lindorm上不可用。</p><h1 id="afeb" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">客户端的高可用性交换解决方案</h1><p id="f57b" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">尽管HBase是一种主从架构，但目前市场上还没有针对客户端的高效交换解决方案。HBase客户端只能访问特定地址的HBase集群。如果主群集出现故障，您需要停止HBase客户端，修改HBase配置，然后重新启动客户端以连接到辅助群集。作为替代，您需要在业务端设计复杂的访问逻辑来访问主集群和辅助集群。Ali-HBase修改了HBase客户端，以便在客户端内部进行流量交换。切换命令通过高可用性通道发送到客户端，然后客户端关闭旧链路，打开到辅助群集的链路，并重新发送请求。</p><h1 id="e422" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">原生云，但成本更低</h1><p id="d65a" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在Lindorm的设计过程中考虑了向云的迁移。为了尽可能重用云基础设施，进行了各种优化。例如，除了磁盘，我们还支持在阿里云<a class="ae kl" href="https://www.alibabacloud.com/product/oss?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank">对象存储服务</a> (OSS)等低成本存储服务中进行数据存储，以降低成本。我们还对我们的<a class="ae kl" href="https://www.alibabacloud.com/product/ecs?spm=a2c41.14005934.0.0" rel="noopener ugc nofollow" target="_blank">弹性计算服务</a> (ECS)部署进行了一些优化，以适应小内存模型并增强部署灵活性。这使我们能够实现云原生解决方案并降低总体成本。</p><h1 id="bb4f" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ECS和磁盘的极限弹性</h1><p id="5fd6" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">目前，Lindorm是通过使用ECS实例和云盘部署的——尽管有些客户选择使用本地磁盘。这给了Lindorm极大的弹性。</p><p id="d747" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当初阿里巴巴集团在物理机上部署HBase。在开展每项业务之前，我们必须规划机器数量和磁盘大小。使用物理机部署HBase时，您可能会遇到以下问题:</p><ul class=""><li id="f679" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">难以满足弹性要求:当业务流量激增或出现异常请求时，可能很难在短时间内找到新的物理机来调整大小。</li><li id="02fa" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">存储和计算集成导致的灵活性差:物理机上的CPU资源和磁盘资源的比例是固定的，但是每个关联业务的特性是不同的。在同一台物理机上，一些企业可能计算资源不足但存储空间过剩，而一些企业可能计算资源过剩但存储空间不足。特别是在HBase推出混合存储之后，很难确定硬盘驱动器(HDD)与固态驱动器(SSD)的比例。一些高要求的企业可能会用完他们的固态硬盘，但有可用的硬盘，而一些有大量数据的离线企业由于成本高而无法使用固态硬盘。</li><li id="7fe8" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">运营和维护方面的问题(O&amp;M):使用物理机时，O&amp;M的工作人员必须经常检查物理机是否在保修期内，以及是否需要修复硬件故障，如磁盘损坏和网络接口控制器(NIC)损坏。物理机器维修需要停机并且耗时，这给O&amp;M的工作人员带来了很大的压力。对于海量存储的HBase来说，每天都有几个磁盘损坏是正常的。这些问题可以通过在ECS和云盘上部署Lindorm来解决。</li></ul><p id="1efc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用阿里云ECS服务器迁移到云解决了其中的许多问题。阿里云ECS提供了一个几乎无限的资源池。要快速调整业务规模，您只需在资源池中申请一个新的ECS实例，启动它，并将其添加到集群中。整个过程只需要几分钟，这可以帮助您的企业和其他企业应对高峰时段的流量高峰。通过使用将存储和计算相互分离的架构，我们还可以灵活地为不同的业务分配不同的磁盘空间。空间不足的时候，我们可以直接在网上扩大规模。此外，O&amp;M人员不再需要担心硬件故障。当ECS实例出现故障时，它可以在另一台主机上启动，而云盘完全保护上层免受损坏的物理磁盘的影响。极大的弹性也提高了成本效率。我们不需要为业务预留太多的额外资源。此外，我们可以在商业促销结束后迅速缩减规模以降低成本。</p><h1 id="4caf" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">冷热数据的分离</h1><p id="64d0" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在海量大数据场景下，一个表中的一些业务数据只作为存档数据使用或者很少被访问，而历史数据，包括订单数据或者监控数据的量非常大。降低这些数据的存储成本实际上可以大大降低企业的总体开支。Lindorm的冷热分离功能就是专门为此开发的。Lindorm为冷数据提供了新的存储介质。新存储介质的存储成本仅为超磁盘存储成本的三分之一。</p><p id="7e69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lindorm将同一个表中的冷数据和热数据分开后，系统会根据用户自定义的冷数据和热数据的分界线，自动将表中的冷数据归档到冷存储中。用户访问模式与普通表几乎相同。在查询过程中，您只需要按提示或时间范围配置查询，然后系统会根据条件自动确定查询应该在热数据区还是冷数据区。这个过程对用户几乎是完全透明的。</p><h1 id="84c1" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ZSTD-V2将压缩比提高了100%</h1><p id="c597" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">两年前，我们在阿里巴巴集团把存储压缩算法换成了ZSTD。与最初的SNAPPY算法相比，ZSTD将压缩率增加了25%。2019年，我们开发了新算法ZSTD-v2。通过这种新算法，我们可以使用预采样数据来训练字典，然后使用字典来加速小块数据的压缩。在Lindorm中构建LDFile时，我们使用这个特性对数据进行采样，构建一个字典，然后压缩数据。在不同业务的数据测试中，我们实现了比原生ZSTD算法高100%的压缩率，表明我们可以将客户存储成本再降低50%。</p><h1 id="1ed8" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">为什么HBase Serverless是初学者的首选</h1><p id="38da" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">阿里云HBase Serverless是利用基于Lindorm内核的无服务器架构构建的一套新的HBase服务。阿里云HBase Serverless把HBase变成了服务。您不需要预先规划资源、选择CPU资源和内存资源的数量或购买集群。在业务增长的高峰时段，企业不需要复杂的O&amp;M操作(如调整大小),在非高峰时段也不会浪费闲置资源。</p><p id="c694" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以根据您的业务量购买所有存储资源。鉴于HBase Serverless的高弹性和可伸缩性，您在使用它时可能会有一种使用无限资源的HBase集群的感觉。这些看似无限的资源可以为您的业务流量的任何突然变化做好准备。此外，鉴于阿里巴巴灵活的支付系统，你只需要为你实际使用的资源付费。</p><h1 id="3c4c" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">面向主要客户的安全性和多租户功能</h1><p id="3280" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">Lindorm引擎内置用户名和密码系统，提供多级权限控制，对每个请求进行认证，防止未经授权的数据访问，确保数据访问安全。此外，Lindorm提供多租户隔离功能，如组和配额控制，以满足主要企业客户的需求。该功能确保同一个HBase集群中的业务安全高效地共享大数据平台，互不影响。</p><h1 id="db8d" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">用户和ACL系统</h1><p id="26b5" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">Lindorm内核提供了一个简单的用户认证和访问控制列表(ACL)系统。您只需在用户身份验证配置中输入用户名和密码。用户密码以密文形式存储在服务器上，并在身份验证过程中以密文形式传输。即使密文在认证过程中被截获，用于认证的通信内容也不能被重用或伪造。</p><p id="1187" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lindorm有三个权限级别:全局、命名空间和表，它们是相互包含的。例如，如果user1被授予全局读写权限，那么user1可以读写所有名称空间中的所有表。如果user2被授予了命名空间1的读写权限，那么user2可以读写命名空间1中的所有表。</p><h1 id="d253" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">群体隔离</h1><p id="d649" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">当多个用户或企业使用同一个HBase集群时，他们可能会争夺资源。在这种情况下，线下业务的批量读写操作可能会影响线上一些重要业务的读写操作。Lindorm提供了Group函数来解决多租户隔离问题。</p><p id="85f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">区域服务器被分成不同的组，每个组托管不同的表。这允许他们隔离资源。</p><p id="3a4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，假设我们已经创建了Group1，将RegionServer1和RegionServer2移动到Group1，创建了Group2，并将RegionServer3和RegionServer4移动到Group2。此外，我们将表1和表2移到了组1。这样，表1和表2的所有区域只分配给组1中的RegionServer1和RegionServer2。</p><p id="7678" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，Group2中的Table3和Table4的区域在平衡过程中只分配给RegionServer3和RegionServer4。因此，当您请求这些表时，发送到Table1和Table2的请求仅由RegionServer1和RegionServer2提供服务，而发送到Table3和Table4的请求仅由RegionServer3和RegionServer4提供服务。通过这种方法，可以实现资源隔离。</p><h1 id="bb06" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">配额限制</h1><p id="1cb7" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">Lindorm内核有一个完整的配额系统来限制每个用户使用的资源。Lindorm内核根据消耗的资源精确地计算每个请求消耗的容量单元(Cu)的数量。例如，由于过滤器特性，只为您的扫描请求返回少量数据，但是RegionServer可能已经消耗了大量的CPU和I/O资源来过滤数据。所有消耗的资源都被计算为消耗的Cu。当使用Lindorm作为大数据平台时，企业管理员可以将不同的用户分配给不同的业务，并限制一个用户每秒读取的Cu的最大数量或配额系统中的Cu总数。这样可以防止用户占用过多资源，影响其他用户。配额限制还支持命名空间和表级别的限制。</p><h1 id="f46f" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="2527" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">Lindorm作为下一代NoSQL数据库，是Alibaba HBase和Lindorm团队在过去九年中产生的技术的产物。Lindorm可以为海量数据场景提供全球领先的高性能、跨域、多一致性、多模式的混合存储处理能力。它旨在满足大数据的无限扩展和高吞吐量、在线服务的低延迟和高可用性以及多功能查询需求，并为您提供实时混合数据访问能力。这包括无缝扩展、高吞吐量、连续可用性、毫秒级稳定响应、强弱一致性、低存储成本和丰富的索引。</p><p id="5d7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lindorm是阿里巴巴大数据体系中的核心产品之一，支撑着阿里巴巴集团各个业务部门的数千个业务。也经受住了双11购物节多年的考验。前阿里巴巴CTO星点表示，阿里巴巴的技术应该由阿里云输出，让所有行业的数百万客户受益。为了实现这一姿态，Lindorm已经以“HBase Enhanced”的形式在Apsara Stack和阿里云上提供给客户，允许云中的客户享受阿里巴巴技术的好处。</p><h1 id="8c21" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">原始来源:</h1><div class="km kn gp gr ko kp"><a href="https://www.alibabacloud.com/blog/how-can-alibabas-newest-databases-support-700-million-requests-a-second_595828?spm=a2c41.14005934.0.0" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">阿里巴巴的最新数据库如何支持每秒7亿次请求？</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">阿里巴巴云2020年2月14日753由杨文龙，在阿里巴巴昵称为阎正。</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">www.alibabacloud.com</p></div></div><div class="ky l"><div class="ns l la lb lc ky ld le kp"/></div></div></a></div><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div></div>    
</body>
</html>