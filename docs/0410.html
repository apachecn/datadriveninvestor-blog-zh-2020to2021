<html>
<head>
<title>Named Pipes Communication between Python Server and Python Client on Window</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Window环境下Python服务器和Python客户端之间的命名管道通信</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/named-pipes-communication-between-python-server-and-python-client-on-window-8cdf64504801?source=collection_archive---------0-----------------------#2020-01-29">https://medium.datadriveninvestor.com/named-pipes-communication-between-python-server-and-python-client-on-window-8cdf64504801?source=collection_archive---------0-----------------------#2020-01-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b725" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用命名管道进行进程间通信？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/80b01a3c9ab78cf10f42aacd79a3b5e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/0*dbp1rh4KAx-VMFzO"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Photo by Pei Seng Tan at Queen Victoria Building</figcaption></figure><p id="7aa7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据Wikipedia，命名管道被定义为通常用于执行进程间通信(IPC)的方法之一，其中进程可以在它们之间轻松地共享数据。管道被视为一个文件，允许进程写入或读取命名管道。到目前为止，它能够在Linux和Window操作系统上实现。在此示例中，将创建一个Python服务器和一个Python客户端，以演示如何使用基于Python的Win32 API在Window上执行它们之间的命名管道通信。</p><h1 id="fe03" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Python命名管道服务器</h1><p id="c6b7" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">将用于创建Python命名管道服务器的API包括:</p><ul class=""><li id="83be" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32pipe。CreateNamedPipe: </strong>为了将命名管道用于IPC，首先，我们需要通过给命名管道分配一个特定的名称来初始化它。它将创建一个命名管道的实例，并为后续管道操作返回一个句柄。该字符串必须遵循“\的格式。\pipe &lt; i &gt; pipename ",其中pipename在本例中设置为“ABC”。其他参数如openMode、pipeMode、nMaxInstances、nOutBufferSize、nInBufferSize、nDefaultTimeOut和lpSecurityAttributes可以设置为默认值或根据您的需要设置。openMode设置为“ePIPE_ACCESS_DUPLEX”表示允许服务器和客户端进程从命名管道读取和向其写入。pipeMode设置为“PIPE_TYPE_MESSAGE ”,这意味着数据将作为消息流写入命名管道，或者设置为“PIPE_READMODE_MESSAGE ”,允许数据作为消息流从命名管道读取，或者设置为“PIPE_WAIT ”,打开阻塞模式。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="0657" class="my lo iq mu b gy mz na l nb nc">pipe = win32pipe.CreateNamedPipe(r'\\.\pipe\ABC', win32pipe.PIPE_ACCESS_DUPLEX, win32pipe.PIPE_TYPE_MESSAGE | win32pipe.PIPE_READMODE_MESSAGE | win32pipe.PIPE_WAIT, 1, 65536, 65536, 0, None)</span></pre><ul class=""><li id="2641" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32pipe。ConnectNamedPipe: </strong>命名管道初始化后，我们需要通过命名管道将服务器连接到客户端。该函数使命名管道进程能够等待客户端连接到服务器。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="95b5" class="my lo iq mu b gy mz na l nb nc">win32pipe.ConnectNamedPipe(pipe, None)</span></pre><ul class=""><li id="80eb" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32file。WriteFile: </strong>客户端通过命名管道连接到服务器后，服务器现在可以向客户端发送数据了。该函数将通过命名管道向客户端写入多个编码字符串。该函数将返回两个值，其中primer表示错误代码，后者表示发送的字节数。如果函数执行失败或进程完全异步，错误代码的返回值将为零。在这个例子中，客户端和服务器的进程是异步的。因此，存储在“err”变量中的值将始终为零。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="fed8" class="my lo iq mu b gy mz na l nb nc">err, bytes_written=win32file.WriteFile(pipe, some_data)</span></pre><ul class=""><li id="570e" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32file。FlushFileBuffers: </strong>缓冲区将被刷新，因此所有缓冲的数据都将被写入命名管道。通过调用这个函数，我们可以确保所有的消息都被客户端接收到。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="dbd7" class="my lo iq mu b gy mz na l nb nc">win32file.FlushFileBuffers(pipe)</span></pre><ul class=""><li id="eb0a" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32pipe。DisconnectNamedPipe: </strong>服务器和命名管道之间的连接被断开。如果客户端和命名管道之间的连接仍处于连接状态，可能会导致客户端句柄无效。在客户端处理这个错误需要额外的工作。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="f99f" class="my lo iq mu b gy mz na l nb nc">win32pipe.DisconnectNamedPipe(pipe)</span></pre><ul class=""><li id="3caa" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32pipe。CloseHandle: </strong>最后，关闭管道实例的句柄。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="33d7" class="my lo iq mu b gy mz na l nb nc">win32file.CloseHandle(pipe)</span></pre><h1 id="5b14" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Python命名管道客户端</h1><p id="68ae" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">将用于创建Python命名管道客户端的API包括:</p><ul class=""><li id="5671" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32file。CreateFile: </strong>在服务器初始化命名管道后，客户端将被要求使用该函数或另一个命名为“CallNamedPipe”的命名管道连接到服务器。如果管道实例可用，将向客户端返回一个句柄。dwDesiredAccess设置为“GENERIC_READ”或“GENERIC_WRITE”，这允许客户端读取或写入命名管道。dwCreationDisposition的参数设置为“OPEN_EXISTING”表示如果退出，将打开命名管道。dwFlagsAndAttributes的参数设置为“FILE_ATTRIBUTE_NORMAL ”,因为命名管道没有设置其他属性。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="0221" class="my lo iq mu b gy mz na l nb nc">handle = win32file.CreateFile(r'\\.\pipe\ABC',win32file.GENERIC_READ | win32file.GENERIC_WRITE, 0, None, win32file.OPEN_EXISTING, win32file.FILE_ATTRIBUTE_NORMAL, None)</span></pre><ul class=""><li id="3090" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32pipe。SetNamedPipeHandleState: </strong>客户端通过命名管道连接到服务器后，我们需要设置为read模式，以便从服务器接收消息。“lpMode”设置为“PIPE_READMODE_MESSAGE ”,因此数据将作为消息流从命名管道中读取。如果客户端连接到字节类型管道而不是消息类型管道，您将会遇到失败。在本例中，使用了消息类型管道。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="7dfd" class="my lo iq mu b gy mz na l nb nc">res = win32pipe.SetNamedPipeHandleState(handle, win32pipe.PIPE_READMODE_MESSAGE, None, None)</span></pre><ul class=""><li id="aeeb" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><strong class="kt ir"> win32file。ReadFile: </strong>在设置了读取模式之后，客户机现在准备从命名管道中读取数据。将读取一系列消息，直到服务器和命名管道或客户端和命名管道之间的连接断开。</li></ul><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="e6a5" class="my lo iq mu b gy mz na l nb nc">resp = win32file.ReadFile(handle, 65536)</span></pre><h1 id="b0ec" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">示例应用程序:将数据从Python服务器发送到Python客户端</h1><p id="1860" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">要了解如何将上述API转化为简单应用程序的更多细节，您可以参考下面的github链接。总的来说，Python服务器将以0.2秒的周期连续3个周期向Python客户端发送10行用日期时间信息编码的字符串。图1显示了来自Python服务器的控制台，图2显示了来自Python客户端的控制台。</p><div class="nd ne gp gr nf ng"><a href="https://github.com/PeiSeng/Named_Pipe_Communication" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">Pei seng/命名管道通信</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">github.co</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kl ng"/></div></div></a></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/aeb1cf8879f4f383a68504f6bbd1cb9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUl6foPk_1cexNvgeaYuWA.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Figure 1: Console of Python Server</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oa"><img src="../Images/f928336e39dcf05142e93240da6c7cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TdvOTfCTbo1Yng9N8hMrOw.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Figure 2: Console of Python Client</figcaption></figure><h1 id="fdaa" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">参考</h1><ol class=""><li id="36fc" class="mk ml iq kt b ku mf kx mg la ob le oc li od lm oe mq mr ms bi translated">进程间通信:<a class="ae of" href="https://en.wikipedia.org/wiki/Inter-process_communication" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Inter-process_communication</a></li><li id="33d8" class="mk ml iq kt b ku og kx oh la oi le oj li ok lm oe mq mr ms bi translated">Python和Windows命名管道:<a class="ae of" href="https://stackoverflow.com/questions/48542644/python-and-windows-named-pipes" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/48542644/python-and-Windows-Named-Pipes</a></li><li id="64a4" class="mk ml iq kt b ku og kx oh la oi le oj li ok lm oe mq mr ms bi translated">命名管道操作:<a class="ae of" href="https://docs.microsoft.com/en-us/windows/win32/ipc/named-pipe-operations" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/windows/win32/IPC/named-Pipe-Operations</a></li><li id="81b6" class="mk ml iq kt b ku og kx oh la oi le oj li ok lm oe mq mr ms bi translated">用于Win32扩展的Python帮助【http://timgolden.me.uk/pywin32-docs/contents.html T4】</li></ol></div></div>    
</body>
</html>