<html>
<head>
<title>Build and Deploy your Machine Learning Application with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker构建和部署您的机器学习应用程序</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/build-and-deploy-your-machine-learning-application-with-docker-f6ec5acdf2ff?source=collection_archive---------1-----------------------#2020-04-22">https://medium.datadriveninvestor.com/build-and-deploy-your-machine-learning-application-with-docker-f6ec5acdf2ff?source=collection_archive---------1-----------------------#2020-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c98a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有没有部署过一个机器学习模型，它在你的本地计算机上运行得非常好，但是当它被部署到生产环境中时，代码在另一台机器上就崩溃了或者更糟？在这篇文章中，我将带你了解如何使用一个名为“Docker”的流行工具来运行和部署你的机器学习模型。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/1722baf98529a67a1a6a3b770980d010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BJfHwuzr436VWBAAmtFCw.jpeg"/></div></div></figure><h1 id="e96d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">那么Docker是什么？</h1><p id="f848" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Docker 是一个工具，通过使用所谓的<strong class="jp ir">容器，可以更容易地创建、部署和运行任何应用程序。</strong>它也是一个软件平台，用于创建<strong class="jp ir"> Docker映像</strong>，这些映像在部署后将被称为Docker容器。</p><p id="12b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Docker容器是一个隔离的环境，包含了应用程序运行所需的所有依赖关系，它通常被称为Docker映像的运行实例。</p><p id="9760" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ma"> Docker镜像</em> <strong class="jp ir"> <em class="ma"> </em> </strong>是一个文件(只读)，由多个层组成，用于执行Docker容器中的代码。Docker映像位于一个被称为<strong class="jp ir"> Docker hub的大型Hub中。</strong>因此，您可以从中心提取图像，或者从基础图像构建自定义图像，当这些图像被执行时，它们将充当您的应用程序的容器。</p><div class="mb mc gp gr md me"><a href="https://www.datadriveninvestor.com/2020/03/24/encoder-decoder-sequences-how-long-is-too-long/" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">编码器解码器序列:多长是太长？数据驱动的投资者</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">在机器学习中，很多时候我们处理的输入是序列，输出也是序列。我们称这样的一个…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms kv me"/></div></div></a></div><p id="a9c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，将这些部分结合在一起，我们可以简单地将Docker定义为:</p><blockquote class="mt mu mv"><p id="c017" class="jn jo ma jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">一个软件平台，通过创建Docker映像使创建和部署任何应用程序变得更容易，Docker映像将成为一个Docker容器，其中包含我们的应用程序在部署后工作所需的所有依赖项和软件包。</p></blockquote><h1 id="be0f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">码头工人的好处</h1><ul class=""><li id="673a" class="mz na iq jp b jq lv ju lw jy nb kc nc kg nd kk ne nf ng nh bi translated">Docker解决了在不同的开发阶段拥有相同的环境以及在您的应用程序中拥有独立环境的问题。</li><li id="90e1" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">Docker允许您从任何地方运行您的应用程序，只要您在那台机器上安装了docker。</li><li id="ec1b" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">Docker为您提供了快速扩展的自由。</li><li id="80f4" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">轻松扩展您的开发团队。</li></ul><h1 id="5804" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安装Docker</h1><p id="0d58" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Docker可以跨多种平台使用，无论你使用的是Linux、Windows还是Mac电脑，你都可以点击这里的安装指南<a class="ae nn" href="https://docs.docker.com/" rel="noopener ugc nofollow" target="_blank"><em class="ma"/></a></p><p id="609b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">***</p><p id="b9a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经了解了Docker的基础知识，并且您已经让Docker在您的机器上运行了，让我们继续使用它部署一个机器学习应用程序。</p><p id="8106" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">工作目录</strong></p><p id="2a1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我想要部署的模型，我的工作目录看起来是这样的:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="8548" class="nt ky iq np b gy nu nv l nw nx">.<br/>├── app.py<br/>├── Dockerfile<br/>├── ML_Model<br/>│   ├── Diabetestype.csv<br/>│   ├── model.pkl<br/>│   └── model.py<br/>└── requirements.txt</span><span id="08fc" class="nt ky iq np b gy ny nv l nw nx">1 directory, 6 files</span></pre><p id="34d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> app.py </strong></p><p id="05f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">app.py是一个python脚本，其中包含我使用flask为我的机器学习模型构建的API。我定义了API端点和路径，我们如何从web接收数据，如何处理数据，以及如何将预测作为响应返回。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="821b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">ML _模型</strong></p><p id="8491" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ML_Model </strong>目录包含ML模型，我用来训练模型的数据，以及模型被训练后生成的pickle文件，API将使用这些文件。</p><p id="52b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> requirements.txt </strong></p><p id="6b9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">requirements.txt文件是一个文本文件，它包含了我们的应用程序运行所需的所有python包。我使用的一些包是:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ob"><img src="../Images/6dda1e954a3dab95c240d807f4cc829b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qLpDO_lIXLV1C-Z8cumf9Q.png"/></div></div><figcaption class="oc od gj gh gi oe of bd b be z dk">requirements.txt</figcaption></figure><p id="a3a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Dockerfile </strong></p><p id="249f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Docker文件是定义Docker图像的文本文件。当您想要用于项目的基础图像不能满足您的需求时，您将使用Docker文件来创建您自己的自定义Docker图像。对于我将要部署的模型，我的Dockefile看起来是这样的:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5dc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的Docker文件中，我提取了Docker基础映像python:3.7，更新了系统依赖项，在requirements.txt文件中安装了包，运行ML代码来训练模型并生成API将使用的pickle文件，最后在本地运行服务器。</p><p id="8a2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们使用以下命令从我们创建的Docker文件构建Docker映像:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="1908" class="nt ky iq np b gy nu nv l nw nx">israel@israel:~/Documents/Projects/Docker_ML$ <!-- -->docker build -t aminu_israel/ml_model:1.0 .</span></pre><p id="ef26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将我的自定义图像命名为“aminu_israel/ml_model ”,并将标签设置为1.0。请注意“.”在命令的末尾，意味着我告诉Docker在我的当前目录中定位Dockerfile，这个目录是我的项目文件夹。如果它成功了，您应该会得到这样的结果:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="6cff" class="nt ky iq np b gy nu nv l nw nx">Sending build context to Docker daemon  249.3kB<br/>Step 1/16 : FROM python:3.7<br/> ---&gt; cda8c7e31f89<br/>Step 2/16 : MAINTAINER aminu israel &lt;<a class="ae nn" href="mailto:aminuisrael2@gmail.com" rel="noopener ugc nofollow" target="_blank">aminuisrael2@gmail.com</a>&gt;<br/> ---&gt; Running in cea1c80b990f<br/>Removing intermediate container cea1c80b990f<br/> ---&gt; 2c82fc9c1b5a<br/>Step 3/16 : ENV PYTHONDONTWRITEBYTECODE 1<br/> ---&gt; Running in 6ee3497a7ff4<br/>Removing intermediate container 6ee3497a7ff4<br/> ---&gt; 56f5f9838610<br/>Step 4/16 : ENV PYTHONUNBUFFERED 1<br/> ---&gt; Running in 1f53b581eed7</span><span id="3800" class="nt ky iq np b gy ny nv l nw nx">...</span><span id="29ce" class="nt ky iq np b gy ny nv l nw nx">Step 16/16 : CMD [ "app.py","run","--host","0.0.0.0"]<br/> ---&gt; Running in 1f7fc05b4e12<br/>Removing intermediate container 1f7fc05b4e12<br/> ---&gt; 8636b5bc482e<br/>Successfully built 8636b5bc482e<br/>Successfully tagged aminu_israel/ml_model:1.0</span></pre><p id="4496" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下命令检查您创建的新图像:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="6d5e" class="nt ky iq np b gy nu nv l nw nx">israel@israel:~$ docker images</span></pre><p id="17bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经成功构建了映像，让我们使用以下命令运行docker映像:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="7e11" class="nt ky iq np b gy nu nv l nw nx">israel@israel:~$ <!-- -->docker run --name deployML -p 8080:8080 <!-- -->aminu_israel/ml_model:1.0</span></pre><p id="0127" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果成功，您应该会看到如下结果:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="3ef1" class="nt ky iq np b gy nu nv l nw nx">* Serving Flask app "app" (lazy loading)<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: off<br/> * Running on <a class="ae nn" href="http://0.0.0.0:8080/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8080/</a> (Press CTRL+C to quit)</span></pre><p id="c81b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要检查docker容器是否正在运行，请使用以下命令:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="87a3" class="nt ky iq np b gy nu nv l nw nx">israel@israel:~$ docker ps</span></pre><p id="5af6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会看到这样的结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi og"><img src="../Images/02f427607faaae0b5284bbe93a3d02a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SVdTVCcajV14Hx4vwQH-Tg.jpeg"/></div></div></figure><p id="8b81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这表明新容器当前正在运行。要获得完整的docker文档，您可以查看这里的<a class="ae nn" href="https://docs.docker.com" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="e7e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">现在，您已经使用docker成功地部署了您的ML模型。</strong></p><p id="a362" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里获得这篇文章的代码<a class="ae nn" href="https://github.com/AminuIsrael/Deploy-ML-model" rel="noopener ugc nofollow" target="_blank"/></p><p id="f420" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读😀</p><p id="5865" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过以下方式联系我:</p><p id="35ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">电子邮件:aminuisrael2@gmail.com</p><p id="828b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特:@aminu_israelb</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oh oa l"/></div></figure></div></div>    
</body>
</html>