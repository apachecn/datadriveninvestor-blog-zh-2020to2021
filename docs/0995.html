<html>
<head>
<title>Build Image Watermark App For Branding or Security Purpose in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中为品牌或安全目的构建图像水印应用程序</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/build-image-watermark-app-for-branding-or-security-purpose-in-go-80f7ee15003b?source=collection_archive---------18-----------------------#2020-02-26">https://medium.datadriveninvestor.com/build-image-watermark-app-for-branding-or-security-purpose-in-go-80f7ee15003b?source=collection_archive---------18-----------------------#2020-02-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5e27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编写一个小的便携式Go应用程序，将一个徽标放在一幅图像的顶部</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/01d269e3d68db78c8d72e4cb37c121de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6UHdkhzGI4A-eJVX2FaGFQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Watermarked documents. Original Photo by <a class="ae lb" href="https://unsplash.com/@anniespratt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Annie Spratt</a> on <a class="ae lb" href="https://unsplash.com/s/photos/document?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="d487" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">背景</h1><p id="cd54" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">通过放置品牌标识来保护图像格式的内容是业内称为水印的常见做法。没有人想使用带水印的图像。移除水印的努力相当高，从而使得未授权方失去了窃取内容的意图。这种尝试被证明可以改善安全措施。</p><div class="mf mg gp gr mh mi"><a href="https://www.datadriveninvestor.com/2019/01/23/which-is-more-promising-data-science-or-software-engineering/" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">数据科学和软件工程哪个更有前途？数据驱动的投资者</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">大约一个月前，当我坐在咖啡馆里为一个客户开发网站时，我发现了这个女人…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw kv mi"/></div></div></a></div><p id="1536" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">水印也可以作为审计工具。当向外部发送机密图像时，必须在其中添加包含收件人姓名和使用案例的水印。想象一下，当一张机密图像泄露时。很难确定泄漏的源头在哪里。但是如果图像包含水印，我们可以通过看水印来判断图像是从哪一方泄露的。另一方面，只有公司的内部人员能够得到没有水印的图像。如果没有水印的图像泄露，它一定是来自内部人员。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="c5b9" class="lc ld iq bd le lf ne lh li lj nf ll lm ln ng lp lq lr nh lt lu lv ni lx ly lz bi translated">目标</h1><p id="936f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">为带有公司标签图像的图像文件创建水印</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="3d93" class="lc ld iq bd le lf ne lh li lj nf ll lm ln ng lp lq lr nh lt lu lv ni lx ly lz bi translated">伪代码</h1><ol class=""><li id="3adf" class="nj nk iq jp b jq ma ju mb jy nl kc nm kg nn kk no np nq nr bi translated">获取基础图像的原始图像文件</li><li id="8c00" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">获取徽标图像的原始图像文件</li><li id="845e" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">计算徽标位置</li><li id="c696" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">合并这两个文件</li><li id="a6e3" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated">写入图像文件</li></ol></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="09af" class="lc ld iq bd le lf ne lh li lj nf ll lm ln ng lp lq lr nh lt lu lv ni lx ly lz bi translated">履行</h1><p id="968c" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">该应用程序需要以下依赖项。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="1e69" class="oc ld iq ny b gy od oe l of og"> "flag"<br/> "fmt"<br/> "image"<br/> "image/color"<br/> "image/draw"<br/> "image/jpeg"<br/> "image/png"<br/> "log"<br/> "os"<br/> "strings"</span></pre><p id="4904" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个名为<code class="fe oh oi oj ny b">readImage</code>的函数来读取文件并将其转换成图像对象。我们使用这个函数两次。(在伪代码中反映步骤1和2)</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="49c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建另一个名为<code class="fe oh oi oj ny b">writeImage </code>的函数，将图像对象写入文件。添加水印完成后，应用程序调用函数。(在伪代码中反映步骤6)</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="c2fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦子函数可用，就该创建名为<code class="fe oh oi oj ny b">createWatermark</code>的主函数了。该函数调用<code class="fe oh oi oj ny b">readImage</code>两次，然后处理步骤3和4。最后，函数调用<code class="fe oh oi oj ny b">writeImage</code>来编写输出文件。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="9210" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤3注释的代码显示了添加水印的过程。在上面的代码示例中，应用程序将徽标居中对齐。您可以通过修改<code class="fe oh oi oj ny b">x</code>和<code class="fe oh oi oj ny b">y</code>值来调整位置。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="74ca" class="oc ld iq ny b gy od oe l of og">offset := image.Pt(x, y)<br/>x ==&gt; distance from left<br/>y ==&gt; distance from top</span><span id="6c2c" class="oc ld iq ny b gy om oe l of og">image.Pt(0, 0) ==&gt; watermark at the very top-left</span></pre><p id="7ed8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，请注意步骤4注释的代码。您可以更改不透明度以符合产品要求。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="727c" class="oc ld iq ny b gy od oe l of og">image.NewUniform(color.Alpha{255}) ==&gt; 100% solid<br/>image.NewUniform(color.Alpha{128}) ==&gt; 50% opacity<br/>image.NewUniform(color.Alpha{64}) ==&gt; 25% opacity<br/>image.NewUniform(color.Alpha{0}) ==&gt; transparant</span></pre><p id="ca0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">功能<code class="fe oh oi oj ny b">createWatermark</code>独立工作。任何包都可以导入该函数。在这个示例中，为了制作一个可移植的Go应用程序，我们需要创建<code class="fe oh oi oj ny b">main</code>函数来读取用户输入(作为标志)并将其传递给该函数。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ok ol l"/></div></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="6d3b" class="lc ld iq bd le lf ne lh li lj nf ll lm ln ng lp lq lr nh lt lu lv ni lx ly lz bi translated">运行应用程序</h1><p id="83da" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">使用下面的Go命令将代码构建到Go应用程序中。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="4aeb" class="oc ld iq ny b gy od oe l of og">go build -o watermark</span></pre><p id="416a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为基础图像和徽标图像准备两个图像文件。将文件分别命名为<code class="fe oh oi oj ny b">base.jpg</code>和<code class="fe oh oi oj ny b">mark.png</code>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi on"><img src="../Images/d3d50a380fcca6170bc67343b1cc9f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLYArfjorVFNDU_414B_0g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">The base image at the left and logo image at the right.</figcaption></figure><p id="76fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，运行go应用程序，将图像文件名传递给右边的标志。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="e126" class="oc ld iq ny b gy od oe l of og">./watermark -base=base.jpg -mark=mark.png -output=out.jpg</span></pre><p id="9035" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该应用程序在与Go应用程序相同的文件夹中创建名为<code class="fe oh oi oj ny b">out.jpg</code>的输出。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oo"><img src="../Images/b3c215cfe93445e1ee89c0c5c62a817e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOAKx66-mJRAkqypqJzjcw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Watermarked image. Astronaut with a confidential label.</figcaption></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="537f" class="lc ld iq bd le lf ne lh li lj nf ll lm ln ng lp lq lr nh lt lu lv ni lx ly lz bi translated">摘要</h1><p id="309e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">水印的实现增加了防止内容误用的保护和优秀的审计工具。看看上面的代码——实现水印的工作非常简单。如果你的业务/产品是与其他方沟通，那么水印是必须的。</p><blockquote class="op oq or"><p id="3e2d" class="jn jo os jp b jq jr js jt ju jv jw jx ot jz ka kb ou kd ke kf ov kh ki kj kk ij bi translated">完整代码:<a class="ae lb" href="https://github.com/purnaresa/secureme/tree/master/watermark" rel="noopener ugc nofollow" target="_blank"> Git库</a></p></blockquote><p id="3fc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文中的示例是创建一个Go应用程序。但该功能本身也可以放在任何现有的Go应用程序中。</p><p id="55b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是什么？你也有需要有水印的PDF吗？</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ow ol l"/></div></figure></div></div>    
</body>
</html>