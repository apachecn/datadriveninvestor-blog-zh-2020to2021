<html>
<head>
<title>Deploying ML models using Django REST API Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Django REST API部署ML模型第2部分</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/deploying-ml-models-using-django-rest-api-part-2-84cea50b3c83?source=collection_archive---------0-----------------------#2020-03-14">https://medium.datadriveninvestor.com/deploying-ml-models-using-django-rest-api-part-2-84cea50b3c83?source=collection_archive---------0-----------------------#2020-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1056" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的<a class="ae kl" href="https://medium.com/@aminuisrael2/deploying-ml-models-using-django-rest-api-part-1-da0370a07b90" rel="noopener">上一篇文章</a>中，我解释了API的基本先决条件，并重点强调了Python web框架Django。在本文中，我将向您展示如何使用Django REST框架部署任何机器学习模型。让我们开始吧…</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/930a21b2d88cce358df466a5409967dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b059n7iQXt7J3RHV"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Photo by <a class="ae kl" href="https://unsplash.com/@spacex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">SpaceX</a> on <a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a> (Yeah, am so much a fan of spaceX and space travel 😀)</figcaption></figure><p id="0701" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将部署一个简单的多分类模型，根据血糖、血糖等预测糖尿病的类型(1型、2型或正常)。ML模型的代码可以在<a class="ae kl" href="https://colab.research.google.com/drive/1YOyEA2M_fQtvdwtUOvCWQhk-n7-8YcId" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="3e87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要部署我们通过API训练的模型，我们必须将API构建为:</p><ul class=""><li id="661f" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">接受数据并进行预处理</li><li id="4729" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">使用pickle加载我们训练过的模型</li><li id="8e4c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">根据我们通过的数据预测结果</li><li id="5160" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">以JSON( JavaScript对象表示法)的形式返回预测和置信度得分</li></ul><h2 id="f4b3" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">第一步</h2><p id="3547" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated"><strong class="jp ir"> <em class="mo">创建虚拟环境并安装所需库</em> : </strong></p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="6588" class="lq lr iq mq b gy mu mv l mw mx">C:\Users\Documents\mldeployment&gt;python -m venv my_api</span></pre><p id="3141" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我把我的虚拟环境命名为‘my _ API’，你可以使用任何你喜欢的名字。</p><p id="47ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行该命令后，使用以下命令激活虚拟环境…</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="48fe" class="lq lr iq mq b gy mu mv l mw mx">C:\Users\Documents\mldeployment&gt;cd my_api</span><span id="fd86" class="lq lr iq mq b gy my mv l mw mx">C:\Users\Documents\mldeployment\my_api&gt;cd Scripts</span><span id="4044" class="lq lr iq mq b gy my mv l mw mx">C:\Users\Documents\mldeployment\my_api\Scripts&gt;activate</span></pre><p id="cf93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会得到这样的结果:</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="94b6" class="lq lr iq mq b gy mu mv l mw mx">(my_api) C:\Users\Documents\mldeployment\my_api\Scripts&gt;</span></pre><p id="14f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于Linux和Mac用户，您可以使用以下链接了解如何创建虚拟环境:</p><blockquote class="mz na nb"><p id="aa08" class="jn jo mo jp b jq jr js jt ju jv jw jx nc jz ka kb nd kd ke kf ne kh ki kj kk ij bi translated"><strong class="jp ir">Linux</strong>:<a class="ae kl" href="https://www.liquidweb.com/kb/creating-virtual-environment-ubuntu-16-04/" rel="noopener ugc nofollow" target="_blank">https://www . liquid web . com/kb/creating-virtual-environment-Ubuntu-16-04/</a></p><p id="d3cd" class="jn jo mo jp b jq jr js jt ju jv jw jx nc jz ka kb nd kd ke kf ne kh ki kj kk ij bi translated"><strong class="jp ir">Mac</strong>:<a class="ae kl" href="https://programwithus.com/learn-to-code/Pip-and-virtualenv-on-Mac/" rel="noopener ugc nofollow" target="_blank">https://programwithus . com/learn-to-code/Pip-and-virtualenv-on-Mac/</a></p></blockquote><p id="cf43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个项目，这些是我们将要安装的必需包:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/60ef0b7f375ab8bb8093cd7defecd310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtDoC2mENhFhbg6hsvhcuw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Requirements</figcaption></figure><p id="be12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">建议将这个包添加到一个<strong class="jp ir"> requirements.txt </strong>文件中，并使用<strong class="jp ir"> pip </strong>从文本文件中安装，而不是一个接一个地安装。</p><div class="ng nh gp gr ni nj"><a href="https://www.datadriveninvestor.com/2019/02/25/6-alternatives-to-the-yahoo-finance-api/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">雅虎财经API |数据驱动投资者的6种替代方案</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">长期以来，雅虎金融API一直是许多数据驱动型投资者的可靠工具。许多人依赖于他们的…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx kw nj"/></div></div></a></div><p id="5bc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建文件并添加python库之后，将它们安装到使用命令创建的虚拟环境中</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="cd1c" class="lq lr iq mq b gy mu mv l mw mx">pip install -r requirements.txt</span></pre><p id="e6ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后将安装所需的软件包。</p><h2 id="c2cb" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">第二步</h2><p id="e625" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated"><strong class="jp ir"> <em class="mo">建立Django和Djangorest: </em> </strong></p><p id="3bce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在命令行中，创建一个Django项目…</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="d017" class="lq lr iq mq b gy mu mv l mw mx">(my_api)C:\Users\Documents\mldeployment&gt;django-admin startproject model_deploy</span></pre><p id="111a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，导航到文件夹的目录并创建一个Django应用程序</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="ce42" class="lq lr iq mq b gy mu mv l mw mx">(my_api)C:\Users\Documents\mldeployment\model_deploy&gt;django-admin startapp api</span></pre><p id="fce6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在一天结束的时候，你应该有一个这样的工作目录…</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/21317c37d98daa9d7966fc64dbbc6f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*CQxx5RpGGCmdZ6TmDntDPw.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Working Directory</figcaption></figure><p id="5a18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在model_deploy文件夹中，导航到<strong class="jp ir"> settings.py </strong>文件，添加“rest_framework”和“api”，这是我们在<strong class="jp ir"> INSTALLED_APPS </strong>下创建的应用程序。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/9905d699bb75b20843cabc9ffc0a95f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*T10-P92IX4Er2j-UR0fWNA.png"/></div></figure><p id="5059" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后进行迁移</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="e08b" class="lq lr iq mq b gy mu mv l mw mx">(my_api)C:\Users\Documents\mldeployment\model_deploy&gt;python manage.py makemigrations</span></pre><p id="6336" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后迁移</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="2b78" class="lq lr iq mq b gy mu mv l mw mx">(my_api)C:\Users\Documents\mldeployment\model_deploy&gt;python manage.py migrate</span></pre><p id="ea85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过运行服务器来检查一切是否正常</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="8754" class="lq lr iq mq b gy mu mv l mw mx">(my_api)C:\Users\Documents\mldeployment\model_deploy&gt;python manage.py runserver</span></pre><p id="a131" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你应该会得到这样的结果…</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="ba0f" class="lq lr iq mq b gy mu mv l mw mx">Performing system checks...</span><span id="bddb" class="lq lr iq mq b gy my mv l mw mx">System check identified no issues (0 silenced).<br/>March 04, 2020 - 07:34:15<br/>Django version 2.2.7, using settings 'model_deploy.settings'<br/>Starting development server at <a class="ae kl" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/</a><br/>Quit the server with CTRL-BREAK.</span></pre><p id="b88c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">复制<a class="ae kl" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000/ </a>并粘贴到您的网络浏览器上，您应该会得到类似下图的东西。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oa"><img src="../Images/bc320633518722d14c227a307eba99c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xPtNAAqG_82pgdar7Ab3Hg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">The installation worked successfully…</figcaption></figure><h2 id="d0ae" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">第三步</h2><p id="1b23" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated"><strong class="jp ir"> <em class="mo">构建API: </em> </strong></p><p id="4a84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在api文件夹中，导航到<strong class="jp ir"> views.py </strong>文件并粘贴以下代码。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="ob oc l"/></div></figure><ul class=""><li id="0f62" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">在第2–6行，我导入了必要的库</li><li id="497e" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">在第9-15行，我创建了一个简单的索引页面，它更像是每个网站或API的欢迎页面，注意第9行中使用的装饰器，装饰器做了什么，它检查API请求方法以查看它是否是一个GET请求，如果不是GET请求，那么你将不能访问那个函数。</li><li id="c1ba" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">第20–25行从API端点收集数据，并将其存储在一个变量中</li><li id="a867" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">从第27行到第33行，我做了一个简单的数据预处理，把变量转换成浮点型，因为当你从网上收集数据时，它总是被表示成字符串数据类型。</li><li id="3410" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">从36到39，我使用pickle加载模型，我将它存储在一个名为“ml_model”的文件夹中。然后在加载模型后，我传入收集的数据来进行预测，并获得置信度得分。</li><li id="189f" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">然后，在第40–44行，我构造了将响应作为JSON返回的方式。</li></ul><p id="1fb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">配置URL(路径)</strong></p><p id="a272" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，导航到“model_deploy”文件夹中的“urls.py”文件，然后粘贴以下代码</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="a121" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在“api”文件夹中创建一个新的urls.py文件，并粘贴以下内容</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="mz na nb"><p id="8e2e" class="jn jo mo jp b jq jr js jt ju jv jw jx nc jz ka kb nd kd ke kf ne kh ki kj kk ij bi translated">请注意，在urls.py中，我们将路径“predict”设置为views.py中的函数“predict_diabetictype”。因此，每当我们将该路径添加到端点时，Django都会将您带到views.py文件中的该函数</p></blockquote><p id="8376" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过运行服务器检查是否没有任何问题:</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="7aac" class="lq lr iq mq b gy mu mv l mw mx">(my_api)C:\Users\Documents\mldeployment\model_deploy&gt;python manage.py runserver</span><span id="ca75" class="lq lr iq mq b gy my mv l mw mx">Performing system checks...</span><span id="c4e3" class="lq lr iq mq b gy my mv l mw mx">System check identified no issues (0 silenced).<br/>March 11, 2020 - 11:15:15<br/>Django version 2.2.7, using settings 'model_deploy.settings'<br/>Starting development server at <a class="ae kl" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/</a><br/>Quit the server with CTRL-BREAK.</span></pre><p id="1294" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的。！！您已经成功部署了您的ML模型。</p><p id="d57a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">测试API </strong></p><p id="6c62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用邮递员</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oa"><img src="../Images/0d3bfaa497a17ea0eb079e1610e8bf02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7enLqCd5H8UwPvBYA_Mnxw.png"/></div></div></figure><p id="81f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以基于我传递的那个数据，我得到了一个<strong class="jp ir">正常</strong>的预测，置信分值<strong class="jp ir"> 69 </strong> %,速度<strong class="jp ir"> 3.0秒。</strong></p><p id="76d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">***</p><h2 id="405a" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">查看API的运行情况</h2><p id="73c5" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">这个API被整合到Adeniran Opeyemi Adewale建立的网站上，帮助病人和医生了解他们的糖尿病类型。你可以点击查看<a class="ae kl" href="https://nifty-ride-7ff752.netlify.com/#" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="13b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个项目，你可以在这里得到代码<a class="ae kl" href="https://github.com/AminuIsrael/Deploying-ML-Models-with-Django" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3bf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读😀。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="of oc l"/></div></figure></div></div>    
</body>
</html>