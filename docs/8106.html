<html>
<head>
<title>How to Simulate and Troubleshoot Medical Imaging Transfers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何模拟和排除医学成像传输故障</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/how-to-simulate-and-troubleshoot-medical-imaging-transfers-8f328de80c03?source=collection_archive---------2-----------------------#2021-01-01">https://medium.datadriveninvestor.com/how-to-simulate-and-troubleshoot-medical-imaging-transfers-8f328de80c03?source=collection_archive---------2-----------------------#2021-01-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5ecc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用DICOM图像传输部署和模拟PACS系统，故障排除，并了解每种设备的安全含义。</h2></div><p id="ea5f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我们将介绍如何结合使用免费和开源工具来设置和部署一个基于客户端-服务器的小型医学成像网络。此外，我们将对这类系统之间一些常见的互操作性问题进行故障排除；并且还为健康信息技术(<a class="ae le" href="https://www.hhs.gov/hipaa/for-professionals/special-topics/health-information-technology/index.html" rel="noopener ugc nofollow" target="_blank"> HIT </a>)专业人士提供建议。</p><p id="c5b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成本文后，您应该能够:</p><ul class=""><li id="2d9c" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">对常见的医学影像协议<br/>和标准有基本的了解</li><li id="ce3e" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">能够利用该标准部署两种不同的客户端/服务器供应商软件<br/></li><li id="a055" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">对两个供应商之间的基本网络和配置支持需求<br/>进行故障排除</li><li id="5d33" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">了解这些系统的<a class="ae le" href="https://cyber.findings.co/click.track?CID=431076&amp;AFID=470105&amp;ADID=2431672&amp;SID=WD" rel="noopener ugc nofollow" target="_blank">安全含义</a>和所需的补偿控制<br/></li></ul></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="a177" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">医学成像系统101</h1><p id="0b69" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">作为一名安全专业人员和前渗透测试人员；我一直困惑于我是如何能够如此轻易地损害许多内部医疗成像相关系统的。当我向必须部署和管理这些系统的管理员展示重要发现时；你可以看到他们脸上绝望的表情。这与典型的Windows系统管理员大不相同，后者可能只是以一劳永逸的方式推送额外的补丁或GPO配置。</p><p id="0609" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，为什么医疗成像系统比典型的IT企业系统更难管理呢？首先，我们需要了解成像组件的两个关键部分。在行业中，医疗保健支持技术的专业技术人员将这些类型的技术集合称为图片归档和通信系统(<a class="ae le" href="https://www.nccoe.nist.gov/sites/default/files/library/sp1800/hit-pacs-nist-sp1800-24-draft.pdf" rel="noopener ugc nofollow" target="_blank"> PACS </a>)。</p><p id="83e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些类型的网络专用于不同的系统和组件，称为上传、编辑、保存和传输医学特定图像的设备。作为文件对象和协议规范的最常见成像标准称为:医学数字成像和通信(<a class="ae le" href="http://dicom.nema.org/medical/dicom/current/output/html/part01.html" rel="noopener ugc nofollow" target="_blank"> DICOM </a>)。</p><p id="1399" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">许多不得不在PACS网络上使用DICOM标准的HIT管理员遇到了互操作性问题，这主要是因为不同供应商部署DICOM标准的方式、支持的DICOM版本以及支持的采集<a class="ae le" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html" rel="noopener ugc nofollow" target="_blank">设备类型</a>存在差异。这三个不同之处意味着，要使PACS组件能够正确地相互“对话”;它通常是系统架构和安全性的最佳实践的折衷，我们很快就会看到。</p><p id="520b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在较小程度上支持发行；在每个图像周围支持的元数据中也存在潜在的问题，这些图像组合在一起成为一个完整的患者记录；两个常见的标准是<a class="ae le" href="https://healthstandards.com/blog/2013/03/26/hl7-fhir/" rel="noopener ugc nofollow" target="_blank"> HL7和FHIR </a>。元数据标准超出了本教程的范围。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="d920" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">为实验室安装软件</h1><p id="0b1a" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">让我们开始我们的第一个服务器/客户机部署设置。出于本实验的目的，我将使用相同的本地主机。然而，这些可以很容易地放在不同的容器上，或者直接部署在网络上的不同系统上。我们将使用不冲突的端口，这样您就可以跟着做了。我们将首先下载并安装<a class="ae le" href="https://www.orthanc-server.com/" rel="noopener ugc nofollow" target="_blank">或传统服务器</a>，使用默认的向导设置来包含所有支持的插件。</p><p id="d272" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Orthanc Server是一个为医疗专业人员和研究人员开发的开源平台，它提供了一个一体化的DICOM兼容服务器和客户端。它还拥有插件和REST API以及使用用户名/密码认证和TLS来保护服务器本身的能力。要在生产网络中部署它，请先通读他们的<a class="ae le" href="https://www.orthanc-server.com/static.php?page=documentation" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="4452" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">docker、Linux和Windows编译的二进制文件的安装步骤有所不同。在写这篇文章的时候，我已经把我的例子安装在64位的Windows 10上了。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/5a88920187c2cfa9d27cefa94f46e9bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*I8GVmr-m1OYQx1800ZX4cQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Orthanc Server Install Directory</figcaption></figure><p id="baca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果安装正确，您应该能够导航到服务器目录。在windows中，这是默认位置:“C:\ Program Files \ or ANC Server”。有一个“README.txt”文件，您可以打开它来了解有关您的安装的更多信息，您将找到可以使用浏览器导航到的主机和端口号。默认为HTTP不安全:"<a class="ae le" href="http://127.0.0.1:8042/app/explorer.html" rel="noopener ugc nofollow" target="_blank">HTTP://127 . 0 . 0 . 1:8042/app/explorer . html</a>"</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi mx"><img src="../Images/09cab80b83f8bec77fb54db1c1c095be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*4h4x6Z6meGwhC8FOy5cLCw.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Orthanc Explorer Home Page</figcaption></figure><p id="8e56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们保留该部署，并使用我们的第二个客户机/服务器来处理与的图像交换。这次我们将使用一个叫做<a class="ae le" href="http://www.onis-viewer.com/ProductInfo.aspx?id=19" rel="noopener ugc nofollow" target="_blank">的工具on Viewer 2.5</a>(免费版)。出于实验目的，也在同一台主机上下载并安装该软件。或者，如果您愿意，也可以将其放在不同的主机上。记住以后要更改IP地址设置。</p><p id="09ad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用ONIS来模拟一个完全不同的供应商，作为我们PACS的一部分，以模拟根据功能文档“应该”与exchanges images和Orthanc软件套件完全互操作的内容。我不会在此一一列举，但我们将在本实验室测试的DICOM相关特性至关重要:</p><blockquote class="nn no np"><p id="58e2" class="ki kj nq kk b kl km ju kn ko kp jx kq nr ks kt ku ns kw kx ky nt la lb lc ld im bi translated">从任何设备读取和显示所有DICOM文件</p><p id="980a" class="ki kj nq kk b kl km ju kn ko kp jx kq nr ks kt ku ns kw kx ky nt la lb lc ld im bi translated">按需功能(可以直接从DICOM <br/>服务器、CD或文件夹中打开DICOM文件，而无需先下载到本地<br/>数据库中)</p><p id="94b7" class="ki kj nq kk b kl km ju kn ko kp jx kq nr ks kt ku ns kw kx ky nt la lb lc ld im bi translated">支持DICOM网络服务(C-查找SCU，C-获取SCU，C-移动SCU，<br/>C-存储SCP/SCU)</p></blockquote><p id="f2c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">成功的安装应该显示如下所示的窗口；请暂时忽略患者条目。这些是导入的示例，稍后将在我们的实验室测试中使用。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/6488c4c43b27001431954514e47d9575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*yYWFHhd-lTv5dqSPOoqzgg.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Onis 2.5 Free Edition Home Screen</figcaption></figure><p id="c9ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们将安装使用npcap库安装的<a class="ae le" href="https://www.wireshark.org/download.html" rel="noopener ugc nofollow" target="_blank"> Wireshark </a>，而<em class="nq">将需要重启</em>。使用向导中的默认设置。如果您使用较旧的wireshark或已安装，它将默认使用winpcap或libpcap，具体取决于您的操作系统和预安装的打包版本。成功安装后，如果您打开Wireshark，您应该会看到您主机的一个或多个适配器。我们将关注“环回”适配器，如下图所示:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/ce60e5a9b7d3c29750a66ed150bb0845.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*l0DwJugLiIwwxCF0OJ65GQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Ensure that your Wireshark has a Loopback Traffic Adapter</figcaption></figure></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="6b9f" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">配置PACS通信</h1><p id="8bd1" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">现在是时候记下我们对Orthanc和Onis的配置了。我们将从Orthanc开始，因为我们首先安装了它。导航到服务器目录并检查“配置”文件夹。在windows中，这是:C:\ Program Files \ or ANC Server \ Configuration。制作ortanc.json的备份，并将备份重命名为类似ortanc.json.bak的名称，如下所示:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/b2911f4047019dd4e6b6f8dbe535e144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*aX80y8YYzvrTDiStWOaBKA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Make a backup of the config JSON file first</figcaption></figure><p id="756b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用您喜欢的文本编辑器，继续编辑orthanc.json原始文件。我使用的是<a class="ae le" href="https://notepad-plus-plus.org/downloads/" rel="noopener ugc nofollow" target="_blank"> notepad++ </a>，它默认给出了JSON格式的颜色解释。在Orthanc服务器上，您可以配置许多有趣的选项。现在忽略它们，让我们专注于配置与另一个DICOM服务器/客户端设备的通信；也就是Onis 2.5。向下滚动并注意“DICOM服务器配置”部分下的DICOM AET字符串名称和端口设置:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/d733c80adf72c708695d639c6a8cb680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*cR2tiph1t0Oq1wOcOO1Y5Q.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Note the peer connection name and port</figcaption></figure><p id="6e8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您看到的字符串“ORTHANC”相当于常规网络监控管理中的SNMP <a class="ae le" href="https://www.dnsstuff.com/snmp-community-string" rel="noopener ugc nofollow" target="_blank">社区名称字符串</a>；在PACS世界中，这被称为应用实体标题(<a class="ae le" href="http://dicom.nema.org/medical/dicom/2014c/output/chtml/part02/sect_A.3.4.html" rel="noopener ugc nofollow" target="_blank"> AET </a>)。端口是服务器端口，Ortanc主机正在侦听入站“推送”连接，例如存储和查询数据。请记下这些信息，因为我们以后还会用到它们。</p><p id="8fad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nq">让orthanc.json文件保持打开状态</em>在2.5上继续打开。导航至首选项模块。正如你所看到的，这个软件也是一个客户端/服务器，只是支持不同的功能。单击“DICOM服务器”选项卡，记下网络AET、IP和端口信息。PDU大小没问题，因为它是大多数PACS交换大小的常见默认值。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/2d2bb8310101025139da28a66f6d014a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*uc72V1JQei4klZygLrjAHA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Note the Onis server connection name and port</figcaption></figure><p id="450b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们知道了两个端点服务器端的监听信息，让我们继续将它们“对等”在一起。在Onis 2.5中，单击“Clients”选项卡，并使用之前看到的奥桑克AET详细信息添加一个新名称。请注意，由于我们在同一台主机上进行实验，因此我们使用的是环回IP地址“127.0.0.1”。</p><p id="01a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您在不同的主机上安装这两个解决方案，请用正确的地址信息替换它。在ORTHANC中输入AET信息。您可以选择将CSTORE留空或添加一个标题。记得将端口更改为“4242 ”,因为这是默认端口或anc正在侦听的端口。请注意，在生产环境中，许多PACS系统已经在tcp端口104上进行了转换。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/f2184feaf4c27c49602cf945fd98317c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*2iHVg71wtBPUJvD8YMkItA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Add Orthanc as a client peer to Onis under the clients tab</figcaption></figure><p id="9a3b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建您的客户端，然后返回到“DICOM服务器”选项卡，关闭并再次启动服务器，以确保配置更改已加载到内存中，以防万一:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/55ff7f426c53e522a79b8ab46f6789db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*ZckKun9P7pS_8tibFPn-LQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Restart the Onis DICOM Server</figcaption></figure><p id="d58a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们返回othanc.json，向下滚动到“DicomModalities”部分，将Onis 2.5添加为我们的对等项。请记住，之前的字符串“ONIS25”被用作tcp端口104上的服务器AET。在一行中添加对等配置，如下图所示:</p><blockquote class="nn no np"><p id="35d8" class="ki kj nq kk b kl km ju kn ko kp jx kq nr ks kt ku ns kw kx ky nt la lb lc ld im bi translated">" ONIS25" : [ "ONIS25 "，" 127.0.0.1 "，104 ]</p></blockquote><p id="9fee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请务必注意配置文件中的意图和间距:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/bef9a18842f2488b65d90d24fb4e592c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*UvHrMYguc9fnnm2QEV9Y9Q.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Set the Onis peer connection details</figcaption></figure><p id="afaf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">保存orthanc.json并重新启动orthanc服务。在windows中，这位于“开始”、“运行”、“服务”. msc管理单元下:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/2786b8aab3567514700b9932be58e3b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*gpR6IgVJjFMYM3p5lWdpKQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Restart the Orthanc service after saving the JSON config file</figcaption></figure><p id="cbcc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为最终配置组件；让我们打开Wireshark嗅探器和适当的捕获过滤器，只捕获这两个本地应用程序之间的流量。为此，在捕获部分设置以下过滤器:</p><blockquote class="nn no np"><p id="7e31" class="ki kj nq kk b kl km ju kn ko kp jx kq nr ks kt ku ns kw kx ky nt la lb lc ld im bi translated">tcp端口104或tcp端口4242</p></blockquote><p id="dd49" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在选择或突出显示“回送流量捕获适配器”如果您看不到这一点，这意味着您的安装不包括启用环回的适配器。选择与您的监听服务相对应的本地以太网适配器。或者，使用适当的组件重新安装wireshark。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/7873b1235610650bae60dabf950b51dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*6bM5kxkqFkd-qPN4IN8u5w.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Add the filter to the wireshark capture screen</figcaption></figure><p id="d380" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在导航到Wireshark应用程序的左上方，单击蓝鲨图标。它现在将开始将数据包捕获到临时假脱机中:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/4c887004c9cf83868f1e12438595849b.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*xapa0C0nqh1FgBvOHS3NfQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Start the capture</figcaption></figure><p id="2a53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们通过DICOM协议在这两个PACS端点之间发出“<a class="ae le" href="https://book.orthanc-server.com/dicom-guide.html#c-echo-testing-connectivity" rel="noopener ugc nofollow" target="_blank"> C-Echo </a>”来测试连通性。这相当于在常规网络测试中运行“<a class="ae le" href="https://www.howtogeek.com/howto/windows-vista/allow-pings-icmp-echo-request-through-your-windows-vista-firewall/" rel="noopener ugc nofollow" target="_blank"> ping </a>”。回到Orthanc explorer窗口并刷新页面。如果你关闭了它，这是链接</p><blockquote class="nn no np"><p id="dccd" class="ki kj nq kk b kl km ju kn ko kp jx kq nr ks kt ku ns kw kx ky nt la lb lc ld im bi translated">http://127 . 0 . 0 . 1:8042/app/explorer . html</p></blockquote><p id="969e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，点击右上角的查询/检索:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/0b114153e06e9147347fd1a41de718e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*sMwgvy6z5izM3rFu6-N2hw.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Begin a query retrieve job against Onis</figcaption></figure><p id="2438" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过点击不同的选项进行导航，或者保留默认值。点击“测试回声”</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/4c36cf1b7fd34b370c7bfdce1bcc3c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*MnJjAaWdSekzQhIdtUrFcQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Perform a peer connection test between the modalities</figcaption></figure><p id="18af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您应该会在Wireshark中收到一条成功消息和一个新的TCP流，如下所示:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/93da581dab08e5b52ee7ba1430168497.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*TEjkQi8lDEcXtMmt83YpMg.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">A successful DICOM connection based on AET strings</figcaption></figure><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/2fde4cf0f8d866a93aaee6fd3e5fd894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*zRUCsM3LUm6IXye2O6ir1Q.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Packet capture validation of the successful peer connection test</figcaption></figure></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="98f2" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">模拟图像传输</h1><p id="205a" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">是时候开始我们的测试用例了。因为这些不是图像采集模式；只有DICOM客户端和服务器。我们将需要获取一些去标识的公共样本数据，以摄取到我们的一个端点进行传输。让我们从dicomlibrary.com<a class="ae le" href="https://www.dicomlibrary.com/" rel="noopener ugc nofollow" target="_blank">下载2个样本文件</a>，一个是模态“OT”类型，是“其他”的缩写，另一个是“CT”，是“计算机断层扫描”的缩写。</p><p id="2bb1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下载以下内容:</p><p id="b2ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://www.dicomlibrary.com?requestType=WADO&amp;studyUID=1.2.826.0.1.3680043.8.1055.1.20111102150758591.92402465.76095170&amp;manage=1b9baeb16d2aeba13bed71045df1bc65&amp;token=a915dc65c126e7c152e35f5e209fc7e6" rel="noopener ugc nofollow" target="_blank">CT设备匿名的文件1</a></p><p id="9b2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://www.dicomlibrary.com?requestType=WADO&amp;studyUID=1.2.826.0.1.3680043.8.1055.1.20111103112244831.40200514.30965937&amp;manage=feb6447a72c9a0a31e1bb4459e547964&amp;token=74820de0bc791c79af946968ef09dea0" rel="noopener ugc nofollow" target="_blank">用于OT设备匿名化的文件2</a></p><p id="dc04" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意:如果在撰写本文之后链接失败或改变，请直接访问dicomlibrary.com链接，从他们的公共库中找到两个相同的样本。</p><p id="09da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将文件解压缩到一个暂存位置，并在我们测试用例的过程中注意哪个文件是哪个文件。</p><p id="d5ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于我们的第一个测试案例，让我们通过单击import按钮，并为每个研究选择目录或文件，将两个文件都导入到Onis 2.5中。请注意，患者姓名是“匿名的”，这是两者的标准字符串，ID设置为“0”。如果您选择将图像放在不同的患者档案下，Onis免费版将限制您使用15个唯一的患者ID。观察新的元数据和与设备相关的系列或图像。您也可以选择在他们的胖客户端查看它们。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/87166e3a4f6e9b7676e83caeddae6236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*XFt-EgIr3fb6-XEmjOygjA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Import the sample DICOM images to Onis locally</figcaption></figure><p id="b8cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要在查看器中查看图像，请双击右下角的图标:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/7716ddd290de3890779b936778e0865e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*_2VUaNwiT59IoqsGb2bA6g.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Viewer mode in Onis of one of the DICOM images</figcaption></figure><p id="9cc8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您可以根据自己的意愿进行更改，或者添加注释或其他项目，就像您是一名放射科医师或其他医学专业人员一样。让我们通过将这个映像推送到Orthanc服务器端点来启动我们的第一个文件传输。完成所需的任何更改后，单击文件、导入，然后选择“或”。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/26e805379726bf50d6516848d21d3716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*3c-KqiH7BAVxwfk0MeNhYQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Push the DICOM image to the Orthanc Server modality</figcaption></figure><p id="19bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能还希望更改与该患者健康记录相关的一些元数据。完成后，点击“复制到”:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nx"><img src="../Images/0a3519471012dcb406cfd60bc3a33d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*M3R7H7SfyDJFOgO7-gLVog.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Modify the DICOM image if you desire before pushing to Orthanc</figcaption></figure><p id="6429" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，观察Wireshark已经创建了一个新的TCP流，并且正在通过C-STORE协议命令initiated传输数据。Wireshark尽最大努力解码DICOM格式的有效载荷，并解析报头和适当的协议细节。欲了解更多关于DICOM网络级分析的信息，请点击<a class="ae le" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC61235/" rel="noopener ugc nofollow" target="_blank"> NIH参考</a>，了解更多关于C-methods和PDU架构的细节。观察字段中不同的元数据和网络级成功的图像上传，显示为“C-STORE-RSP ID=5”状态退出代码0x00作为回复。随后是FIN-ACK的TCP流拆除。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nx"><img src="../Images/09f05abcebe67e5a2f6c3e8a09b0cd1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*f3Kg-bZWjSPa-FSRFu3xEg.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Packet capture example of a successful image transfer from Onis to Orthanc</figcaption></figure><p id="2ed9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从网络取证的角度来看；Wireshark还有一个内置的解剖器，可以将DICOM图像切割成其原生的DCS文件扩展名格式。它并不完美；尤其是当存在网络延迟、错误或数据包丢失时，因为这会影响DICOM图像的完整性。尽管如此，它在Wireshark的更高版本中还是很可靠的。为此，在菜单中选择文件、导出对象和DICOM:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oc"><img src="../Images/43d387060f6256a67c2313c6e231181d.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*vLAwmBy8ybpCfN59pq9fsg.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Forensically extract DICOM images out of a packet capture</figcaption></figure><p id="8ad5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您可以选择每个图像的流，然后单击“保存”保存DCM文件，并在任何您喜欢的本地查看器中打开它:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/0e4e836561319a2bc331d82ab60d627e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*F3wLCWGx1QJIpHyds2lRnw.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Save the DICOM image locally from the Wireshark packet capture</figcaption></figure><p id="bf79" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是查看是否有重大网络问题或其他应用程序特定问题导致PACS端点之间的DICOM图像损坏的好方法。</p><div class="od oe gp gr of og"><a href="https://www.datadriveninvestor.com/2020/09/04/the-lowest-cost-most-effective-path-to-better-cybersecurity/" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">提高网络安全的最低成本和最有效途径|数据驱动型投资者</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">在组织在2020年面临的诸多挑战中，网络安全(或缺乏网络安全)已成为新闻报道的焦点…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="op l"><div class="oq l or os ot op ou nd og"/></div></div></a></div><p id="b4af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要在Orthanc中观察图像上传，请导航回浏览器主页。或者点击左上方的“查找”。现在将患者ID设置为“0 ”,并单击“执行查找”或单击“所有患者”。执行“执行查找”将显示上传到患者的所有文件:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nx"><img src="../Images/7c420f47aca20a54f7b5f80ba0e1637f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*2ObC36VF9zh-33DCGuDgWw.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Search for patient records inside Orthanc</figcaption></figure><p id="a00f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nq">注意:执行“所有患者”将仅加载每个患者的结果并显示文件数。在这里，我按患者“0”进行了查找，您会注意到两个不同的条目。这是因为出于本实验的目的，我从Onis上传了CT和OT设备图像文件。</em></p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/fbf5b5039bc19ad621bb5b9cd9a83289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*pLHKUOqZ5BhH5l8spB486g.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">A ‘do lookup’ click will show unique files per study ID for the specified patient number</figcaption></figure><p id="6b73" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击你上传的腹部CT图像。您将导航至患者的病历报告，其中包含变更中的元数据以及样本DCS文件中的原始信息。这个系列看起来像你在PCAP看到的吗？这应该是因为虽然这不是我们在图像中显示的相同的UID。它是一个特定于患者、研究和其他层次结构的标识符，DICOM协议利用它来匹配哪个图像部分或系列属于谁。</p><p id="bf77" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在该窗口中，您可以选择使用Orthanc自己的DICOM查看器，并对其界面中的数据进行编辑，或者如果您是开发人员，可以使用其REST API。现在，让我们尝试将这个更新的图像<em class="nq">传输回</em>到Onis 2.5来更新它的本地索引:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/6c0bf6e80001b5884109ea964d8474cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*dmzZ6FBKHOiglpBqahSVVg.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Attempt to push DICOM image back to Onis from Orthanc</figcaption></figure><p id="03b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单击“发送到DICOM设备”,您应该会看到一个弹出窗口，将我们唯一的对等目标指向ONIS25:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/73ed5862ba88c8fdd42261b622b3601e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*lPl0IH36-wdSWJHcCXc75w.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Execute the send DICOM image transfer job to Onis</figcaption></figure><p id="1130" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您现在应该会收到一条错误消息:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/fc6e33c1687512dc5502c7257e5fedc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*ygCyANpjFmcRoSHv0fYdfw.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">An expected error attempting to push to Onis</figcaption></figure><p id="c5da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">检查PCAP数据，您现在应该看到对on上的tcp端口104的“C-STORE”尝试。现在，响应显示状态错误代码0cx001，Wireshark将其解释为Onis 2.5上的端点由于某种原因无法理解或处理，后面是映像名称的UID:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/12ef0e242d62c76edf36d4b0d0c7070d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*dmOQniriS5R7iRLkr4qQsw.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Packet capture troubleshooting the DICOM transfer</figcaption></figure><p id="f45d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而从网络层面来看，这有助于确定问题是<em class="nq">而不是</em>网络；这并不能帮助我们排除PACS终端应用层的故障。此外，图像仍然以明文形式通过电线传送。如果你做另一个文件导出对象；您将能够看到DCS文件，就像传输成功一样！</p><p id="9949" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们检查Onis 2.5，看看日志中是否有什么。正如我们所看到的，这里没有任何东西可以从这个端点帮助我们诊断我们的问题。要查看此信息，请单击首选项、管理，然后单击日志选项卡以了解更多详细信息:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/4462ebb9f1bc6545b51388218db4ff41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*xJhMwR3_jCBnyLyhBTVVAQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Onis log file does not provide much verbosity of the failure</figcaption></figure><p id="4ee1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了完整的测试；我们知道连接对等是单向的。我们能不能至少查询一下Onis索引中的病人数据？毕竟，我们首先在这里存储了这两个文件。导航回Orthanc并单击查询/检索。将患者ID设置为0，选择“ct”记录设备类型，然后单击“搜索病历报告”:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/14283e4c15a1182f1696f51acf038f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*KTSqlU4yf9RC2G5QX1L7iQ.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Try a different method to get files from Onis instead</figcaption></figure><p id="cd17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在执行简单查询(C-Find)时，您应该会收到一个错误，请注意，wireshark捕获显示了更多关于UID的上下文，请求的详细信息如下。然而，pcap在状态命令中变得更加无用。我们知道调用者请求了什么，但是没有C响应，只有AET连接级别的关联对等接受:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/257348a8f30924cf8450d11ef2f2bef5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*i_wIrApBgFgPkM-7a3oj1w.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Error persists connecting to Onis for patient identifiers with packet capture</figcaption></figure><p id="1d2f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更好地进行诊断，请转到Orthanc服务器文件夹目录并打开最新的日志文件。请记住，每次运行服务时，至少会有两个日志。您可以在windows中的“C:\ Program Files \ or ANC Server \ Logs”下找到这些日志。滚动到底部，它将声明查询不支持C-Find命令，也不支持store命令。这两者都在Onis目标服务器上，尽管公布了特性集；Orthanc似乎说不出Onis能接受的DICOM的适当实现:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/b41bfcedd7a766dd8b92ff9d1d3688cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*e3IlU-4kGljDXWEPDho4kA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Log file from Orthanc showing Onis does not accept or understand its C-FIND/STORE methods implementation of DICOM</figcaption></figure><p id="63e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根本原因可能是一个或多个问题；但至少在我们的基础设施中没有。很明显，C-FIND和C-STORE命令应该是相同的，这在Onis 2.5免费版中有记录，正如我们从模态之间的通信对话中看到的那样。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="0dfc" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">高级故障排除和解决方法</h1><p id="d83f" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">接下来的步骤是通过修改Orthanc配置文件来尝试利用C-GET的修改，我们将不会在本教程中介绍这一点。这样做的信息可以在<a class="ae le" href="https://book.orthanc-server.com/dicom-guide.html#c-echo-testing-connectivity" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="238a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者，Orthanc的参数在运行时内置了补丁或行为修饰符，特别是在C-FIND重用中。在orthanc.json文件中，您可以在“DicomModalities”下找到它。您还可以尝试对Onis强制执行修补的行为，看看会发生什么。这本质上是它自己内置的挂钩机制。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/b8aecff82a13496f84799d49de2a76ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*3bVYDKVGTbBaaAFJc6W5dg.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Use Orthanc’s built in function hooking patches to modify the C-method behavior</figcaption></figure><p id="d121" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个解决方案可能是使用动态工具在二进制级别使用定制挂钩。PACS专家或工程师必须审查DICOM客户端或服务器的相关C-method库的任何公开记录的API，并在适当时制作适当的参数函数入口或出口挂钩。完成这项工作的一个工具是<a class="ae le" href="https://frida.re/" rel="noopener ugc nofollow" target="_blank">弗里达</a>。这是一项非常高级的要求，通常由不再提供支持的传统供应商完成。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="cfcf" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">安全考虑</h1><p id="812d" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">我多次看到医疗IT专业人员禁用安全验证来试图隔离问题，例如AET验证和源IP验证。我强烈反对这种做法，因为它会给安全威胁带来更大的问题。例如，如果我在源IP验证访问控制列表上禁用了，如下图所示；从攻击者的角度来看，你认为会发生什么？</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/06de4e85c1b280a1aab26fe3482c3b04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*FlI_UuJvE_BzHuJ8wdju8Q.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Security turned off for Onis DICOM server</figcaption></figure><p id="df56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您的答案是肯定的，那么任何可以在网络级别访问该IP和端口组合的人都可以— <em class="nq">操纵患者记录、文件，甚至完全删除记录</em>。你的猜测是正确的。最起码，需要实施和维护所有的访问控制。如果您的设备不支持这一点，您将需要在操作系统或网络级别抽象更高的安全性来帮助保护这一点。</p><p id="7ad6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了确保您使用所有内置的粒度控制，而不管PACS设备端点如何；您应该考虑通过TLS连接隧道包装所有DICOM图像传输。作为一名前医疗安全工程师；我见过许多设备不支持加密，或者只支持传统的TLS v1.0或SSLv3。要解决这个问题，您需要使用一个<a class="ae le" href="https://nmap.org/ncat/guide/ncat-tricks.html" rel="noopener ugc nofollow" target="_blank">本地端口重定向器</a>包装每个端点连接。</p><p id="6141" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“<a class="ae le" href="https://nmap.org/ncat/guide/ncat-ssl.html" rel="noopener ugc nofollow" target="_blank"> ncat </a>的最新nmap包支持内置的动态生成的SSL证书，您可以使用该证书来保护DICOM连接免受网络上的被动嗅探和潜在的主动中间人攻击。这不仅对于加密特别有用，而且作为TCP端口代理也特别有用，因为一些模式具有不能改变的硬编码端口号，例如TCP端口104。使用ncat终止您的连接可能有助于在每个设备上完成额外的配置步骤，以满足多种用例或工程部署需求。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="96aa" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">关闭</h1><p id="12fb" class="pw-post-body-paragraph ki kj it kk b kl ms ju kn ko mt jx kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">我希望您喜欢我们对PACS和DICOM模式的简要介绍。我们部署了两个免费且受欢迎的解决方案，以了解它们在沟通方面有哪些现成的限制。我们还检查了数据包跟踪的网络取证工件、完整性和认证安全问题。当然，对于典型的PACS管理员来说，我们也经历了尽可能多的实际故障排除。一如既往，如果您有任何网络安全需求，请随时拨打<a class="ae le" href="http://www.scisecurity.com" rel="noopener ugc nofollow" target="_blank">www.scisecurity.com</a>联系我。</p><p id="b685" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">获得专家视图— <a class="ae le" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>