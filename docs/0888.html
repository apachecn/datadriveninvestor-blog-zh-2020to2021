<html>
<head>
<title>Delete or Empty MongoDB log file</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">删除或清空MongoDB日志文件</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/delete-or-empty-mongodb-log-file-e6f838b66838?source=collection_archive---------0-----------------------#2020-02-21">https://medium.datadriveninvestor.com/delete-or-empty-mongodb-log-file-e6f838b66838?source=collection_archive---------0-----------------------#2020-02-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/3cfa29201aca549df8f2b7366b410174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7C5sQ36fdT2ZEAfJ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@joelfilip?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joel Filipe</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><figure class="gl gn ke kf kg is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kd"><img src="../Images/21501c33b76b7dac8fb32b3d3ab62fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*nBbnGUOCqGKVg1zNDfh7xA.jpeg"/></div></div></figure><p id="d5c5" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">有时我们的数据库服务器变得缓慢，没有任何原因或错误。那一次我们的思维陷入了错误，我们不认为这可能是导致这个问题的其他原因。这可能是因为大型日志文件导致内存满。</p><div class="ip iq gp gr ir lf"><a href="https://www.datadriveninvestor.com/2019/03/25/a-programmers-guide-to-creating-an-eclectic-bookshelf/" rel="noopener  ugc nofollow" target="_blank"><div class="lg ab fo"><div class="lh ab li cl cj lj"><h2 class="bd jh gy z fp lk fr fs ll fu fw jf bi translated">创建折衷书架的程序员指南</h2><div class="lm l"><h3 class="bd b gy z fp lk fr fs ll fu fw dk translated">每个开发者都应该有一个书架。他的内阁中可能的文本集合是无数的，但不是每一个集合…</h3></div><div class="ln l"><p class="bd b dl z fp lk fr fs ll fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="lo l"><div class="lp l lq lr ls lo lt ix lf"/></div></div></a></div><p id="0e4b" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">日志写入对于任何应用程序跟踪历史都很重要。但是当日志文件变大时，可能会导致磁盘空间问题。特别是对于数据库服务器，这可能会导致性能问题，因为数据库需要连续地写入一个大文件。通过安排定期的日志轮换，我们可以主动避免这种情况，并将日志文件大小保持在预定的阈值以下。让我们开始研究如何解决这个问题。</p><h2 id="1a08" class="lu lv jg bd lw lx ly dn lz ma mb dp mc ks md me mf kw mg mh mi la mj mk ml mm bi translated">步骤1:-检查您的服务器内存</h2><p id="07f2" class="pw-post-body-paragraph kh ki jg kj b kk mn km kn ko mo kq kr ks mp ku kv kw mq ky kz la mr lc ld le ij bi translated">通过<code class="fe ms mt mu mv b">ssh</code>命令进入你的服务器。然后通过下面的命令检查内存。</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="a7d0" class="lu lv jg mv b gy ne nf l ng nh">$ df -h</span><span id="39eb" class="lu lv jg mv b gy ni nf l ng nh"><strong class="mv jh">OutPut:-<br/></strong>Filesystem      Size  Used Avail Use% Mounted on<br/>udev            488M     0  488M   0% /dev<br/>tmpfs           100M  3.3M   96M   4% /run<br/>/dev/xvda1       20G  7.7G   12G  40% /<br/>tmpfs           496M     0  496M   0% /dev/shm<br/>tmpfs           5.0M     0  5.0M   0% /run/lock<br/>tmpfs           496M     0  496M   0% /sys/fs/cgroup<br/>/dev/loop0       92M   92M     0 100% /snap/core/8592<br/>/dev/loop1       92M   92M     0 100% /snap/core/8689<br/>/dev/loop2       18M   18M     0 100% /snap/amazon-ssm-agent/1480<br/>/dev/loop3       18M   18M     0 100% /snap/amazon-ssm-agent/1455<br/>tmpfs           100M     0  100M   0% /run/user/1000</span></pre><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/bfc4ba1660266549af3d45bd75e46833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*ZhNdT-UVho6VZewqfJAGLw.png"/></div></figure><p id="a659" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在这种情况下，内存占40%。</p><h2 id="5bce" class="lu lv jg bd lw lx ly dn lz ma mb dp mc ks md me mf kw mg mh mi la mj mk ml mm bi translated">步骤2:-检查独白的文件大小</h2><p id="564a" class="pw-post-body-paragraph kh ki jg kj b kk mn km kn ko mo kq kr ks mp ku kv kw mq ky kz la mr lc ld le ij bi translated">进入<code class="fe ms mt mu mv b"><strong class="kj jh">mongodb</strong></code> <strong class="kj jh"> </strong>文件夹，运行以下命令检查大小。</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="e85e" class="lu lv jg mv b gy ne nf l ng nh">$ cd /var/log/mongodb<br/>$ ls -l</span></pre><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/aea549f2a485145d2b0e9eaa892bc500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*JQsZrh9fEKhgC_jsuN4-dw.png"/></div></figure><h2 id="b2fb" class="lu lv jg bd lw lx ly dn lz ma mb dp mc ks md me mf kw mg mh mi la mj mk ml mm bi translated">步骤3:-循环日志文件</h2><p id="4fd3" class="pw-post-body-paragraph kh ki jg kj b kk mn km kn ko mo kq kr ks mp ku kv kw mq ky kz la mr lc ld le ij bi translated">在循环中，它生成新的mongod.log文件，并将旧数据保存在另一个文件中。因为我们需要旧的日志来进行分析以及其他许多原因。在MongoDB中，日志不会自动旋转，所以我们需要手动旋转它。通常，MongoDB服务器的日志大小取决于配置的信息级别和配置的慢速日志。</p><p id="8d7f" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">通过运行以下命令进入mongo shell。</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="0db0" class="lu lv jg mv b gy ne nf l ng nh">$ mongo</span></pre><p id="f7bd" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">通过运行以下命令旋转日志。</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="ee73" class="lu lv jg mv b gy ne nf l ng nh">&gt; use admin<br/>&gt; db.adminCommand( { logRotate : 1 } )</span><span id="4f75" class="lu lv jg mv b gy ni nf l ng nh"><strong class="mv jh">OutPut:-</strong></span><span id="e76f" class="lu lv jg mv b gy ni nf l ng nh">{ "ok" : 1 }</span></pre><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/c81da871bae7a0171e9cdd46819d2011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ShtEyETTbUh2lmQr6dP7Q.png"/></div></div></figure><p id="6945" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj jh">步骤4:-删除旧日志</strong></p><p id="26e4" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">现在，进入<code class="fe ms mt mu mv b"><strong class="kj jh">mongodb</strong></code> <strong class="kj jh"> </strong>文件夹，通过<code class="fe ms mt mu mv b">ls</code>命令检查文件。你会看到两个文件，一个是新的mongod.log文件，另一个是<code class="fe ms mt mu mv b">mongod.log.date</code>，旧的日志都在这个文件里。现在，您可以删除该文件。</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/7b33268e8793c28720135b2a64f3e2a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gLX8cVYKNAUXwWDUI-HXSQ.png"/></div></div></figure><p id="9b60" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">这是解决服务器速度慢的方法之一。</p><p id="c007" class="pw-post-body-paragraph kh ki jg kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj jh"> <em class="nn">欢迎在评论区提出任何问题或疑问，或者你可以在脸书上ping我。</em> </strong></p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="no np l"/></div></figure></div></div>    
</body>
</html>