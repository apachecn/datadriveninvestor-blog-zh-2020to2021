<html>
<head>
<title>Why to use Hikari Connection Pool ?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么要使用光连接池？</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/why-to-use-hikari-connection-pool-ce1a482cb9ab?source=collection_archive---------2-----------------------#2020-04-01">https://medium.datadriveninvestor.com/why-to-use-hikari-connection-pool-ce1a482cb9ab?source=collection_archive---------2-----------------------#2020-04-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0c1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客最初发表在我的博客@linqz.io <a class="ae kl" href="https://www.linqz.io/2019/03/why-to-use-hikari-connection-pool.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="98b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://brettwooldridge.github.io/HikariCP/" rel="noopener ugc nofollow" target="_blank">光</a>连接池(或光CP)是这个领域的新生事物，虽然是池机制的后来者，但它的表现优于<a class="ae kl" href="https://github.com/swaldman/c3p0" rel="noopener ugc nofollow" target="_blank"> C3P0 </a>、<a class="ae kl" href="https://commons.apache.org/proper/commons-dbcp/" rel="noopener ugc nofollow" target="_blank"> Apache Commons DBCP </a>、<a class="ae kl" href="http://www.jolbox.com/" rel="noopener ugc nofollow" target="_blank"> BoneCP </a>、<a class="ae kl" href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html" rel="noopener ugc nofollow" target="_blank"> Tomcat </a>、<a class="ae kl" href="http://www.vibur.org/" rel="noopener ugc nofollow" target="_blank"> Vibur </a>等提供的连接池。</p><p id="b522" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的基准图显示了连接和语句ops/ms图:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f5fc2b2bb59c74d9c8d01db15ef7e5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0TZkCkvTaK_pGZEGMu2fA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Hikari Benchmark source : <a class="ae kl" href="https://github.com/brettwooldridge/HikariCP" rel="noopener ugc nofollow" target="_blank">https://github.com/brettwooldridge/HikariCP</a></figcaption></figure><p id="d356" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">许多博客已经写了关于<a class="ae kl" href="https://github.com/brettwooldridge/HikariCP" rel="noopener ugc nofollow" target="_blank"> HikariCP </a>的比较和性能，所以这篇博客试图探索一些内在的复杂问题，例如，为什么它比它的对等连接池更快？有什么特殊代码吗？等等。</p><p id="3b0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后分享了其他资源的链接，这些链接提高了我对HikariCP的理解。</p><h1 id="5787" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">引擎盖下功能:</strong></h1><ul class=""><li id="cabe" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated">字节码简化:HikariCP库已经优化了代码，直到编译的字节码最小，以便CPU缓存可以加载更多的程序代码，这是通过Javassist实现的。(JavaAssist用于通过JDK代理生成动态代理。因为生成的字节数比JDK代理少，所以取消了许多不必要的字节码，从而使它的执行速度更快)</li><li id="bc23" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">代理和拦截器的优化:光库减少了大量代码，例如HikariCP的语句代理只有100行代码。</li><li id="49e9" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">实现FastList 而不是ArrayList是为了避免每次都进行范围检查，因为get()调用也是在remove()调用期间执行的，所以避免了从头到尾的完整数组扫描。ArrayList的remove(Object)方法从头开始遍历数组，而FastList是从数组的末尾开始遍历的，所以当被删除的元素位于末尾时效率会更高，这是通常的情况。以下摘自FastList.java的<a class="ae kl" href="https://github.com/openbouquet/HikariCP/blob/master/src/main/java/com/zaxxer/hikari/util/FastList.java" rel="noopener ugc nofollow" target="_blank"/></li></ul><pre class="kn ko kp kq gt mq mr ms mt aw mu bi"><span id="db4d" class="mv ld iq mr b gy mw mx l my mz">@Override   <br/>public T get(int index)   <br/>{<br/> return elementData[index];   <strong class="mr ir">// no range check of ArrayList</strong><br/>}</span></pre><ul class=""><li id="a049" class="ma mb iq jp b jq jr ju jv jy na kc nb kg nc kk mh mi mj mk bi translated">移除方法实现:</li></ul><pre class="kn ko kp kq gt mq mr ms mt aw mu bi"><span id="1229" class="mv ld iq mr b gy mw mx l my mz"><a class="ae kl" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>public boolean remove(Object element)<br/>{<br/> for (<strong class="mr ir">int index = size - 1; index &gt;= 0; index--</strong>)<br/> {<br/>  if (element == elementData[index])<br/>  {<br/>   final int numMoved = size - index - 1;<br/>   if (numMoved &gt; 0)<br/>   {<br/>    System.arraycopy(elementData, index + 1, elementData, index, numMoved);<br/>   }<br/>   elementData[--size] = null;<br/>   return true;<br/>  }<br/> }<br/> return false;<br/>}</span><span id="0c1d" class="mv ld iq mr b gy nd mx l my mz">}</span></pre><ul class=""><li id="aa11" class="ma mb iq jp b jq jr ju jv jy na kc nb kg nc kk mh mi mj mk bi translated">实现了名为<a class="ae kl" href="https://www.javadoc.io/doc/com.zaxxer/HikariCP/2.6.1/com/zaxxer/hikari/util/ConcurrentBag.html" rel="noopener ugc nofollow" target="_blank"> ConcurrentBag </a>的自定义集合类型，以提高并发读写的效率。</li><li id="b3af" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">ConcurrentBag实现提供了无锁设计、线程本地缓存、队列窃取和直接移交优化，从而实现了高度的并发性、极低的延迟和最小化的错误共享。</li><li id="b8b1" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">实现了与方法调用相关的、占用最小CPU时间片的其他优化。</li><li id="8eb2" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">HikariCP jar大小仅为135KB，由于代码量较小，执行效率较高。根据软件编码实践中的流行说法“代码越低，出现错误的概率越低”，HikariCP的错误数量最少。</li></ul><p id="704f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里 查看ConcurrentBag <a class="ae kl" href="https://github.com/openbouquet/HikariCP/blob/master/src/main/java/com/zaxxer/hikari/util/ConcurrentBag.java" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">的无锁和线程安全实现的源代码。</strong></a></p><p id="a720" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进一步阅读材料:</p><ul class=""><li id="6b1d" class="ma mb iq jp b jq jr ju jv jy na kc nb kg nc kk mh mi mj mk bi translated">如何选择数据库连接池:<a class="ae kl" href="https://techblog.topdesk.com/coding/choosing-a-database-connection-pool/" rel="noopener ugc nofollow" target="_blank">https://tech blog . top desk . com/coding/choosing-a-database-connection-pool/</a></li><li id="373c" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><a class="ae kl" href="http://www.programmersought.com/article/319698001/" rel="noopener ugc nofollow" target="_blank">http://www.programmersought.com/article/319698001/</a></li><li id="0540" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">如何确定池的大小:<a class="ae kl" href="https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing" rel="noopener ugc nofollow" target="_blank">https://github . com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing</a></li><li id="c7a6" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">数据库关闭行为:<a class="ae kl" href="https://github.com/brettwooldridge/HikariCP/wiki/Bad-Behavior:-Handling-Database-Down" rel="noopener ugc nofollow" target="_blank">https://github . com/brettwooldridge/HikariCP/wiki/Bad-Behavior:-Handling-Database-Down</a></li><li id="85bf" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">性能比较1:<a class="ae kl" href="https://www.wix.engineering/blog/how-does-hikaricp-compare-to-other-connection-pools" rel="noopener ugc nofollow" target="_blank">https://www . wix . engineering/blog/how-does-hikaricp-compare-to-other-connection-pools</a></li><li id="a28f" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">性能对比二:<a class="ae kl" href="https://nbsoftsolutions.com/blog/the-difficulty-of-performance-evaluation-of-hikaricp-in-dropwizard" rel="noopener ugc nofollow" target="_blank">https://nbsoftsolutions . com/blog/the-difficult-of-hikaricp-in-drop wizard性能评估难度</a></li><li id="0897" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><a class="ae kl" href="https://blog.jooq.org/2017/02/21/jooq-tuesdays-brett-wooldridge-shows-what-it-takes-to-write-the-fastest-java-connection-pool/" rel="noopener ugc nofollow" target="_blank">https://blog . jooq . org/2017/02/21/jooq-Tuesdays-Brett-wooldridge-shows-what-it-take-to-write-the-fast-Java-connection-pool/</a></li></ul></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="26c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这个博客内容，请考虑买一杯咖啡。谢谢大家的支持！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="http://buymeacoff.ee/cyby0109"><div class="gh gi nl"><img src="../Images/83dc7212ef8502659c81086ad58b8d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*bk_C8Um34KavCkO2yzMCZg.png"/></div></a></figure><p id="7ccc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有问题吗？建议？评论？</p><p id="068d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是什么？<a class="ae kl" href="https://medium.com/@vaibhav0109" rel="noopener"> <strong class="jp ir">在Medium上关注我</strong> </a>成为第一个阅读我故事的人。</p><div class="nm nn gp gr no np"><a href="https://www.datadriveninvestor.com/2020/01/16/software-development-process-how-to-pick-the-right-process/" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">软件开发过程:如何选择正确的过程？数据驱动的投资者</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">软件是任何企业组织成功的生命线。没有软件的帮助，一个…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kw np"/></div></div></a></div><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oe of l"/></div></figure></div></div>    
</body>
</html>