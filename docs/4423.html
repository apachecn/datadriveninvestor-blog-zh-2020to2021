<html>
<head>
<title>Angular — Cleaner Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度-更清晰的代码</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/angular-cleaner-code-5571f861865d?source=collection_archive---------5-----------------------#2020-08-07">https://medium.datadriveninvestor.com/angular-cleaner-code-5571f861865d?source=collection_archive---------5-----------------------#2020-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8173" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Angular是一个基于类型脚本的框架，通过反应式编程来构建复杂的UI密集型应用程序。</h2></div><p id="2b93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">干净的代码不仅仅是可读性，还包括避免编程错误和不必要的复杂逻辑带来的副作用。这是正常的，因为软件规划<em class="le">从来不会</em>按计划进行。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/295fd22bdc6368d7086c017adf18c237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpvk4hmlbp1tJ7mcLRqP0w.png"/></div></div></figure><h1 id="9804" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">1).takeUntil —取消订阅observables</h1><p id="3df1" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">使用反应式/陈述式方法。这个RxJS操作符确保了我们的订阅生命周期，无论是使用AsyncPipe还是。ngOnInit()中的subscribe()将在组件拆卸期间取消订阅</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="eb08" class="mt ls it mp b gy mu mv l mw mx">// <em class="le">app.component.ts</em></span><span id="ecbe" class="mt ls it mp b gy my mv l mw mx">export class AppComponent implements OnDestroy  {</span><span id="d0c6" class="mt ls it mp b gy my mv l mw mx">destroyed$: Subject&lt;boolean&gt; = new Subject();<br/>  messages$: Observable&lt;Message[]&gt; =    this.http.get('/messages').pipe(<strong class="mp iu"><em class="le">takeUntil</em></strong>(<em class="le">this.destroyed$</em>));</span><span id="1f4b" class="mt ls it mp b gy my mv l mw mx">constructor(private http: HttpClient) {}</span><span id="2f4d" class="mt ls it mp b gy my mv l mw mx">ngOnDestroy(): void {<br/>    this.destroyed$.next(true);<br/>    this.destroyed$.unsubscribe();<br/>  }<br/>}</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="1c65" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">2).使用异步管道|始终异步</h1><p id="a29c" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">流是一个随时间变化的<em class="le">值序列</em>。在web应用程序中，通过网络、事件或用户与DOM的交互，输入会随着时间不断变化。</p><p id="ef62" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们最终编写的大部分逻辑只是为了弄清楚<em class="le">哪些</em>函数需要从用户事件中调用。</p><p id="4226" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用异步可观察对象将解析的别名；这确保了组件加载时不会出现问题。</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="f77d" class="mt ls it mp b gy mu mv l mw mx">&lt;div class="message__wrapper" *ngIf="<strong class="mp iu">messages$ | async as <em class="le">messages</em></strong>"&gt;<br/>  &lt;div class="message__item" *ngFor="<strong class="mp iu">let message of <em class="le">messages</em></strong>"&gt;<br/>    ...<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="4438" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">3).嵌套订阅上的切换映射</h1><p id="646e" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">这个RxJS运算符听起来很吓人，其实不然。switchMap 停止从第一个发射的可观测值发射值，并开始从新的可观测值发射项目。</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="5f69" class="mt ls it mp b gy mu mv l mw mx"><strong class="mp iu">// Don't do this...</strong></span><span id="4d9b" class="mt ls it mp b gy my mv l mw mx">this.userService.currentUser$.subscribe(user =&gt; <br/>  this.pageService.getUserPages(user.id).subscribe(pages =&gt;<br/>    this.pages = pages;</span><span id="39d3" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Do this.</strong></span><span id="6b9e" class="mt ls it mp b gy my mv l mw mx">destroyed$: Subject&lt;boolean&gt; = new Subject();<br/>user$: Observable&lt;IUser&gt; = this.userService.currentUser$;<br/>pages: IPages = null;</span><span id="e554" class="mt ls it mp b gy my mv l mw mx">ngOnInit(input: FormInput): void {</span><span id="d03d" class="mt ls it mp b gy my mv l mw mx">user$.pipe(<br/>    takeUntil(this.destroyed$),<br/>    switchMap(({ id }) =&gt; this.pageService.getUserPages(id))<br/>  ).subscribe((pages) =&gt; this.pages = pages);</span><span id="1d42" class="mt ls it mp b gy my mv l mw mx">}</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="c110" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">4).处理装载/进度条</h1><p id="7acc" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">组件内部的代码很容易变得混乱。在处理加载指示器时，避免一些常见的陷阱。</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="52d3" class="mt ls it mp b gy mu mv l mw mx"><strong class="mp iu">// Don't do this...</strong></span><span id="2186" class="mt ls it mp b gy my mv l mw mx">this.isLoading = true;    <br/>  this.pageService.getPages().subscribe(<br/>     (pages: IPages[]) =&gt; {<br/>      if (pages.length) {<br/>        this.pages = pages;</span><span id="04ae" class="mt ls it mp b gy my mv l mw mx">this.firstPage = pages[0];</span><span id="35fb" class="mt ls it mp b gy my mv l mw mx">this.isLoading = false;<br/>      }</span><span id="a9d9" class="mt ls it mp b gy my mv l mw mx">},<br/>     (err) =&gt; this.isLoading = false<br/>);</span><span id="535b" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Do this.</strong><br/>getPages(): void {<br/>  this.isLoading = true;    <br/>  this.pageService.getPages().subscribe(<br/>     (pages) =&gt; this.handlePages(pages),<br/>     (err) =&gt; console.warn(err),<br/>     () =&gt; this.isLoading = false<br/>  );<br/>}</span><span id="a7f5" class="mt ls it mp b gy my mv l mw mx">handlePages(pages: IPages[] | null): void {</span><span id="3f6b" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Validate for undefined or null<br/> // pages is array, <br/> // has property 'length'</strong></span><span id="6e3d" class="mt ls it mp b gy my mv l mw mx">if (pages?.length) {<br/>   this.pages = pages;</span><span id="c109" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Avoid using indexes [0], <br/>   // if needed, use '?.' in like pages?.[0]<br/>   // Destructure first element of the array</strong><br/>   const [ firstPage ] = pages;</span><span id="27cc" class="mt ls it mp b gy my mv l mw mx">this.firstPage = firstPage;<br/>  }<br/>}</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="d3d4" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">如果这对你有帮助，请鼓掌！🙏</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nl"><img src="../Images/310b4e51aaa4b87c9fd2261939a32732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6iaKPnfvW92K2LUrxempHw.gif"/></div></div></figure></div></div>    
</body>
</html>