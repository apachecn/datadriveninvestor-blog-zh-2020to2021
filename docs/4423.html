<html>
<head>
<title>Angular â€” Cleaner Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">è§’åº¦-æ›´æ¸…æ™°çš„ä»£ç </h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.datadriveninvestor.com/angular-cleaner-code-5571f861865d?source=collection_archive---------5-----------------------#2020-08-07">https://medium.datadriveninvestor.com/angular-cleaner-code-5571f861865d?source=collection_archive---------5-----------------------#2020-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8173" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Angularæ˜¯ä¸€ä¸ªåŸºäºç±»å‹è„šæœ¬çš„æ¡†æ¶ï¼Œé€šè¿‡ååº”å¼ç¼–ç¨‹æ¥æ„å»ºå¤æ‚çš„UIå¯†é›†å‹åº”ç”¨ç¨‹åºã€‚</h2></div><p id="2b93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹²å‡€çš„ä»£ç ä¸ä»…ä»…æ˜¯å¯è¯»æ€§ï¼Œè¿˜åŒ…æ‹¬é¿å…ç¼–ç¨‹é”™è¯¯å’Œä¸å¿…è¦çš„å¤æ‚é€»è¾‘å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè½¯ä»¶è§„åˆ’<em class="le">ä»æ¥ä¸ä¼š</em>æŒ‰è®¡åˆ’è¿›è¡Œã€‚</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/295fd22bdc6368d7086c017adf18c237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpvk4hmlbp1tJ7mcLRqP0w.png"/></div></div></figure><h1 id="9804" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">1).takeUntil â€”å–æ¶ˆè®¢é˜…observables</h1><p id="3df1" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">ä½¿ç”¨ååº”å¼/é™ˆè¿°å¼æ–¹æ³•ã€‚è¿™ä¸ªRxJSæ“ä½œç¬¦ç¡®ä¿äº†æˆ‘ä»¬çš„è®¢é˜…ç”Ÿå‘½å‘¨æœŸï¼Œæ— è®ºæ˜¯ä½¿ç”¨AsyncPipeè¿˜æ˜¯ã€‚ngOnInit()ä¸­çš„subscribe()å°†åœ¨ç»„ä»¶æ‹†å¸æœŸé—´å–æ¶ˆè®¢é˜…</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="eb08" class="mt ls it mp b gy mu mv l mw mx">// <em class="le">app.component.ts</em></span><span id="ecbe" class="mt ls it mp b gy my mv l mw mx">export class AppComponent implements OnDestroy  {</span><span id="d0c6" class="mt ls it mp b gy my mv l mw mx">destroyed$: Subject&lt;boolean&gt; = new Subject();<br/>  messages$: Observable&lt;Message[]&gt; =    this.http.get('/messages').pipe(<strong class="mp iu"><em class="le">takeUntil</em></strong>(<em class="le">this.destroyed$</em>));</span><span id="1f4b" class="mt ls it mp b gy my mv l mw mx">constructor(private http: HttpClient) {}</span><span id="2f4d" class="mt ls it mp b gy my mv l mw mx">ngOnDestroy(): void {<br/>    this.destroyed$.next(true);<br/>    this.destroyed$.unsubscribe();<br/>  }<br/>}</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="1c65" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">2).ä½¿ç”¨å¼‚æ­¥ç®¡é“|å§‹ç»ˆå¼‚æ­¥</h1><p id="a29c" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">æµæ˜¯ä¸€ä¸ªéšæ—¶é—´å˜åŒ–çš„<em class="le">å€¼åºåˆ—</em>ã€‚åœ¨webåº”ç”¨ç¨‹åºä¸­ï¼Œé€šè¿‡ç½‘ç»œã€äº‹ä»¶æˆ–ç”¨æˆ·ä¸DOMçš„äº¤äº’ï¼Œè¾“å…¥ä¼šéšç€æ—¶é—´ä¸æ–­å˜åŒ–ã€‚</p><p id="ef62" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬æœ€ç»ˆç¼–å†™çš„å¤§éƒ¨åˆ†é€»è¾‘åªæ˜¯ä¸ºäº†å¼„æ¸…æ¥š<em class="le">å“ªäº›</em>å‡½æ•°éœ€è¦ä»ç”¨æˆ·äº‹ä»¶ä¸­è°ƒç”¨ã€‚</p><p id="4226" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä½¿ç”¨å¼‚æ­¥å¯è§‚å¯Ÿå¯¹è±¡å°†è§£æçš„åˆ«åï¼›è¿™ç¡®ä¿äº†ç»„ä»¶åŠ è½½æ—¶ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="f77d" class="mt ls it mp b gy mu mv l mw mx">&lt;div class="message__wrapper" *ngIf="<strong class="mp iu">messages$ | async as <em class="le">messages</em></strong>"&gt;<br/>  &lt;div class="message__item" *ngFor="<strong class="mp iu">let message of <em class="le">messages</em></strong>"&gt;<br/>    ...<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="4438" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">3).åµŒå¥—è®¢é˜…ä¸Šçš„åˆ‡æ¢æ˜ å°„</h1><p id="646e" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">è¿™ä¸ªRxJSè¿ç®—ç¬¦å¬èµ·æ¥å¾ˆå“äººï¼Œå…¶å®ä¸ç„¶ã€‚switchMap åœæ­¢ä»ç¬¬ä¸€ä¸ªå‘å°„çš„å¯è§‚æµ‹å€¼å‘å°„å€¼ï¼Œå¹¶å¼€å§‹ä»æ–°çš„å¯è§‚æµ‹å€¼å‘å°„é¡¹ç›®ã€‚</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="5f69" class="mt ls it mp b gy mu mv l mw mx"><strong class="mp iu">// Don't do this...</strong></span><span id="4d9b" class="mt ls it mp b gy my mv l mw mx">this.userService.currentUser$.subscribe(user =&gt; <br/>  this.pageService.getUserPages(user.id).subscribe(pages =&gt;<br/>    this.pages = pages;</span><span id="39d3" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Do this.</strong></span><span id="6b9e" class="mt ls it mp b gy my mv l mw mx">destroyed$: Subject&lt;boolean&gt; = new Subject();<br/>user$: Observable&lt;IUser&gt; = this.userService.currentUser$;<br/>pages: IPages = null;</span><span id="e554" class="mt ls it mp b gy my mv l mw mx">ngOnInit(input: FormInput): void {</span><span id="d03d" class="mt ls it mp b gy my mv l mw mx">user$.pipe(<br/>    takeUntil(this.destroyed$),<br/>    switchMap(({ id }) =&gt; this.pageService.getUserPages(id))<br/>  ).subscribe((pages) =&gt; this.pages = pages);</span><span id="1d42" class="mt ls it mp b gy my mv l mw mx">}</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="c110" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">4).å¤„ç†è£…è½½/è¿›åº¦æ¡</h1><p id="7acc" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">ç»„ä»¶å†…éƒ¨çš„ä»£ç å¾ˆå®¹æ˜“å˜å¾—æ··ä¹±ã€‚åœ¨å¤„ç†åŠ è½½æŒ‡ç¤ºå™¨æ—¶ï¼Œé¿å…ä¸€äº›å¸¸è§çš„é™·é˜±ã€‚</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="52d3" class="mt ls it mp b gy mu mv l mw mx"><strong class="mp iu">// Don't do this...</strong></span><span id="2186" class="mt ls it mp b gy my mv l mw mx">this.isLoading = true;    <br/>  this.pageService.getPages().subscribe(<br/>     (pages: IPages[]) =&gt; {<br/>      if (pages.length) {<br/>        this.pages = pages;</span><span id="04ae" class="mt ls it mp b gy my mv l mw mx">this.firstPage = pages[0];</span><span id="35fb" class="mt ls it mp b gy my mv l mw mx">this.isLoading = false;<br/>      }</span><span id="a9d9" class="mt ls it mp b gy my mv l mw mx">},<br/>     (err) =&gt; this.isLoading = false<br/>);</span><span id="535b" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Do this.</strong><br/>getPages(): void {<br/>  this.isLoading = true;    <br/>  this.pageService.getPages().subscribe(<br/>     (pages) =&gt; this.handlePages(pages),<br/>     (err) =&gt; console.warn(err),<br/>     () =&gt; this.isLoading = false<br/>  );<br/>}</span><span id="a7f5" class="mt ls it mp b gy my mv l mw mx">handlePages(pages: IPages[] | null): void {</span><span id="3f6b" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Validate for undefined or null<br/> // pages is array, <br/> // has property 'length'</strong></span><span id="6e3d" class="mt ls it mp b gy my mv l mw mx">if (pages?.length) {<br/>   this.pages = pages;</span><span id="c109" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">// Avoid using indexes [0], <br/>   // if needed, use '?.' in like pages?.[0]<br/>   // Destructure first element of the array</strong><br/>   const [ firstPage ] = pages;</span><span id="27cc" class="mt ls it mp b gy my mv l mw mx">this.firstPage = firstPage;<br/>  }<br/>}</span></pre></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="d3d4" class="lr ls it bd lt lu ng lw lx ly nh ma mb jz ni ka md kc nj kd mf kf nk kg mh mi bi translated">å¦‚æœè¿™å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·é¼“æŒï¼ğŸ™</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nl"><img src="../Images/310b4e51aaa4b87c9fd2261939a32732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6iaKPnfvW92K2LUrxempHw.gif"/></div></div></figure></div></div>    
</body>
</html>