<html>
<head>
<title>How to Deploy a Bitcoin Trading Bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何部署比特币交易机器人</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/deploying-a-bitcoin-trading-bot-eb9998dfc0f5?source=collection_archive---------4-----------------------#2020-08-24">https://medium.datadriveninvestor.com/deploying-a-bitcoin-trading-bot-eb9998dfc0f5?source=collection_archive---------4-----------------------#2020-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b1ed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">机器中的逻辑</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2806437b62496891be12e524405fabbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-FjcZbypyBNVa29y29EIQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://www.coindesk.com/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="aeb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">挑选股票很难，通常需要一些可怜的初级分析师在早上7点将堆积如山的报告输入Excel。</p><p id="c6bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有一个机器人为我们做<strong class="lb iu">有利可图的交易决策</strong>，那不是更简单吗？</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a7f9" class="ma mb it lw b gy mc md l me mf">-------------- Results ---------------</span><span id="685b" class="ma mb it lw b gy mg md l me mf">-------------- Benchmark ---------------<br/>Capital      : 10.00<br/>Final Equity : 10.24<br/>Net profit   : 0.24 (+2.37%)<br/>Max Drawdown : -49.16%<br/>--------------- Strategy ---------------<br/>Capital      : 10.00<br/>Final Equity : 12.29<br/>Net profit   : 2.29 (+22.87%)<br/>Max Drawdown : -21.71%<br/>Sharpe Ratio : 0.86<br/>Sortino Ratio: 1.30<br/>Alpha        : 0.11<br/>Beta         : 0.16<br/>Fees paid    : 0.24<br/>-------------- Statistics --------------<br/>Longs        : 30<br/>Sells        : 30<br/>Shorts       : 21<br/>Covers       : 20<br/>Total Trades : 101<br/>-----------------------------------------</span></pre><p id="6274" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我用<a class="ae ky" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python </a>，技术分析<a class="ae ky" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">，AWS </a>，一个Rasberry Pi和<a class="ae ky" href="https://www.sainsburys.co.uk/gol-ui/product/all-coffee/sainsburys-italian-roasted---ground-coffee-227g" rel="noopener ugc nofollow" target="_blank">一大堆咖啡</a>部署的。这篇文章旨在通过我的旅程来指导你，以便你可以自己运行类似的项目，如果你有任何问题，请让我知道。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="77d7" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">交易策略</h2><p id="c21d" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">技术分析是一门交易学科，使用图表和交易统计数据，而不是公司报告和宏观经济因素。有太多的技术分析交易策略，但我们将专注于用Python写CMO。</p><p id="f243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下公式计算CMO:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e3af69894b56af3f8ed068542751952a.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*Udt4LCodqf7V8uOgSgiwZg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">CMO Calculation (<a class="ae ky" href="https://www.investopedia.com/terms/c/chandemomentumoscillator.asp" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="acdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个结果数字表明资产的“超卖”或“超买”程度。高CMO可能表明资产超买，应建立空头头寸，而低CMO表明资产超卖，应建立多头头寸。</p><p id="0aa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将CMO翻译成Python的过程是这样的:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="89e8" class="ma mb it lw b gy mc md l me mf">for day in range(first_day, final_day):<br/>    if data['close'][day] &gt; data['open'][day]:<br/>        higher_close_price += 1<br/>    elif data['close'][day] &lt; data['open'][day]:<br/>        lower_closing_price += 1<br/><br/># Chande Momentum Oscillator (CMO)<br/>cmo = ((higher_close_price - lower_closing_price) / \<br/>       (higher_close_price + lower_closing_price)) * 100<br/><br/>return cmo</span></pre><p id="7c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次程序运行时，通过回顾过去N天(9)计算CMO，并根据CMO做出交易决策。如果CMO高于50，做空，如果低于-50，做多，当亏损或盈利超过特定阈值时，交易就会结束。</p><p id="f325" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该代码检查这些损失/收益:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="447d" class="ma mb it lw b gy mc md l me mf"># Check to see if we've made gains / losses<br/>for trade in gemini.account.positions:<br/>    if gemini.account.opened_trades[trade.number].price &gt;= data.iloc[-1].high * (1+position_gain_loss):<br/>        close_position_function(gemini=gemini, <br/>                                position=trade, <br/>                                percent=1, <br/>                                price=data.iloc[-1].high)<br/>    elif gemini.account.opened_trades[trade.number].price &lt;= data.iloc[-1].high * (1-position_gain_loss):<br/>        close_position_function(gemini=gemini, <br/>                                position=trade, <br/>                                percent=1, <br/>                                price=data.iloc[-1].high)</span></pre><p id="a4f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码检查是否进行新的交易:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ee4a" class="ma mb it lw b gy mc md l me mf"># CMO &gt; 50 indicates overbought. Go short.<br/>if cmo &gt; cmo_params['OVERBOUGHT_VALUE(0:100)']:<br/>    enter_position_function(gemini, data, position='Short', max_positions=max_positions, risk=risk, minimum_reserves=minimum_reserves)<br/><br/># CMO &lt; -50 indicates oversold. Go long.<br/>if cmo &lt; cmo_params['OVERSOLD_VALUE(-100:0)']:<br/>    enter_position_function(gemini, data, position='Long', max_positions=max_positions, risk=risk, minimum_reserves=minimum_reserves)</span></pre><p id="adf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对这个回购的更广泛的版本感兴趣，给我发消息。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="ef1c" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">使用Gemini进行回溯测试</h2><p id="05bb" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">过去的表现可能不代表未来的结果，但使用回溯测试引擎肯定会增强信心。</p><p id="9278" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我推荐一个名为<a class="ae ky" href="https://github.com/anfederico/Gemini" rel="noopener ugc nofollow" target="_blank"> Gemini </a>的现有回溯测试引擎，这个项目让任何人都可以很容易地测试出自己的加密交易策略。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/717dbdda54045cfb15ae11dd340ce004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1hSKDYypr-scfqMBwn9uug.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Source: <a class="ae ky" href="https://github.com/anfederico/Gemini" rel="noopener ugc nofollow" target="_blank">Gemini</a></figcaption></figure><p id="9691" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Gemini引擎有自己的类，允许你将你的逻辑、参数和绘图工具加载到一个对象中。它还具有有用的帮助功能，允许您以熊猫数据帧的形式从Poloniex crypto exchange加载全面的历史定价信息。</p><p id="35be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">波洛涅克斯交易所</strong> <br/>在波洛涅克斯交易所——不同的“密码对”被交易，例如比特币换以太币或一些Dogecoin换莱特币，这类似于用一些英镑换一些欧元。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/416cea2d3e317944a4b1c98bb7ca0924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KdC4ZElBjvtnySuzQJ8MLQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://poloniex.com/exchange/" rel="noopener ugc nofollow" target="_blank">The Poloniex Exchange</a></figcaption></figure><p id="3c6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该机器人目前专注于比特币以太网市场，<strong class="lb iu">，但肯定会有不同密码对之间的套利阿尔法(hit me up) </strong>。</p><p id="d91d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个使用Poloniex加密交换数据初始化Gemini类的例子。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="609f" class="ma mb it lw b gy mc md l me mf">pair = "ETH_BTC"    # Use ETH pricing data on the BTC market<br/>period = 1800       # Use x second candles<br/>days_history = 300  # Collect y days data<br/><br/># Request data from Poloniex<br/>df = px.load_dataframe(pair, period, days_history)<br/><br/># Algorithm settings<br/>sim_params = {<br/>    'capital_base': 10,      # initial capital in BTC<br/>    'fee': {<br/>        'Long': 0.0025,      # fee settings for Long<br/>        'Short': 0.0025,     # fee settings for Short<br/>    },<br/>    'data_frequency': '1D'    # Time frame to use (see /helpers/timeframe_resampler.py for more info<br/>    # Allowed periods:<br/>    # * T - minute (15T - 15 minutes),<br/>    # * H - hour,<br/>    # * D - day,<br/>    # * W - week,<br/>    # * M - month<br/>}<br/><br/># Load data and settings to backtester core<br/>gemini = gemini_master.Gemini(logic=backtesting_cmo_strategy_logic, sim_params=sim_params, analyze=analyze_bokeh)<br/><br/># Start backtesting custom logic with 10 (BTC) initial capital<br/>gemini.run(df, show_trades=True)</span></pre><p id="e01f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然数据、参数和策略已经加载到Gemini中，运行这个程序将生成一个图表(见本文的顶部),展示特定时期的性能。</p><p id="38dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示，在过去的六个月中部署这种策略是有利可图的(约23%的利润)。绿色和红色分别表示开仓的多头和空头交易，而蓝色(多头)和橙色(空头)表示已经平仓。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/dd81a11f66fe6abaf8ed3f94d765cd5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKAHWOR8S3eMGm04QDiCrA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Bokeh plot of the CMO trading strategy</figcaption></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="ef7d" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">使用Rasberry Pi进行部署</h2><p id="1d1d" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">为了经常运行这些脚本，而不是让它一直在我的笔记本电脑上作为后台进程，我把所有的代码都移到了一个记忆棒上，并下载到了一个Rasberry Pi上。使用下面的CRON命令，脚本被设置为每五分钟运行一次。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ea27" class="ma mb it lw b gy mc md l me mf">*/5 * * * * source /home/pi/Desktop/venvs/crypto_trading/bin/activate &amp;&amp; /home/pi/Desktop/crypto_trading/strategies/cmo_strategy.py</span></pre><p id="404f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个项目之前，无论我在做什么，我总是喜欢使用最新、最辣、最令人兴奋的Python版本。但是他的整个经历让我明白了使用稳定版的价值。我的项目在Pi util上非常不稳定，直到我退回到Python 3.6。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="5c9c" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">优化和改进</h2><blockquote class="no"><p id="1248" class="np nq it bd nr ns nt nu nv nw nx lu dk translated">“如果你不能衡量它，你就不能改善它。”—彼得·德鲁克</p></blockquote><p id="e268" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">为了确保该项目的未来稳定性，回溯测试引擎生成的大量有价值的数据被捕获，这些数据可以插入机器学习模型，以便找到最佳参数(CMO阈值、最大仓位、交易规模、交易对等)，从而实现利润最大化。</p><p id="8bdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集可以通过每次运行该程序时在S3 (AWS Datalake)中捕获的额外数据来增强，下面的Python摘录说明了机器人开始工作时捕获的数据。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8c34" class="ma mb it lw b gy mc md l me mf">session_data = {'cmo': cmo,<br/>                'cmoOverbought': cmo_params['OVERBOUGHT_VALUE(0:100)'],<br/>                'cmoOversold': cmo_params['OVERSOLD_VALUE(-100:0)'],<br/>                'BTC': balance['BTC'],<br/>                'ETH': balance['ETH'],<br/>                'pruchasePrice': purchase_price,<br/>                'sellPrice': sell_price,<br/>                'purchaseAmount': purchase_amount}</span><span id="503b" class="ma mb it lw b gy mg md l me mf">with open(filename, 'w') as file:<br/>    writer = csv.DictWriter(file, session_data.keys())<br/>    writer.writeheader()<br/>    writer.writerow(session_data)<br/><br/>s3_client = boto3.client('s3')<br/><br/>s3_response = s3_client.upload_file(Filename=f'{os.getcwd()}/{filename}',<br/>                                  Bucket=cmo_aws_params['BUCKET_NAME'],<br/>                                    Key=f'{cmo_aws_params["KEY_PARTITIONS"]}/{filename}')</span></pre><p id="bcef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器人还没有产生足够的数据来产生有价值的见解，<strong class="lb iu">但是如果你有兴趣了解未来的优化，访问这些数据或者对解决这个问题的最佳方法有任何想法，请告诉我。</strong></p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="cd25" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">后续步骤和结论</h2><p id="77a8" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">编写交易算法是整个过程中最简单也是最令人兴奋的部分。这个项目的其余时间是配置、部署、测试、完善……这些都是非常重要的事情，但比交易算法或帮助你提前退休的<strong class="lb iu">机器学习机器人要逊色得多。</strong></p><p id="627b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，这个机器人藏在我的沙发后面，每五分钟生成一次交易模式数据。接下来，我将分析数据集，以优化交易模式，并给机器一些真钱。</p><p id="e603" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你需要任何帮助来建立和运行你自己的交易机器人，请告诉我！</p><p id="b921" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看我的YouTube视频，深入了解回溯测试引擎:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><p id="b2bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">访问专家视图— </strong> <a class="ae ky" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>