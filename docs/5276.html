<html>
<head>
<title>Working With Google Analytics BigQuery Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google Analytics BigQuery数据</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/working-with-google-analytics-bigquery-data-10be145149ee?source=collection_archive---------5-----------------------#2020-09-12">https://medium.datadriveninvestor.com/working-with-google-analytics-bigquery-data-10be145149ee?source=collection_archive---------5-----------------------#2020-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f3b7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单指南。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a051da6b98df874a594f60007a26f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TijmZT8JZQ4M8wjd"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@mjessier?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Myriam Jessier</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="91ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">igQuery是一种存储和访问大量数据的强大方法。当您拥有大量千兆字节甚至兆兆字节的数据时，这是非常有用的。</p><p id="3846" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种规模下，需要像谷歌的BigQuery这样的定制服务，因为Excel等工具会在<a class="ae ky" href="https://support.microsoft.com/en-us/office/data-model-specification-and-limits-19aa79f8-e6e8-45a8-9be2-b58778fd68ef" rel="noopener ugc nofollow" target="_blank"> 2 GB </a>时中断，Tableau的建议限制为10 GB，Python的Pandas会很快遇到内存问题。</p><p id="3476" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大量表格数据的一个来源是Google Analytics 360。例如，谷歌公布了来自谷歌商品商店的谷歌分析360数据的<a class="ae ky" href="https://www.kaggle.com/bigquery/google-analytics-sample" rel="noopener ugc nofollow" target="_blank">大查询数据集</a>，其中<a class="ae ky" href="https://www.similarweb.com/website/googlemerchandisestore.com/" rel="noopener ugc nofollow" target="_blank">的月访问量超过10万次</a>。</p><h1 id="27b4" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">读取数据</h1><p id="4fa9" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">如果您有少量的Google Analytics数据，单击报告右上角的“导出”可以很容易地导出为Google Sheet、Excel sheet或CSV。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/496fd2aba0f32e41d4c1ff436f7a0005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*ZpdZOdd0PSgUbEhcKCsImg.png"/></div></figure><p id="0f5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，较大的谷歌分析账户(谷歌分析360)有一个<a class="ae ky" href="https://support.google.com/analytics/answer/3416092?hl=en" rel="noopener ugc nofollow" target="_blank">大查询导出功能</a>。</p><p id="16cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分析BigQuery数据不同于我们习惯的格式——比如CSV。我们不是“打开”或“读取”数据，而是查询它，就像这样:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="a693" class="nh mf it nd b gy ni nj l nk nl">import bq_helper<br/>from bq_helper import BigQueryHelper<br/>google_analytics = bq_helper.BigQueryHelper(active_project="bigquery-public-data",dataset_name="data:google_analytics_sample")</span><span id="203e" class="nh mf it nd b gy nm nj l nk nl">bq_assistant = BigQueryHelper("bigquery-public-data", "google_analytics_sample")<br/><strong class="nd iu">query = """SELECT *<br/>            FROM `bigquery-public-data.google_analytics_sample.ga_sessions_*`<br/>            WHERE<br/>_TABLE_SUFFIX BETWEEN '20170701' AND '20170701'<br/>            """</strong><br/>export = bq_assistant.query_to_pandas_safe(query)<br/>export.to_csv("export.csv")</span></pre><p id="4b3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nd b">query =</code>后面的代码是一个SQL语句，它选择了2017年7月1日以来的所有BigQuery Google Analytics 360会话数据。然后，我使用一个名为<code class="fe nn no np nd b">query_to_pandas_safe</code>的函数将其转换成熊猫数据帧，我可以使用<code class="fe nn no np nd b">to_csv</code>将其导出为CSV。</p><div class="nq nr gp gr ns nt"><a href="https://www.datadriveninvestor.com/2020/08/11/being-good-at-google-is-a-skill/" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">擅长谷歌是一种技能|数据驱动的投资者</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">擅长‘谷歌’是一种技能。是的，你听到了。知道什么和如何谷歌或搜索的东西是一个…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div><h1 id="d191" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">分析数据</h1><p id="18ae" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">使用像<a class="ae ky" href="http://apteo.co" rel="noopener ugc nofollow" target="_blank"> Apteo </a>这样的分析工具，我们可以轻松地连接BigQuery数据，无论是直接从数据源，还是作为我们导出的CSV。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/60271c7e99671a5af0e1a3d9a61cef20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VS-CuTN4n786BlItfHDQZA.png"/></div></div></figure><p id="32b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于简单的统计，比如特定类型的访问次数，我们可以在BigQuery上使用SQL查询，而Apteo让我们无需任何代码就可以轻松地可视化数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/2e6b519710c421be75038285af58d5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHPH5GSwJL548SEh6uoUsw.png"/></div></div></figure><p id="6fb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以从上面看到，大部分流量来自有机搜索(搜索引擎)，其次是社交媒体，直接访问googlemerchandisestore.com<a class="ae ky" href="https://googlemerchandisestore.com/" rel="noopener ugc nofollow" target="_blank"/>(例如点击书签)，少量流量来自付费搜索和推荐链接。</p><p id="7136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过绘制<code class="fe nn no np nd b">customDimensions</code>(包含区域)和<code class="fe nn no np nd b">visitID</code>来想象流量来自哪个区域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/e2e97ba7bdc1659c20b07bea800140bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dTObmld1LR4g637EekgUVA.png"/></div></div></figure><p id="2e58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，北美是流量最大的地区，其次是EMEA(欧洲、中东和非洲)、APAC(亚太地区)，少量流量来自南美和中美。</p><p id="c5b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，可以用类似于典型数据源的方式来分析BigQuery数据。使用像<a class="ae ky" href="http://apteo.co" rel="noopener ugc nofollow" target="_blank"> Apteo </a>这样的工具，您可以直接连接BigQuery源，或者甚至使用我们讨论过的导出函数来创建您最感兴趣的数据子集的CSV。</p><p id="f931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">访问专家视图— </strong> <a class="ae ky" href="https://datadriveninvestor.com/ddi-intel" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">订阅DDI英特尔</strong> </a></p></div></div>    
</body>
</html>