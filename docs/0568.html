<html>
<head>
<title>How to add custom environment variables to your Create-React-App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将自定义环境变量添加到创建-反应-应用程序中</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/how-to-add-custom-environment-variables-to-your-create-react-app-6c336e081075?source=collection_archive---------2-----------------------#2020-02-05">https://medium.datadriveninvestor.com/how-to-add-custom-environment-variables-to-your-create-react-app-6c336e081075?source=collection_archive---------2-----------------------#2020-02-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/1e7ca4e3fa370166eb928a0547ba6609.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*5EMtShJXYtAf7fRtYThlKg.png"/></div></figure><p id="049e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="kv">这篇文章假设你已经使用ReactJS和Docker对web开发和容器有了一个大致的了解。在这篇文章中，我将提供一些关于如何向React应用程序添加自定义环境变量的高级背景知识(注意:仅适用于基于Unix的操作系统)。我假设你用</em><a class="ae kw" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"><em class="kv">create-React-app</em></a><em class="kv">设置了你的React应用，它使用了Webpack、Babel、ESLint等工具。</em></p><p id="46e6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果您已经对React应用程序进行了Dockerised，并且想要注入一些环境变量，那么可以通过在Dockerfile和构建脚本中添加几行代码来实现。</p><figure class="ky kz la lb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi kx"><img src="../Images/ecb936f48ef848d1ad5a556433d6df7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLnu2triJ4ME3PvUAtQMgQ.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@guibolduc?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Guillaume Bolduc</a> on <a class="ae kw" href="https://unsplash.com/s/photos/container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="34ff" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">为什么要注入变量？</h1><h2 id="401e" class="mi ll it bd lm mj mk dn lq ml mm dp lu ki mn mo ly km mp mq mc kq mr ms mg mt bi translated">这是个秘密！</h2><p id="fc78" class="pw-post-body-paragraph jx jy it jz b ka mu kc kd ke mv kg kh ki mw kk kl km mx ko kp kq my ks kt ku im bi translated">也许你想注入某种配置，但不一定想让这些信息在你的应用程序中可见。避免“不安全地”将URL、API键等硬编码(从而共享)到代码中的一种方法是，让容器管理系统在运行时或构建时将它们作为环境变量注入到应用程序中。例如，rancher——containers/Kubernetes集群管理器——能够创建命名的“秘密”用于容器。<a class="ae kw" href="https://kubernetes.io/docs/concepts/configuration/secret/#overview-of-secrets" rel="noopener ugc nofollow" target="_blank"> Secrets </a>存储这些敏感数据(比如密码、令牌和密钥)，当根据他们在Rancher中选择的特定范围将秘密添加到项目或名称空间时，相关的项目所有者可以确保严格控制谁有权访问这些信息。</p><h2 id="ae16" class="mi ll it bd lm mj mk dn lq ml mm dp lu ki mn mo ly km mp mq mc kq mr ms mg mt bi translated">我已经有了哪些环境变量？</h2><p id="8281" class="pw-post-body-paragraph jx jy it jz b ka mu kc kd ke mv kg kh ki mw kk kl km mx ko kp kq my ks kt ku im bi translated">在您的终端中，您可以通过键入<code class="fe mz na nb nc b">export</code>(在您的项目的主目录中)，然后按enter键，看到您的应用程序已经存在的所有环境变量的列表。这将返回如下所示的项目列表:</p><p id="9c4f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe mz na nb nc b">declare -x REACT_APP_&lt;NAME_OF_VARIABLE&gt;="value"</code></p><p id="b265" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在本例中，<code class="fe mz na nb nc b">REACT_APP_</code>是表示React app变量的文本，<code class="fe mz na nb nc b">&lt;NAME_OF_VARIABLE&gt;</code>表示已由用户定义的变量名的一部分。因此，<code class="fe mz na nb nc b">&lt;NAME_OF_VARIABLE&gt;</code>是用户定义的变量名称，<code class="fe mz na nb nc b">“value”</code>表示分配给它的任何值。</p><h1 id="cd64" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">注入环境变量</h1><h2 id="7270" class="mi ll it bd lm mj mk dn lq ml mm dp lu ki mn mo ly km mp mq mc kq mr ms mg mt bi translated">临时变量</h2><p id="66f6" class="pw-post-body-paragraph jx jy it jz b ka mu kc kd ke mv kg kh ki mw kk kl km mx ko kp kq my ks kt ku im bi translated">您可以通过在项目目录下的终端中键入以下命令，将环境变量临时添加到shell中:</p><p id="2702" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe mz na nb nc b">export REACT_APP_&lt;YOUR_NEW_VARIABLE_NAME&gt;="new_value"</code></p><p id="42a5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这对于测试非常有用。只有外壳打开时，变量才会保持“活性”。</p><h2 id="ebe2" class="mi ll it bd lm mj mk dn lq ml mm dp lu ki mn mo ly km mp mq mc kq mr ms mg mt bi translated">注入变量</h2><p id="c96f" class="pw-post-body-paragraph jx jy it jz b ka mu kc kd ke mv kg kh ki mw kk kl km mx ko kp kq my ks kt ku im bi translated">假设你在Rancher中定义了一些变量作为秘密。在您的<strong class="jz iu"> Dockerfile </strong>中，您可以将每个环境变量添加到开发/构建下，如下所示:</p><pre class="ky kz la lb gt nd nc ne nf aw ng bi"><span id="4d78" class="mi ll it nc b gy nh ni l nj nk">ARG REACT_APP_&lt;NAME_OF_VARIABLE&gt;<br/>ENV REACT_APP_&lt;NAME_OF_VARIABLE&gt;=$REACT_APP_&lt;NAME_OF_VARIABLE&gt;</span></pre><p id="8862" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我发现这个<a class="ae kw" href="https://stackoverflow.com/questions/41916386/arg-or-env-which-one-to-use-in-this-case" rel="noopener ugc nofollow" target="_blank">讨论</a>有助于理解ARG和ENV之间的区别。由于Create React App会生成一个静态的HTML/CSS/JS包，根据您自己的特定配置，您可能需要包含这两个包，以便变量在您的应用程序中可用。</p><p id="05ed" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">根据您希望何时注入环境变量，可能会有各种脚本来引用环境变量。</p><p id="11c0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu"> <em class="kv">构建时间</em> </strong></p><p id="0938" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在您的构建脚本中，您可以向构建过程添加一个参数:</p><pre class="ky kz la lb gt nd nc ne nf aw ng bi"><span id="e5e3" class="mi ll it nc b gy nh ni l nj nk">--build-arg="REACT_APP_NAME_OF_VARIABLE=$REACT_APP_NAME_OF_VARIABLE"</span></pre><p id="abd2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu"> <em class="kv">运行时</em> </strong></p><p id="351c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">无论哪个脚本运行您的容器，您都可以将环境变量作为参数添加到docker run命令:</p><pre class="ky kz la lb gt nd nc ne nf aw ng bi"><span id="df05" class="mi ll it nc b gy nh ni l nj nk">-e REACT_APP_NAME_OF_VARIABLE="$RANCHER_VARIABLE_NAME"</span></pre><p id="86df" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在<strong class="jz iu"> App.js </strong>(或者任何你想在你的React前端声明你的变量的地方)，你可以访问环境变量，例如:</p><pre class="ky kz la lb gt nd nc ne nf aw ng bi"><span id="8b0c" class="mi ll it nc b gy nh ni l nj nk">const API_KEY = process.env.REACT_APP_API_KEY</span></pre><p id="7eed" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu"> <em class="kv">定制</em> </strong></p><p id="3fbd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此外，您可以考虑定制<strong class="jz iu"> config/env.js </strong>文件的需求，该文件通常隐藏在Create-React-App中。你可以通过“弹出”你的应用来做到这一点。</p><p id="e84e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请注意，在<strong class="jz iu"> config/env.js </strong>(通常隐藏的脚本之一)中，您的变量会作为<code class="fe mz na nb nc b">getClientEnvironment</code>函数的一部分自动添加到<code class="fe mz na nb nc b">process.env</code>中，因此我不建议您弹出您的应用程序，因为您无法[<a class="ae kw" href="https://stackoverflow.com/questions/51454729/undo-npm-run-eject-in-react" rel="noopener ugc nofollow" target="_blank"/>]轻松地取消弹出它！然而，如果您想确保容器在构建时没有特定变量时抛出错误，或者如果您想添加某些其他定制，那么向该文件中添加您自己的代码可能就是您想要的。</p><figure class="ky kz la lb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi nl"><img src="../Images/e47d3a84a238955610df60562c689b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaJ-Aoy4F0P3C3szX9cvaQ.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@therealsam?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Sam Xu</a> on <a class="ae kw" href="https://unsplash.com/s/photos/stop-sign?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ede3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要弹出React应用程序，使这些脚本变得可见，您可以输入<code class="fe mz na nb nc b">npm run eject</code>。警告:我鼓励继续阅读这些脚本，因为保留它们也有好处！</p><p id="1915" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这将启动从Create React App的构建脚本中弹出的过程，并且意味着您可以在您的文本编辑器中访问这些文件。</p><pre class="ky kz la lb gt nd nc ne nf aw ng bi"><span id="6483" class="mi ll it nc b gy nh ni l nj nk">// Example of customised error handling that has been added in <!-- -->config/env.js</span><span id="9b87" class="mi ll it nc b gy nm ni l nj nk">const REACT_APP_NAME_OF_VARIABLE =     process.env.REACT_APP_NAME_OF_VARIABLE;</span><span id="70e5" class="mi ll it nc b gy nm ni l nj nk">if (!REACT_APP_NAME_OF_VARIABLE) {</span><span id="8e4c" class="mi ll it nc b gy nm ni l nj nk">throw new Error('The REACT_APP_NAME_OF_VARIABLE environment variable is required but was not specified.');</span><span id="2fb8" class="mi ll it nc b gy nm ni l nj nk">}</span></pre><p id="1d59" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你做到了这一步，感谢你的阅读！我希望我的文章能帮助你开始设置环境变量。</p></div></div>    
</body>
</html>