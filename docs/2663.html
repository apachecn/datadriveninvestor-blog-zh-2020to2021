<html>
<head>
<title>Using Matplotlib To Analyze Stock Trends</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Matplotlib分析股票趋势</h1>
<blockquote>原文：<a href="https://medium.datadriveninvestor.com/using-matplotlib-to-analyze-stock-trends-2599332e4530?source=collection_archive---------7-----------------------#2020-05-10">https://medium.datadriveninvestor.com/using-matplotlib-to-analyze-stock-trends-2599332e4530?source=collection_archive---------7-----------------------#2020-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/d5b5fd0bb10f2b0206ad3f8a6fef677a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/0*orbt51BjO3yFPqUh.png"/></div></figure><p id="5495" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在本教程中，我们将学习如何利用Python中的数据可视化来研究公司估值、流动性和运营效率的趋势。</p><p id="afdd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们还将从我在<a class="ae kv" href="https://www.tenquant.io/" rel="noopener ugc nofollow" target="_blank"> TenQuant.io </a>上的API中获取历史财务数据。你可以在网站上免费注册一个API密匙——你可以直接从SEC的数据库中获得早在2010年的财务报表和价格。注册你的API密匙并把它放在安全的地方。</p><p id="805b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在开始任何重大项目之前，最好先做好计划。让我们写出一些类和方法存根，并导入一些我们将要使用的库。打开Python IDE或编辑器，编写以下代码:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="bb11" class="lf lg it lb b gy lh li l lj lk">import matplotlib.pyplot as plt; plt.rcdefaults()<br/>import numpy as np<br/>import matplotlib.pyplot as plt <br/>import requests<br/><br/><br/>class StockPlot:<br/>    def __init__(self, ticker):<br/>        self.ticker = ticker<br/><br/>    # plots a graph of our data over time<br/>    def plot(self):<br/>        pass<br/><br/>    # returns a Dictionary of point-in-time financial data<br/>    def get_financials(self, date='20200101'):<br/>        pass<br/><br/>    # runs calculations and returns the current ratio: current assets - current liabilities<br/>    def get_current_ratio(self, financials):<br/>        pass<br/><br/>    # returns enterprise value to sales<br/>    def get_ev_to_sales(self, financials):<br/>        pass<br/><br/>    # returns ev to ebit, excluding unusual items<br/>    def get_ev_to_ebit(self, financials):<br/>        pass</span></pre><p id="8ba0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这是一种松散的面向对象的方法——请注意，我们将各种特定的计算分解成单一的方法。这有助于我们保持更清晰的代码，并轻松地添加新功能。</p><p id="1abd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">让我们从<a class="ae kv" href="https://www.tenquant.io/" rel="noopener ugc nofollow" target="_blank"> TenQuant.io </a>的财务数据开始:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="9925" class="lf lg it lb b gy lh li l lj lk">def get_financials(self, date='20200101'):<br/>    API_KEY = 'YOUR_KEY_HERE'<br/><br/>    # use an f-string to build your query<br/>    query_url = f'https://api.tenquant.io/historical?key={API_KEY}&amp;date={date}&amp;ticker={self.ticker}'<br/>    financials = requests.get(query_url).json()<br/>    return financials</span></pre><p id="b477" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">该方法将在指定日期返回一个经过清理的标准化财务的JSON表示。</p><p id="cc42" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来，我们需要对这些财务数据进行一些基本的计算，这样我们就可以可视化趋势。我选择了流动比率(因为它可以让我们看到一家公司是否有能力按时履行义务)、EV-to-sales(一种估值指标，衡量收购一家公司的成本与其产生的收入之比)和EV-to-EBIT，这是另一种估值指标，常用于模拟收购一家公司的成本。</p><p id="fbde" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">先说流动比率:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="6f75" class="lf lg it lb b gy lh li l lj lk">def get_current_ratio(self, financials):<br/>    current_assets = financials['currentassets']<br/>    current_liabilities = financials['currentliabilities']<br/>    return current_assets / current_liabilities</span></pre><p id="fd7d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如您所见，这是一个相当简单的计算。低于1或1.5的流动比率可能表明一个公司有在下一年无法偿还债务的危险，除非它能产生足够的现金流来偿还债务。</p><div class="ll lm gp gr ln lo"><a href="https://www.datadriveninvestor.com/2020/03/12/three-simple-questions-and-one-difficult-one-to-ask-before-investing-in-a-blockchain/" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab fo"><div class="lq ab lr cl cj ls"><h2 class="bd iu gy z fp lt fr fs lu fu fw is bi translated">投资区块链前要问的三个简单问题(也是一个困难的问题)|数据…</h2><div class="lv l"><h3 class="bd b gy z fp lt fr fs lu fu fw dk translated">现在是了解区块链的最佳时机。不同货币之间的增长率，比如…</h3></div><div class="lw l"><p class="bd b dl z fp lt fr fs lu fu fw dk translated">www.datadriveninvestor.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc jv lo"/></div></div></a></div><p id="5fb3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来是电动汽车销售。企业价值定义为:[市值]+[债务]-[现金及等价物]。因为有些财务报告不是全年的，我们还需要按年计算报告的收入。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="4876" class="lf lg it lb b gy lh li l lj lk">def get_ev_to_sales(self, financials):<br/>    sales = financials['revenues']<br/>    duration = financials['duration']  # figures are from this many quarters<br/>    cash = financials['currentassets']  # substitute current assets for cash<br/>    debt = financials['liabilities']<br/>    market_cap = financials['marketcap']<br/>    <br/>    annualized_sales = sales / (duration / 4)  # annualize sales<br/>    <br/>    ev = market_cap + debt - cash<br/>    ev_to_sales = ev / annualized_sales<br/>    <br/>    return ev_to_sales</span></pre><p id="b621" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，我们将计算EV-to-EBIT。根据计算方式的不同，EBIT(息税前收益)可以自下而上计算(取净收入，加回利息和税)，也可以自上而下计算(仅计算营业收入)。我们将采用前一种方法，因为它更符合指标的精神，但可能包括非营业收入和费用。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="9408" class="lf lg it lb b gy lh li l lj lk">def get_ev_to_ebit(self, financials):<br/>    net_income = financials['netincomeavailabletocommonstockholdersbasic']<br/>    interest = financials['interestanddebtexpense']<br/>    taxes = financials['incometaxexpensebenefit']<br/>    ebit = net_income + interest + taxes*(-1)  # taxes are recorded as an absolute figure: income/(loss)<br/><br/>    duration = financials['duration']  # figures are from this many quarters<br/>    cash = financials['currentassets']  # substitute current assets for cash<br/>    debt = financials['liabilities']<br/>    market_cap = financials['marketcap']<br/><br/>    annualized_sales = ebit / (duration / 4)<br/><br/>    ev = market_cap + debt - cash<br/>    ev_to_ebit = ev / annualized_sales<br/><br/>    return ev_to_ebit</span></pre><p id="a40e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">太好了！现在，我们需要使用强大的Python数据可视化工具Matplotlib来可视化这些数据点。获取数据并为绘图做好准备:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="38c0" class="lf lg it lb b gy lh li l lj lk">def plot(self):<br/>    dates = ['20160101', '20170101', '20180101', '20190101', '20200101']<br/>    x_pos = np.arange(len(dates))<br/><br/>    # let's use some fancy list comprehension<br/>    # it's fun and makes for cleaner code.<br/>    financials = [self.get_financials(d) for d in dates]<br/>    current_ratios = [self.get_current_ratio(f) for f in financials]<br/>    ev_to_saless = [self.get_ev_to_sales(f) for f in financials]<br/>    ev_to_ebits = [self.get_ev_to_ebit(f) for f in financials]</span></pre><p id="a0dd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在，我们只需要使用Matplotlib生成一些图。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="3f7d" class="lf lg it lb b gy lh li l lj lk"># window 1<br/>plt.figure(1)<br/>plt.bar(x_pos, current_ratios, align='center', alpha=0.5)<br/>plt.xticks(x_pos, dates)<br/><br/>plt.ylabel('Current Ratio')<br/>plt.xlabel('Date')<br/><br/># window 2<br/>plt.figure(2)<br/>plt.bar(x_pos, ev_to_saless, align='center', alpha=0.5)<br/>plt.xticks(x_pos, dates)<br/><br/>plt.ylabel('EV/Sales')<br/>plt.xlabel('Date')<br/><br/># window 3<br/>plt.figure(3)<br/>plt.bar(x_pos, ev_to_ebits, align='center', alpha=0.5)<br/>plt.xticks(x_pos, dates)<br/><br/>plt.ylabel('EV/EBIT')<br/>plt.xlabel('Date')<br/><br/># plot graphs<br/>plt.show()</span></pre><p id="bb4b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，添加这些代码，让你的程序运行起来！</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="1f78" class="lf lg it lb b gy lh li l lj lk">if __name__ == '__main__':<br/>    sp = StockPlot('AAPL')<br/>    sp.plot()</span></pre><p id="5f13" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">你应该会看到三张美丽的图表记录了苹果公司的发展趋势。</p><figure class="kw kx ky kz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/7ec12f152a68ec3aea8860cc9d0d3d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d6-8UUU61HeI4iMy2VH-bQ.png"/></div></div></figure><p id="ab6f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">像往常一样，研究一下这段代码，让它成为你自己的代码。尝试绘制新的变量，改进逻辑，或者尝试新的图表类型。祝你玩Python愉快！</p><p id="1f2c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在我的Github上查看完整的项目:<a class="ae kv" href="https://github.com/hsauers5/StockPlot" rel="noopener ugc nofollow" target="_blank">https://github.com/hsauers5/StockPlot</a></p><figure class="kw kx ky kz gt ju"><div class="bz fp l di"><div class="mi mj l"/></div></figure></div></div>    
</body>
</html>